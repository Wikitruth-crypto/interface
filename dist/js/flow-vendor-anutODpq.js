import{s as e,p as t,z as n,i as o,d as i,a as r,b as s,t as a}from"./vendor-CVSnAKA7.js";const l={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${"source"===e?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},d=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],u=["Enter"," ","Escape"],c={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var h,p,f,g,m,y;(p=h||(h={})).Strict="strict",p.Loose="loose",(g=f||(f={})).Free="free",g.Vertical="vertical",g.Horizontal="horizontal",(y=m||(m={})).Partial="partial",y.Full="full";const x={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var v,w,M,P,b,E;(w=v||(v={})).Bezier="default",w.Straight="straight",w.Step="step",w.SmoothStep="smoothstep",w.SimpleBezier="simplebezier",(P=M||(M={})).Arrow="arrow",P.ArrowClosed="arrowclosed",(E=b||(b={})).Left="left",E.Top="top",E.Right="right",E.Bottom="bottom";const I={[b.Left]:b.Right,[b.Right]:b.Left,[b.Top]:b.Bottom,[b.Bottom]:b.Top};function S(e){return null===e?null:e?"valid":"invalid"}const z=e=>"id"in e&&"source"in e&&"target"in e,N=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),H=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),$=(e,t=[0,0])=>{const{width:n,height:o}=re(e),i=e.origin??t,r=n*i[0],s=o*i[1];return{x:e.position.x-r,y:e.position.y-s}},C=(e,t={nodeOrigin:[0,0]})=>{if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const o="string"==typeof n;let i=t.nodeLookup||o?void 0:n;t.nodeLookup&&(i=o?t.nodeLookup.get(n):H(n)?n:t.nodeLookup.get(n.id));const r=i?W(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return R(e,r)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return G(n)},D=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},o=!1;return e.forEach(e=>{(void 0===t.filter||t.filter(e))&&(n=R(n,W(e)),o=!0)}),o?G(n):{x:0,y:0,width:0,height:0}},T=(e,t,[n,o,i]=[0,0,1],r=!1,s=!1)=>{const a={...J(t,[n,o,i]),width:t.width/i,height:t.height/i},l=[];for(const d of e.values()){const{measured:e,selectable:t=!0,hidden:n=!1}=d;if(s&&!t||n)continue;const o=e.width??d.width??d.initialWidth??null,i=e.height??d.height??d.initialHeight??null,u=K(a,_(d)),c=(o??0)*(i??0),h=r&&u>0;(!d.internals.handleBounds||h||u>=c||d.dragging)&&l.push(d)}return l};async function A({nodes:e,width:t,height:n,panZoom:o,minZoom:i,maxZoom:r},s){if(0===e.size)return Promise.resolve(!0);const a=function(e,t){const n=new Map,o=(null==t?void 0:t.nodes)?new Set(t.nodes.map(e=>e.id)):null;return e.forEach(e=>{!e.measured.width||!e.measured.height||!(null==t?void 0:t.includeHiddenNodes)&&e.hidden||o&&!o.has(e.id)||n.set(e.id,e)}),n}(e,s),l=D(a),d=ne(l,t,n,(null==s?void 0:s.minZoom)??i,(null==s?void 0:s.maxZoom)??r,(null==s?void 0:s.padding)??.1);return await o.setViewport(d,{duration:null==s?void 0:s.duration,ease:null==s?void 0:s.ease,interpolate:null==s?void 0:s.interpolate}),Promise.resolve(!0)}function O({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:i,onError:r}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:d,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},c=s.origin??o;let h=s.extent||i;if("parent"!==s.extent||s.expandParent)a&&ie(s.extent)&&(h=[[s.extent[0][0]+d,s.extent[0][1]+u],[s.extent[1][0]+d,s.extent[1][1]+u]]);else if(a){const e=a.measured.width,t=a.measured.height;e&&t&&(h=[[d,u],[d+e,u+t]])}else null==r||r("005",l.error005());const p=ie(h)?B(t,h,s.measured):t;return void 0!==s.measured.width&&void 0!==s.measured.height||null==r||r("015",l.error015()),{position:{x:p.x-d+(s.measured.width??0)*c[0],y:p.y-u+(s.measured.height??0)*c[1]},positionAbsolute:p}}async function k({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:i}){const r=new Set(e.map(e=>e.id)),s=[];for(const h of n){if(!1===h.deletable)continue;const e=r.has(h.id),t=!e&&h.parentId&&s.find(e=>e.id===h.parentId);(e||t)&&s.push(h)}const a=new Set(t.map(e=>e.id)),l=o.filter(e=>!1!==e.deletable),d=((e,t)=>{const n=new Set;return e.forEach(e=>{n.add(e.id)}),t.filter(e=>n.has(e.source)||n.has(e.target))})(s,l),u=d;for(const h of l){a.has(h.id)&&!u.find(e=>e.id===h.id)&&u.push(h)}if(!i)return{edges:u,nodes:s};const c=await i({nodes:s,edges:u});return"boolean"==typeof c?c?{edges:u,nodes:s}:{edges:[],nodes:[]}:c}const L=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),B=(e={x:0,y:0},t,n)=>({x:L(e.x,t[0][0],t[1][0]-((null==n?void 0:n.width)??0)),y:L(e.y,t[0][1],t[1][1]-((null==n?void 0:n.height)??0))});function Y(e,t,n){const{width:o,height:i}=re(n),{x:r,y:s}=n.internals.positionAbsolute;return B(e,[[r,s],[r+o,s+i]],t)}const V=(e,t,n)=>e<t?L(Math.abs(e-t),1,t)/t:e>n?-L(Math.abs(e-n),1,t)/t:0,X=(e,t,n=15,o=40)=>[V(e.x,o,t.width-o)*n,V(e.y,o,t.height-o)*n],R=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Z=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),G=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),_=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=H(e)?e.internals.positionAbsolute:$(e,t);return{x:i,y:r,width:(null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0,height:(null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0}},W=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=H(e)?e.internals.positionAbsolute:$(e,t);return{x:i,y:r,x2:i+((null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0),y2:r+((null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0)}},F=(e,t)=>G(R(Z(e),Z(t))),K=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},q=e=>j(e.width)&&j(e.height)&&j(e.x)&&j(e.y),j=e=>!isNaN(e)&&isFinite(e),U=(e,t)=>{},Q=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),J=({x:e,y:t},[n,o,i],r=!1,s=[1,1])=>{const a={x:(e-n)/i,y:(t-o)/i};return r?Q(a,s):a},ee=({x:e,y:t},[n,o,i])=>({x:e*i+n,y:t*i+o});function te(e,t){if("number"==typeof e)return Math.floor(.5*(t-t/(1+e)));if("string"==typeof e&&e.endsWith("px")){const t=parseFloat(e);if(!Number.isNaN(t))return Math.floor(t)}if("string"==typeof e&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return 0}const ne=(e,t,n,o,i,r)=>{const s=function(e,t,n){if("string"==typeof e||"number"==typeof e){const o=te(e,n),i=te(e,t);return{top:o,right:i,bottom:o,left:i,x:2*i,y:2*o}}if("object"==typeof e){const o=te(e.top??e.y??0,n),i=te(e.bottom??e.y??0,n),r=te(e.left??e.x??0,t),s=te(e.right??e.x??0,t);return{top:o,right:s,bottom:i,left:r,x:r+s,y:o+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}(r,t,n),a=(t-s.x)/e.width,l=(n-s.y)/e.height,d=Math.min(a,l),u=L(d,o,i),c=t/2-(e.x+e.width/2)*u,h=n/2-(e.y+e.height/2)*u,p=function(e,t,n,o,i,r){const{x:s,y:a}=ee(e,[t,n,o]),{x:l,y:d}=ee({x:e.x+e.width,y:e.y+e.height},[t,n,o]),u=i-l,c=r-d;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(u),bottom:Math.floor(c)}}(e,c,h,u,t,n),f=Math.min(p.left-s.left,0),g=Math.min(p.top-s.top,0);return{x:c-f+Math.min(p.right-s.right,0),y:h-g+Math.min(p.bottom-s.bottom,0),zoom:u}},oe=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0};function ie(e){return null!=e&&"parent"!==e}function re(e){var t,n;return{width:(null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth??0,height:(null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight??0}}function se(e){var t,n;return void 0!==((null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth)&&void 0!==((null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight)}function ae(e,t={width:0,height:0},n,o,i){const r={...e},s=o.get(n);if(s){const e=s.origin||i;r.x+=s.internals.positionAbsolute.x-(t.width??0)*e[0],r.y+=s.internals.positionAbsolute.y-(t.height??0)*e[1]}return r}function le(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function de(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}function ue(e){return{...c,...e||{}}}function ce(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:i}){const{x:r,y:s}=ye(e),a=J({x:r-((null==i?void 0:i.left)??0),y:s-((null==i?void 0:i.top)??0)},o),{x:l,y:d}=n?Q(a,t):a;return{xSnapped:l,ySnapped:d,...a}}const he=e=>({width:e.offsetWidth,height:e.offsetHeight}),pe=e=>{var t;return(null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},fe=["INPUT","SELECT","TEXTAREA"];function ge(e){var t,n;const o=(null==(n=null==(t=e.composedPath)?void 0:t.call(e))?void 0:n[0])||e.target;if(1!==(null==o?void 0:o.nodeType))return!1;return fe.includes(o.nodeName)||o.hasAttribute("contenteditable")||!!o.closest(".nokey")}const me=e=>"clientX"in e,ye=(e,t)=>{var n,o;const i=me(e),r=i?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,s=i?e.clientY:null==(o=e.touches)?void 0:o[0].clientY;return{x:r-((null==t?void 0:t.left)??0),y:s-((null==t?void 0:t.top)??0)}},xe=(e,t,n,o,i)=>{const r=t.querySelectorAll(`.${e}`);return r&&r.length?Array.from(r).map(t=>{const r=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),type:e,nodeId:i,position:t.getAttribute("data-handlepos"),x:(r.left-n.left)/o,y:(r.top-n.top)/o,...he(t)}}):null};function ve({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:i,sourceControlY:r,targetControlX:s,targetControlY:a}){const l=.125*e+.375*i+.375*s+.125*n,d=.125*t+.375*r+.375*a+.125*o;return[l,d,Math.abs(l-e),Math.abs(d-t)]}function we(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Me({pos:e,x1:t,y1:n,x2:o,y2:i,c:r}){switch(e){case b.Left:return[t-we(t-o,r),n];case b.Right:return[t+we(o-t,r),n];case b.Top:return[t,n-we(n-i,r)];case b.Bottom:return[t,n+we(i-n,r)]}}function Pe({sourceX:e,sourceY:t,sourcePosition:n=b.Bottom,targetX:o,targetY:i,targetPosition:r=b.Top,curvature:s=.25}){const[a,l]=Me({pos:n,x1:e,y1:t,x2:o,y2:i,c:s}),[d,u]=Me({pos:r,x1:o,y1:i,x2:e,y2:t,c:s}),[c,h,p,f]=ve({sourceX:e,sourceY:t,targetX:o,targetY:i,sourceControlX:a,sourceControlY:l,targetControlX:d,targetControlY:u});return[`M${e},${t} C${a},${l} ${d},${u} ${o},${i}`,c,h,p,f]}function be({sourceX:e,sourceY:t,targetX:n,targetY:o}){const i=Math.abs(n-e)/2,r=n<e?n+i:n-i,s=Math.abs(o-t)/2;return[r,o<t?o+s:o-s,i,s]}function Ee({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:i=!1}){if(void 0!==o)return o;return(i&&n?1e3:0)+Math.max(e.parentId||i&&e.selected?e.internals.z:0,t.parentId||i&&t.selected?t.internals.z:0)}function Ie({sourceNode:e,targetNode:t,width:n,height:o,transform:i}){const r=R(W(e),W(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:o/i[2]};return K(s,G(r))>0}const Se=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,ze=(e,t)=>{if(!e.source||!e.target)return t;let n;return n=z(e)?{...e}:{...e,id:Se(e)},((e,t)=>t.some(t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))))(n,t)?t:(null===n.sourceHandle&&delete n.sourceHandle,null===n.targetHandle&&delete n.targetHandle,t.concat(n))};function Ne({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[i,r,s,a]=be({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,i,r,s,a]}const He={[b.Left]:{x:-1,y:0},[b.Right]:{x:1,y:0},[b.Top]:{x:0,y:-1},[b.Bottom]:{x:0,y:1}},$e=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Ce({source:e,sourcePosition:t=b.Bottom,target:n,targetPosition:o=b.Top,center:i,offset:r,stepPosition:s}){const a=He[t],l=He[o],d={x:e.x+a.x*r,y:e.y+a.y*r},u={x:n.x+l.x*r,y:n.y+l.y*r},c=(({source:e,sourcePosition:t=b.Bottom,target:n})=>t===b.Left||t===b.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:d,sourcePosition:t,target:u}),h=0!==c.x?"x":"y",p=c[h];let f,g,m=[];const y={x:0,y:0},x={x:0,y:0},[,,v,w]=be({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[h]*l[h]===-1){"x"===h?(f=i.x??d.x+(u.x-d.x)*s,g=i.y??(d.y+u.y)/2):(f=i.x??(d.x+u.x)/2,g=i.y??d.y+(u.y-d.y)*s);const e=[{x:f,y:d.y},{x:f,y:u.y}],t=[{x:d.x,y:g},{x:u.x,y:g}];m=a[h]===p?"x"===h?e:t:"x"===h?t:e}else{const i=[{x:d.x,y:u.y}],s=[{x:u.x,y:d.y}];if(m="x"===h?a.x===p?s:i:a.y===p?i:s,t===o){const t=Math.abs(e[h]-n[h]);if(t<=r){const o=Math.min(r-1,r-t);a[h]===p?y[h]=(d[h]>e[h]?-1:1)*o:x[h]=(u[h]>n[h]?-1:1)*o}}if(t!==o){const e="x"===h?"y":"x",t=a[h]===l[e],n=d[e]>u[e],o=d[e]<u[e];(1===a[h]&&(!t&&n||t&&o)||1!==a[h]&&(!t&&o||t&&n))&&(m="x"===h?i:s)}const c={x:d.x+y.x,y:d.y+y.y},v={x:u.x+x.x,y:u.y+x.y};Math.max(Math.abs(c.x-m[0].x),Math.abs(v.x-m[0].x))>=Math.max(Math.abs(c.y-m[0].y),Math.abs(v.y-m[0].y))?(f=(c.x+v.x)/2,g=m[0].y):(f=m[0].x,g=(c.y+v.y)/2)}return[[e,{x:d.x+y.x,y:d.y+y.y},...m,{x:u.x+x.x,y:u.y+x.y},n],f,g,v,w]}function De({sourceX:e,sourceY:t,sourcePosition:n=b.Bottom,targetX:o,targetY:i,targetPosition:r=b.Top,borderRadius:s=5,centerX:a,centerY:l,offset:d=20,stepPosition:u=.5}){const[c,h,p,f,g]=Ce({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:i},targetPosition:r,center:{x:a,y:l},offset:d,stepPosition:u});return[c.reduce((e,t,n)=>{let o="";return o=n>0&&n<c.length-1?function(e,t,n,o){const i=Math.min($e(e,t)/2,$e(t,n)/2,o),{x:r,y:s}=t;if(e.x===r&&r===n.x||e.y===s&&s===n.y)return`L${r} ${s}`;if(e.y===s)return`L ${r+i*(e.x<n.x?-1:1)},${s}Q ${r},${s} ${r},${s+i*(e.y<n.y?1:-1)}`;const a=e.x<n.x?1:-1;return`L ${r},${s+i*(e.y<n.y?-1:1)}Q ${r},${s} ${r+i*a},${s}`}(c[n-1],t,c[n+1],s):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=o},""),h,p,f,g]}function Te(e){var t;return e&&!(!e.internals.handleBounds&&!(null==(t=e.handles)?void 0:t.length))&&!!(e.measured.width||e.width||e.initialWidth)}function Ae(e){var t;const{sourceNode:n,targetNode:o}=e;if(!Te(n)||!Te(o))return null;const i=n.internals.handleBounds||Oe(n.handles),r=o.internals.handleBounds||Oe(o.handles),s=Le((null==i?void 0:i.source)??[],e.sourceHandle),a=Le(e.connectionMode===h.Strict?(null==r?void 0:r.target)??[]:((null==r?void 0:r.target)??[]).concat((null==r?void 0:r.source)??[]),e.targetHandle);if(!s||!a)return null==(t=e.onError)||t.call(e,"008",l.error008(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const d=(null==s?void 0:s.position)||b.Bottom,u=(null==a?void 0:a.position)||b.Top,c=ke(n,s,d),p=ke(o,a,u);return{sourceX:c.x,sourceY:c.y,targetX:p.x,targetY:p.y,sourcePosition:d,targetPosition:u}}function Oe(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,"source"===o.type?t.push(o):"target"===o.type&&n.push(o);return{source:t,target:n}}function ke(e,t,n=b.Left,o=!1){const i=((null==t?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((null==t?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??re(e);if(o)return{x:i+s/2,y:r+a/2};switch((null==t?void 0:t.position)??n){case b.Top:return{x:i+s/2,y:r};case b.Right:return{x:i+s,y:r+a/2};case b.Bottom:return{x:i+s/2,y:r+a};case b.Left:return{x:i,y:r+a/2}}}function Le(e,t){return e&&(t?e.find(e=>e.id===t):e[0])||null}function Be(e,t){if(!e)return"";if("string"==typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`}function Ye(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:i}){const r=new Set;return e.reduce((e,s)=>([s.markerStart||o,s.markerEnd||i].forEach(o=>{if(o&&"object"==typeof o){const i=Be(o,t);r.has(i)||(e.push({id:i,color:o.color||n,...o}),r.add(i))}}),e),[]).sort((e,t)=>e.id.localeCompare(t.id))}const Ve={nodeOrigin:[0,0],nodeExtent:d,elevateNodesOnSelect:!0,defaults:{}},Xe={...Ve,checkEquality:!0};function Re(e,t){const n={...e};for(const o in t)void 0!==t[o]&&(n[o]=t[o]);return n}function Ze(e,t,n){const o=Re(Ve,n);for(const i of e.values())if(i.parentId)We(i,e,t,o);else{const e=$(i,o.nodeOrigin),t=ie(i.extent)?i.extent:o.nodeExtent,n=B(e,t,re(i));i.internals.positionAbsolute=n}}function Ge(e,t){if(!e.handles)return e.measured?null==t?void 0:t.internals.handleBounds:void 0;const n=[],o=[];for(const i of e.handles){const t={id:i.id,width:i.width??1,height:i.height??1,nodeId:e.id,x:i.x,y:i.y,position:i.position,type:i.type};"source"===i.type?n.push(t):"target"===i.type&&o.push(t)}return{source:n,target:o}}function _e(e,t,n,o){var i,r;const s=Re(Xe,o);let a={i:-1},l=e.length>0;const d=new Map(t),u=(null==s?void 0:s.elevateNodesOnSelect)?1e3:0;t.clear(),n.clear();for(const c of e){let e=d.get(c.id);if(s.checkEquality&&c===(null==e?void 0:e.internals.userNode))t.set(c.id,e);else{const n=$(c,s.nodeOrigin),o=ie(c.extent)?c.extent:s.nodeExtent,a=B(n,o,re(c));e={...s.defaults,...c,measured:{width:null==(i=c.measured)?void 0:i.width,height:null==(r=c.measured)?void 0:r.height},internals:{positionAbsolute:a,handleBounds:Ge(c,e),z:Fe(c,u),userNode:c}},t.set(c.id,e)}void 0!==e.measured&&void 0!==e.measured.width&&void 0!==e.measured.height||e.hidden||(l=!1),c.parentId&&We(e,t,n,o,a)}return l}function We(e,t,n,o,i){const{elevateNodesOnSelect:r,nodeOrigin:s,nodeExtent:a}=Re(Ve,o),l=e.parentId,d=t.get(l);if(!d)return;!function(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}(e,n),i&&!d.parentId&&void 0===d.internals.rootParentIndex&&(d.internals.rootParentIndex=++i.i,d.internals.z=d.internals.z+10*i.i),i&&void 0!==d.internals.rootParentIndex&&(i.i=d.internals.rootParentIndex);const u=r?1e3:0,{x:c,y:h,z:p}=function(e,t,n,o,i){const{x:r,y:s}=t.internals.positionAbsolute,a=re(e),l=$(e,n),d=ie(e.extent)?B(l,e.extent,a):l;let u=B({x:r+d.x,y:s+d.y},o,a);"parent"===e.extent&&(u=Y(u,a,t));const c=Fe(e,i),h=t.internals.z??0;return{x:u.x,y:u.y,z:h>=c?h+1:c}}(e,d,s,a,u),{positionAbsolute:f}=e.internals,g=c!==f.x||h!==f.y;(g||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:c,y:h}:f,z:p}})}function Fe(e,t){return(j(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Ke(e,t,n,o=[0,0]){var i;const r=[],s=new Map;for(const a of e){const e=t.get(a.parentId);if(!e)continue;const n=(null==(i=s.get(a.parentId))?void 0:i.expandedRect)??_(e),o=F(n,a.rect);s.set(a.parentId,{expandedRect:o,parent:e})}return s.size>0&&s.forEach(({expandedRect:t,parent:i},s)=>{var a;const l=i.internals.positionAbsolute,d=re(i),u=i.origin??o,c=t.x<l.x?Math.round(Math.abs(l.x-t.x)):0,h=t.y<l.y?Math.round(Math.abs(l.y-t.y)):0,p=Math.max(d.width,Math.round(t.width)),f=Math.max(d.height,Math.round(t.height)),g=(p-d.width)*u[0],m=(f-d.height)*u[1];(c>0||h>0||g||m)&&(r.push({id:s,type:"position",position:{x:i.position.x-c+g,y:i.position.y-h+m}}),null==(a=n.get(s))||a.forEach(t=>{e.some(e=>e.id===t.id)||r.push({id:t.id,type:"position",position:{x:t.position.x+c,y:t.position.y+h}})})),(d.width<t.width||d.height<t.height||c||h)&&r.push({id:s,type:"dimensions",setAttributes:!0,dimensions:{width:p+(c?u[0]*c-g:0),height:f+(h?u[1]*h-m:0)}})}),r}function qe(e,t,n,o,i,r){const s=null==o?void 0:o.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const l=[],d=window.getComputedStyle(s),{m22:u}=new window.DOMMatrixReadOnly(d.transform),c=[];for(const h of e.values()){const e=t.get(h.id);if(!e)continue;if(e.hidden){t.set(e.id,{...e,internals:{...e.internals,handleBounds:void 0}}),a=!0;continue}const o=he(h.nodeElement),s=e.measured.width!==o.width||e.measured.height!==o.height;if(!(!o.width||!o.height||!s&&e.internals.handleBounds&&!h.force)){const d=h.nodeElement.getBoundingClientRect(),p=ie(e.extent)?e.extent:r;let{positionAbsolute:f}=e.internals;e.parentId&&"parent"===e.extent?f=Y(f,o,t.get(e.parentId)):p&&(f=B(f,p,o));const g={...e,measured:o,internals:{...e.internals,positionAbsolute:f,handleBounds:{source:xe("source",h.nodeElement,d,u,e.id),target:xe("target",h.nodeElement,d,u,e.id)}}};t.set(e.id,g),e.parentId&&We(g,t,n,{nodeOrigin:i}),a=!0,s&&(l.push({id:e.id,type:"dimensions",dimensions:o}),e.expandParent&&e.parentId&&c.push({id:e.id,parentId:e.parentId,rect:_(g,i)}))}}if(c.length>0){const e=Ke(c,t,n,i);l.push(...e)}return{changes:l,updatedInternals:a}}async function je({delta:e,panZoom:t,transform:n,translateExtent:o,width:i,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[i,r]],o),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function Ue(e,t,n,o,i,r){let s=i;const a=o.get(s)||new Map;o.set(s,a.set(n,t)),s=`${i}-${e}`;const l=o.get(s)||new Map;if(o.set(s,l.set(n,t)),r){s=`${i}-${e}-${r}`;const a=o.get(s)||new Map;o.set(s,a.set(n,t))}}function Qe(e,t,n){e.clear(),t.clear();for(const o of n){const{source:n,target:i,sourceHandle:r=null,targetHandle:s=null}=o,a={edgeId:o.id,source:n,target:i,sourceHandle:r,targetHandle:s},l=`${n}-${r}--${i}-${s}`;Ue("source",a,`${i}-${s}--${n}-${r}`,e,n,r),Ue("target",a,l,e,i,s),t.set(o.id,o)}}function Je(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return!!n&&(!!n.selected||Je(n,t))}function et(e,t,n){var o;let i=e;do{if(null==(o=null==i?void 0:i.matches)?void 0:o.call(i,t))return!0;if(i===n)return!1;i=null==i?void 0:i.parentElement}while(i);return!1}function tt({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var i,r,s;const a=[];for(const[d,u]of t){const e=null==(i=n.get(d))?void 0:i.internals.userNode;e&&a.push({...e,position:u.position,dragging:o})}if(!e)return[a[0],a];const l=null==(r=n.get(e))?void 0:r.internals.userNode;return[l?{...l,position:(null==(s=t.get(e))?void 0:s.position)||l.position,dragging:o}:a[0],a]}function nt({onNodeMouseDown:t,getStoreItems:n,onDragStart:o,onDrag:r,onDragStop:s}){let a={x:null,y:null},l=0,d=new Map,u=!1,c={x:0,y:0},h=null,p=!1,f=null,g=!1,m=!1,y=null;return{update:function({noDragClassName:x,handleSelector:v,domNode:w,isSelectable:M,nodeId:P,nodeClickDistance:b=0}){function E({x:e,y:t}){const{nodeLookup:o,nodeExtent:i,snapGrid:s,snapToGrid:l,nodeOrigin:u,onNodeDrag:c,onSelectionDrag:h,onError:p,updateNodePositions:f}=n();a={x:e,y:t};let g=!1;const x=d.size>1,v=x&&i?Z(D(d)):null,w=x&&l?function({dragItems:e,snapGrid:t,x:n,y:o}){const i=e.values().next().value;if(!i)return null;const r={x:n-i.distance.x,y:o-i.distance.y},s=Q(r,t);return{x:s.x-r.x,y:s.y-r.y}}({dragItems:d,snapGrid:s,x:e,y:t}):null;for(const[n,r]of d){if(!o.has(n))continue;let a={x:e-r.distance.x,y:t-r.distance.y};l&&(a=w?{x:Math.round(a.x+w.x),y:Math.round(a.y+w.y)}:Q(a,s));let d=null;if(x&&i&&!r.extent&&v){const{positionAbsolute:e}=r.internals,t=e.x-v.x+i[0][0],n=e.x+r.measured.width-v.x2+i[1][0];d=[[t,e.y-v.y+i[0][1]],[n,e.y+r.measured.height-v.y2+i[1][1]]]}const{position:c,positionAbsolute:h}=O({nodeId:n,nextPosition:a,nodeLookup:o,nodeExtent:d||i,nodeOrigin:u,onError:p});g=g||r.position.x!==c.x||r.position.y!==c.y,r.position=c,r.internals.positionAbsolute=h}if(m=m||g,g&&(f(d,!0),y&&(r||c||!P&&h))){const[e,t]=tt({nodeId:P,dragItems:d,nodeLookup:o});null==r||r(y,d,e,t),null==c||c(y,e,t),P||null==h||h(y,t)}}async function I(){if(!h)return;const{transform:e,panBy:t,autoPanSpeed:o,autoPanOnNodeDrag:i}=n();if(!i)return u=!1,void cancelAnimationFrame(l);const[r,s]=X(c,h,o);0===r&&0===s||(a.x=(a.x??0)-r/e[2],a.y=(a.y??0)-s/e[2],await t({x:r,y:s})&&E(a)),l=requestAnimationFrame(I)}function S(e){var i;const{nodeLookup:r,multiSelectionActive:s,nodesDraggable:l,transform:u,snapGrid:c,snapToGrid:f,selectNodesOnDrag:g,onNodeDragStart:m,onSelectionDragStart:y,unselectNodesAndEdges:x}=n();p=!0,g&&M||s||!P||(null==(i=r.get(P))?void 0:i.selected)||x(),M&&g&&P&&(null==t||t(P));const v=ce(e.sourceEvent,{transform:u,snapGrid:c,snapToGrid:f,containerBounds:h});if(a=v,d=function(e,t,n,o){const i=new Map;for(const[r,s]of e)if((s.selected||s.id===o)&&(!s.parentId||!Je(s,e))&&(s.draggable||t&&void 0===s.draggable)){const t=e.get(r);t&&i.set(r,{id:r,position:t.position||{x:0,y:0},distance:{x:n.x-t.internals.positionAbsolute.x,y:n.y-t.internals.positionAbsolute.y},extent:t.extent,parentId:t.parentId,origin:t.origin,expandParent:t.expandParent,internals:{positionAbsolute:t.internals.positionAbsolute||{x:0,y:0}},measured:{width:t.measured.width??0,height:t.measured.height??0}})}return i}(r,l,v,P),d.size>0&&(o||m||!P&&y)){const[t,n]=tt({nodeId:P,dragItems:d,nodeLookup:r});null==o||o(e.sourceEvent,d,t,n),null==m||m(e.sourceEvent,t,n),P||null==y||y(e.sourceEvent,n)}}f=e(w);const z=i().clickDistance(b).on("start",e=>{const{domNode:t,nodeDragThreshold:o,transform:i,snapGrid:r,snapToGrid:s}=n();h=(null==t?void 0:t.getBoundingClientRect())||null,g=!1,m=!1,y=e.sourceEvent,0===o&&S(e);const l=ce(e.sourceEvent,{transform:i,snapGrid:r,snapToGrid:s,containerBounds:h});a=l,c=ye(e.sourceEvent,h)}).on("drag",e=>{const{autoPanOnNodeDrag:t,transform:o,snapGrid:i,snapToGrid:r,nodeDragThreshold:s,nodeLookup:l}=n(),f=ce(e.sourceEvent,{transform:o,snapGrid:i,snapToGrid:r,containerBounds:h});if(y=e.sourceEvent,("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1||P&&!l.has(P))&&(g=!0),!g){if(!u&&t&&p&&(u=!0,I()),!p){const t=ye(e.sourceEvent,h),n=t.x-c.x,o=t.y-c.y;Math.sqrt(n*n+o*o)>s&&S(e)}(a.x!==f.xSnapped||a.y!==f.ySnapped)&&d&&p&&(c=ye(e.sourceEvent,h),E(f))}}).on("end",e=>{if(p&&!g&&(u=!1,p=!1,cancelAnimationFrame(l),d.size>0)){const{nodeLookup:t,updateNodePositions:o,onNodeDragStop:i,onSelectionDragStop:r}=n();if(m&&(o(d,!1),m=!1),s||i||!P&&r){const[n,o]=tt({nodeId:P,dragItems:d,nodeLookup:t,dragging:!1});null==s||s(e.sourceEvent,d,n,o),null==i||i(e.sourceEvent,n,o),P||null==r||r(e.sourceEvent,o)}}}).filter(e=>{const t=e.target;return!e.button&&(!x||!et(t,`.${x}`,w))&&(!v||et(t,v,w))});f.call(z)},destroy:function(){null==f||f.on(".drag",null)}}}function ot(e,t,n,o){var i,r;let s=[],a=1/0;const l=function(e,t,n){const o=[],i={x:e.x-n,y:e.y-n,width:2*n,height:2*n};for(const r of t.values())K(i,_(r))>0&&o.push(r);return o}(e,n,t+250);for(const d of l){const n=[...(null==(i=d.internals.handleBounds)?void 0:i.source)??[],...(null==(r=d.internals.handleBounds)?void 0:r.target)??[]];for(const i of n){if(o.nodeId===i.nodeId&&o.type===i.type&&o.id===i.id)continue;const{x:n,y:r}=ke(d,i,i.position,!0),l=Math.sqrt(Math.pow(n-e.x,2)+Math.pow(r-e.y,2));l>t||(l<a?(s=[{...i,x:n,y:r}],a=l):l===a&&s.push({...i,x:n,y:r}))}}if(!s.length)return null;if(s.length>1){const e="source"===o.type?"target":"source";return s.find(t=>t.type===e)??s[0]}return s[0]}function it(e,t,n,o,i,r=!1){var s,a,l;const d=o.get(e);if(!d)return null;const u="strict"===i?null==(s=d.internals.handleBounds)?void 0:s[t]:[...(null==(a=d.internals.handleBounds)?void 0:a.source)??[],...(null==(l=d.internals.handleBounds)?void 0:l.target)??[]],c=(n?null==u?void 0:u.find(e=>e.id===n):null==u?void 0:u[0])??null;return c&&r?{...c,...ke(d,c,c.position,!0)}:c}function rt(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}const st=()=>!0;function at(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:i,fromType:r,doc:s,lib:a,flowId:l,isValidConnection:d=st,nodeLookup:u}){const c="target"===r,p=t?s.querySelector(`.${a}-flow__handle[data-id="${l}-${null==t?void 0:t.nodeId}-${null==t?void 0:t.id}-${null==t?void 0:t.type}"]`):null,{x:f,y:g}=ye(e),m=s.elementFromPoint(f,g),y=(null==m?void 0:m.classList.contains(`${a}-flow__handle`))?m:p,x={handleDomNode:y,isValid:!1,connection:null,toHandle:null};if(y){const e=rt(void 0,y),t=y.getAttribute("data-nodeid"),r=y.getAttribute("data-handleid"),s=y.classList.contains("connectable"),a=y.classList.contains("connectableend");if(!t||!e)return x;const l={source:c?t:o,sourceHandle:c?r:i,target:c?o:t,targetHandle:c?i:r};x.connection=l;const p=s&&a&&(n===h.Strict?c&&"source"===e||!c&&"target"===e:t!==o||r!==i);x.isValid=p&&d(l),x.toHandle=it(t,e,r,u,n,!0)}return x}const lt={onPointerDown:function(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:i,edgeUpdaterType:r,isTarget:s,domNode:a,nodeLookup:l,lib:d,autoPanOnConnect:u,flowId:c,panBy:h,cancelConnection:p,onConnectStart:f,onConnect:g,onConnectEnd:m,isValidConnection:y=st,onReconnectEnd:x,updateConnection:v,getTransform:w,getFromHandle:M,autoPanSpeed:P,dragThreshold:E=1,handleDomNode:S}){const z=pe(e.target);let N,H=0;const{x:$,y:C}=ye(e),D=rt(r,S),T=null==a?void 0:a.getBoundingClientRect();let A=!1;if(!T||!D)return;const O=it(i,D,o,l,t);if(!O)return;let k=ye(e,T),L=!1,B=null,Y=!1,V=null;function R(){if(!u||!T)return;const[e,t]=X(k,T,P);h({x:e,y:t}),H=requestAnimationFrame(R)}const Z={...O,nodeId:i,type:D,position:O.position},G=l.get(i);let _={inProgress:!0,isValid:null,from:ke(G,Z,b.Left,!0),fromHandle:Z,fromPosition:Z.position,fromNode:G,to:k,toHandle:null,toPosition:I[Z.position],toNode:null};function W(){A=!0,v(_),null==f||f(e,{nodeId:i,handleId:o,handleType:D})}function F(e){if(!A){const{x:t,y:n}=ye(e),o=t-$,i=n-C;if(!(o*o+i*i>E*E))return;W()}if(!M()||!Z)return void K(e);const r=w();k=ye(e,T),N=ot(J(k,r,!1,[1,1]),n,l,Z),L||(R(),L=!0);const a=at(e,{handle:N,connectionMode:t,fromNodeId:i,fromHandleId:o,fromType:s?"target":"source",isValidConnection:y,doc:z,lib:d,flowId:c,nodeLookup:l});V=a.handleDomNode,B=a.connection,Y=function(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}(!!N,a.isValid);const u={..._,isValid:Y,to:a.toHandle&&Y?ee({x:a.toHandle.x,y:a.toHandle.y},r):k,toHandle:a.toHandle,toPosition:Y&&a.toHandle?a.toHandle.position:I[Z.position],toNode:a.toHandle?l.get(a.toHandle.nodeId):null};Y&&N&&_.toHandle&&u.toHandle&&_.toHandle.type===u.toHandle.type&&_.toHandle.nodeId===u.toHandle.nodeId&&_.toHandle.id===u.toHandle.id&&_.to.x===u.to.x&&_.to.y===u.to.y||(v(u),_=u)}function K(e){if(!("touches"in e&&e.touches.length>0)){if(A){(N||V)&&B&&Y&&(null==g||g(B));const{inProgress:t,...n}=_,o={...n,toPosition:_.toHandle?_.toPosition:null};null==m||m(e,o),r&&(null==x||x(e,o))}p(),cancelAnimationFrame(H),L=!1,Y=!1,B=null,V=null,z.removeEventListener("mousemove",F),z.removeEventListener("mouseup",K),z.removeEventListener("touchmove",F),z.removeEventListener("touchend",K)}}0===E&&W(),z.addEventListener("mousemove",F),z.addEventListener("mouseup",K),z.addEventListener("touchmove",F),z.addEventListener("touchend",K)},isValid:at};function dt({domNode:o,panZoom:i,getTransform:r,getViewScale:s}){const a=e(o);return{update:function({translateExtent:e,width:t,height:o,zoomStep:l=1,pannable:d=!0,zoomable:u=!0,inversePan:c=!1}){let h=[0,0];const p=n().on("start",e=>{"mousedown"!==e.sourceEvent.type&&"touchstart"!==e.sourceEvent.type||(h=[e.sourceEvent.clientX??e.sourceEvent.touches[0].clientX,e.sourceEvent.clientY??e.sourceEvent.touches[0].clientY])}).on("zoom",d?n=>{const a=r();if("mousemove"!==n.sourceEvent.type&&"touchmove"!==n.sourceEvent.type||!i)return;const l=[n.sourceEvent.clientX??n.sourceEvent.touches[0].clientX,n.sourceEvent.clientY??n.sourceEvent.touches[0].clientY],d=[l[0]-h[0],l[1]-h[1]];h=l;const u=s()*Math.max(a[2],Math.log(a[2]))*(c?-1:1),p={x:a[0]-d[0]*u,y:a[1]-d[1]*u},f=[[0,0],[t,o]];i.setViewportConstrained({x:p.x,y:p.y,zoom:a[2]},f,e)}:null).on("zoom.wheel",u?e=>{if("wheel"!==e.sourceEvent.type||!i)return;const t=r(),n=e.sourceEvent.ctrlKey&&oe()?10:1,o=-e.sourceEvent.deltaY*(1===e.sourceEvent.deltaMode?.05:e.sourceEvent.deltaMode?1:.002)*l,s=t[2]*Math.pow(2,o*n);i.scaleTo(s)}:null);a.call(p,{})},destroy:function(){a.on("zoom",null)},pointer:t}}const ut=e=>({x:e.x,y:e.y,zoom:e.k}),ct=({x:e,y:t,zoom:n})=>o.translate(e,t).scale(n),ht=(e,t)=>e.target.closest(`.${t}`),pt=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),ft=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,gt=(e,t=0,n=ft,o=()=>{})=>{const i="number"==typeof t&&t>0;return i||o(),i?e.transition().duration(t).ease(n).on("end",o):e},mt=e=>{const t=e.ctrlKey&&oe()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t};function yt({domNode:o,minZoom:i,maxZoom:l,translateExtent:d,viewport:u,onPanZoom:c,onPanZoomStart:h,onPanZoomEnd:p,onDraggingChange:g}){const m={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},y=o.getBoundingClientRect(),x=n().scaleExtent([i,l]).translateExtent(d),v=e(o).call(x);E({x:u.x,y:u.y,zoom:L(u.zoom,i,l)},[[0,0],[y.width,y.height]],d);const w=v.on("wheel.zoom"),M=v.on("dblclick.zoom");function P(e,t){return v?new Promise(n=>{null==x||x.interpolate("linear"===(null==t?void 0:t.interpolate)?s:r).transform(gt(v,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)}function b(){x.on("zoom",null)}async function E(e,t,n){const o=ct(e),i=null==x?void 0:x.constrain()(o,t,n);return i&&await P(i),new Promise(e=>e(i))}return x.wheelDelta(mt),{update:function({noWheelClassName:e,noPanClassName:n,onPaneContextMenu:o,userSelectionActive:i,panOnScroll:r,panOnDrag:s,panOnScrollMode:a,panOnScrollSpeed:l,preventScrolling:d,zoomOnPinch:u,zoomOnScroll:y,zoomOnDoubleClick:P,zoomActivationKeyPressed:E,lib:I,onTransformChange:S,connectionInProgress:z,paneClickDistance:N,selectionOnDrag:H}){i&&!m.isZoomingOrPanning&&b();const $=r&&!E&&!i;x.clickDistance(H?1/0:!j(N)||N<0?0:N);const C=$?function({zoomPanValues:e,noWheelClassName:n,d3Selection:o,d3Zoom:i,panOnScrollMode:r,panOnScrollSpeed:s,zoomOnPinch:a,onPanZoomStart:l,onPanZoom:d,onPanZoomEnd:u}){return c=>{if(ht(c,n))return c.ctrlKey&&c.preventDefault(),!1;c.preventDefault(),c.stopImmediatePropagation();const h=o.property("__zoom").k||1;if(c.ctrlKey&&a){const e=t(c),n=mt(c),r=h*Math.pow(2,n);return void i.scaleTo(o,r,e,c)}const p=1===c.deltaMode?20:1;let g=r===f.Vertical?0:c.deltaX*p,m=r===f.Horizontal?0:c.deltaY*p;!oe()&&c.shiftKey&&r!==f.Vertical&&(g=c.deltaY*p,m=0),i.translateBy(o,-g/h*s,-m/h*s,{internal:!0});const y=ut(o.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(null==d||d(c,y),e.panScrollTimeout=setTimeout(()=>{null==u||u(c,y),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,null==l||l(c,y))}}({zoomPanValues:m,noWheelClassName:e,d3Selection:v,d3Zoom:x,panOnScrollMode:a,panOnScrollSpeed:l,zoomOnPinch:u,onPanZoomStart:h,onPanZoom:c,onPanZoomEnd:p}):function({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,i){const r="wheel"===o.type,s=!t&&r&&!o.ctrlKey,a=ht(o,e);if(o.ctrlKey&&r&&a&&o.preventDefault(),s||a)return null;o.preventDefault(),n.call(this,o,i)}}({noWheelClassName:e,preventScrolling:d,d3ZoomHandler:w});if(v.on("wheel.zoom",C,{passive:!1}),!i){const e=function({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var i,r,s;if(null==(i=o.sourceEvent)?void 0:i.internal)return;const a=ut(o.transform);e.mouseButton=(null==(r=o.sourceEvent)?void 0:r.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=a,"mousedown"===(null==(s=o.sourceEvent)?void 0:s.type)&&t(!0),n&&(null==n||n(o.sourceEvent,a))}}({zoomPanValues:m,onDraggingChange:g,onPanZoomStart:h});x.on("start",e);const t=function({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:i}){return r=>{var s,a;e.usedRightMouseButton=!(!n||!pt(t,e.mouseButton??0)),(null==(s=r.sourceEvent)?void 0:s.sync)||o([r.transform.x,r.transform.y,r.transform.k]),i&&!(null==(a=r.sourceEvent)?void 0:a.internal)&&(null==i||i(r.sourceEvent,ut(r.transform)))}}({zoomPanValues:m,panOnDrag:s,onPaneContextMenu:!!o,onPanZoom:c,onTransformChange:S});x.on("zoom",t);const n=function({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:i,onPaneContextMenu:r}){return s=>{var a;if(!(null==(a=s.sourceEvent)?void 0:a.internal)&&(e.isZoomingOrPanning=!1,r&&pt(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&r(s.sourceEvent),e.usedRightMouseButton=!1,o(!1),i)){const t=ut(s.transform);e.prevViewport=t,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{null==i||i(s.sourceEvent,t)},n?150:0)}}}({zoomPanValues:m,panOnDrag:s,panOnScroll:r,onPaneContextMenu:o,onPanZoomEnd:p,onDraggingChange:g});x.on("end",n)}const D=function({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:i,zoomOnDoubleClick:r,userSelectionActive:s,noWheelClassName:a,noPanClassName:l,lib:d,connectionInProgress:u}){return c=>{var h;const p=e||t,f=n&&c.ctrlKey,g="wheel"===c.type;if(1===c.button&&"mousedown"===c.type&&(ht(c,`${d}-flow__node`)||ht(c,`${d}-flow__edge`)))return!0;if(!(o||p||i||r||n))return!1;if(s)return!1;if(u&&!g)return!1;if(ht(c,a)&&g)return!1;if(ht(c,l)&&(!g||i&&g&&!e))return!1;if(!n&&c.ctrlKey&&g)return!1;if(!n&&"touchstart"===c.type&&(null==(h=c.touches)?void 0:h.length)>1)return c.preventDefault(),!1;if(!p&&!i&&!f&&g)return!1;if(!o&&("mousedown"===c.type||"touchstart"===c.type))return!1;if(Array.isArray(o)&&!o.includes(c.button)&&"mousedown"===c.type)return!1;const m=Array.isArray(o)&&o.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||g)&&m}}({zoomActivationKeyPressed:E,panOnDrag:s,zoomOnScroll:y,panOnScroll:r,zoomOnDoubleClick:P,zoomOnPinch:u,userSelectionActive:i,noPanClassName:n,noWheelClassName:e,lib:I,connectionInProgress:z});x.filter(D),P?v.on("dblclick.zoom",M):v.on("dblclick.zoom",null)},destroy:b,setViewport:async function(e,t){const n=ct(e);return await P(n,t),new Promise(e=>e(n))},setViewportConstrained:E,getViewport:function(){const e=v?a(v.node()):{x:0,y:0,k:1};return{x:e.x,y:e.y,zoom:e.k}},scaleTo:function(e,t){return v?new Promise(n=>{null==x||x.interpolate("linear"===(null==t?void 0:t.interpolate)?s:r).scaleTo(gt(v,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},scaleBy:function(e,t){return v?new Promise(n=>{null==x||x.interpolate("linear"===(null==t?void 0:t.interpolate)?s:r).scaleBy(gt(v,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},setScaleExtent:function(e){null==x||x.scaleExtent(e)},setTranslateExtent:function(e){null==x||x.translateExtent(e)},syncViewport:function(e){if(v){const t=ct(e),n=v.property("__zoom");n.k===e.zoom&&n.x===e.x&&n.y===e.y||null==x||x.transform(v,t,null,{sync:!0})}},setClickDistance:function(e){const t=!j(e)||e<0?0:e;null==x||x.clickDistance(t)}}}var xt,vt;function wt(e){return{isHorizontal:e.includes("right")||e.includes("left"),isVertical:e.includes("bottom")||e.includes("top"),affectsX:e.includes("left"),affectsY:e.includes("top")}}function Mt(e,t){return Math.max(0,t-e)}function Pt(e,t){return Math.max(0,e-t)}function bt(e,t,n){return Math.max(0,t-e,e-n)}function Et(e,t){return e?!t:t}(vt=xt||(xt={})).Line="line",vt.Handle="handle";const It={width:0,height:0,x:0,y:0},St={...It,pointerX:0,pointerY:0,aspectRatio:1};function zt(e,t,n){const o=t.position.x+e.position.x,i=t.position.y+e.position.y,r=e.measured.width??0,s=e.measured.height??0,a=n[0]*r,l=n[1]*s;return[[o-a,i-l],[o+r-a,i+s-l]]}function Nt({domNode:t,nodeId:n,getStoreItems:o,onChange:r,onEnd:s}){const a=e(t);let l={controlDirection:wt("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};return{update:function({controlPosition:e,boundaries:t,keepAspectRatio:d,resizeDirection:u,onResizeStart:c,onResize:h,onResizeEnd:p,shouldResize:f}){let g,m={...It},y={...St};l={boundaries:t,resizeDirection:u,keepAspectRatio:d,controlDirection:wt(e)};let x,v,w,M=null,P=[],b=!1;const E=i().on("start",e=>{const{nodeLookup:t,transform:i,snapGrid:r,snapToGrid:s,nodeOrigin:a,paneDomNode:l}=o();if(g=t.get(n),!g)return;M=(null==l?void 0:l.getBoundingClientRect())??null;const{xSnapped:d,ySnapped:u}=ce(e.sourceEvent,{transform:i,snapGrid:r,snapToGrid:s,containerBounds:M});m={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},y={...m,pointerX:d,pointerY:u,aspectRatio:m.width/m.height},x=void 0,g.parentId&&("parent"===g.extent||g.expandParent)&&(x=t.get(g.parentId),v=x&&"parent"===g.extent?function(e){return[[0,0],[e.measured.width,e.measured.height]]}(x):void 0),P=[],w=void 0;for(const[o,c]of t)if(c.parentId===n&&(P.push({id:o,position:{...c.position},extent:c.extent}),"parent"===c.extent||c.expandParent)){const e=zt(c,g,c.origin??a);w=w?[[Math.min(e[0][0],w[0][0]),Math.min(e[0][1],w[0][1])],[Math.max(e[1][0],w[1][0]),Math.max(e[1][1],w[1][1])]]:e}null==c||c(e,{...m})}).on("drag",e=>{const{transform:t,snapGrid:n,snapToGrid:i,nodeOrigin:s}=o(),a=ce(e.sourceEvent,{transform:t,snapGrid:n,snapToGrid:i,containerBounds:M}),d=[];if(!g)return;const{x:u,y:c,width:p,height:E}=m,I={},S=g.origin??s,{width:z,height:N,x:H,y:$}=function(e,t,n,o,i,r,s,a){let{affectsX:l,affectsY:d}=t;const{isHorizontal:u,isVertical:c}=t,h=u&&c,{xSnapped:p,ySnapped:f}=n,{minWidth:g,maxWidth:m,minHeight:y,maxHeight:x}=o,{x:v,y:w,width:M,height:P,aspectRatio:b}=e;let E=Math.floor(u?p-e.pointerX:0),I=Math.floor(c?f-e.pointerY:0);const S=M+(l?-E:E),z=P+(d?-I:I),N=-r[0]*M,H=-r[1]*P;let $=bt(S,g,m),C=bt(z,y,x);if(s){let e=0,t=0;l&&E<0?e=Mt(v+E+N,s[0][0]):!l&&E>0&&(e=Pt(v+S+N,s[1][0])),d&&I<0?t=Mt(w+I+H,s[0][1]):!d&&I>0&&(t=Pt(w+z+H,s[1][1])),$=Math.max($,e),C=Math.max(C,t)}if(a){let e=0,t=0;l&&E>0?e=Pt(v+E,a[0][0]):!l&&E<0&&(e=Mt(v+S,a[1][0])),d&&I>0?t=Pt(w+I,a[0][1]):!d&&I<0&&(t=Mt(w+z,a[1][1])),$=Math.max($,e),C=Math.max(C,t)}if(i){if(u){const e=bt(S/b,y,x)*b;if($=Math.max($,e),s){let e=0;e=!l&&!d||l&&!d&&h?Pt(w+H+S/b,s[1][1])*b:Mt(w+H+(l?E:-E)/b,s[0][1])*b,$=Math.max($,e)}if(a){let e=0;e=!l&&!d||l&&!d&&h?Mt(w+S/b,a[1][1])*b:Pt(w+(l?E:-E)/b,a[0][1])*b,$=Math.max($,e)}}if(c){const e=bt(z*b,g,m)/b;if(C=Math.max(C,e),s){let e=0;e=!l&&!d||d&&!l&&h?Pt(v+z*b+N,s[1][0])/b:Mt(v+(d?I:-I)*b+N,s[0][0])/b,C=Math.max(C,e)}if(a){let e=0;e=!l&&!d||d&&!l&&h?Mt(v+z*b,a[1][0])/b:Pt(v+(d?I:-I)*b,a[0][0])/b,C=Math.max(C,e)}}}I+=I<0?C:-C,E+=E<0?$:-$,i&&(h?S>z*b?I=(Et(l,d)?-E:E)/b:E=(Et(l,d)?-I:I)*b:u?(I=E/b,d=l):(E=I*b,l=d));const D=l?v+E:v,T=d?w+I:w;return{width:M+(l?-E:E),height:P+(d?-I:I),x:r[0]*E*(l?-1:1)+D,y:r[1]*I*(d?-1:1)+T}}(y,l.controlDirection,a,l.boundaries,l.keepAspectRatio,S,v,w),C=z!==p,D=N!==E,T=H!==u&&C,A=$!==c&&D;if(!(T||A||C||D))return;if((T||A||1===S[0]||1===S[1])&&(I.x=T?H:m.x,I.y=A?$:m.y,m.x=I.x,m.y=I.y,P.length>0)){const e=H-u,t=$-c;for(const n of P)n.position={x:n.position.x-e+S[0]*(z-p),y:n.position.y-t+S[1]*(N-E)},d.push(n)}if((C||D)&&(I.width=!C||l.resizeDirection&&"horizontal"!==l.resizeDirection?m.width:z,I.height=!D||l.resizeDirection&&"vertical"!==l.resizeDirection?m.height:N,m.width=I.width,m.height=I.height),x&&g.expandParent){const e=S[0]*(I.width??0);I.x&&I.x<e&&(m.x=e,y.x=y.x-(I.x-e));const t=S[1]*(I.height??0);I.y&&I.y<t&&(m.y=t,y.y=y.y-(I.y-t))}const O=function({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:i,affectsY:r}){const s=e-t,a=n-o,l=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(l[0]=-1*l[0]),a&&r&&(l[1]=-1*l[1]),l}({width:m.width,prevWidth:p,height:m.height,prevHeight:E,affectsX:l.controlDirection.affectsX,affectsY:l.controlDirection.affectsY}),k={...m,direction:O};!1!==(null==f?void 0:f(e,k))&&(b=!0,null==h||h(e,k),r(I,d))}).on("end",e=>{b&&(null==p||p(e,{...m}),null==s||s({...m}),b=!1)});a.call(E)},destroy:function(){a.on(".drag",null)}}}export{he as $,d as A,v as B,h as C,oe as D,dt as E,Nt as F,yt as G,nt as H,Q as I,O as J,T as K,ge as L,M,u as N,ve as O,b as P,j as Q,xt as R,m as S,Ie as T,S as U,ue as V,F as W,lt as X,D as Y,ye as Z,le as _,ze as a,x as a0,je as a1,_e as a2,Ke as a3,qe as a4,Ze as a5,Qe as a6,A as a7,c as a8,U as a9,K as b,k as c,pe as d,l as e,me as f,C as g,ne as h,q as i,N as j,ae as k,z as l,se as m,_ as n,re as o,J as p,Ye as q,ee as r,De as s,Ne as t,Pe as u,Ae as v,de as w,Ee as x,Be as y,f as z};
