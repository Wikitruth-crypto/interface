import{r as e,j as t,a as s,R as r,s as a,L as i,c as n,t as d,v as l,w as o,x as c,y as m,q as u}from"./react-vendor-zDXgJfFk.js";import{j as h,k as x,b as p,l as g,m as w,c as y,h as b,s as f,u as j,n as v,T as k,a as S,S as N,o as B,p as I,q as M,i as C}from"./page-boxdetail-B0b9qN-M.js";import{C as T}from"./page-create-3kqNbUMp.js";import{g as D,C as _,E as q,B as L,S as A,A as $,p as z,m as E,o as P,a as R,s as W,T as F,q as V,r as K,u as O,v as H,w as U,j as G,x as Y,y as Z,z as J,M as Q}from"./ui-vendor-BK4VHMl3.js";import{g as X,h as ee,j as te}from"./vendor-CVSnAKA7.js";import{f as se,g as re,h as ae}from"./web3-vendor-CWtaQkP0.js";const ie=(e,t,s)=>{var r,a;if(!t||!s)return"";const i=e.accounts[t];return i?(null==(r=i[s])?void 0:r.userId)??(null==(a=i[s.toLowerCase()])?void 0:a.userId)??"":""};function ne(){const[t,s]=e.useState(""),r=e.useRef(!1),{setUserId:a}=h(),{myUserId:i}=x(),{address:n,chainId:d}=p(),{isValidateSession:l,session:o}=g(),c=h(e=>{const t=d||w,s=n||e.currentAccount;return ie(e,t,s)}),m=e.useCallback(async()=>{if(r.current)return;if(!o.token||!l)return;const e=n;if(!e)return;const t=d||w||0,c=ie(h.getState(),t,e);if(c)return s(c),void(r.current=!1);r.current=!0;try{const e=await i(o.token);if(e&&e>0){const t=e.toString();a(t),s(t)}}catch(m){}finally{r.current=!1}},[o.token,l,n,d,i,a]);return e.useEffect(()=>{c&&c!==t&&s(c)},[c,t]),e.useEffect(()=>{c||!l||r.current||m()},[c,l,m]),t}const de=[{key:"rewards",label:"MyRewards",description:"Helper & Minter earnings"},{key:"boxes",label:"MyBoxes",description:"All boxes linked to me"}],le=({active:e,onChange:s,className:r})=>t.jsx("div",{className:y("flex flex-wrap gap-3 justify-center",r),children:t.jsx(D.Group,{buttonStyle:"solid",size:"large",onChange:e=>s(e.target.value),defaultValue:e,children:de.map(e=>t.jsx(D.Button,{value:e.key,children:e.label},e.key))})});async function oe(e){const{network:t,layer:s}=b;try{const{data:r,error:a}=await f.from("user_rewards").select("*").eq("network",t).eq("layer",s).eq("user_id",e);if(a)return{userRewardsData:null,error:a};const i=r?r.map(e=>function(e){var t,s;const r=X(e,{deep:!0});return{id:r.id||"",userId:r.userId||(null==(t=r.user_id)?void 0:t.toString())||"",rewardType:r.rewardType||r.reward_type||"",token:r.token||"",amount:(null==(s=r.amount)?void 0:s.toString())||"0"}}(e)):[];return{userRewardsData:i.length>0?i:null,error:null}}catch(r){return{userRewardsData:null,error:me(r)}}}async function ce(e){const{network:t,layer:s}=b;try{const{data:r,error:a}=await f.from("user_withdraws").select("*").eq("network",t).eq("layer",s).eq("user_id",e);if(a)return{userWithdrawsData:null,error:a};const i=r?r.map(e=>function(e){var t,s;const r=X(e,{deep:!0});return{id:r.id||"",userId:r.userId||(null==(t=r.user_id)?void 0:t.toString())||"",withdrawType:r.withdrawType||r.withdraw_type||"",token:r.token||"",amount:(null==(s=r.amount)?void 0:s.toString())||"0"}}(e)):[];return{userWithdrawsData:i.length>0?i:null,error:null}}catch(r){return{userWithdrawsData:null,error:me(r)}}}function me(e){return e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null}const ue=[],he={Minter:{label:"The Minter Rewards",description:"The cumulative rewards from minting boxes, which can be withdrawn through withdrawMinterRewards.",withdrawMethod:"withdrawMinterRewards"},Helper:{label:"The Helper Rewards",description:"The rewards obtained by sellers/completers, which can be withdrawn through withdrawHelperRewards.",withdrawMethod:"withdrawHelperRewards"}},xe=e=>{if(!e)return BigInt(0);try{return BigInt(e)}catch{return BigInt(0)}},pe=(e,t)=>{if(e===BigInt(0))return"0";try{const s=se(e,t),[r,a="0"]=s.split("."),i=a.replace(/0+$/,"").slice(0,4);return i?`${r}.${i}`:r}catch{return e.toString()}},ge=e=>e?e.toLowerCase():"",we=t=>{const r=j(),a=e.useMemo(()=>(e=>{const t=new Map;return e.forEach(e=>{t.set(e.address.toLowerCase(),e)}),t})(r),[r]),i=Boolean(t),n=s({queryKey:["profile-user-rewards",b.network,b.layer,t],queryFn:async()=>{if(!t)return{rewards:[],withdraws:[]};const[e,s]=await Promise.all([oe(t),ce(t)]);if(e.error)throw e.error;if(s.error)throw s.error;return{rewards:e.userRewardsData??[],withdraws:s.userWithdrawsData??[]}},enabled:i,staleTime:6e4}),d=e.useMemo(()=>{if(!i||!n.data)return ue;const e={Minter:new Map,Helper:new Map},t={Minter:new Map,Helper:new Map};n.data.rewards.forEach(t=>{const s="Minter"===t.rewardType?"Minter":"Helper",r=ge(t.token),a=xe(t.amount),i=e[s];i.set(r,(i.get(r)??BigInt(0))+a)}),n.data.withdraws.forEach(e=>{const s="Minter"===e.withdrawType?"Minter":"Helper",r=ge(e.token),a=xe(e.amount),i=t[s];i.set(r,(i.get(r)??BigInt(0))+a)});return["Minter","Helper"].map(s=>{const r=Array.from(e[s].entries()).map(([e,r])=>{const i=t[s].get(e)??BigInt(0),n=r-i,d=n>BigInt(0)?n:BigInt(0),l=a.get(e),o=(null==l?void 0:l.decimals)??18;var c;return{tokenAddress:e,tokenSymbol:(null==l?void 0:l.symbol)??((c=e)?`${c.slice(0,6)}...${c.slice(-4)}`:"UNKNOWN"),decimals:o,formattedEarned:pe(r,o),formattedWithdrawn:pe(i,o),formattedClaimable:pe(d,o),raw:{earned:r,withdrawn:i,claimable:d}}});return 0===r.length?null:{category:s,label:he[s].label,description:he[s].description,withdrawMethod:he[s].withdrawMethod,tokens:r}}).filter(e=>Boolean(e))},[i,n.data,a]),l=e.useMemo(()=>d.some(e=>e.tokens.some(e=>e.raw.claimable>BigInt(0))),[d]);return{categories:d,hasClaimable:l,isLoading:n.isLoading,isFetching:n.isFetching,isError:n.isError,error:n.error,refetch:n.refetch,enabled:i}},ye=()=>{const{writeContractAsync:t,data:s,error:r,isPending:a,isError:i,isSuccess:n,status:d,reset:l}=re(),{isSuccess:o}=ae({hash:s}),{address:c}=p(),[m,u]=e.useState(null),[x,g]=e.useState(null),w=h(e=>e.addWithdrawInteraction);return e.useEffect(()=>{o&&m&&c&&x?w(m,x,s):i&&l()},[o,m,c,x,s,w,i,l]),{writeCustormV3:async e=>{const s=e.functionName;u(s),g(e.tokenAddress);try{return await t({address:e.contract.address,abi:e.contract.abi,functionName:e.functionName,args:e.args})}catch(r){throw r}},hash:s,error:r,isPending:a,isLoading:"idle"!==d&&"error"!==d&&!o,isSuccess:n,status:d,isError:i,reset:l,isSuccessed:o}},{Text:be}=R,fe=({userId:s,className:i})=>{const{categories:n,isLoading:d,isFetching:l,error:o,refetch:c}=we(s),{withdrawRewards:m,pendingKey:u,isLoading:x,error:p,isSuccessed:w}=(()=>{const{writeCustormV3:t,error:s,isLoading:r,isSuccessed:a}=ye(),i=v(),[n,d]=e.useState(null),l=e.useCallback(async({method:e,tokenAddress:s})=>{if(!s)throw new Error("Token address is required");d({method:e,tokenAddress:s});try{return await t({contract:i.FundManager,functionName:e,tokenAddress:s,args:[s]})}catch(r){throw d(null),r}},[i.FundManager,t]),o=n?`${n.method}-${n.tokenAddress.toLowerCase()}`:null;return e.useEffect(()=>{a&&n&&d(null)},[a,n]),e.useEffect(()=>{s&&d(null)},[s]),{withdrawRewards:l,currentAction:n,pendingKey:o,error:s,isLoading:r,isSuccessed:a}})(),{login:b}=g(),f=h(e=>e.hasWithdrawInteraction);r.useEffect(()=>{if(w){const e=setTimeout(()=>{c()},2e3);return()=>clearTimeout(e)}},[w,c]);return s?t.jsx(_,{className:y("rounded-2xl",i),styles:{body:{padding:"24px"}},children:t.jsxs(A,{direction:"vertical",size:"large",className:"w-full",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(k,{children:"Rewards Dashboard"}),t.jsx(L,{icon:t.jsx(a,{className:"h-4 w-4"}),onClick:()=>c(),loading:l,size:"middle",children:"Refresh"})]}),o&&t.jsx($,{message:"Failed to load reward data",description:o.message,type:"error",showIcon:!0,closable:!0}),p&&t.jsx($,{message:"Withdrawal failed",description:p.message,type:"warning",showIcon:!0,closable:!0}),d?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx(z,{size:"large"})}):0===n.length?t.jsx(q,{description:"No reward records to display"}):t.jsx(A,{direction:"vertical",size:"large",className:"w-full",children:n.map(e=>t.jsx(_,{title:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(k,{className:"mb-1!",children:e.label}),t.jsx(S,{size:"sm",type:"secondary",children:e.description})]}),t.jsxs(E,{color:"blue",children:["Total ",e.tokens.length," tokens"]})]}),className:"rounded-xl",styles:{body:{padding:"20px"}},children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.tokens.map(s=>{const r=`${e.withdrawMethod}-${s.tokenAddress.toLowerCase()}`,a=s.raw.claimable>BigInt(0),i=u===r&&x,n=f(e.withdrawMethod,s.tokenAddress)&&a,d=!a||i||n;return t.jsx(_,{size:"small",className:"rounded-lg",styles:{body:{padding:"16px"}},children:t.jsxs(A,{direction:"vertical",size:"middle",className:"w-full",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(E,{color:"yellow",style:{fontSize:"14px"},children:s.tokenSymbol})}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(P,{title:t.jsx(be,{type:"secondary",children:"Total Rewards"}),value:s.formattedEarned,precision:3,valueStyle:{fontSize:"16px",fontWeight:500}})}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(P,{title:t.jsx(be,{type:"secondary",children:"Withdrawn"}),value:s.formattedWithdrawn,precision:3,valueStyle:{fontSize:"16px"}})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(P,{title:t.jsx(be,{strong:!0,children:"Claimable"}),value:s.formattedClaimable,precision:3,valueStyle:{fontSize:"18px",fontWeight:600,color:a?"#52c41a":void 0}})}),t.jsx("div",{className:"flex-1 min-w-0 sm:max-w-[200px]",children:t.jsx(L,{type:"primary",block:!0,size:"large",disabled:d,loading:i,onClick:()=>(async(e,t)=>{try{await m({method:e,tokenAddress:t}),W.success("Withdrawal transaction submitted, waiting for confirmation...")}catch(s){W.error("Withdrawal failed. Please try again.")}})(e.withdrawMethod,s.tokenAddress),children:i?"Withdrawing...":n?"Success":"Withdraw"})})]})]})},`${e.category}-${s.tokenAddress}`)})})},e.withdrawMethod))})]})}):t.jsx(_,{className:y("rounded-2xl",i),children:t.jsx(q,{description:"You need to login/bind to view the reward data",image:q.PRESENTED_IMAGE_SIMPLE,children:t.jsx(L,{type:"primary",onClick:()=>b(),children:"Login"})})})},je=({userId:e,className:s})=>t.jsx("div",{className:y("space-y-6",s),children:t.jsx(fe,{userId:e})}),ve=({data:e,loading:s=!1,selectedTab:r="all",onTabClick:a,className:n,variant:d="default",showZeroValues:l=!0})=>{const o=[{key:"all",displayName:"All Boxes",count:(null==e?void 0:e.totalBoxes)||0},{key:"owned",displayName:"Owned",count:(null==e?void 0:e.ownedBoxes)||0},{key:"minted",displayName:"Minted",count:(null==e?void 0:e.mintedBoxes)||0},{key:"sold",displayName:"Sold",count:(null==e?void 0:e.soldBoxes)||0},{key:"bought",displayName:"Bought",count:(null==e?void 0:e.boughtBoxes)||0},{key:"bade",displayName:"Bade",count:(null==e?void 0:e.bidBoxes)||0},{key:"completed",displayName:"Completed",count:(null==e?void 0:e.completedBoxes)||0},{key:"published",displayName:"Published",count:(null==e?void 0:e.publishedBoxes)||0}],c=l?o:o.filter(e=>e.count>0||e.key===r),m=e=>{a&&!s&&a(e)};return"compact"===d?t.jsx("div",{className:y("flex flex-wrap gap-2 p-4 bg-card border rounded-lg",n),children:c.map(e=>t.jsxs("button",{onClick:()=>m(e.key),disabled:s||!a,className:y("flex items-center gap-1 px-3 py-2 rounded-md","text-sm font-medium transition-all duration-200","border border-transparent",r===e.key?"bg-primary text-primary-foreground border-primary":"bg-muted hover:bg-muted/80 text-muted-foreground hover:text-foreground",a&&"cursor-pointer",s&&"opacity-50 cursor-not-allowed"),children:[t.jsx("span",{children:e.displayName}),t.jsx("span",{className:y("px-1.5 py-0.5 text-xs rounded",r===e.key?"bg-primary-foreground/20 text-primary-foreground":"bg-background text-foreground"),children:s?"...":e.count})]},e.key))}):t.jsx("div",{className:y("grid grid-cols-4 md:grid-cols-8 gap-1 md:gap-1.5","p-1.5 md:p-2 bg-card border rounded-xl shadow-sm",n),children:c.map(e=>t.jsxs("div",{onClick:()=>m(e.key),className:y("relative flex flex-col items-center justify-center","p-1 md:p-1.5 rounded-lg transition-all duration-300","border border-transparent","hover:shadow-md hover:border-primary",a&&!s&&"cursor-pointer hover:scale-105",r===e.key&&["bg-primary/10 border-primary shadow-lg scale-105","ring-1 ring-primary/20"],r!==e.key&&["bg-background hover:bg-accent/50",a&&"hover:border-border"],s&&"opacity-60 cursor-not-allowed",0===e.count&&r!==e.key&&"opacity-75"),children:[t.jsx("div",{className:y("text-sm md:text-base lg:text-lg font-bold","transition-all duration-300",r===e.key?"text-primary":"text-foreground",s&&"animate-pulse"),children:s?t.jsx(i,{className:"h-3 w-3 md:h-3.5 md:w-3.5 animate-spin"}):e.count.toLocaleString()}),t.jsx("div",{className:"text-center",children:t.jsx("p",{className:y("text-xs font-medium leading-tight mt-0.5",r===e.key?"text-primary":"text-muted-foreground"),children:e.displayName})}),r===e.key&&t.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:t.jsx("div",{className:"w-1.5 h-1.5 md:w-2 md:h-2 bg-primary rounded-full"})})]},e.key))})},ke=({title:s="",description:r="",metadata:a,onClick:i,className:n,titleMaxLength:d,descriptionMaxLength:l,responsive:o=!0})=>{var c,m;const u=o?{titleMaxLength:{sm:d||50,md:d||70,lg:d||90},descriptionMaxLength:{sm:l||100,md:l||180,lg:l||220},titleSize:{sm:"h5",md:"h5",lg:"h4"},descriptionClamp:{sm:"line-clamp-2",md:"line-clamp-3",lg:"line-clamp-4"}}:{titleMaxLength:d||100,descriptionMaxLength:l||250,titleSize:"h4",descriptionClamp:"line-clamp-3"},h=(e,t)=>{if(!e||"string"!=typeof e)return"";if("number"==typeof t)return e.length<=t?e:e.substring(0,t)+"...";const s=t.md;return e.length<=s?e:e.substring(0,s)+"..."},x=e=>{if(!e||"string"!=typeof e)return"";try{const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}};e.useMemo(()=>o?4:3,[o]);const p=e.useMemo(()=>[a.country,a.state].filter(Boolean).join(", "),[a.country,a.state]),g=e.useMemo(()=>h(s,u.titleMaxLength),[s,u.titleMaxLength]),w=e.useMemo(()=>h(r,u.descriptionMaxLength),[r,u.descriptionMaxLength]),b=s&&s.length>("number"==typeof u.titleMaxLength?u.titleMaxLength:(null==(c=u.titleMaxLength)?void 0:c.md)||70),f=r&&r.length>("number"==typeof u.descriptionMaxLength?u.descriptionMaxLength:(null==(m=u.descriptionMaxLength)?void 0:m.md)||180);return t.jsx("div",{className:y("flex-1 min-w-0",n),children:t.jsxs(A,{direction:"vertical",size:o?["small","middle"]:"middle",style:{width:"100%"},children:[t.jsxs(A,{direction:"vertical",size:o?"small":"middle",style:{width:"100%"},children:[b?t.jsx(F,{title:s,placement:"topLeft",children:t.jsx(k,{children:g})}):t.jsx(k,{children:g}),r&&(f?t.jsx(F,{title:r,placement:"topLeft",children:t.jsx(S,{size:"xs",type:"secondary",className:"line-clamp-2",children:w})}):t.jsx(S,{size:"xs",type:"secondary",className:"line-clamp-2",children:w}))]}),t.jsxs(A,{wrap:!0,size:o?["small","middle"]:"middle",style:{width:"100%"},children:[t.jsxs(E,{style:{fontFamily:"monospace",fontSize:o?void 0:13},className:y(o&&"text-xs sm:text-sm"),children:["ID: ",a.tokenId]}),t.jsx(N,{status:a.status,size:"sm",responsive:o}),p&&t.jsx(F,{title:p,children:t.jsx(E,{icon:t.jsx(V,{}),style:{fontSize:o?void 0:12},className:y(o&&"text-xs sm:text-sm"),children:t.jsx("span",{style:{maxWidth:o?void 0:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block"},className:y(o&&"max-w-[100px] sm:max-w-[120px] md:max-w-[140px]"),children:p})})}),a.eventDate&&x(a.eventDate)&&t.jsx(E,{icon:t.jsx(K,{}),style:{fontSize:o?void 0:12},className:y(o&&"text-xs sm:text-sm"),children:x(a.eventDate)})]})]})})},{Text:Se,Title:Ne}=R,Be=({title:e="Can withdraw Funds",funds:s,selectedValue:r,onSelect:a,onDeselect:i,className:n})=>{const d=s.filter(e=>{if(e.disabled)return!1;if(!e.amount||"0"===e.amount||"0n"===e.amount)return!1;try{return("string"==typeof e.amount&&e.amount.includes("n")?BigInt(e.amount.replace("n","")):BigInt(e.amount))>BigInt(0)}catch{return!1}}),l=d.length>0;return s.length>0&&0===d.length?t.jsx("div",{className:n,children:t.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:t.jsxs(A,{direction:"vertical",size:"small",align:"center",children:[t.jsx(Se,{type:"secondary",children:"ðŸ’°"}),t.jsx(Se,{type:"secondary",children:"No funds available"})]}),style:{padding:"16px 0"}})}):t.jsx("div",{className:n,children:t.jsxs(A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[t.jsx(Ne,{level:5,style:{margin:0},children:l?e:"No funds available"}),d.length>0&&t.jsx(D.Group,{value:r||void 0,onChange:e=>{const t=e.target.value;r===t?null==i||i(t):null==a||a(t)},children:t.jsx(A,{direction:"vertical",size:"small",style:{width:"100%"},children:d.map((e,s)=>t.jsx(D.Button,{value:e.symbol,disabled:e.disabled,onClick:()=>{return t=e.symbol,void(r===t&&(null==i||i(t)));var t},style:{width:"100%",height:"auto",padding:"6px 10px",textAlign:"left"},children:t.jsxs(A,{direction:"horizontal",size:4,style:{width:"100%"},children:[t.jsx(Se,{strong:!0,style:{fontSize:16,fontFamily:"monospace"},children:B(e.amount,e.decimals??18)}),t.jsx(Se,{type:"secondary",style:{fontSize:12},children:e.symbol}),e.type&&t.jsx(Se,{type:"secondary",style:{fontSize:11},children:e.type})]})},`${e.symbol}-${s}`))})})]})})},Ie=({data:s,funds:r,actions:a,className:i})=>{const n={tokenId:s.tokenId.toString(),status:s.status,country:s.country,state:s.state,eventDate:s.eventDate},d=e.useMemo(()=>t.jsx("style",{children:"\n            .card-profile-mobile {\n                display: block;\n            }\n            .card-profile-desktop {\n                display: none;\n            }\n            @media (min-width: 768px) {\n                .card-profile-mobile {\n                    display: none;\n                }\n                .card-profile-desktop {\n                    display: block;\n                }\n            }\n        "}),[]);return t.jsxs(t.Fragment,{children:[d,t.jsxs(_,{className:i,style:{marginBottom:10},hoverable:!0,styles:{body:{padding:"12px 16px"}},children:[t.jsx("div",{className:"card-profile-mobile",children:t.jsxs(O,{gutter:[12,12],children:[t.jsx(H,{span:24,children:t.jsx("div",{onClick:a.onCardClick,style:{cursor:a.onCardClick?"pointer":"default"},children:t.jsx(ke,{title:s.title,description:s.description,metadata:n,responsive:!0})})}),t.jsx(H,{span:24,children:t.jsxs(O,{gutter:[12,12],align:"middle",children:[t.jsx(H,{span:9,children:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(U,{src:I(s.boxImage||""),alt:`${s.title} #${s.tokenId}`,width:100,height:100,style:{objectFit:"cover"}})})}),t.jsx(H,{span:15,children:t.jsx(Be,{funds:r,selectedValue:a.selectedTokenSymbol,onSelect:a.onSelect,onDeselect:a.onDeselect})})]})})]})}),t.jsx("div",{className:"card-profile-desktop",children:t.jsxs(O,{gutter:[12,12],align:"middle",children:[t.jsx(H,{md:16,lg:17,xl:18,children:t.jsxs(O,{onClick:a.onCardClick,style:{cursor:a.onCardClick?"pointer":"default"},gutter:[12,12],align:"top",children:[t.jsx(H,{md:8,lg:7,xl:6,children:t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx(U,{src:I(s.boxImage||""),alt:`${s.title} #${s.tokenId}`,width:110,height:110,style:{objectFit:"cover"}})})}),t.jsx(H,{md:16,lg:17,xl:18,children:t.jsx(ke,{title:s.title,description:s.description,metadata:n,responsive:!0})})]})}),t.jsx(H,{md:8,lg:7,xl:6,children:t.jsx(Be,{funds:r,selectedValue:a.selectedTokenSymbol,onSelect:a.onSelect,onDeselect:a.onDeselect})})]})})]})]})},Me={currentPage:1,pageSize:10,loadedItems:[]},Ce={hasMoreItems:!0,showPagination:!1},Te={selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"},De=n((e,t)=>({pageState:Me,scrollState:Ce,filterState:Te,batchSize:4,setPageState:t=>{e(e=>({pageState:{...e.pageState,...t}}))},addLoadedItems:t=>{e(e=>{const s=new Set(e.pageState.loadedItems),r=t.filter(e=>!s.has(e));if(0===r.length)return e;const a=Array.from(new Set([...e.pageState.loadedItems,...r]));return a.sort((e,t)=>e-t),{pageState:{...e.pageState,loadedItems:a}}})},getNextIndex:()=>{const{pageState:e}=t();return 0===e.loadedItems.length?0:e.loadedItems.length},resetPageState:()=>{e(()=>({pageState:Me}))},updateScrollState:t=>{e(e=>({scrollState:{...e.scrollState,...t}}))},setFilterState:t=>{e(e=>({filterState:{...e.filterState,...t}}))},updateSelectedTab:t=>{e(e=>({filterState:{...e.filterState,selectedTab:t},pageState:{...Me},scrollState:{...Ce}}))},updateSelectedStatus:t=>{e(e=>({filterState:{...e.filterState,selectedStatus:t},pageState:{...Me},scrollState:{...Ce}}))},updateOrderBy:(t,s="desc")=>{e(e=>({filterState:{...e.filterState,orderBy:t,orderDirection:s},pageState:{...Me},scrollState:{...Ce}}))},resetAllState:()=>{e({pageState:Me,scrollState:Ce,filterState:Te})}})),_e=(e,t)=>{if(e===BigInt(0))return"0.000";try{const s=se(e,t),[r,a="0"]=s.split("."),i=a.replace(/0+$/,"").slice(0,4);return i?`${r}.${i}`:r}catch{return e.toString()}},qe=({box:t,userId:s})=>{const r=j(),a=De(e=>e.filterState.selectedTab),i=e.useMemo(()=>t.acceptedToken?r.find(e=>{var s;return e.address.toLowerCase()===(null==(s=t.acceptedToken)?void 0:s.toLowerCase())}):null,[t.acceptedToken,r]),n=Boolean(("bought"===a||"bade"===a)&&s&&t.acceptedToken),{orderAmountsData:d,isLoading:l}=M(t.id,s??"",["Buyer","Bidder"]),o=e.useMemo(()=>{var e,r,a;const l=t.acceptedToken??(null==i?void 0:i.address),o=(null==i?void 0:i.decimals)??18,c=(null==i?void 0:i.symbol)??((m=l)?m.length<=10?m:`${m.slice(0,6)}...${m.slice(-4)}`:"UNKNOWN");var m;const u=[];if(n&&d&&d.length>0){const e=d.reduce((e,t)=>{try{return e+BigInt(t.amount||"0")}catch{return e}},BigInt(0));e>BigInt(0)&&u.push({amount:(h={amount:e,symbol:c,address:l??void 0,decimals:o}).amount.toString(),formattedAmount:_e(h.amount,h.decimals),symbol:h.symbol,address:h.address,decimals:h.decimals,hasValidAmount:h.amount>BigInt(0)})}var h;const x=Boolean(s&&t.refundPermit&&(null==(e=t.buyer)?void 0:e.id)&&t.buyer.id===s),p=Boolean(s&&(!(null==(r=t.buyer)?void 0:r.id)||t.buyer.id!==s)&&(null==(a=t.bidders)?void 0:a.some(e=>e.id===s))),g=x||p,w=x?"withdrawRefundAmounts":"withdrawOrderAmounts",y=x?"Refund":"Order";return{funds:{boxId:t.id,type:y,claimMethod:w,tokens:g?u:[]},hasClaimableFunds:g&&u.some(e=>e.hasValidAmount)}},[i,t.id,t.acceptedToken,t.bidders,t.buyer,t.refundPermit,d,n,s]);return{funds:o.funds,isLoading:l,hasClaimableFunds:o.hasClaimableFunds}},Le={selectedClaimMethod:null,selectedBoxes:null,selectedTokenSymbol:null,selectedTokenAddress:null,selectedTokenDecimals:null,selectedType:null},Ae=e=>String(e),$e=n((e,t)=>({withdrawData:Le,registeredItems:new Map,updateWithdrawData:t=>{e(e=>({withdrawData:{...e.withdrawData,...t}}))},resetWithdrawData:()=>{e({withdrawData:Le})},registerSelectableItem:t=>{e(e=>{const s=new Map(e.registeredItems),r=`${Ae(t.boxId)}-${t.tokenSymbol}`;return s.set(r,{...t,boxId:Ae(t.boxId)}),{registeredItems:s}})},unregisterSelectableItem:(t,s)=>{e(e=>{const r=new Map(e.registeredItems),a=`${Ae(t)}-${s}`;return r.delete(a),{registeredItems:r}})},getMatchingItems:(e,s,r)=>{const{registeredItems:a}=t(),i=[];return a.forEach(t=>{t.tokenSymbol===e&&t.type===s&&t.claimMethod===r&&t.hasValidAmount&&i.push(t)}),i},handleRadioSelect:(s,r,a,i,n)=>{const d=Ae(s),l=t().withdrawData;if(!n||"0"===n||parseFloat(n)<=0)return;if(l.selectedTokenSymbol===r&&l.selectedClaimMethod===i&&l.selectedType===a){const t=l.selectedBoxes??[];if(t.includes(d))return;return void e({withdrawData:{...l,selectedBoxes:[...t,d]}})}const o=t().getMatchingItems(r,a,i),c=`${d}-${r}`,m=t().registeredItems.get(c),u=o[0]??m,h=o.map(e=>Ae(e.boxId)),x=h.length>0?h:[d];e({withdrawData:{selectedClaimMethod:i,selectedTokenSymbol:r,selectedTokenAddress:(null==u?void 0:u.tokenAddress)??null,selectedTokenDecimals:(null==u?void 0:u.tokenDecimals)??null,selectedType:a,selectedBoxes:x}})},handleRadioDeselect:t=>{const s=Ae(t);e(e=>{const t=(e.withdrawData.selectedBoxes||[]).filter(e=>e!==s);return 0===t.length?{withdrawData:Le}:{withdrawData:{...e.withdrawData,selectedBoxes:t}}})},isRadioSelected:(e,s)=>{const{selectedTokenSymbol:r,selectedBoxes:a}=t().withdrawData,i=Ae(e);return r===s&&Array.isArray(a)&&a.includes(i)},canClaim:()=>{const{selectedBoxes:e}=t().withdrawData;return Array.isArray(e)&&e.length>0},totalAmount:()=>{const{withdrawData:e,registeredItems:s}=t(),{selectedBoxes:r,selectedTokenSymbol:a}=e;if(!r||0===r.length||!a)return BigInt(0);let i=BigInt(0);return s.forEach(e=>{if(r.includes(e.boxId)&&e.tokenSymbol===a&&e.hasValidAmount)try{i+=BigInt(e.amount||"0")}catch(t){}}),i},addBoxToSelection:t=>{const s=Ae(t);e(e=>{const t=e.withdrawData.selectedBoxes||[];return t.includes(s)?e:{withdrawData:{...e.withdrawData,selectedBoxes:[...t,s]}}})},removeBoxFromSelection:t=>{const s=Ae(t);e(e=>{const t=(e.withdrawData.selectedBoxes||[]).filter(e=>e!==s);return 0===t.length?{withdrawData:Le}:{withdrawData:{...e.withdrawData,selectedBoxes:t}}})},resetAllState:()=>{e({withdrawData:Le,registeredItems:new Map})}})),ze=({data:s,userId:r,onCardClick:a,className:i})=>{const n=e.useMemo(()=>String(s.id),[s.id]),{funds:d,hasClaimableFunds:l}=qe({box:s,userId:r}),o=h(e=>e.hasWithdrawInteraction),{address:c}=p(),m=h(e.useMemo(()=>{if(!c||!w)return()=>[];const e=c.toLowerCase();return t=>{var s,r;return(null==(r=null==(s=t.accounts[w])?void 0:s[e])?void 0:r.withdrawInteractions)||[]}},[c])),{withdrawData:u,handleRadioSelect:x,handleRadioDeselect:g,isRadioSelected:y,registerSelectableItem:b,unregisterSelectableItem:f}=$e();e.useEffect(()=>{if(!l)return;const e=d.tokens.filter(e=>e.hasValidAmount);return e.forEach(e=>{const t={boxId:n,tokenSymbol:e.symbol,tokenAddress:e.address,tokenDecimals:e.decimals,type:d.type,claimMethod:d.claimMethod,amount:e.amount,hasValidAmount:e.hasValidAmount};b(t)}),()=>{e.forEach(e=>{f(n,e.symbol)})}},[n,d.tokens,d.type,d.claimMethod,l,b,f]);const j=e.useMemo(()=>({tokenId:s.tokenId,title:s.title||`Box #${s.tokenId}`,description:s.description||"No description available",boxImage:s.boxImage??s.nftImage??s.image,status:s.status,country:s.country,state:s.state,eventDate:s.eventDate}),[s]),v=e.useMemo(()=>d.tokens.map(e=>!!e.address&&o(d.claimMethod,e.address)?{amount:"0",symbol:e.symbol,type:d.type,decimals:e.decimals,disabled:!0}:{amount:e.amount,symbol:e.symbol,type:d.type,decimals:e.decimals,disabled:!e.hasValidAmount||!l}),[d.tokens,d.claimMethod,d.type,l,o,m]),k=e.useMemo(()=>d.tokens.map(e=>e.symbol),[d.tokens]),S=e.useMemo(()=>{for(const e of k)if(y(n,e))return e;return""},[n,k,u.selectedBoxes,y]),N=e.useMemo(()=>({selectedTokenSymbol:S,onCardClick:a,onSelect:e=>{const t=d.tokens.find(t=>t.symbol===e);t&&t.hasValidAmount&&x(n,e,d.type,d.claimMethod,t.amount)},onDeselect:()=>{g(n)}}),[a,S,d.tokens,d.type,d.claimMethod,n,x,g]);return t.jsx(Ie,{data:j,funds:v,actions:N,className:i})},{Paragraph:Ee}=R,Pe=({disabled:e=!1,isLoading:s=!1,buttonText:r="Withdraw",message:a="",formattedAmount:i,tokenSymbol:n="",submit:d,cancel:l,className:o,isSuccess:c=!1,error:m})=>{const u=c?{type:"default",icon:t.jsx(G,{}),danger:!1}:m?{type:"primary",icon:t.jsx(Z,{}),danger:!0}:{type:"primary",icon:void 0,danger:!1};return t.jsx($,{type:c?"success":m?"error":"info",showIcon:!0,icon:c?t.jsx(G,{}):s?t.jsx(Y,{spin:!0}):void 0,message:c?"Successfully withdrawn!":m?"Withdrawal failed":s?"Processing transaction...":`Withdrawal: ${i} ${n}`,description:t.jsxs(A,{direction:"horizontal",size:"small",style:{width:"100%"},children:[t.jsxs(A,{direction:"vertical",size:"small",children:[a&&t.jsx(Ee,{type:"secondary",style:{marginBottom:0,fontSize:"12px"},children:a}),m&&t.jsx(Ee,{type:"secondary",style:{marginBottom:0,fontSize:"12px"},children:m})]}),t.jsxs(A,{direction:"vertical",size:"small",style:{width:"100%"},children:[t.jsx(L,{...u,disabled:e||c,onClick:d,loading:s,size:"middle",block:!0,children:c?"Withdrawn":s?"Withdrawing...":m?"Retry":r}),t.jsx(L,{type:"default",disabled:e||c,onClick:l,size:"middle",block:!0,children:"Cancel"})]})]}),className:o})},Re=["withdrawOrderAmounts","withdrawRefundAmounts"],We=()=>{var s;const{withdraw:r,isLoading:a,isSuccessed:i,error:n}=(()=>{const e=j(),t=v(),{writeCustormV3:s,error:r,isLoading:a,isSuccessed:i}=ye();return{withdraw:async()=>{const r=$e.getState().withdrawData,{selectedBoxes:a,selectedTokenSymbol:i,selectedTokenAddress:n,selectedClaimMethod:d}=r;try{if(!i||!d)throw new Error("Invalid withdraw data");if(!("withdrawOrderAmounts"!==d&&"withdrawRefundAmounts"!==d||a&&0!==a.length))throw new Error("Please select at least one box");const r=e.find(e=>e.symbol===i),l=n??(null==r?void 0:r.address);if(!l)throw new Error("Invalid token");let o=[];return o=[l,(a??[]).map(e=>BigInt(e))],await s({contract:t.FundManager,functionName:d,tokenAddress:l,args:o})}catch(l){throw l}},error:r,isLoading:a,isSuccessed:i}})(),{withdrawData:d,canClaim:l,totalAmount:o,resetWithdrawData:c}=$e();e.useEffect(()=>{if(i){const e=setTimeout(()=>{c()},2e3);return()=>clearTimeout(e)}},[i,c]);const m=l(),u=d.selectedClaimMethod,h=m&&!!u&&Re.includes(u),x=h?o():BigInt(0),p=d.selectedTokenDecimals??18,g=d.selectedTokenSymbol??"",w=h?B(x,p,4):"0.0000",y=(null==(s=d.selectedBoxes)?void 0:s.length)??0,b="Refund"===(d.selectedType??null)?"Refund Amount":"Order Amount";const f=h?`Selected ${y} boxes, ready to withdraw ${b}${g?`ï¼ˆ${g}ï¼‰`:""}`:"Please select the funds to withdraw";return h?t.jsx(Pe,{formattedAmount:w,tokenSymbol:g,message:f,buttonText:`Withdraw ${b}`,disabled:!h||a,isLoading:a,isSuccess:i,error:null==n?void 0:n.message,submit:()=>{r().catch(e=>{})},cancel:()=>{c()},className:"mb-3!"}):null},Fe=({className:s,animate:r=!0})=>{const a=r?"animate-pulse":"",i=e.useMemo(()=>t.jsx("style",{children:"\n            .skeleton-profile-mobile {\n                display: block;\n            }\n            .skeleton-profile-desktop {\n                display: none;\n            }\n            @media (min-width: 768px) {\n                .skeleton-profile-mobile {\n                    display: none;\n                }\n                .skeleton-profile-desktop {\n                    display: block;\n                }\n            }\n        "}),[]);return t.jsxs(t.Fragment,{children:[i,t.jsxs(_,{className:s,style:{marginBottom:10},styles:{body:{padding:"10px 13px"}},children:[t.jsx("div",{className:"skeleton-profile-mobile",children:t.jsxs(O,{gutter:[12,12],children:[t.jsx(H,{span:24,children:t.jsxs("div",{children:[t.jsx(J,{active:r,paragraph:{rows:0},title:{width:"80%"},style:{marginBottom:8}}),t.jsx(J,{active:r,paragraph:{rows:3,width:["100%","75%","50%"]},title:!1,style:{marginBottom:8}}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-16",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-20",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-24",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-20",a)})]})]})}),t.jsx(H,{span:24,children:t.jsxs(O,{gutter:[12,12],align:"middle",children:[t.jsx(H,{span:9,children:t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx("div",{className:y("bg-white/20 rounded","w-[100px] h-[100px]",a)})})}),t.jsx(H,{span:15,children:t.jsxs("div",{children:[t.jsx("div",{className:y("h-5 bg-white/20 rounded mb-3","w-32",a)}),t.jsx("div",{children:t.jsx("div",{className:y("p-[6px_10px] border border-white/20 rounded-lg mb-2",a),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:y("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:y("h-4 bg-white/20 rounded mb-1","w-20",a)}),t.jsx("div",{className:y("h-3 bg-white/20 rounded","w-12",a)})]})]})})})]})})]})})]})}),t.jsx("div",{className:"skeleton-profile-desktop",children:t.jsxs(O,{gutter:[12,12],align:"middle",children:[t.jsx(H,{md:16,lg:17,xl:18,children:t.jsxs(O,{gutter:[12,12],align:"top",children:[t.jsx(H,{md:8,lg:7,xl:6,children:t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsx("div",{className:y("bg-white/20 rounded","w-[110px] h-[110px]",a)})})}),t.jsx(H,{md:16,lg:17,xl:18,children:t.jsxs("div",{children:[t.jsx(J,{active:r,paragraph:{rows:0},title:{width:"75%"},style:{marginBottom:8}}),t.jsx(J,{active:r,paragraph:{rows:3,width:["100%","80%","60%"]},title:!1,style:{marginBottom:8}}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-16",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-20",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-24",a)}),t.jsx("div",{className:y("h-6 bg-white/20 rounded-md","w-20",a)})]})]})})]})}),t.jsx(H,{md:8,lg:7,xl:6,children:t.jsxs("div",{children:[t.jsx("div",{className:y("h-5 bg-white/20 rounded mb-3","w-32",a)}),t.jsxs("div",{children:[t.jsx("div",{className:y("p-[6px_10px] border border-white/20 rounded-lg mb-2",a),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:y("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:y("h-4 bg-white/20 rounded mb-1","w-20",a)}),t.jsx("div",{className:y("h-3 bg-white/20 rounded","w-12",a)})]})]})}),t.jsx("div",{className:y("p-[6px_10px] border border-white/20 rounded-lg",a),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:y("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:y("h-4 bg-white/20 rounded mb-1","w-16",a)}),t.jsx("div",{className:y("h-3 bg-white/20 rounded","w-10",a)})]})]})})]})]})})]})})]})]})},Ve={white:"text-white","gray-3":"text-gray-300","gray-5":"text-gray-500",black:"text-black","muted-foreground":"text-muted-foreground",primary:"text-primary",secondary:"text-secondary"},Ke={xs:"text-xs",sm:"text-sm",md:"text-md",lg:"text-lg"},Oe={light:"font-light",normal:"font-normal",medium:"font-medium",semibold:"font-semibold"},He={1:"line-clamp-1",2:"line-clamp-2",3:"line-clamp-3",4:"line-clamp-4",5:"line-clamp-5",6:"line-clamp-6",none:""};function Ue({children:e,color:s="white",size:r="md",weight:a="normal",lineClamp:i=2,isCopy:n=!1,className:o,maxLength:c,maxWidth:m}){const u=null==o?void 0:o.match(/text-(xs|sm|md|lg)/);let h=e,x=!1;"string"==typeof e&&c&&e.length>c&&(h=e.slice(0,c)+"...",x=!0);const p=String(h),g=String(e);return t.jsx(R.Paragraph,{className:y("leading-relaxed font-mono",Ve[s],!u&&Ke[r],Oe[a],He[i],o),style:m?{maxWidth:"number"==typeof m?m+"px":m}:void 0,title:x?g:void 0,copyable:!!n&&{text:g,icon:[t.jsx(d,{className:"h-4 w-4"},"copy"),t.jsx(l,{className:"h-4 w-4 text-green-500"},"check")],tooltips:["Copy","Copied!"]},children:p})}function Ge({open:e,closable:s=!1,onCancel:r,title:a="Loading..."}){return t.jsx(Q,{open:e,footer:null,closable:s,onCancel:r,maskClosable:!1,centered:!0,width:600,children:t.jsxs("div",{className:"flex flex-col justify-center items-center gap-4 h-full",children:[t.jsx(Ue,{color:"muted-foreground",className:"mb-4",children:a}),t.jsx("div",{className:"flex justify-center items-center",children:t.jsx(o,{className:"animate-spin",size:30})})]})})}const Ye=e=>e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null;const Ze=(e,t)=>{const{network:r,layer:a}=b,{data:i,isLoading:n,isError:d,error:l,isSuccess:o}=s({queryKey:["user-profile",r,a,e,t],queryFn:async()=>{if(!e)return null;const s=await async function(e,t){try{const s={totalBoxes:0,ownedBoxes:0,mintedBoxes:0,soldBoxes:0,boughtBoxes:0,bidBoxes:0,completedBoxes:0,publishedBoxes:0},{count:r}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("owner_address",e.toLowerCase());if(s.ownedBoxes=r||0,t){const{count:r}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("minter_id",t);s.mintedBoxes=r||0;const{count:a}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("seller_id",t);s.soldBoxes=a||0;const{count:i}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("buyer_id",t);s.boughtBoxes=i||0;const{count:n}=await f.from("box_bidders").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("bidder_id",t);s.bidBoxes=n||0;const{count:d}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("completer_id",t);s.completedBoxes=d||0;const{count:l}=await f.from("boxes").select("*",{count:"exact",head:!0}).eq("network",b.network).eq("layer",b.layer).eq("publisher_id",t);s.publishedBoxes=l||0;const{data:o}=await f.from("boxes").select("id").eq("network",b.network).eq("layer",b.layer).or(`owner_address.eq.${e.toLowerCase()},minter_id.eq.${t},seller_id.eq.${t},buyer_id.eq.${t},completer_id.eq.${t},publisher_id.eq.${t}`),{data:c}=await f.from("box_bidders").select("id").eq("network",b.network).eq("layer",b.layer).eq("bidder_id",t),m=new Set;null==o||o.forEach(e=>m.add(e.id)),null==c||c.forEach(e=>m.add(e.id)),s.totalBoxes=m.size}else s.totalBoxes=s.ownedBoxes;return{data:s,error:null}}catch(l){return{data:null,error:Ye(l)}}}(e,t);if(s.error)throw s.error;return s.data},enabled:!!e,staleTime:3e4});return{data:i?{id:t||e,address:e||"",stats:{totalBoxes:i.totalBoxes,ownedBoxes:i.ownedBoxes,mintedBoxes:i.mintedBoxes,soldBoxes:i.soldBoxes,boughtBoxes:i.boughtBoxes,bidBoxes:i.bidBoxes,completedBoxes:i.completedBoxes,publishedBoxes:i.publishedBoxes},allBoxes:[],ownedBoxes:[],mintedBoxes:[],soldBoxes:[],boughtBoxes:[],bidBoxes:[],completedBoxes:[],publishedBoxes:[]}:null,isLoading:n,isError:d,error:l||null,isSuccess:o}},Je=e=>{var t;const s=e.metadata_boxes,r=C(e.status,e.deadline,e.buyer_id);return{id:e.id,tokenId:e.token_id,price:e.price,deadline:e.deadline,status:r,createTimestamp:e.create_timestamp,boxInfoCID:e.box_info_cid||void 0,acceptedToken:e.accepted_token||void 0,refundPermit:e.refund_permit||!1,listedMode:e.listed_mode||void 0,owner:{id:e.owner_address},minter:{id:e.minter_id},seller:e.seller_id?{id:e.seller_id}:void 0,buyer:e.buyer_id?{id:e.buyer_id}:void 0,completer:e.completer_id?{id:e.completer_id}:void 0,publisher:e.publisher_id?{id:e.publisher_id}:void 0,bidders:(null==(t=e.box_bidders)?void 0:t.map(e=>({id:e.bidder_id})))||[],title:(null==s?void 0:s.title)||void 0,description:(null==s?void 0:s.description)||void 0,nftImage:(null==s?void 0:s.nft_image)||void 0,boxImage:(null==s?void 0:s.box_image)||void 0,country:(null==s?void 0:s.country)||void 0,state:(null==s?void 0:s.state)||void 0,eventDate:(null==s?void 0:s.event_date)||void 0,typeOfCrime:(null==s?void 0:s.type_of_crime)||void 0,hasError:!1}},Qe=(e,t,s)=>{const{network:r,layer:a}=b,{data:i,isLoading:n,isError:d,error:l,isSuccess:o,fetchNextPage:m,hasNextPage:u,isFetchingNextPage:h}=c({queryKey:["user-boxes",r,a,e,s,t],queryFn:async({pageParam:r})=>{if(!e)return{items:[],hasMore:!1};const a=await async function(e,t,s,r=20,a=0){try{let i=f.from("boxes").select("\n                *,\n                metadata_boxes (*),\n                box_bidders (*)\n            ").eq("network",b.network).eq("layer",b.layer);switch(s.selectedTab){case"owned":i=i.eq("owner_address",e.toLowerCase());break;case"minted":if(!t)return{data:[],error:null};i=i.eq("minter_id",t);break;case"sold":if(!t)return{data:[],error:null};i=i.eq("seller_id",t);break;case"bought":if(!t)return{data:[],error:null};i=i.eq("buyer_id",t);break;case"bade":if(!t)return{data:[],error:null};const{data:s,error:r}=await f.from("box_bidders").select("id").eq("network",b.network).eq("layer",b.layer).eq("bidder_id",t);if(r)return{data:null,error:r};const a=(null==s?void 0:s.map(e=>e.id))||[];if(0===a.length)return{data:[],error:null};i=i.in("id",a);break;case"completed":if(!t)return{data:[],error:null};i=i.eq("completer_id",t);break;case"published":if(!t)return{data:[],error:null};i=i.eq("publisher_id",t);break;default:i=t?i.or(`owner_address.eq.${e.toLowerCase()},minter_id.eq.${t},seller_id.eq.${t},buyer_id.eq.${t},completer_id.eq.${t},publisher_id.eq.${t}`):i.eq("owner_address",e.toLowerCase())}switch(s.selectedStatus&&(i=i.eq("status",s.selectedStatus)),s.orderBy){case"tokenId":i=i.order("id",{ascending:"asc"===s.orderDirection});break;case"price":i=i.order("price",{ascending:"asc"===s.orderDirection});break;case"createTimestamp":i=i.order("create_timestamp",{ascending:"asc"===s.orderDirection});break;default:i=i.order("create_timestamp",{ascending:!1})}i=i.range(a,a+r-1);const{data:n,error:d}=await i;return d?{data:null,error:d}:{data:n,error:null}}catch(l){return{data:null,error:Ye(l)}}}(e,s,t,20,r);if(a.error)throw a.error;const i=(a.data||[]).map(Je);return{items:i,hasMore:20===i.length}},initialPageParam:0,getNextPageParam:(e,t)=>{if(e.hasMore)return t.reduce((e,t)=>e+t.items.length,0)},enabled:!!e,staleTime:3e4});return{data:{pages:(null==i?void 0:i.pages)||[{items:[],hasMore:!1}],pageParams:(null==i?void 0:i.pageParams)||[0]},isLoading:n,isError:d,error:l||null,isSuccess:o,fetchNextPage:m,hasNextPage:u||!1,isFetchingNextPage:h}},Xe=({address:s,userId:r,className:a})=>{const{filters:i,updateTab:n}=(()=>{const{setFilterState:t}=De(),[s,r]=e.useState({selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"}),a=e.useMemo(()=>[{id:"tokenId",accessorKey:"tokenId",header:"Token ID"},{id:"price",accessorKey:"price",header:"Price"},{id:"deadline",accessorKey:"deadline",header:"Deadline"},{id:"status",accessorKey:"status",header:"Status"}],[]);return{table:m({data:[],columns:a,state:{sorting:[{id:s.orderBy,desc:"desc"===s.orderDirection}]},onSortingChange:e=>{const s="function"==typeof e?e([]):e;s[0]&&(r(e=>({...e,orderBy:s[0].id,orderDirection:s[0].desc?"desc":"asc"})),t({orderBy:s[0].id,orderDirection:s[0].desc?"desc":"asc"}))},getCoreRowModel:te(),getSortedRowModel:ee()}),filters:s,setFilters:r,updateTab:e=>{r(t=>({...t,selectedTab:e})),t({selectedTab:e})},updateStatus:e=>{r(t=>({...t,selectedStatus:e})),t({selectedStatus:e})},updateSorting:(e,s)=>{r(t=>({...t,orderBy:e,orderDirection:s})),t({orderBy:e,orderDirection:s})},resetFilters:()=>{r({selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"})}}})();(()=>{const{filterState:t}=De(),{resetWithdrawData:s}=$e(),r=e.useRef(t.selectedTab);e.useEffect(()=>{r.current!==t.selectedTab&&(s(),r.current=t.selectedTab)},[t.selectedTab,s])})();const d=s??"",l=r??"",{data:o,isLoading:c,error:h}=Ze(d,l),{data:x,isLoading:p,fetchNextPage:g,hasNextPage:w,isFetchingNextPage:b,error:f}=Qe(d,i,l),j=e.useMemo(()=>(null==x?void 0:x.pages.flatMap(e=>e.items))??[],[x]),v=u(),[k,S]=e.useState(!1),[N,B]=e.useState(!1),I=e.useCallback(e=>{S(!0),v(`/boxDetail/${e}`)},[v]),M=e.useCallback(()=>{B(!0),window.location.reload()},[]),C=e.useCallback(()=>{g()},[g]),T=c||p,D=Boolean(h||f);return t.jsxs("div",{className:y("space-y-6",a),children:[D?t.jsx("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-red-400",children:"The data loading failed"}),t.jsx("p",{className:"text-foreground/70",children:"Something went wrong while loading boxes"}),t.jsx("button",{onClick:M,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",disabled:N,children:N?"Refreshing...":"Reload"})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsx(ve,{data:null==o?void 0:o.stats,loading:c,selectedTab:i.selectedTab,onTabClick:n}),t.jsx(We,{className:"w-full"}),t.jsx("div",{className:"w-full",children:T&&0===j.length?t.jsx("div",{className:"space-y-4",children:Array.from({length:3},(e,s)=>t.jsx(Fe,{},s))}):j.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-full space-y-3 sm:space-y-4 md:space-y-6",children:j.map(e=>t.jsx(ze,{data:e,userId:r,onCardClick:()=>I(e.id)},e.id))}),w&&t.jsx("div",{className:"flex justify-center pt-6",children:t.jsx("button",{onClick:C,disabled:b,className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50",children:b?"Loading...":"Load more"})})]}):t.jsx("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"No data"}),t.jsx("p",{className:"text-foreground/70",children:"You don't have any boxes"})]})})})]}),t.jsx(Ge,{open:k,closable:!0})]})},et=({className:s})=>{const{address:r}=p(),a=ne(),i=a&&""!==a.trim()?a.trim():null,[n,d]=e.useState("rewards");return t.jsxs(T,{className:y("space-y-6 py-6",s),children:[t.jsx(le,{active:n,onChange:d}),"rewards"===n?t.jsx(je,{userId:i}):t.jsx(Xe,{address:r,userId:i})]})};export{et as P,ne as u};
