import{j as e,a9 as t,O as s,r,M as a,aP as i,ar as d,as as n,K as l,aB as o,aS as c,B as m,S as u,aT as h,A as x,aR as p,aA as g,N as w,T as y,az as b,ai as f,aU as j,aV as v,aW as k,aC as S,aD as N,aX as B,n as I,av as M,aY as C,aZ as T,a_ as D,a$ as _,b0 as q,at as L,b1 as A,b2 as $,b3 as z,b4 as E,b5 as P,q as R}from"./vendor-BDtTUao2.js";import{c as W,C as F,u as V,d as O,e as K,f as H,h as U,a as G}from"./index-DzM9oNjl.js";import{u as Y,c as Z}from"./hooks-CTGY0WO4.js";import{s as X,S as J,f as Q,i as ee,c as te}from"./status-D2J4ZcA5.js";import{T as se}from"./text_p-y92iNKCg.js";import{T as re}from"./text_title-CzMJOIVd.js";import{u as ae}from"./useBoxOrderAmounts-Df5u3Nzd.js";const ie=[{key:"rewards",label:"MyRewards",description:"Helper & Minter earnings"},{key:"boxes",label:"MyBoxes",description:"All boxes linked to me"}],de=({active:s,onChange:r,className:a})=>e.jsx("div",{className:W("flex flex-wrap gap-3 justify-center",a),children:e.jsx(t.Group,{buttonStyle:"solid",size:"large",onChange:e=>r(e.target.value),defaultValue:s,children:ie.map(s=>e.jsx(t.Button,{value:s.key,children:s.label},s.key))})});async function ne(e){const{network:t,layer:r}=F;try{const{data:a,error:i}=await X.from("user_rewards").select("*").eq("network",t).eq("layer",r).eq("user_id",e);if(i)return{userRewardsData:null,error:i};const d=a?a.map(e=>function(e){var t,r;const a=s(e,{deep:!0});return{id:a.id||"",userId:a.userId||(null==(t=a.user_id)?void 0:t.toString())||"",rewardType:a.rewardType||a.reward_type||"",token:a.token||"",amount:(null==(r=a.amount)?void 0:r.toString())||"0"}}(e)):[];return{userRewardsData:d.length>0?d:null,error:null}}catch(a){return{userRewardsData:null,error:oe(a)}}}async function le(e){const{network:t,layer:r}=F;try{const{data:a,error:i}=await X.from("user_withdraws").select("*").eq("network",t).eq("layer",r).eq("user_id",e);if(i)return{userWithdrawsData:null,error:i};const d=a?a.map(e=>function(e){var t,r;const a=s(e,{deep:!0});return{id:a.id||"",userId:a.userId||(null==(t=a.user_id)?void 0:t.toString())||"",withdrawType:a.withdrawType||a.withdraw_type||"",token:a.token||"",amount:(null==(r=a.amount)?void 0:r.toString())||"0"}}(e)):[];return{userWithdrawsData:d.length>0?d:null,error:null}}catch(a){return{userWithdrawsData:null,error:oe(a)}}}function oe(e){return e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null}const ce=[],me={Minter:{label:"The Minter Rewards",description:"The cumulative rewards from minting boxes, which can be withdrawn through withdrawMinterRewards.",withdrawMethod:"withdrawMinterRewards"},Helper:{label:"The Helper Rewards",description:"The rewards obtained by sellers/completers, which can be withdrawn through withdrawHelperRewards.",withdrawMethod:"withdrawHelperRewards"}},ue=e=>{if(!e)return BigInt(0);try{return BigInt(e)}catch{return BigInt(0)}},he=(e,t)=>{if(e===BigInt(0))return"0";try{const s=i(e,t),[r,a="0"]=s.split("."),d=a.replace(/0+$/,"").slice(0,4);return d?`${r}.${d}`:r}catch{return e.toString()}},xe=e=>e?e.toLowerCase():"",pe=e=>{const t=Y(),s=r.useMemo(()=>(e=>{const t=new Map;return e.forEach(e=>{t.set(e.address.toLowerCase(),e)}),t})(t),[t]),i=Boolean(e),d=a({queryKey:["profile-user-rewards",F.network,F.layer,e],queryFn:async()=>{if(!e)return{rewards:[],withdraws:[]};const[t,s]=await Promise.all([ne(e),le(e)]);if(t.error)throw t.error;if(s.error)throw s.error;return{rewards:t.userRewardsData??[],withdraws:s.userWithdrawsData??[]}},enabled:i,staleTime:6e4}),n=r.useMemo(()=>{if(!i||!d.data)return ce;const e={Minter:new Map,Helper:new Map},t={Minter:new Map,Helper:new Map};d.data.rewards.forEach(t=>{const s="Minter"===t.rewardType?"Minter":"Helper",r=xe(t.token),a=ue(t.amount),i=e[s];i.set(r,(i.get(r)??BigInt(0))+a)}),d.data.withdraws.forEach(e=>{const s="Minter"===e.withdrawType?"Minter":"Helper",r=xe(e.token),a=ue(e.amount),i=t[s];i.set(r,(i.get(r)??BigInt(0))+a)});return["Minter","Helper"].map(r=>{const a=Array.from(e[r].entries()).map(([e,a])=>{const i=t[r].get(e)??BigInt(0),d=a-i,n=d>BigInt(0)?d:BigInt(0),l=s.get(e),o=(null==l?void 0:l.decimals)??18;var c;return{tokenAddress:e,tokenSymbol:(null==l?void 0:l.symbol)??((c=e)?`${c.slice(0,6)}...${c.slice(-4)}`:"UNKNOWN"),decimals:o,formattedEarned:he(a,o),formattedWithdrawn:he(i,o),formattedClaimable:he(n,o),raw:{earned:a,withdrawn:i,claimable:n}}});return 0===a.length?null:{category:r,label:me[r].label,description:me[r].description,withdrawMethod:me[r].withdrawMethod,tokens:a}}).filter(e=>Boolean(e))},[i,d.data,s]),l=r.useMemo(()=>n.some(e=>e.tokens.some(e=>e.raw.claimable>BigInt(0))),[n]);return{categories:n,hasClaimable:l,isLoading:d.isLoading,isFetching:d.isFetching,isError:d.isError,error:d.error,refetch:d.refetch,enabled:i}},ge=()=>{const{writeContractAsync:e,data:t,error:s,isPending:a,isError:i,isSuccess:l,status:o,reset:c}=d(),{isSuccess:m}=n({hash:t}),{address:u}=V(),[h,x]=r.useState(null),[p,g]=r.useState(null),w=O(e=>e.addWithdrawInteraction);return r.useEffect(()=>{m&&h&&u&&p?w(h,p,t):i&&c()},[m,h,u,p,t,w,i,c]),{writeCustormV3:async t=>{const s=t.functionName;x(s),g(t.tokenAddress);try{return await e({address:t.contract.address,abi:t.contract.abi,functionName:t.functionName,args:t.args})}catch(r){throw r}},hash:t,error:s,isPending:a,isLoading:"idle"!==o&&"error"!==o&&!m,isSuccess:l,status:o,isError:i,reset:c,isSuccessed:m}},{Text:we}=y,ye=({userId:t,className:s})=>{const{categories:a,isLoading:i,isFetching:d,error:n,refetch:y}=pe(t),{withdrawRewards:f,pendingKey:j,isLoading:v,error:k,isSuccessed:S}=(()=>{const{writeCustormV3:e,error:t,isLoading:s,isSuccessed:a}=ge(),i=Z(),[d,n]=r.useState(null),l=r.useCallback(async({method:t,tokenAddress:s})=>{if(!s)throw new Error("Token address is required");n({method:t,tokenAddress:s});try{return await e({contract:i.FundManager,functionName:t,tokenAddress:s,args:[s]})}catch(r){throw n(null),r}},[i.FundManager,e]),o=d?`${d.method}-${d.tokenAddress.toLowerCase()}`:null;return r.useEffect(()=>{a&&d&&n(null)},[a,d]),r.useEffect(()=>{t&&n(null)},[t]),{withdrawRewards:l,currentAction:d,pendingKey:o,error:t,isLoading:s,isSuccessed:a}})(),{login:N}=K(),B=O(e=>e.hasWithdrawInteraction);l.useEffect(()=>{if(S){const e=setTimeout(()=>{y()},2e3);return()=>clearTimeout(e)}},[S,y]);return t?e.jsx(o,{className:W("rounded-2xl",s),styles:{body:{padding:"24px"}},children:e.jsxs(u,{direction:"vertical",size:"large",className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(re,{children:"Rewards Dashboard"}),e.jsx(m,{icon:e.jsx(h,{className:"h-4 w-4"}),onClick:()=>y(),loading:d,size:"middle",children:"Refresh"})]}),n&&e.jsx(x,{message:"Failed to load reward data",description:n.message,type:"error",showIcon:!0,closable:!0}),k&&e.jsx(x,{message:"Withdrawal failed",description:k.message,type:"warning",showIcon:!0,closable:!0}),i?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(p,{size:"large"})}):0===a.length?e.jsx(c,{description:"No reward records to display"}):e.jsx(u,{direction:"vertical",size:"large",className:"w-full",children:a.map(t=>e.jsx(o,{title:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(re,{className:"mb-1!",children:t.label}),e.jsx(se,{size:"sm",type:"secondary",children:t.description})]}),e.jsxs(g,{color:"blue",children:["Total ",t.tokens.length," tokens"]})]}),className:"rounded-xl",styles:{body:{padding:"20px"}},children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.tokens.map(s=>{const r=`${t.withdrawMethod}-${s.tokenAddress.toLowerCase()}`,a=s.raw.claimable>BigInt(0),i=j===r&&v,d=B(t.withdrawMethod,s.tokenAddress)&&a,n=!a||i||d;return e.jsx(o,{size:"small",className:"rounded-lg",styles:{body:{padding:"16px"}},children:e.jsxs(u,{direction:"vertical",size:"middle",className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(g,{color:"yellow",style:{fontSize:"14px"},children:s.tokenSymbol})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(w,{title:e.jsx(we,{type:"secondary",children:"Total Rewards"}),value:s.formattedEarned,precision:3,valueStyle:{fontSize:"16px",fontWeight:500}})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(w,{title:e.jsx(we,{type:"secondary",children:"Withdrawn"}),value:s.formattedWithdrawn,precision:3,valueStyle:{fontSize:"16px"}})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(w,{title:e.jsx(we,{strong:!0,children:"Claimable"}),value:s.formattedClaimable,precision:3,valueStyle:{fontSize:"18px",fontWeight:600,color:a?"#52c41a":void 0}})}),e.jsx("div",{className:"flex-1 min-w-0 sm:max-w-[200px]",children:e.jsx(m,{type:"primary",block:!0,size:"large",disabled:n,loading:i,onClick:()=>(async(e,t)=>{try{await f({method:e,tokenAddress:t}),b.success("Withdrawal transaction submitted, waiting for confirmation...")}catch(s){b.error("Withdrawal failed. Please try again.")}})(t.withdrawMethod,s.tokenAddress),children:i?"Withdrawing...":d?"Success":"Withdraw"})})]})]})},`${t.category}-${s.tokenAddress}`)})})},t.withdrawMethod))})]})}):e.jsx(o,{className:W("rounded-2xl",s),children:e.jsx(c,{description:"You need to login/bind to view the reward data",image:c.PRESENTED_IMAGE_SIMPLE,children:e.jsx(m,{type:"primary",onClick:()=>N(),children:"Login"})})})},be=({userId:t,className:s})=>e.jsx("div",{className:W("space-y-6",s),children:e.jsx(ye,{userId:t})}),fe=({data:t,loading:s=!1,selectedTab:r="all",onTabClick:a,className:i,variant:d="default",showZeroValues:n=!0})=>{const l=[{key:"all",displayName:"All Boxes",count:(null==t?void 0:t.totalBoxes)||0},{key:"owned",displayName:"Owned",count:(null==t?void 0:t.ownedBoxes)||0},{key:"minted",displayName:"Minted",count:(null==t?void 0:t.mintedBoxes)||0},{key:"sold",displayName:"Sold",count:(null==t?void 0:t.soldBoxes)||0},{key:"bought",displayName:"Bought",count:(null==t?void 0:t.boughtBoxes)||0},{key:"bade",displayName:"Bade",count:(null==t?void 0:t.bidBoxes)||0},{key:"completed",displayName:"Completed",count:(null==t?void 0:t.completedBoxes)||0},{key:"published",displayName:"Published",count:(null==t?void 0:t.publishedBoxes)||0}],o=n?l:l.filter(e=>e.count>0||e.key===r),c=e=>{a&&!s&&a(e)};return"compact"===d?e.jsx("div",{className:W("flex flex-wrap gap-2 p-4 bg-card border rounded-lg",i),children:o.map(t=>e.jsxs("button",{onClick:()=>c(t.key),disabled:s||!a,className:W("flex items-center gap-1 px-3 py-2 rounded-md","text-sm font-medium transition-all duration-200","border border-transparent",r===t.key?"bg-primary text-primary-foreground border-primary":"bg-muted hover:bg-muted/80 text-muted-foreground hover:text-foreground",a&&"cursor-pointer",s&&"opacity-50 cursor-not-allowed"),children:[e.jsx("span",{children:t.displayName}),e.jsx("span",{className:W("px-1.5 py-0.5 text-xs rounded",r===t.key?"bg-primary-foreground/20 text-primary-foreground":"bg-background text-foreground"),children:s?"...":t.count})]},t.key))}):e.jsx("div",{className:W("grid grid-cols-4 md:grid-cols-8 gap-1 md:gap-1.5","p-1.5 md:p-2 bg-card border rounded-xl shadow-sm",i),children:o.map(t=>e.jsxs("div",{onClick:()=>c(t.key),className:W("relative flex flex-col items-center justify-center","p-1 md:p-1.5 rounded-lg transition-all duration-300","border border-transparent","hover:shadow-md hover:border-primary",a&&!s&&"cursor-pointer hover:scale-105",r===t.key&&["bg-primary/10 border-primary shadow-lg scale-105","ring-1 ring-primary/20"],r!==t.key&&["bg-background hover:bg-accent/50",a&&"hover:border-border"],s&&"opacity-60 cursor-not-allowed",0===t.count&&r!==t.key&&"opacity-75"),children:[e.jsx("div",{className:W("text-sm md:text-base lg:text-lg font-bold","transition-all duration-300",r===t.key?"text-primary":"text-foreground",s&&"animate-pulse"),children:s?e.jsx(f,{className:"h-3 w-3 md:h-3.5 md:w-3.5 animate-spin"}):t.count.toLocaleString()}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:W("text-xs font-medium leading-tight mt-0.5",r===t.key?"text-primary":"text-muted-foreground"),children:t.displayName})}),r===t.key&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsx("div",{className:"w-1.5 h-1.5 md:w-2 md:h-2 bg-primary rounded-full"})})]},t.key))})},je=({title:t="",description:s="",metadata:a,onClick:i,className:d,titleMaxLength:n,descriptionMaxLength:l,responsive:o=!0})=>{var c,m;const h=o?{titleMaxLength:{sm:n||50,md:n||70,lg:n||90},descriptionMaxLength:{sm:l||100,md:l||180,lg:l||220},titleSize:{sm:"h5",md:"h5",lg:"h4"},descriptionClamp:{sm:"line-clamp-2",md:"line-clamp-3",lg:"line-clamp-4"}}:{titleMaxLength:n||100,descriptionMaxLength:l||250,titleSize:"h4",descriptionClamp:"line-clamp-3"},x=(e,t)=>{if(!e||"string"!=typeof e)return"";if("number"==typeof t)return e.length<=t?e:e.substring(0,t)+"...";const s=t.md;return e.length<=s?e:e.substring(0,s)+"..."},p=e=>{if(!e||"string"!=typeof e)return"";try{const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return""}};r.useMemo(()=>o?4:3,[o]);const w=r.useMemo(()=>[a.country,a.state].filter(Boolean).join(", "),[a.country,a.state]),y=r.useMemo(()=>x(t,h.titleMaxLength),[t,h.titleMaxLength]),b=r.useMemo(()=>x(s,h.descriptionMaxLength),[s,h.descriptionMaxLength]),f=t&&t.length>("number"==typeof h.titleMaxLength?h.titleMaxLength:(null==(c=h.titleMaxLength)?void 0:c.md)||70),S=s&&s.length>("number"==typeof h.descriptionMaxLength?h.descriptionMaxLength:(null==(m=h.descriptionMaxLength)?void 0:m.md)||180);return e.jsx("div",{className:W("flex-1 min-w-0",d),children:e.jsxs(u,{direction:"vertical",size:o?["small","middle"]:"middle",style:{width:"100%"},children:[e.jsxs(u,{direction:"vertical",size:o?"small":"middle",style:{width:"100%"},children:[f?e.jsx(j,{title:t,placement:"topLeft",children:e.jsx(re,{children:y})}):e.jsx(re,{children:y}),s&&(S?e.jsx(j,{title:s,placement:"topLeft",children:e.jsx(se,{size:"xs",type:"secondary",className:"line-clamp-2",children:b})}):e.jsx(se,{size:"xs",type:"secondary",className:"line-clamp-2",children:b}))]}),e.jsxs(u,{wrap:!0,size:o?["small","middle"]:"middle",style:{width:"100%"},children:[e.jsxs(g,{style:{fontFamily:"monospace",fontSize:o?void 0:13},className:W(o&&"text-xs sm:text-sm"),children:["ID: ",a.tokenId]}),e.jsx(J,{status:a.status,size:"sm",responsive:o}),w&&e.jsx(j,{title:w,children:e.jsx(g,{icon:e.jsx(v,{}),style:{fontSize:o?void 0:12},className:W(o&&"text-xs sm:text-sm"),children:e.jsx("span",{style:{maxWidth:o?void 0:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block"},className:W(o&&"max-w-[100px] sm:max-w-[120px] md:max-w-[140px]"),children:w})})}),a.eventDate&&p(a.eventDate)&&e.jsx(g,{icon:e.jsx(k,{}),style:{fontSize:o?void 0:12},className:W(o&&"text-xs sm:text-sm"),children:p(a.eventDate)})]})]})})},{Text:ve,Title:ke}=y,Se=({title:s="Can withdraw Funds",funds:r,selectedValue:a,onSelect:i,onDeselect:d,className:n})=>{const l=r.filter(e=>{if(e.disabled)return!1;if(!e.amount||"0"===e.amount||"0n"===e.amount)return!1;try{return("string"==typeof e.amount&&e.amount.includes("n")?BigInt(e.amount.replace("n","")):BigInt(e.amount))>BigInt(0)}catch{return!1}}),o=l.length>0;return r.length>0&&0===l.length?e.jsx("div",{className:n,children:e.jsx(c,{image:c.PRESENTED_IMAGE_SIMPLE,description:e.jsxs(u,{direction:"vertical",size:"small",align:"center",children:[e.jsx(ve,{type:"secondary",children:"ðŸ’°"}),e.jsx(ve,{type:"secondary",children:"No funds available"})]}),style:{padding:"16px 0"}})}):e.jsx("div",{className:n,children:e.jsxs(u,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(ke,{level:5,style:{margin:0},children:o?s:"No funds available"}),l.length>0&&e.jsx(t.Group,{value:a||void 0,onChange:e=>{const t=e.target.value;a===t?null==d||d(t):null==i||i(t)},children:e.jsx(u,{direction:"vertical",size:"small",style:{width:"100%"},children:l.map((s,r)=>e.jsx(t.Button,{value:s.symbol,disabled:s.disabled,onClick:()=>{return e=s.symbol,void(a===e&&(null==d||d(e)));var e},style:{width:"100%",height:"auto",padding:"6px 10px",textAlign:"left"},children:e.jsxs(u,{direction:"horizontal",size:4,style:{width:"100%"},children:[e.jsx(ve,{strong:!0,style:{fontSize:16,fontFamily:"monospace"},children:Q(s.amount,s.decimals??18)}),e.jsx(ve,{type:"secondary",style:{fontSize:12},children:s.symbol}),s.type&&e.jsx(ve,{type:"secondary",style:{fontSize:11},children:s.type})]})},`${s.symbol}-${r}`))})})]})})},Ne=({data:t,funds:s,actions:a,className:i})=>{const d={tokenId:t.tokenId.toString(),status:t.status,country:t.country,state:t.state,eventDate:t.eventDate},n=r.useMemo(()=>e.jsx("style",{children:"\n            .card-profile-mobile {\n                display: block;\n            }\n            .card-profile-desktop {\n                display: none;\n            }\n            @media (min-width: 768px) {\n                .card-profile-mobile {\n                    display: none;\n                }\n                .card-profile-desktop {\n                    display: block;\n                }\n            }\n        "}),[]);return e.jsxs(e.Fragment,{children:[n,e.jsxs(o,{className:i,style:{marginBottom:10},hoverable:!0,styles:{body:{padding:"12px 16px"}},children:[e.jsx("div",{className:"card-profile-mobile",children:e.jsxs(S,{gutter:[12,12],children:[e.jsx(N,{span:24,children:e.jsx("div",{onClick:a.onCardClick,style:{cursor:a.onCardClick?"pointer":"default"},children:e.jsx(je,{title:t.title,description:t.description,metadata:d,responsive:!0})})}),e.jsx(N,{span:24,children:e.jsxs(S,{gutter:[12,12],align:"middle",children:[e.jsx(N,{span:9,children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(B,{src:ee(t.boxImage||""),alt:`${t.title} #${t.tokenId}`,width:100,height:100,style:{objectFit:"cover"}})})}),e.jsx(N,{span:15,children:e.jsx(Se,{funds:s,selectedValue:a.selectedTokenSymbol,onSelect:a.onSelect,onDeselect:a.onDeselect})})]})})]})}),e.jsx("div",{className:"card-profile-desktop",children:e.jsxs(S,{gutter:[12,12],align:"middle",children:[e.jsx(N,{md:16,lg:17,xl:18,children:e.jsxs(S,{onClick:a.onCardClick,style:{cursor:a.onCardClick?"pointer":"default"},gutter:[12,12],align:"top",children:[e.jsx(N,{md:8,lg:7,xl:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(B,{src:ee(t.boxImage||""),alt:`${t.title} #${t.tokenId}`,width:110,height:110,style:{objectFit:"cover"}})})}),e.jsx(N,{md:16,lg:17,xl:18,children:e.jsx(je,{title:t.title,description:t.description,metadata:d,responsive:!0})})]})}),e.jsx(N,{md:8,lg:7,xl:6,children:e.jsx(Se,{funds:s,selectedValue:a.selectedTokenSymbol,onSelect:a.onSelect,onDeselect:a.onDeselect})})]})})]})]})},Be={currentPage:1,pageSize:10,loadedItems:[]},Ie={hasMoreItems:!0,showPagination:!1},Me={selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"},Ce=I((e,t)=>({pageState:Be,scrollState:Ie,filterState:Me,batchSize:4,setPageState:t=>{e(e=>({pageState:{...e.pageState,...t}}))},addLoadedItems:t=>{e(e=>{const s=new Set(e.pageState.loadedItems),r=t.filter(e=>!s.has(e));if(0===r.length)return e;const a=Array.from(new Set([...e.pageState.loadedItems,...r]));return a.sort((e,t)=>e-t),{pageState:{...e.pageState,loadedItems:a}}})},getNextIndex:()=>{const{pageState:e}=t();return 0===e.loadedItems.length?0:e.loadedItems.length},resetPageState:()=>{e(()=>({pageState:Be}))},updateScrollState:t=>{e(e=>({scrollState:{...e.scrollState,...t}}))},setFilterState:t=>{e(e=>({filterState:{...e.filterState,...t}}))},updateSelectedTab:t=>{e(e=>({filterState:{...e.filterState,selectedTab:t},pageState:{...Be},scrollState:{...Ie}}))},updateSelectedStatus:t=>{e(e=>({filterState:{...e.filterState,selectedStatus:t},pageState:{...Be},scrollState:{...Ie}}))},updateOrderBy:(t,s="desc")=>{e(e=>({filterState:{...e.filterState,orderBy:t,orderDirection:s},pageState:{...Be},scrollState:{...Ie}}))},resetAllState:()=>{e({pageState:Be,scrollState:Ie,filterState:Me})}})),Te=(e,t)=>{if(e===BigInt(0))return"0.000";try{const s=i(e,t),[r,a="0"]=s.split("."),d=a.replace(/0+$/,"").slice(0,4);return d?`${r}.${d}`:r}catch{return e.toString()}},De=({box:e,userId:t})=>{const s=Y(),a=Ce(e=>e.filterState.selectedTab),i=r.useMemo(()=>e.acceptedToken?s.find(t=>{var s;return t.address.toLowerCase()===(null==(s=e.acceptedToken)?void 0:s.toLowerCase())}):null,[e.acceptedToken,s]),d=Boolean(("bought"===a||"bade"===a)&&t&&e.acceptedToken),{orderAmountsData:n,isLoading:l}=ae(e.id,t??"",["Buyer","Bidder"]),o=r.useMemo(()=>{var s,r,a;const l=e.acceptedToken??(null==i?void 0:i.address),o=(null==i?void 0:i.decimals)??18,c=(null==i?void 0:i.symbol)??((m=l)?m.length<=10?m:`${m.slice(0,6)}...${m.slice(-4)}`:"UNKNOWN");var m;const u=[];if(d&&n&&n.length>0){const e=n.reduce((e,t)=>{try{return e+BigInt(t.amount||"0")}catch{return e}},BigInt(0));e>BigInt(0)&&u.push({amount:(h={amount:e,symbol:c,address:l??void 0,decimals:o}).amount.toString(),formattedAmount:Te(h.amount,h.decimals),symbol:h.symbol,address:h.address,decimals:h.decimals,hasValidAmount:h.amount>BigInt(0)})}var h;const x=Boolean(t&&e.refundPermit&&(null==(s=e.buyer)?void 0:s.id)&&e.buyer.id===t),p=Boolean(t&&(!(null==(r=e.buyer)?void 0:r.id)||e.buyer.id!==t)&&(null==(a=e.bidders)?void 0:a.some(e=>e.id===t))),g=x||p,w=x?"withdrawRefundAmounts":"withdrawOrderAmounts",y=x?"Refund":"Order";return{funds:{boxId:e.id,type:y,claimMethod:w,tokens:g?u:[]},hasClaimableFunds:g&&u.some(e=>e.hasValidAmount)}},[i,e.id,e.acceptedToken,e.bidders,e.buyer,e.refundPermit,n,d,t]);return{funds:o.funds,isLoading:l,hasClaimableFunds:o.hasClaimableFunds}},_e={selectedClaimMethod:null,selectedBoxes:null,selectedTokenSymbol:null,selectedTokenAddress:null,selectedTokenDecimals:null,selectedType:null},qe=e=>String(e),Le=I((e,t)=>({withdrawData:_e,registeredItems:new Map,updateWithdrawData:t=>{e(e=>({withdrawData:{...e.withdrawData,...t}}))},resetWithdrawData:()=>{e({withdrawData:_e})},registerSelectableItem:t=>{e(e=>{const s=new Map(e.registeredItems),r=`${qe(t.boxId)}-${t.tokenSymbol}`;return s.set(r,{...t,boxId:qe(t.boxId)}),{registeredItems:s}})},unregisterSelectableItem:(t,s)=>{e(e=>{const r=new Map(e.registeredItems),a=`${qe(t)}-${s}`;return r.delete(a),{registeredItems:r}})},getMatchingItems:(e,s,r)=>{const{registeredItems:a}=t(),i=[];return a.forEach(t=>{t.tokenSymbol===e&&t.type===s&&t.claimMethod===r&&t.hasValidAmount&&i.push(t)}),i},handleRadioSelect:(s,r,a,i,d)=>{const n=qe(s),l=t().withdrawData;if(!d||"0"===d||parseFloat(d)<=0)return;if(l.selectedTokenSymbol===r&&l.selectedClaimMethod===i&&l.selectedType===a){const t=l.selectedBoxes??[];if(t.includes(n))return;return void e({withdrawData:{...l,selectedBoxes:[...t,n]}})}const o=t().getMatchingItems(r,a,i),c=`${n}-${r}`,m=t().registeredItems.get(c),u=o[0]??m,h=o.map(e=>qe(e.boxId)),x=h.length>0?h:[n];e({withdrawData:{selectedClaimMethod:i,selectedTokenSymbol:r,selectedTokenAddress:(null==u?void 0:u.tokenAddress)??null,selectedTokenDecimals:(null==u?void 0:u.tokenDecimals)??null,selectedType:a,selectedBoxes:x}})},handleRadioDeselect:t=>{const s=qe(t);e(e=>{const t=(e.withdrawData.selectedBoxes||[]).filter(e=>e!==s);return 0===t.length?{withdrawData:_e}:{withdrawData:{...e.withdrawData,selectedBoxes:t}}})},isRadioSelected:(e,s)=>{const{selectedTokenSymbol:r,selectedBoxes:a}=t().withdrawData,i=qe(e);return r===s&&Array.isArray(a)&&a.includes(i)},canClaim:()=>{const{selectedBoxes:e}=t().withdrawData;return Array.isArray(e)&&e.length>0},totalAmount:()=>{const{withdrawData:e,registeredItems:s}=t(),{selectedBoxes:r,selectedTokenSymbol:a}=e;if(!r||0===r.length||!a)return BigInt(0);let i=BigInt(0);return s.forEach(e=>{if(r.includes(e.boxId)&&e.tokenSymbol===a&&e.hasValidAmount)try{i+=BigInt(e.amount||"0")}catch(t){}}),i},addBoxToSelection:t=>{const s=qe(t);e(e=>{const t=e.withdrawData.selectedBoxes||[];return t.includes(s)?e:{withdrawData:{...e.withdrawData,selectedBoxes:[...t,s]}}})},removeBoxFromSelection:t=>{const s=qe(t);e(e=>{const t=(e.withdrawData.selectedBoxes||[]).filter(e=>e!==s);return 0===t.length?{withdrawData:_e}:{withdrawData:{...e.withdrawData,selectedBoxes:t}}})},resetAllState:()=>{e({withdrawData:_e,registeredItems:new Map})}})),Ae=({data:t,userId:s,onCardClick:a,className:i})=>{const d=r.useMemo(()=>String(t.id),[t.id]),{funds:n,hasClaimableFunds:l}=De({box:t,userId:s}),o=O(e=>e.hasWithdrawInteraction),{address:c}=V(),m=O(r.useMemo(()=>{if(!c||!H)return()=>[];const e=c.toLowerCase();return t=>{var s,r;return(null==(r=null==(s=t.accounts[H])?void 0:s[e])?void 0:r.withdrawInteractions)||[]}},[c])),{withdrawData:u,handleRadioSelect:h,handleRadioDeselect:x,isRadioSelected:p,registerSelectableItem:g,unregisterSelectableItem:w}=Le();r.useEffect(()=>{if(!l)return;const e=n.tokens.filter(e=>e.hasValidAmount);return e.forEach(e=>{const t={boxId:d,tokenSymbol:e.symbol,tokenAddress:e.address,tokenDecimals:e.decimals,type:n.type,claimMethod:n.claimMethod,amount:e.amount,hasValidAmount:e.hasValidAmount};g(t)}),()=>{e.forEach(e=>{w(d,e.symbol)})}},[d,n.tokens,n.type,n.claimMethod,l,g,w]);const y=r.useMemo(()=>({tokenId:t.tokenId,title:t.title||`Box #${t.tokenId}`,description:t.description||"No description available",boxImage:t.boxImage??t.nftImage??t.image,status:t.status,country:t.country,state:t.state,eventDate:t.eventDate}),[t]),b=r.useMemo(()=>n.tokens.map(e=>!!e.address&&o(n.claimMethod,e.address)?{amount:"0",symbol:e.symbol,type:n.type,decimals:e.decimals,disabled:!0}:{amount:e.amount,symbol:e.symbol,type:n.type,decimals:e.decimals,disabled:!e.hasValidAmount||!l}),[n.tokens,n.claimMethod,n.type,l,o,m]),f=r.useMemo(()=>n.tokens.map(e=>e.symbol),[n.tokens]),j=r.useMemo(()=>{for(const e of f)if(p(d,e))return e;return""},[d,f,u.selectedBoxes,p]),v=r.useMemo(()=>({selectedTokenSymbol:j,onCardClick:a,onSelect:e=>{const t=n.tokens.find(t=>t.symbol===e);t&&t.hasValidAmount&&h(d,e,n.type,n.claimMethod,t.amount)},onDeselect:()=>{x(d)}}),[a,j,n.tokens,n.type,n.claimMethod,d,h,x]);return e.jsx(Ne,{data:y,funds:b,actions:v,className:i})},{Paragraph:$e}=y,ze=({disabled:t=!1,isLoading:s=!1,buttonText:r="Withdraw",message:a="",formattedAmount:i,tokenSymbol:d="",submit:n,cancel:l,className:o,isSuccess:c=!1,error:h})=>{const p=c?{type:"default",icon:e.jsx(M,{}),danger:!1}:h?{type:"primary",icon:e.jsx(T,{}),danger:!0}:{type:"primary",icon:void 0,danger:!1};return e.jsx(x,{type:c?"success":h?"error":"info",showIcon:!0,icon:c?e.jsx(M,{}):s?e.jsx(C,{spin:!0}):void 0,message:c?"Successfully withdrawn!":h?"Withdrawal failed":s?"Processing transaction...":`Withdrawal: ${i} ${d}`,description:e.jsxs(u,{direction:"horizontal",size:"small",style:{width:"100%"},children:[e.jsxs(u,{direction:"vertical",size:"small",children:[a&&e.jsx($e,{type:"secondary",style:{marginBottom:0,fontSize:"12px"},children:a}),h&&e.jsx($e,{type:"secondary",style:{marginBottom:0,fontSize:"12px"},children:h})]}),e.jsxs(u,{direction:"vertical",size:"small",style:{width:"100%"},children:[e.jsx(m,{...p,disabled:t||c,onClick:n,loading:s,size:"middle",block:!0,children:c?"Withdrawn":s?"Withdrawing...":h?"Retry":r}),e.jsx(m,{type:"default",disabled:t||c,onClick:l,size:"middle",block:!0,children:"Cancel"})]})]}),className:o})},Ee=["withdrawOrderAmounts","withdrawRefundAmounts"],Pe=()=>{var t;const{withdraw:s,isLoading:a,isSuccessed:i,error:d}=(()=>{const e=Y(),t=Z(),{writeCustormV3:s,error:r,isLoading:a,isSuccessed:i}=ge();return{withdraw:async()=>{const r=Le.getState().withdrawData,{selectedBoxes:a,selectedTokenSymbol:i,selectedTokenAddress:d,selectedClaimMethod:n}=r;try{if(!i||!n)throw new Error("Invalid withdraw data");if(!("withdrawOrderAmounts"!==n&&"withdrawRefundAmounts"!==n||a&&0!==a.length))throw new Error("Please select at least one box");const r=e.find(e=>e.symbol===i),l=d??(null==r?void 0:r.address);if(!l)throw new Error("Invalid token");let o=[];return o=[l,(a??[]).map(e=>BigInt(e))],await s({contract:t.FundManager,functionName:n,tokenAddress:l,args:o})}catch(l){throw l}},error:r,isLoading:a,isSuccessed:i}})(),{withdrawData:n,canClaim:l,totalAmount:o,resetWithdrawData:c}=Le();r.useEffect(()=>{if(i){const e=setTimeout(()=>{c()},2e3);return()=>clearTimeout(e)}},[i,c]);const m=l(),u=n.selectedClaimMethod,h=m&&!!u&&Ee.includes(u),x=h?o():BigInt(0),p=n.selectedTokenDecimals??18,g=n.selectedTokenSymbol??"",w=h?Q(x,p,4):"0.0000",y=(null==(t=n.selectedBoxes)?void 0:t.length)??0,b="Refund"===(n.selectedType??null)?"Refund Amount":"Order Amount";const f=h?`Selected ${y} boxes, ready to withdraw ${b}${g?`ï¼ˆ${g}ï¼‰`:""}`:"Please select the funds to withdraw";return h?e.jsx(ze,{formattedAmount:w,tokenSymbol:g,message:f,buttonText:`Withdraw ${b}`,disabled:!h||a,isLoading:a,isSuccess:i,error:null==d?void 0:d.message,submit:()=>{s().catch(e=>{})},cancel:()=>{c()},className:"mb-3!"}):null},Re=({className:t,animate:s=!0})=>{const a=s?"animate-pulse":"",i=r.useMemo(()=>e.jsx("style",{children:"\n            .skeleton-profile-mobile {\n                display: block;\n            }\n            .skeleton-profile-desktop {\n                display: none;\n            }\n            @media (min-width: 768px) {\n                .skeleton-profile-mobile {\n                    display: none;\n                }\n                .skeleton-profile-desktop {\n                    display: block;\n                }\n            }\n        "}),[]);return e.jsxs(e.Fragment,{children:[i,e.jsxs(o,{className:t,style:{marginBottom:10},styles:{body:{padding:"10px 13px"}},children:[e.jsx("div",{className:"skeleton-profile-mobile",children:e.jsxs(S,{gutter:[12,12],children:[e.jsx(N,{span:24,children:e.jsxs("div",{children:[e.jsx(D,{active:s,paragraph:{rows:0},title:{width:"80%"},style:{marginBottom:8}}),e.jsx(D,{active:s,paragraph:{rows:3,width:["100%","75%","50%"]},title:!1,style:{marginBottom:8}}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-16",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-20",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-24",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-20",a)})]})]})}),e.jsx(N,{span:24,children:e.jsxs(S,{gutter:[12,12],align:"middle",children:[e.jsx(N,{span:9,children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx("div",{className:W("bg-white/20 rounded","w-[100px] h-[100px]",a)})})}),e.jsx(N,{span:15,children:e.jsxs("div",{children:[e.jsx("div",{className:W("h-5 bg-white/20 rounded mb-3","w-32",a)}),e.jsx("div",{children:e.jsx("div",{className:W("p-[6px_10px] border border-white/20 rounded-lg mb-2",a),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:W("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:W("h-4 bg-white/20 rounded mb-1","w-20",a)}),e.jsx("div",{className:W("h-3 bg-white/20 rounded","w-12",a)})]})]})})})]})})]})})]})}),e.jsx("div",{className:"skeleton-profile-desktop",children:e.jsxs(S,{gutter:[12,12],align:"middle",children:[e.jsx(N,{md:16,lg:17,xl:18,children:e.jsxs(S,{gutter:[12,12],align:"top",children:[e.jsx(N,{md:8,lg:7,xl:6,children:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("div",{className:W("bg-white/20 rounded","w-[110px] h-[110px]",a)})})}),e.jsx(N,{md:16,lg:17,xl:18,children:e.jsxs("div",{children:[e.jsx(D,{active:s,paragraph:{rows:0},title:{width:"75%"},style:{marginBottom:8}}),e.jsx(D,{active:s,paragraph:{rows:3,width:["100%","80%","60%"]},title:!1,style:{marginBottom:8}}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-16",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-20",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-24",a)}),e.jsx("div",{className:W("h-6 bg-white/20 rounded-md","w-20",a)})]})]})})]})}),e.jsx(N,{md:8,lg:7,xl:6,children:e.jsxs("div",{children:[e.jsx("div",{className:W("h-5 bg-white/20 rounded mb-3","w-32",a)}),e.jsxs("div",{children:[e.jsx("div",{className:W("p-[6px_10px] border border-white/20 rounded-lg mb-2",a),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:W("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:W("h-4 bg-white/20 rounded mb-1","w-20",a)}),e.jsx("div",{className:W("h-3 bg-white/20 rounded","w-12",a)})]})]})}),e.jsx("div",{className:W("p-[6px_10px] border border-white/20 rounded-lg",a),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:W("w-4 h-4 bg-white/20 rounded-full shrink-0",a)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:W("h-4 bg-white/20 rounded mb-1","w-16",a)}),e.jsx("div",{className:W("h-3 bg-white/20 rounded","w-10",a)})]})]})})]})]})})]})})]})]})},We={white:"text-white","gray-3":"text-gray-300","gray-5":"text-gray-500",black:"text-black","muted-foreground":"text-muted-foreground",primary:"text-primary",secondary:"text-secondary"},Fe={xs:"text-xs",sm:"text-sm",md:"text-md",lg:"text-lg"},Ve={light:"font-light",normal:"font-normal",medium:"font-medium",semibold:"font-semibold"},Oe={1:"line-clamp-1",2:"line-clamp-2",3:"line-clamp-3",4:"line-clamp-4",5:"line-clamp-5",6:"line-clamp-6",none:""};function Ke({children:t,color:s="white",size:r="md",weight:a="normal",lineClamp:i=2,isCopy:d=!1,className:n,maxLength:l,maxWidth:o}){const c=null==n?void 0:n.match(/text-(xs|sm|md|lg)/);let m=t,u=!1;"string"==typeof t&&l&&t.length>l&&(m=t.slice(0,l)+"...",u=!0);const h=String(m),x=String(t);return e.jsx(y.Paragraph,{className:W("leading-relaxed font-mono",We[s],!c&&Fe[r],Ve[a],Oe[i],n),style:o?{maxWidth:"number"==typeof o?o+"px":o}:void 0,title:u?x:void 0,copyable:!!d&&{text:x,icon:[e.jsx(_,{className:"h-4 w-4"},"copy"),e.jsx(q,{className:"h-4 w-4 text-green-500"},"check")],tooltips:["Copy","Copied!"]},children:h})}function He({open:t,closable:s=!1,onCancel:r,title:a="Loading..."}){return e.jsx(L,{open:t,footer:null,closable:s,onCancel:r,maskClosable:!1,centered:!0,width:600,children:e.jsxs("div",{className:"flex flex-col justify-center items-center gap-4 h-full",children:[e.jsx(Ke,{color:"muted-foreground",className:"mb-4",children:a}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(A,{className:"animate-spin",size:30})})]})})}const Ue=e=>e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null;const Ge=(e,t)=>{const{network:s,layer:r}=F,{data:i,isLoading:d,isError:n,error:l,isSuccess:o}=a({queryKey:["user-profile",s,r,e,t],queryFn:async()=>{if(!e)return null;const s=await async function(e,t){try{const s={totalBoxes:0,ownedBoxes:0,mintedBoxes:0,soldBoxes:0,boughtBoxes:0,bidBoxes:0,completedBoxes:0,publishedBoxes:0},{count:r}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("owner_address",e.toLowerCase());if(s.ownedBoxes=r||0,t){const{count:r}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("minter_id",t);s.mintedBoxes=r||0;const{count:a}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("seller_id",t);s.soldBoxes=a||0;const{count:i}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("buyer_id",t);s.boughtBoxes=i||0;const{count:d}=await X.from("box_bidders").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("bidder_id",t);s.bidBoxes=d||0;const{count:n}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("completer_id",t);s.completedBoxes=n||0;const{count:l}=await X.from("boxes").select("*",{count:"exact",head:!0}).eq("network",F.network).eq("layer",F.layer).eq("publisher_id",t);s.publishedBoxes=l||0;const{data:o}=await X.from("boxes").select("id").eq("network",F.network).eq("layer",F.layer).or(`owner_address.eq.${e.toLowerCase()},minter_id.eq.${t},seller_id.eq.${t},buyer_id.eq.${t},completer_id.eq.${t},publisher_id.eq.${t}`),{data:c}=await X.from("box_bidders").select("id").eq("network",F.network).eq("layer",F.layer).eq("bidder_id",t),m=new Set;null==o||o.forEach(e=>m.add(e.id)),null==c||c.forEach(e=>m.add(e.id)),s.totalBoxes=m.size}else s.totalBoxes=s.ownedBoxes;return{data:s,error:null}}catch(l){return{data:null,error:Ue(l)}}}(e,t);if(s.error)throw s.error;return s.data},enabled:!!e,staleTime:3e4});return{data:i?{id:t||e,address:e||"",stats:{totalBoxes:i.totalBoxes,ownedBoxes:i.ownedBoxes,mintedBoxes:i.mintedBoxes,soldBoxes:i.soldBoxes,boughtBoxes:i.boughtBoxes,bidBoxes:i.bidBoxes,completedBoxes:i.completedBoxes,publishedBoxes:i.publishedBoxes},allBoxes:[],ownedBoxes:[],mintedBoxes:[],soldBoxes:[],boughtBoxes:[],bidBoxes:[],completedBoxes:[],publishedBoxes:[]}:null,isLoading:d,isError:n,error:l||null,isSuccess:o}},Ye=e=>{var t;const s=e.metadata_boxes,r=te(e.status,e.deadline,e.buyer_id);return{id:e.id,tokenId:e.token_id,price:e.price,deadline:e.deadline,status:r,createTimestamp:e.create_timestamp,boxInfoCID:e.box_info_cid||void 0,acceptedToken:e.accepted_token||void 0,refundPermit:e.refund_permit||!1,listedMode:e.listed_mode||void 0,owner:{id:e.owner_address},minter:{id:e.minter_id},seller:e.seller_id?{id:e.seller_id}:void 0,buyer:e.buyer_id?{id:e.buyer_id}:void 0,completer:e.completer_id?{id:e.completer_id}:void 0,publisher:e.publisher_id?{id:e.publisher_id}:void 0,bidders:(null==(t=e.box_bidders)?void 0:t.map(e=>({id:e.bidder_id})))||[],title:(null==s?void 0:s.title)||void 0,description:(null==s?void 0:s.description)||void 0,nftImage:(null==s?void 0:s.nft_image)||void 0,boxImage:(null==s?void 0:s.box_image)||void 0,country:(null==s?void 0:s.country)||void 0,state:(null==s?void 0:s.state)||void 0,eventDate:(null==s?void 0:s.event_date)||void 0,typeOfCrime:(null==s?void 0:s.type_of_crime)||void 0,hasError:!1}},Ze=(e,t,s)=>{const{network:r,layer:a}=F,{data:i,isLoading:d,isError:n,error:l,isSuccess:o,fetchNextPage:c,hasNextPage:m,isFetchingNextPage:u}=$({queryKey:["user-boxes",r,a,e,s,t],queryFn:async({pageParam:r})=>{if(!e)return{items:[],hasMore:!1};const a=await async function(e,t,s,r=20,a=0){try{let i=X.from("boxes").select("\n                *,\n                metadata_boxes (*),\n                box_bidders (*)\n            ").eq("network",F.network).eq("layer",F.layer);switch(s.selectedTab){case"owned":i=i.eq("owner_address",e.toLowerCase());break;case"minted":if(!t)return{data:[],error:null};i=i.eq("minter_id",t);break;case"sold":if(!t)return{data:[],error:null};i=i.eq("seller_id",t);break;case"bought":if(!t)return{data:[],error:null};i=i.eq("buyer_id",t);break;case"bade":if(!t)return{data:[],error:null};const{data:s,error:r}=await X.from("box_bidders").select("id").eq("network",F.network).eq("layer",F.layer).eq("bidder_id",t);if(r)return{data:null,error:r};const a=(null==s?void 0:s.map(e=>e.id))||[];if(0===a.length)return{data:[],error:null};i=i.in("id",a);break;case"completed":if(!t)return{data:[],error:null};i=i.eq("completer_id",t);break;case"published":if(!t)return{data:[],error:null};i=i.eq("publisher_id",t);break;default:i=t?i.or(`owner_address.eq.${e.toLowerCase()},minter_id.eq.${t},seller_id.eq.${t},buyer_id.eq.${t},completer_id.eq.${t},publisher_id.eq.${t}`):i.eq("owner_address",e.toLowerCase())}switch(s.selectedStatus&&(i=i.eq("status",s.selectedStatus)),s.orderBy){case"tokenId":i=i.order("id",{ascending:"asc"===s.orderDirection});break;case"price":i=i.order("price",{ascending:"asc"===s.orderDirection});break;case"createTimestamp":i=i.order("create_timestamp",{ascending:"asc"===s.orderDirection});break;default:i=i.order("create_timestamp",{ascending:!1})}i=i.range(a,a+r-1);const{data:d,error:n}=await i;return n?{data:null,error:n}:{data:d,error:null}}catch(l){return{data:null,error:Ue(l)}}}(e,s,t,20,r);if(a.error)throw a.error;const i=(a.data||[]).map(Ye);return{items:i,hasMore:20===i.length}},initialPageParam:0,getNextPageParam:(e,t)=>{if(e.hasMore)return t.reduce((e,t)=>e+t.items.length,0)},enabled:!!e,staleTime:3e4});return{data:{pages:(null==i?void 0:i.pages)||[{items:[],hasMore:!1}],pageParams:(null==i?void 0:i.pageParams)||[0]},isLoading:d,isError:n,error:l||null,isSuccess:o,fetchNextPage:c,hasNextPage:m||!1,isFetchingNextPage:u}},Xe=({address:t,userId:s,className:a})=>{const{filters:i,updateTab:d}=(()=>{const{setFilterState:e}=Ce(),[t,s]=r.useState({selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"}),a=r.useMemo(()=>[{id:"tokenId",accessorKey:"tokenId",header:"Token ID"},{id:"price",accessorKey:"price",header:"Price"},{id:"deadline",accessorKey:"deadline",header:"Deadline"},{id:"status",accessorKey:"status",header:"Status"}],[]);return{table:z({data:[],columns:a,state:{sorting:[{id:t.orderBy,desc:"desc"===t.orderDirection}]},onSortingChange:t=>{const r="function"==typeof t?t([]):t;r[0]&&(s(e=>({...e,orderBy:r[0].id,orderDirection:r[0].desc?"desc":"asc"})),e({orderBy:r[0].id,orderDirection:r[0].desc?"desc":"asc"}))},getCoreRowModel:P(),getSortedRowModel:E()}),filters:t,setFilters:s,updateTab:t=>{s(e=>({...e,selectedTab:t})),e({selectedTab:t})},updateStatus:t=>{s(e=>({...e,selectedStatus:t})),e({selectedStatus:t})},updateSorting:(t,r)=>{s(e=>({...e,orderBy:t,orderDirection:r})),e({orderBy:t,orderDirection:r})},resetFilters:()=>{s({selectedTab:"all",selectedStatus:void 0,orderBy:"tokenId",orderDirection:"desc"})}}})();(()=>{const{filterState:e}=Ce(),{resetWithdrawData:t}=Le(),s=r.useRef(e.selectedTab);r.useEffect(()=>{s.current!==e.selectedTab&&(t(),s.current=e.selectedTab)},[e.selectedTab,t])})();const n=t??"",l=s??"",{data:o,isLoading:c,error:m}=Ge(n,l),{data:u,isLoading:h,fetchNextPage:x,hasNextPage:p,isFetchingNextPage:g,error:w}=Ze(n,i,l),y=r.useMemo(()=>(null==u?void 0:u.pages.flatMap(e=>e.items))??[],[u]),b=R(),[f,j]=r.useState(!1),[v,k]=r.useState(!1),S=r.useCallback(e=>{j(!0),b(`/boxDetail/${e}`)},[b]),N=r.useCallback(()=>{k(!0),window.location.reload()},[]),B=r.useCallback(()=>{x()},[x]),I=c||h,M=Boolean(m||w);return e.jsxs("div",{className:W("space-y-6",a),children:[M?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-400",children:"The data loading failed"}),e.jsx("p",{className:"text-foreground/70",children:"Something went wrong while loading boxes"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",disabled:v,children:v?"Refreshing...":"Reload"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(fe,{data:null==o?void 0:o.stats,loading:c,selectedTab:i.selectedTab,onTabClick:d}),e.jsx(Pe,{className:"w-full"}),e.jsx("div",{className:"w-full",children:I&&0===y.length?e.jsx("div",{className:"space-y-4",children:Array.from({length:3},(t,s)=>e.jsx(Re,{},s))}):y.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full space-y-3 sm:space-y-4 md:space-y-6",children:y.map(t=>e.jsx(Ae,{data:t,userId:s,onCardClick:()=>S(t.id)},t.id))}),p&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("button",{onClick:B,disabled:g,className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50",children:g?"Loading...":"Load more"})})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"No data"}),e.jsx("p",{className:"text-foreground/70",children:"You don't have any boxes"})]})})})]}),e.jsx(He,{open:f,closable:!0})]})},Je=({className:t})=>{const{address:s}=V(),a=U(),i=a&&""!==a.trim()?a.trim():null,[d,n]=r.useState("rewards");return e.jsxs(G,{className:W("space-y-6 py-6",t),children:[e.jsx(de,{active:d,onChange:n}),"rewards"===d?e.jsx(be,{userId:i}):e.jsx(Xe,{address:s,userId:i})]})},Qe=()=>e.jsx(e.Fragment,{children:e.jsx(Je,{})});export{Qe as default};
