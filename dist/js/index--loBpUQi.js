import{j as e,aB as s,S as t,aC as n,T as r,aA as a,A as i,aH as l,M as o,aI as c,aJ as d,aK as u,aL as p,aM as h,u as m,r as y,ar as v,as as x,aq as g,aN as w,at as f,aO as b,aP as k,B as j,a3 as S,a8 as C,aD as E,aQ as T,aR as P,z as I,a9 as A}from"./vendor-BDtTUao2.js";import{b as _,O as R,a as B}from"./index-DzM9oNjl.js";import{b as O,u as N,c as L}from"./hooks-CTGY0WO4.js";import{u as W,a as z,b as $,c as q,P as M}from"./useReadAllowance-RfFW3xzR.js";import{t as K}from"./time-LdUI4bCQ.js";import{T as F}from"./text_p-y92iNKCg.js";const U=(e,s=3)=>{try{const t=parseFloat(e);return isNaN(t)?e:t.toFixed(s)}catch(t){return e}},D=["magenta","red","volcano","orange","gold","lime","green","cyan","blue","geekblue","purple","pink"],V=e=>{let s=0;for(let n=0;n<e.length;n++)s=(s<<5)-s+e.charCodeAt(n),s&=s;const t=Math.abs(s)%D.length;return D[t]},{Title:Y}=r,G=({nativeBalances:r,erc20Tokens:l,scope:o})=>e.jsx(s,{children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(n,{children:[e.jsx(Y,{level:3,children:"Token Balances:"}),"consensus"!==o.layer&&r.length>0&&e.jsx(n,{children:r.map((s,t)=>e.jsxs(a,{style:{marginLeft:"10px",fontSize:"16px",display:"flex",alignItems:"center"},color:"blue",children:[s.token_symbol||"Unknown"," ",U(s.balance)]},"NativeToken"+t))})]}),"consensus"!==o.layer&&l.length>0&&e.jsx(s,{title:"ERC20 Token Balances",size:"small",children:e.jsx(n,{gutter:[16,16],children:l.map(s=>e.jsxs(a,{style:{fontSize:"14px",padding:"5px 10px"},color:V(s.address),children:[s.symbol||s.name||"Unknown"," ",U(s.balance)]},"ERC20Token"+s.address))})}),0===r.length&&0===l.length&&e.jsx(i,{type:"info",message:"You don't have any tokens yet. Use the Faucet tab to mint some test tokens.",showIcon:!0})]})}),H={ROSE:{ticker:"ROSE",geckoId:"oasis-network"},TEST:{ticker:"TEST",free:!0}},Q={mainnet:{tokens:[H.ROSE]},testnet:{tokens:[H.TEST]},localnet:{tokens:[H.TEST]},decimals:9},X={sapphire:{mainnet:{address:"oasis1qrd3mnzhhgst26hsp96uf45yhq6zlax0cuzdgcfc",blockGasLimit:15e6,runtimeId:"000000000000000000000000000000000000000000000000f80306c9858e7279",tokens:[H.ROSE]},testnet:{address:"oasis1qqczuf3x6glkgjuf0xgtcpjjw95r3crf7y2323xd",blockGasLimit:15e6,runtimeId:"000000000000000000000000000000000000000000000000a6d1e3ebf60dff6c",tokens:[H.TEST]},localnet:{address:"",blockGasLimit:15e6,runtimeId:"",tokens:[H.TEST]},decimals:18,type:"evm",offerRoflTxTypes:!0},consensus:null},J=e=>e?e.split(",").filter(e=>!!e).map(e=>e.trim()):[];J("https://explorer.oasis.io, https://explorer.prd.oasis.io"),J("https://explorer.stg.oasis.io");const Z=e=>{var s,t;return e?"consensus"===e.layer?Q[e.network].tokens:null==(t=null==(s=null==X?void 0:X[e.layer])?void 0:s[e.network])?void 0:t.tokens:[]},ee=(e,s,t,n)=>{var r;if(!(null==(r=e.url)?void 0:r.startsWith(s)))return!1;const a=(i=t??"").endsWith("/")?i:`${i}/`;var i;if(!t)throw new Error(`[oasisQuery] Missing environment variable ${n}. Please define it in your .env file.`);return e.url=e.url.replace(s,a),!0},se="ERC20",te=(e,s,t,n,r)=>((e,s)=>{if(!(ee(e,"/mainnet/","https://nexus.oasis.io/v1/","REACT_APP_API")||ee(e,"/testnet/","https://testnet.nexus.oasis.io/v1/","REACT_APP_TESTNET_API")||ee(e,"/localnet/","http://localhost:8547/v1/","REACT_APP_LOCALNET_API")))throw new Error(`Expected URL to be prefixed with network: ${e.url}`);return l({...e,...s})})({url:`/${encodeURIComponent(String(e))}/${encodeURIComponent(String(s))}/accounts/${encodeURIComponent(String(t))}`,method:"GET",signal:r},n),ne=(e,s,t)=>[`/${e}/${s}/accounts/${t}`];function re(e,s,t,n){const r=((e,s,t,n)=>{const{query:r,request:a}=n??{};return{queryKey:(null==r?void 0:r.queryKey)??ne(e,s,t),queryFn:({signal:n})=>te(e,s,t,a,n),enabled:!!(e&&s&&t),...r}})(e,s,t,n),a=o(r);return a.queryKey=r.queryKey,a}const ae=e=>/^0x[0-9a-fA-F]{40}$/.test(e);const ie=e=>{if((e=>{try{return u.staking.addressFromBech32(e),!0}catch(s){return!1}})(e))return e;if(ae(e))return function(e){const s=u.misc.fromHex(e.replace("0x","")),t=u.address.fromData(p.address.V0_SECP256K1ETH_CONTEXT_IDENTIFIER,p.address.V0_SECP256K1ETH_CONTEXT_VERSION,s);return u.staking.addressToBech32(t)}(e);throw new Error("Invalid address")},le=e=>{try{return ie(e)}catch(s){return null}};function oe(e){return c((s=e,`0x${d.Buffer.from(s,"base64").toString("hex")}`));var s}function ce(e){if("oasis-runtime-sdk/address: secp256k1eth"===(null==e?void 0:e.context)&&e.address_data)return oe(e.address_data)}function de(e,s){const t=new h(e).shiftedBy(-s);if(t.isNaN())throw new Error(`Not a number in fromBaseUnits(${e})`);return t.toFixed()}const ue={mainnet:"https://grpc.oasis.io",testnet:"https://testnet.grpc.oasis.io",localnet:"http://localhost:8544."};function pe(e){return null==e?[]:Array.isArray(e)?e:[e]}function he(e,s){if(e&&s&&ae(s)&&le(s)===e)return c(s)}const me=(e,s,t,n)=>{var r,a,i,c;const d=(null==(r=null==n?void 0:n.query)?void 0:r.queryKey)??ne(e,s,t),h=re(e,s,t,{...n,query:{...(null==n?void 0:n.query)??{},queryKey:d,enabled:!!t&&((null==(a=null==n?void 0:n.query)?void 0:a.enabled)??!0)},request:{...null==n?void 0:n.request,transformResponse:[...pe(l.defaults.transformResponse),(n,r,a)=>{var i,l,o,c;return 200!==a?n:(e=>{const s={};return e.evm_balances.forEach(e=>{var t;e.token_type&&(s[t=e.token_type]??(s[t]=[]),s[e.token_type].push(e))}),{...e,tokenBalances:s}})({...n,address_eth:ce(n.address_preimage)||he(n.address,t),evm_contract:n.evm_contract&&{...n.evm_contract,eth_creation_tx:n.evm_contract.eth_creation_tx?`0x${n.evm_contract.eth_creation_tx}`:void 0},evm_balances:(n.evm_balances||[]).filter(e=>e.balance).map(e=>({...e,balance:de(e.balance,e.token_decimals)})),balances:(n.balances||[]).filter(e=>e.balance).map(e=>({...e,balance:de(e.balance,e.token_decimals)})),layer:s,network:e,stats:{...n.stats,total_received:(null==(i=n.stats)?void 0:i.total_received)?de(null==(l=n.stats)?void 0:l.total_received,X[s].decimals):"0",total_sent:(null==(o=n.stats)?void 0:o.total_sent)?de(null==(c=n.stats)?void 0:c.total_sent,X[s].decimals):"0"}})},...pe(null==(i=null==n?void 0:n.request)?void 0:i.transformResponse)]}}),m=null==(c=h.data)?void 0:c.data,y=le(t),v=o({enabled:!!y,queryKey:[y,e,s],queryFn:async()=>{if(!y)throw new Error("Needed to fix types - see `enabled`");return await async function(e,s){const t=X[s.layer][s.network];if(!(null==t?void 0:t.runtimeId))throw new Error("Paratime is not configured");const n=new u.client.NodeInternal(ue[s.network]),r=new p.accounts.Wrapper(u.misc.fromHex(t.runtimeId));return[...(await r.queryBalances().setArgs({address:u.staking.addressFromBech32(e)}).query(n)).balances.entries()].map(([e,t])=>({balance:u.quantity.toBigInt(t).toString(),token_symbol:u.misc.toStringUTF8(e)||Z(s)[0].ticker,token_decimals:X[s.layer].decimals})).map(e=>({...e,balance:de(e.balance,e.token_decimals)}))}(y,{network:e,layer:s})}}).data,x=v&&m?{...m,balances:v}:m;return{...h,data:h.data?{...h.data,data:x}:h.data}};Array(100).keys();const ye=()=>{const{address:e}=m(),s=O(),t=y.useMemo(()=>({network:s.network,layer:s.layer}),[s]),{data:n,isLoading:r,error:a}=(({scope:e,address:s,enabled:t=!0})=>{if("consensus"===e.layer)throw new Error("Consensus layer queries are not supported. Only Sapphire runtime is supported.");return me(e.network,e.layer,s,{query:{queryKey:ne(e.network,e.layer,s),enabled:t&&!!s}})})({scope:t,address:e,enabled:!!e}),i=null==n?void 0:n.data,l=y.useMemo(()=>i&&"balances"in i&&i.balances||[],[i]),o=y.useMemo(()=>i&&"evm_balances"in i?(i.evm_balances||[]).filter(e=>e.token_type===se).map(e=>({address:e.token_contract_addr_eth,symbol:e.token_symbol||"UNKNOWN",name:e.token_name||"Unknown Token",decimals:e.token_decimals,balance:e.balance})):[],[i]),c=y.useMemo(()=>l.map(e=>({address:"0x0000000000000000000000000000000000000000",symbol:e.token_symbol||s.nativeCurrency.symbol,name:e.token_symbol||s.nativeCurrency.name,decimals:e.token_decimals,balance:e.balance})),[l,s]),d=y.useMemo(()=>[...c,...o],[c,o]);return{nativeBalances:l,erc20Tokens:o,allTokens:d,isLoading:r,error:a,scope:t}},ve=y.createContext(null),xe=({children:s})=>{const{address:t}=m(),n=ye(),r=(e=>{const s=N(),[t,n]=y.useState(0),r=y.useMemo(()=>{const t=[],n=e.filter(e=>!e.symbol.endsWith(".S")),r=s.filter(e=>"Secret"===e.types);return n.forEach(e=>{const n="0x0000000000000000000000000000000000000000"===e.address&&("wROSE"===e.symbol.toUpperCase()||"TEST"===e.symbol.toUpperCase());let a,i=null,l=null,o=e.address;if(n){const e=s.find(e=>"wROSE"===e.symbol&&"ERC20"===e.types);e&&(o=e.address),a="wROSE.S",i=r.find(e=>e.symbol===a)||null}else a=`${e.symbol}.S`,i=r.find(e=>e.symbol===a)||null;i&&(l={address:i.address,symbol:i.symbol,name:i.name,decimals:i.decimals,balance:"0"});const c={...e,address:o};t.push({erc20:c,secret:l||null,isNativeROSE:n})}),t},[e,s]);y.useEffect(()=>{r.length>0&&t>=r.length&&n(0)},[r,t]);const a=y.useMemo(()=>r[t]||null,[r,t]),i=y.useMemo(()=>r.filter(e=>e.secret&&parseFloat(e.secret.balance)>0),[r]);return{tokenPairs:r,selectedPair:a,selectedPairIndex:t,setSelectedPairIndex:n,pairsWithSecretBalance:i,supportedTokens:s}})(n.allTokens),a=y.useMemo(()=>({address:t,nativeBalances:n.nativeBalances,erc20Tokens:n.erc20Tokens,allTokens:n.allTokens,scope:n.scope,isBalancesLoading:n.isLoading,balancesError:n.error,tokenPairs:r.tokenPairs,selectedPair:r.selectedPair,selectedPairIndex:r.selectedPairIndex,setSelectedPairIndex:r.setSelectedPairIndex,pairsWithSecretBalance:r.pairsWithSecretBalance}),[t,n.nativeBalances,n.erc20Tokens,n.allTokens,n.scope,n.isLoading,n.error,r.tokenPairs,r.selectedPair,r.selectedPairIndex,r.setSelectedPairIndex,r.pairsWithSecretBalance]);return e.jsx(ve.Provider,{value:a,children:s})},ge=()=>{const e=y.useContext(ve);if(!e)throw new Error("useTokenPage must be used within TokenPageProvider");return e},we=()=>{const{writeToken:e,status:s,isPending:t,isError:n,isSuccessed:r,isLoading:a}=(()=>{const{writeContractAsync:e,data:s,error:t,isPending:n,isError:r,isSuccess:a,status:i,reset:l}=v(),o=N(),{isSuccess:c}=x({hash:s});return y.useEffect(()=>{r&&l()},[r,l]),{writeToken:async s=>{try{const t=o.find(e=>e.address.toLowerCase()===s.contractAddress.toLowerCase());if(!t)throw new Error("Token metadata not found");return await e({address:s.contractAddress,abi:t.abi,functionName:s.functionName,args:s.args,value:s.value})}catch(t){throw t}},hash:s,error:t,isPending:n,isLoading:"idle"!==i&&"error"!==i&&!c,isSuccess:a,isError:r,status:i,isSuccessed:c,reset:l}})(),{address:i}=m(),[l,o]=y.useState(null),[c,d]=y.useState(null);return{transfer:y.useCallback(async(s,t,n,r)=>{if(!i)throw new Error("Wallet not connected");try{const a=g(n,r);o("transfer"),d(null),e({contractAddress:s,functionName:"transfer",args:[t,a]})}catch(a){throw d(a),o(null),a}},[i,e]),burn:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{const r=g(t,n);o("burn"),d(null),e({contractAddress:s,functionName:"burn",args:[r]})}catch(r){throw d(r),o(null),r}},[i,e]),wrap:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{const r=g(t,n);o("wrap"),d(null),e({contractAddress:s,functionName:"wrap",args:[r]})}catch(r){throw d(r),o(null),r}},[i,e]),unwrap:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{const r=g(t,n);o("unwrap"),d(null),e({contractAddress:s,functionName:"unwrap",args:[r]})}catch(r){throw d(r),o(null),r}},[i,e]),deposit:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{const r=g(t,n);o("deposit"),d(null),e({contractAddress:s,functionName:"deposit",args:[],value:r})}catch(r){throw d(r),o(null),r}},[i,e]),withdraw:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{const r=g(t,n);o("withdraw"),d(null),e({contractAddress:s,functionName:"withdraw",args:[r]})}catch(r){throw d(r),o(null),r}},[i,e]),approve:y.useCallback(async(s,t,n)=>{if(!i)throw new Error("Wallet not connected");try{o("approve"),d(null),e({contractAddress:s,functionName:"approve",args:[t,n]})}catch(r){throw d(r),o(null),r}},[i,e]),isPending:t,isLoading:a,activeButton:l,error:c,status:s,isError:n,isSuccessed:r}},fe={allowance:{title:"Checking allowance...",descriptions:{idle:"Checking allowance...",pending:"Checking allowance...",success:"Allowance is enough",error:"Checking allowance failed"}},approve:{title:"Approve",descriptions:{idle:"Need to approve",pending:"Approving...",success:"Approve success",error:"Approve failed"}},wrap:{title:"Wrap",descriptions:{idle:"Ready to wrap",pending:"Executing wrap operation...",success:"Wrap operation success",error:"Wrap operation failed"}}},be=e=>{const s=[{stepKey:"allowance",title:fe.allowance.title,description:fe.allowance.descriptions.success,status:"finish"}];return e&&s.push({stepKey:"approve",title:fe.approve.title,description:fe.approve.descriptions.idle,status:"wait"}),s.push({stepKey:"wrap",title:fe.wrap.title,description:fe.wrap.descriptions.idle,status:"wait"}),s},{Text:ke}=r,je=({open:s,onClose:n,tokenPair:r,amount:a})=>{var l,o;const{steps:c,checkAllowance:d,handleApproveClick:u,handleApproveMaxClick:p,handleWrapClick:h,isLoading:v,isSuccessed:x,status:S,currentStepItem:C,allowanceAmount:E}=((e,s)=>{const{address:t}=m(),{readAllowance:n,allowanceAmount:r}=W(),{wrap:a,approve:i,status:l,isLoading:o,isPending:c,isSuccessed:d,activeButton:u}=we(),[p,h]=y.useState({steps:be(!1),currentIndex:1}),v=y.useCallback(e=>{const s=be(!e);h({steps:s,currentIndex:1})},[]),x=y.useCallback((e,s)=>{h(t=>{const n=t.steps.findIndex(s=>s.stepKey===e);if(-1===n)return t;const r=(e=>{switch(e){case"pending":return"process";case"success":return"finish";case"error":return"error";default:return"wait"}})(s),a=fe[e].descriptions[s],i=t.steps.map((e,s)=>s===n?{...e,status:r,description:a}:e);let l=t.currentIndex;const o=n===t.currentIndex,c=n<i.length-1;return"finish"===r&&o&&c&&(l=n+1),{steps:i,currentIndex:l}})},[]),{steps:f,currentIndex:b}=p,k=f[b]??f[f.length-1],j=y.useCallback(async r=>{var a,i;if(!(t&&e.erc20.address&&s&&(null==(a=e.secret)?void 0:a.address)))return;const l=g(s,e.erc20.decimals);try{const s=await n(e.erc20.address,t,null==(i=e.secret)?void 0:i.address,l);"init"===r&&v(s.isEnough)}catch(o){x("allowance","error")}},[e,s,n,t,v]);y.useEffect(()=>{"approve"===u?"idle"!==l&&x("approve",l):"wrap"===u&&"idle"!==l&&x("wrap",l)},[u,l]);const S=y.useCallback(async()=>{var t,n;if(!e||!s||!(null==(t=e.secret)?void 0:t.address))return;const r=g(s,e.erc20.decimals);try{await i(e.erc20.address,null==(n=e.secret)?void 0:n.address,r)}catch(a){x("approve","error")}},[e,s,i,x]),C=y.useCallback(async()=>{var s,t;if(!e||!(null==(s=e.secret)?void 0:s.address))return;const n=w;try{await i(e.erc20.address,null==(t=e.secret)?void 0:t.address,n)}catch(r){x("approve","error")}},[e,i,x]),E=y.useCallback(async()=>{var t,n;e&&s&&(null==(t=e.secret)?void 0:t.address)&&await a(null==(n=e.secret)?void 0:n.address,s,e.erc20.decimals)},[e,s,a]);return{steps:f,currentIndex:b,currentStepItem:k,initializeSteps:v,updateStepStatus:x,checkAllowance:j,handleApproveClick:S,handleApproveMaxClick:C,handleWrapClick:E,isPending:c,isLoading:o,isSuccessed:d,status:l,activeButton:u,allowanceAmount:r}})(r,a),T="approve"===C.stepKey&&"finish"!==C.status,P="wrap"===C.stepKey&&"finish"!==C.status,I=y.useMemo(()=>c.map(({stepKey:e,...s})=>({key:e,...s})),[c]);y.useEffect(()=>{s&&d("init")},[s]);const A=()=>{n()};return e.jsx(f,{title:"Wrap operation process",open:s,onCancel:A,closable:"pending"!==S,maskClosable:"pending"!==S,footer:[e.jsx(j,{onClick:A,disabled:"pending"===S||v,children:x?"Complete":"Cancel"},"close")],width:450,centered:!0,children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(i,{type:"info",message:e.jsxs(t,{direction:"vertical",size:"small",children:[e.jsxs(ke,{strong:!0,children:[r.erc20.symbol," - ",(null==(l=r.secret)?void 0:l.symbol)||`${r.erc20.symbol}.S`]}),e.jsxs(ke,{children:["Amount: ",a," ",r.erc20.symbol]})]}),showIcon:!0}),e.jsx(b,{direction:"vertical",items:I,size:"small"}),T&&e.jsxs(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(i,{type:"warning",message:e.jsx(t,{direction:"vertical",size:"small",children:e.jsxs(ke,{children:["Allowance is not enough. Current: ",k(E,r.erc20.decimals),", Required: ",a]})}),showIcon:!0}),e.jsx(j,{type:"primary",onClick:u,loading:v,disabled:!T,block:!0,children:v?"Waiting...":`Approve ${a} ${r.erc20.symbol}...`}),e.jsx(j,{type:"primary",onClick:p,loading:v,disabled:!T,block:!0,children:v?"Waiting...":"Approve Max(uint256)"})]}),"approve"===C.stepKey&&"process"===C.status&&e.jsx(i,{type:"info",message:"Approving token...",showIcon:!0}),P&&e.jsx(j,{type:"primary",onClick:h,loading:v,disabled:!P,block:!0,children:v?"Waiting...":`Wrap ${a} ${r.erc20.symbol} to ${(null==(o=r.secret)?void 0:o.symbol)||"Secret Token"}...`}),c.some(e=>"error"===e.status)&&e.jsx(i,{type:"error",message:"Operation failed",description:"Please check network connection and wallet status, then try again.",showIcon:!0}),x&&e.jsx(i,{type:"success",message:"Wrap operation completed successfully",showIcon:!0})]})})},{Text:Se}=r,{Option:Ce}=S,Ee=({tokenPairs:s,selectedPairIndex:n=0,onPairChange:r,isLoading:a})=>{var l,o;const[c,d]=y.useState(""),[u,p]=y.useState(!1),h=s[n]||s[0],m=y.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&d(s)},[]),v=y.useCallback(()=>{(null==h?void 0:h.erc20)&&h.erc20.balance&&d(U(h.erc20.balance))},[h]),x=y.useCallback(()=>{var e;c&&h&&(null==(e=h.secret)?void 0:e.address)&&p(!0)},[c,h]);return h?e.jsxs(e.Fragment,{children:[e.jsxs(t,{direction:"vertical",size:"middle",children:[s.length>1&&e.jsx(S,{value:n,onChange:r,style:{width:"100%"},disabled:a,children:s.map((s,t)=>{var n;return e.jsxs(Ce,{value:t,children:[s.erc20.symbol," - ",(null==(n=s.secret)?void 0:n.symbol)||`${s.erc20.symbol}.S`]},t)})}),e.jsx(t.Compact,{style:{width:"100%"},children:e.jsx(C,{placeholder:"Amount",value:c,suffix:(null==h?void 0:h.erc20.symbol)||"",onChange:m,disabled:a||!h,style:{flex:1}})}),e.jsxs(t.Compact,{style:{width:"100%"},children:[e.jsx(j,{onClick:v,disabled:!(null==h?void 0:h.erc20.balance)||a||!h,children:"All"}),e.jsxs(j,{type:"primary",onClick:x,loading:a,disabled:!c||a||!h||!(null==(l=h.secret)?void 0:l.address),block:!0,children:["Wrap to ",(null==(o=null==h?void 0:h.secret)?void 0:o.symbol)||"Secret Token"]})]}),(null==h?void 0:h.erc20)&&e.jsxs(Se,{type:"secondary",children:["Balance: ",U(h.erc20.balance)," ",h.erc20.symbol]})]}),e.jsx(je,{open:u,onClose:()=>p(!1),tokenPair:h,amount:c})]}):e.jsx(i,{type:"info",message:"Please select a token pair",showIcon:!0})},Te=({selectedPair:s,onDeposit:n,isLoading:r})=>{var a,l,o;const[c,d]=y.useState(""),u=y.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&d(s)},[]),p=y.useCallback(()=>{c&&n(c)},[c,n]);return e.jsxs(t,{direction:"vertical",size:"middle",children:[e.jsx(t.Compact,{style:{width:"100%"},children:e.jsx(C,{placeholder:"Amount",value:c,suffix:s.erc20.symbol,onChange:u,disabled:r||!s,style:{flex:1}})}),e.jsxs(j,{type:"primary",onClick:p,loading:r,disabled:!c||r||!s||!(null==(a=s.secret)?void 0:a.address),block:!0,children:["Deposit ",s.erc20.symbol," to ",null==(l=null==s?void 0:s.secret)?void 0:l.symbol]}),e.jsx(i,{type:"info",message:`Deposit will convert ${s.erc20.symbol} to ${null==(o=null==s?void 0:s.secret)?void 0:o.symbol}`,showIcon:!0})]})},{Text:Pe}=r,{Option:Ie}=S,Ae=()=>{var r,a,l,o;const c=L(),[d,u]=y.useState("wrap"),{tokenPairs:p,selectedPair:h,selectedPairIndex:m,setSelectedPairIndex:v,pairsWithSecretBalance:x}=ge(),{deposit:g,isLoading:w}=we();y.useEffect(()=>{(null==h?void 0:h.isNativeROSE)?u("deposit"):h&&!h.isNativeROSE&&u("wrap")},[h]);const f=y.useMemo(()=>{var e,s;if(!h)return null;if(h.isNativeROSE){if(null==(e=h.secret)?void 0:e.address){const e=Object.values(c).find(e=>{var s;return e&&e.address&&e.address.toLowerCase()===(null==(s=h.secret)?void 0:s.address.toLowerCase())});if(e)return e}return c[_.WROSE_SECRET]||null}if(null==(s=h.secret)?void 0:s.address){const e=Object.values(c).find(e=>{var s;return e&&e.address&&e.address.toLowerCase()===(null==(s=h.secret)?void 0:s.address.toLowerCase())});if(e)return e}return c.OfficialTokenSecret||null},[h,c]),b=y.useCallback(async e=>{var s,t;if(h&&(null==(s=h.secret)?void 0:s.address))try{await g(null==(t=h.secret)?void 0:t.address,e,h.erc20.decimals)}catch(n){}},[g,h]);if(!h)return e.jsx(s,{style:{marginTop:"24px"},children:e.jsx(i,{type:"info",message:"Please select a token pair to perform operations.",showIcon:!0})});const k=[];return h.isNativeROSE?k.push({key:"deposit",label:"Deposit",children:e.jsx(Te,{selectedPair:h,onDeposit:b,isLoading:w})}):k.push({key:"wrap",label:"Wrap",children:e.jsx(Ee,{tokenPairs:p,selectedPairIndex:m,onPairChange:v,isLoading:w})}),e.jsx(s,{style:{marginTop:"24px"},children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(E,{children:[e.jsxs(n,{children:[e.jsx(Pe,{strong:!0,style:{marginRight:"8px"},children:"Select Token Pair: "}),e.jsx(S,{value:m,onChange:v,style:{width:"100%",maxWidth:"400px"},disabled:w,children:p.map((s,t)=>{var n;return e.jsxs(Ie,{value:t,children:[s.erc20.symbol,s.isNativeROSE&&" (Native ROSE)"," - ",(null==(n=s.secret)?void 0:n.symbol)||`${s.erc20.symbol}.S`]},t)})})]}),e.jsxs(t,{style:{marginTop:"12px"},direction:"vertical",size:"small",children:[e.jsxs(Pe,{strong:!0,children:[h.erc20.name," (",h.erc20.symbol,")",h.secret&&` -> ${h.secret.name} (${h.secret.symbol})`]}),(null==(r=h.erc20)?void 0:r.address)&&e.jsxs(Pe,{type:"secondary",copyable:!0,children:["ERC20: ",null==(a=h.erc20)?void 0:a.address]}),(null==(l=h.secret)?void 0:l.address)&&e.jsxs(Pe,{type:"secondary",copyable:!0,children:["Secret: ",null==(o=h.secret)?void 0:o.address]})]})]}),e.jsx(T,{activeKey:d,onChange:u,items:k}),h&&!f&&e.jsx(i,{type:"warning",message:"Secret contract configuration not found for this token pair. Please check contract configuration.",showIcon:!0})]})})},_e=(e,s=4,t=4)=>!e||e.length<=s+t?e:`${e.slice(0,s)}...${e.slice(-t)}`,Re=(e,s)=>{var t,n,r;const{address:a}=m(),[i,l]=y.useState("EIP712Permit"),[o,c]=y.useState(null),{signAndSavePermit:d,getCurrentEip712Permit:u,isLoading:p,error:h}=q(),{readBalance:v,balance:x,isLoading:g,error:w}=(()=>{const[e,s]=y.useState(!1),[t,n]=y.useState(BigInt(0)),[r,a]=y.useState(null),{balanceOf:i}=z(),{balanceOfWithPermit:l}=$(),{getValidPermit:o}=q(),c=N();return{readBalance:async(e,t,r=!1)=>{s(!0),a(null);try{const a=c.find(s=>s.address.toLowerCase()===e.toLowerCase());if(!a)throw new Error("Token metadata not found");let d=BigInt(0);if("ERC20"===(null==a?void 0:a.types))d=await i(e,t,r);else{if("Secret"!==(null==a?void 0:a.types))return s(!1),BigInt(0);{const s=await o({spender:t,amount:BigInt(0),label:M.VIEW,contractAddress:e});d=await l(e,s,r)}}return n(d),s(!1),d}catch(d){return s(!1),a(d),BigInt(0)}},isLoading:e,balance:t,error:r}})(),f=y.useRef(!1),b=y.useCallback(async()=>{var s;if(!a||!(null==(s=e.secret)?void 0:s.address))return l("EIP712Permit"),void(f.current=!1);if(f.current)return;f.current=!0;u(M.VIEW,a,e.secret.address)?(l("checkBalance"),await v(e.secret.address,a,!0)):l("EIP712Permit"),f.current=!1},[u,a,null==(t=e.secret)?void 0:t.address,v]),k=y.useCallback(async()=>{var s;if(a&&(null==(s=e.secret)?void 0:s.address)){c(null);try{const s={contractAddress:e.secret.address,amount:BigInt(0),label:M.VIEW,spender:a};await d(s)&&(l("checkBalance"),c(null),await v(e.secret.address,a,!0))}catch(t){c(t instanceof Error?t:new Error("Failed to sign EIP712 permit"))}}},[null==(n=e.secret)?void 0:n.address,d,a,v]);return y.useEffect(()=>{var s;f.current=!1,(null==(s=e.secret)?void 0:s.address)&&a&&b()},[null==(r=e.secret)?void 0:r.address,a]),{initSteps:b,handleEIP712Permit:k,currentStep:i,isLoading:g||p,balance:x,error:o||h||w}},{Text:Be}=r,Oe=({selectedPair:s,onUnwrap:n,isLoading:r})=>{var a,l,o,c,d,u,p,h,m;const{handleEIP712Permit:v,currentStep:x,isLoading:g,balance:w,error:f}=Re(s),[b,S]=y.useState("");y.useEffect(()=>{S("")},[null==(a=null==s?void 0:s.secret)?void 0:a.address]);const E=y.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&S(s)},[]),T=y.useCallback(()=>{var e,t;if(w&&w>BigInt(0)){const n=(null==(e=null==s?void 0:s.secret)?void 0:e.decimals)||(null==(t=null==s?void 0:s.erc20)?void 0:t.decimals)||18,r=U(k(w,n));S(r)}},[w,s]),P=y.useCallback(()=>{var e,t;b&&s&&(null==(e=s.secret)?void 0:e.address)&&n(null==(t=s.secret)?void 0:t.address,b)},[b,s,n]);return"EIP712Permit"===x?e.jsx(t,{direction:"vertical",size:"middle",children:e.jsx(i,{type:"warning",showIcon:!0,message:"EIP-712 Signature Required",description:e.jsxs(t,{direction:"vertical",size:"middle",style:{marginTop:8},children:[e.jsxs("div",{children:[e.jsx(Be,{strong:!0,children:"Type: View Permission"}),e.jsx("div",{children:e.jsxs(Be,{type:"secondary",style:{fontSize:13},children:["Contract: ",(null==(l=null==s?void 0:s.secret)?void 0:l.address)?_e(null==(o=s.secret)?void 0:o.address):"N/A"]})})]}),f&&e.jsx(i,{type:"error",showIcon:!0,message:"Signature failed!",description:f.message,style:{marginTop:8}}),e.jsx(j,{type:"primary",block:!0,onClick:v,loading:g,disabled:!(null==(c=null==s?void 0:s.secret)?void 0:c.address)||!(null==s?void 0:s.erc20.address),children:"Sign EIP-712 Permit"})]})})}):"checkBalance"===x?g?e.jsx(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:e.jsx(i,{type:"info",showIcon:!0,message:"Reading balance...",description:"Please wait while we check your token balance."})}):w&&w!==BigInt(0)?e.jsxs(t,{direction:"vertical",size:"middle",children:[e.jsx(t.Compact,{style:{width:"100%"},children:e.jsx(C,{placeholder:"Amount",value:b,suffix:(null==(u=null==s?void 0:s.secret)?void 0:u.symbol)||"",onChange:E,disabled:r||!s,style:{flex:1}})}),e.jsxs(t.Compact,{style:{width:"100%"},children:[e.jsx(j,{onClick:T,disabled:!w||w===BigInt(0)||r||!s,children:"All"}),e.jsxs(j,{type:"primary",onClick:P,loading:r,disabled:!b||r||!s||!(null==(p=s.secret)?void 0:p.address),block:!0,children:["Unwrap to ",null==s?void 0:s.erc20.symbol]})]}),w&&w>BigInt(0)&&e.jsxs(Be,{type:"secondary",children:["Balance: ",(null==s?void 0:s.secret)?U(k(w,s.secret.decimals))+" "+s.secret.symbol:U(k(w,(null==(h=null==s?void 0:s.erc20)?void 0:h.decimals)||18))+" "+((null==(m=null==s?void 0:s.secret)?void 0:m.symbol)||"Secret Token")]})]}):e.jsx(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:e.jsx(i,{type:"info",showIcon:!0,message:"No balance",description:e.jsxs(Be,{type:"secondary",children:["You don't have any ",(null==(d=null==s?void 0:s.secret)?void 0:d.symbol)||"Secret Token"," balance to unwrap."]})})}):null},{Text:Ne,Paragraph:Le}=r,We=({selectedPair:s,onWithdraw:n,isLoading:r})=>{var a,l,o,c,d,u,p,h;const{handleEIP712Permit:m,currentStep:v,isLoading:x,balance:g,error:w}=Re(s),[f,b]=y.useState("");y.useEffect(()=>{b("")},[null==(a=null==s?void 0:s.secret)?void 0:a.address]);const S=y.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&b(s)},[]),E=y.useCallback(()=>{var e,t;if(g&&g>BigInt(0)){const n=(null==(e=null==s?void 0:s.secret)?void 0:e.decimals)||(null==(t=null==s?void 0:s.erc20)?void 0:t.decimals)||18,r=U(k(g,n));b(r)}},[g,s]),T=y.useCallback(()=>{var e;f&&s&&(null==(e=s.secret)?void 0:e.address)&&n(s.secret.address,f)},[f,s,n]);return"EIP712Permit"===v?e.jsx(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:e.jsx(i,{type:"warning",showIcon:!0,message:"EIP-712 Signature Required",description:e.jsxs(t,{direction:"vertical",size:"middle",style:{marginTop:8},children:[e.jsxs("div",{children:[e.jsx(Ne,{strong:!0,children:"Type: View Permission"}),e.jsx("div",{children:e.jsxs(Ne,{type:"secondary",style:{fontSize:13},children:["Contract: ",(null==(l=null==s?void 0:s.secret)?void 0:l.address)?_e(s.secret.address):"N/A"]})})]}),w&&e.jsx(i,{type:"error",showIcon:!0,message:"Signature failed!",description:w.message,style:{marginTop:8}}),e.jsx(j,{type:"primary",block:!0,onClick:m,loading:x,disabled:!(null==(o=null==s?void 0:s.secret)?void 0:o.address),children:"Sign EIP-712 Permit"})]})})}):"checkBalance"===v?x?e.jsx(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:e.jsx(i,{type:"info",showIcon:!0,message:"Reading balance...",description:"Please wait while we check your token balance."})}):g&&g!==BigInt(0)?e.jsxs(t,{direction:"vertical",size:"middle",children:[e.jsx(t.Compact,{style:{width:"100%"},children:e.jsx(C,{placeholder:"Amount",value:f,suffix:(null==(d=null==s?void 0:s.secret)?void 0:d.symbol)||"",onChange:S,disabled:r||!s,style:{flex:1}})}),e.jsxs(t.Compact,{style:{width:"100%"},children:[e.jsx(j,{onClick:E,disabled:!g||g===BigInt(0)||r||!s,children:"All"}),e.jsx(j,{type:"primary",onClick:T,loading:r,disabled:!f||r||!s||!(null==(u=s.secret)?void 0:u.address),block:!0,children:"Withdraw to Native ROSE"})]}),g&&g>BigInt(0)&&e.jsxs(Ne,{type:"secondary",children:["Balance: ",(null==s?void 0:s.secret)?U(k(g,s.secret.decimals))+" "+s.secret.symbol:U(k(g,(null==(p=null==s?void 0:s.erc20)?void 0:p.decimals)||18))+" "+((null==(h=null==s?void 0:s.secret)?void 0:h.symbol)||"Secret Token")]})]}):e.jsx(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:e.jsx(i,{type:"info",showIcon:!0,message:"No balance",description:e.jsxs(Ne,{type:"secondary",children:["You don't have any ",(null==(c=null==s?void 0:s.secret)?void 0:c.symbol)||"Secret Token"," balance to withdraw."]})})}):null},{Text:ze}=r,{Option:$e}=S,qe=()=>{var r,a;const l=L(),[o,c]=y.useState("unwrap"),[d,u]=y.useState(0),{tokenPairs:p}=(()=>{const e=N(),s=e.filter(e=>"ERC20"===e.types),t=e.filter(e=>"Secret"===e.types);return{tokenPairs:y.useMemo(()=>{const e=[];return t.forEach(t=>{if("wROSE.S"===t.symbol){const n={erc20:{address:"0x0000000000000000000000000000000000000000",symbol:"TEST",name:"Sapphire Test Token",decimals:18,balance:"0"},secret:{address:t.address,symbol:t.symbol,name:t.name,decimals:t.decimals||18,balance:"0"},isNativeROSE:!0};e.push(n);const r=s.find(e=>"wROSE"===e.symbol);if(r){const s={erc20:{address:r.address,symbol:r.symbol,name:r.name,decimals:r.decimals||18,balance:"0"},secret:{address:t.address,symbol:t.symbol,name:t.name,decimals:t.decimals||18,balance:"0"},isNativeROSE:!1};e.push(s)}}else{const n=s.find(e=>{var s;return e.address.toLowerCase()===(null==(s=t.mappingAddress)?void 0:s.toLowerCase())});if(n){const s={erc20:{address:n.address,symbol:n.symbol,name:n.name,decimals:n.decimals||18,balance:"0"},secret:{address:t.address,symbol:t.symbol,name:t.name,decimals:t.decimals||18,balance:"0"},isNativeROSE:!1};e.push(s)}}}),e},[t,s])}})(),{withdraw:h,unwrap:m,isLoading:v}=we(),x=y.useMemo(()=>p[d]||null,[p,d]);y.useEffect(()=>{p.length>0&&d>=p.length&&u(0)},[p,d]),y.useEffect(()=>{(null==x?void 0:x.isNativeROSE)?c("withdraw"):c("unwrap")},[x]);const g=y.useMemo(()=>{var e;if(!x||!(null==(e=x.secret)?void 0:e.address))return null;const s=Object.values(l).find(e=>e&&e.address&&e.address.toLowerCase()===x.secret.address.toLowerCase());return s||(x.isNativeROSE?l[_.WROSE_SECRET]||null:l.OfficialTokenSecret||null)},[x,l]),w=y.useCallback(async(e,s)=>{var t;if(x&&(null==(t=x.secret)?void 0:t.address))try{await h(x.secret.address,s,x.secret.decimals)}catch(n){}},[h,x]),f=y.useCallback(async(e,s)=>{var t;if(x&&(null==(t=x.secret)?void 0:t.address))try{await m(x.secret.address,s,x.secret.decimals)}catch(n){}},[m,x]);if(!x||0===p.length)return e.jsx(s,{style:{marginTop:"24px"},children:e.jsx(i,{type:"info",message:"Please select a token pair to perform operations.",showIcon:!0})});const b=[];return x.isNativeROSE?b.push({key:"withdraw",label:"Withdraw",children:e.jsx(We,{selectedPair:x,onWithdraw:w,isLoading:v})}):b.push({key:"unwrap",label:"Unwrap",children:e.jsx(Oe,{selectedPair:x,onUnwrap:f,isLoading:v})}),e.jsx(s,{style:{marginTop:"24px"},children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(E,{children:[e.jsxs(n,{children:[e.jsx(ze,{strong:!0,style:{marginRight:"8px"},children:"Select Token Pair: "}),e.jsx(S,{value:d,onChange:u,style:{width:"100%",maxWidth:"400px"},disabled:v,children:p.map((s,t)=>{var n;return e.jsxs($e,{value:t,children:[(null==(n=s.secret)?void 0:n.symbol)||`${s.erc20.symbol}.S`," - ",s.erc20.symbol,s.isNativeROSE&&" (Native ROSE)"]},t)})})]}),e.jsxs(t,{style:{marginTop:"12px"},direction:"vertical",size:"small",children:[e.jsxs(ze,{strong:!0,children:[x.secret&&x.secret.name,` ---\x3e ${x.erc20.name}`]}),(null==(r=x.secret)?void 0:r.address)&&e.jsxs(ze,{type:"secondary",copyable:!0,children:["Secret: ",x.secret.address]}),(null==(a=x.erc20)?void 0:a.address)&&e.jsxs(ze,{type:"secondary",copyable:!0,children:["ERC20: ",x.erc20.address]})]})]}),e.jsx(T,{activeKey:o,onChange:c,items:b}),x&&!g&&e.jsx(i,{type:"warning",message:"Secret contract configuration not found for this token pair. Please check contract configuration.",showIcon:!0})]})})},Me=()=>{const{address:n,nativeBalances:r,erc20Tokens:a,scope:l,isBalancesLoading:o,balancesError:c}=ge();return n?o?e.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:e.jsx(s,{children:e.jsx(P,{size:"large",style:{display:"block",textAlign:"center",padding:"40px"}})})}):c?e.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:e.jsx(s,{children:e.jsx(i,{type:"error",message:"Failed to load account data. Please try again later.",showIcon:!0})})}):e.jsxs("div",{children:[e.jsx(G,{nativeBalances:r,erc20Tokens:a,scope:l}),e.jsxs(t,{direction:"horizontal",size:"large",align:"start",style:{width:"100%"},children:[e.jsx(Ae,{}),e.jsx(qe,{})]})]}):e.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:e.jsx(s,{children:e.jsx(i,{type:"warning",message:"Please connect your wallet to view and manage your tokens.",showIcon:!0})})})},Ke=()=>e.jsx(xe,{children:e.jsx(Me,{})}),{Title:Fe,Text:Ue}=r,De=()=>{const{writeContract:r,status:a,isPending:l}=v(),{balanceOf:o,mintDate:c}=z(),{address:d}=m(),u=L(),[p,h]=y.useState(BigInt(0)),[x,g]=y.useState(0),[w,f]=y.useState(!1),[b,S]=y.useState(!1),C=u.OfficialToken;y.useEffect(()=>{(async()=>{if(!d||d===I)return;const e=await o(C.address,d);h(e);const s=await c(C.address,d);g(s);const t=s+259200<Date.now()/1e3;f(t)})()},[d,C.address]),y.useEffect(()=>{if(("success"===a||"error"===a)&&(S(!1),"success"===a&&d)){(async()=>{const e=await o(C.address,d);h(e);const s=await c(C.address,d);g(s)})()}},[a,d,C.address]);const T=l||b,P=p?k(p,R.decimals):"0";return e.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[e.jsx(s,{children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(Fe,{level:2,children:"Test Token Faucet"}),e.jsxs(t,{direction:"vertical",size:"small",children:[e.jsxs(Ue,{strong:!0,children:[R.name," (",R.symbol,")"]}),e.jsx(Ue,{type:"secondary",copyable:!0,children:C.address})]})]}),e.jsx(s,{size:"small",title:"Mint Tokens",children:e.jsxs(t,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(n,{justify:"space-between",align:"middle",children:[e.jsxs(E,{children:[e.jsx(Ue,{strong:!0,children:"Your Balance: "}),e.jsxs(Ue,{children:[P," ",R.symbol]})]}),e.jsx(E,{children:e.jsx(j,{type:"primary",onClick:()=>{d&&(S(!0),r({...C,functionName:"mint",args:[d]}))},loading:T,disabled:!d||T||!w,children:"Mint"})})]}),e.jsx(i,{type:"info",message:e.jsxs(t,{direction:"vertical",size:"small",children:[e.jsx(Ue,{children:"You can mint 1,000 tokens each time."}),e.jsxs(Ue,{children:["You last minted on: ",K(x||0)]}),e.jsxs(Ue,{children:["You can mint again on: ",K(x+259200||0)]})]}),showIcon:!0})]})})]})}),e.jsx(s,{style:{marginTop:"24px"},children:e.jsxs(t,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(Fe,{level:3,children:"Oasis Official Faucet:"}),e.jsx(F,{type:"info",children:e.jsx("a",{href:"https://faucet.testnet.oasis.io/?",target:"_blank",rel:"noopener noreferrer",children:"https://faucet.testnet.oasis.io/?"})}),e.jsx(F,{children:"The symbol of the token is “TEST”, which can be used for payment of transaction fees in oasis sapphire (testnet), and can also be wrapped into WROSE.S tokens."})]})})]})};function Ve(){const[s,t]=y.useState("token");return e.jsxs(B,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"20px"},children:e.jsxs(A.Group,{buttonStyle:"solid",value:s,onChange:e=>t(e.target.value),children:[e.jsx(A.Button,{value:"token",children:"Token"}),e.jsx(A.Button,{value:"faucet",children:"Faucet"})]})}),"token"===s&&e.jsx(Ke,{}),"faucet"===s&&e.jsx(De,{})]})}export{Ve as default};
