import{k as e,l as s,m as r,n as t}from"./vendor-CVSnAKA7.js";import{j as n,a,r as i}from"./react-vendor-zDXgJfFk.js";import{C as l,S as o,u as c,a as d,m as u,A as p,M as h,c as m,B as y,d as v,I as x,v as g,F as w,p as f}from"./ui-vendor-BK4VHMl3.js";import{f as b,u as k,r as j,n as S,e as E,v as C,w as P,x as T,y as I,O as _,t as A,a as R}from"./page-boxdetail-B0b9qN-M.js";import{j as B,k as O,u as N,g as L,h as W,p as z,m as $,f as q,z as M}from"./web3-vendor-CWtaQkP0.js";const K=(e,s=3)=>{try{const r=parseFloat(e);return isNaN(r)?e:r.toFixed(s)}catch(r){return e}},F=["magenta","red","volcano","orange","gold","lime","green","cyan","blue","geekblue","purple","pink"],U=e=>{let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s&=s;const r=Math.abs(s)%F.length;return F[r]},{Title:D}=d,V=({nativeBalances:e,erc20Tokens:s,scope:r})=>n.jsx(l,{children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsxs(c,{children:[n.jsx(D,{level:3,children:"Token Balances:"}),"consensus"!==r.layer&&e.length>0&&n.jsx(c,{children:e.map((e,s)=>n.jsxs(u,{style:{marginLeft:"10px",fontSize:"16px",display:"flex",alignItems:"center"},color:"blue",children:[e.token_symbol||"Unknown"," ",K(e.balance)]},"NativeToken"+s))})]}),"consensus"!==r.layer&&s.length>0&&n.jsx(l,{title:"ERC20 Token Balances",size:"small",children:n.jsx(c,{gutter:[16,16],children:s.map(e=>n.jsxs(u,{style:{fontSize:"14px",padding:"5px 10px"},color:U(e.address),children:[e.symbol||e.name||"Unknown"," ",K(e.balance)]},"ERC20Token"+e.address))})}),0===e.length&&0===s.length&&n.jsx(p,{type:"info",message:"You don't have any tokens yet. Use the Faucet tab to mint some test tokens.",showIcon:!0})]})}),Y={ROSE:{ticker:"ROSE",geckoId:"oasis-network"},TEST:{ticker:"TEST",free:!0}},G={mainnet:{tokens:[Y.ROSE]},testnet:{tokens:[Y.TEST]},localnet:{tokens:[Y.TEST]},decimals:9},H={sapphire:{mainnet:{address:"oasis1qrd3mnzhhgst26hsp96uf45yhq6zlax0cuzdgcfc",blockGasLimit:15e6,runtimeId:"000000000000000000000000000000000000000000000000f80306c9858e7279",tokens:[Y.ROSE]},testnet:{address:"oasis1qqczuf3x6glkgjuf0xgtcpjjw95r3crf7y2323xd",blockGasLimit:15e6,runtimeId:"000000000000000000000000000000000000000000000000a6d1e3ebf60dff6c",tokens:[Y.TEST]},localnet:{address:"",blockGasLimit:15e6,runtimeId:"",tokens:[Y.TEST]},decimals:18,type:"evm",offerRoflTxTypes:!0},consensus:null},X=e=>e?e.split(",").filter(e=>!!e).map(e=>e.trim()):[];X("https://explorer.oasis.io, https://explorer.prd.oasis.io"),X("https://explorer.stg.oasis.io");const Q=e=>{var s,r;return e?"consensus"===e.layer?G[e.network].tokens:null==(r=null==(s=null==H?void 0:H[e.layer])?void 0:s[e.network])?void 0:r.tokens:[]},J=(e,s,r,t)=>{var n;if(!(null==(n=e.url)?void 0:n.startsWith(s)))return!1;const a=(i=r??"").endsWith("/")?i:`${i}/`;var i;if(!r)throw new Error(`[oasisQuery] Missing environment variable ${t}. Please define it in your .env file.`);return e.url=e.url.replace(s,a),!0},Z="ERC20",ee=(s,r,t,n,a)=>((s,r)=>{if(!(J(s,"/mainnet/","https://nexus.oasis.io/v1/","REACT_APP_API")||J(s,"/testnet/","https://testnet.nexus.oasis.io/v1/","REACT_APP_TESTNET_API")||J(s,"/localnet/","http://localhost:8547/v1/","REACT_APP_LOCALNET_API")))throw new Error(`Expected URL to be prefixed with network: ${s.url}`);return e({...s,...r})})({url:`/${encodeURIComponent(String(s))}/${encodeURIComponent(String(r))}/accounts/${encodeURIComponent(String(t))}`,method:"GET",signal:a},n),se=(e,s,r)=>[`/${e}/${s}/accounts/${r}`];function re(e,s,r,t){const n=((e,s,r,t)=>{const{query:n,request:a}=t??{};return{queryKey:(null==n?void 0:n.queryKey)??se(e,s,r),queryFn:({signal:t})=>ee(e,s,r,a,t),enabled:!!(e&&s&&r),...n}})(e,s,r,t),i=a(n);return i.queryKey=n.queryKey,i}const te=e=>/^0x[0-9a-fA-F]{40}$/.test(e);const ne=e=>{if((e=>{try{return B.staking.addressFromBech32(e),!0}catch(s){return!1}})(e))return e;if(te(e))return function(e){const s=B.misc.fromHex(e.replace("0x","")),r=B.address.fromData(O.address.V0_SECP256K1ETH_CONTEXT_IDENTIFIER,O.address.V0_SECP256K1ETH_CONTEXT_VERSION,s);return B.staking.addressToBech32(r)}(e);throw new Error("Invalid address")},ae=e=>{try{return ne(e)}catch(s){return null}};function ie(e){return s((t=e,`0x${r.Buffer.from(t,"base64").toString("hex")}`));var t}function le(e){if("oasis-runtime-sdk/address: secp256k1eth"===(null==e?void 0:e.context)&&e.address_data)return ie(e.address_data)}function oe(e,s){const r=new t(e).shiftedBy(-s);if(r.isNaN())throw new Error(`Not a number in fromBaseUnits(${e})`);return r.toFixed()}const ce={mainnet:"https://grpc.oasis.io",testnet:"https://testnet.grpc.oasis.io",localnet:"http://localhost:8544."};function de(e){return null==e?[]:Array.isArray(e)?e:[e]}function ue(e,r){if(e&&r&&te(r)&&ae(r)===e)return s(r)}const pe=(s,r,t,n)=>{var i,l,o,c;const d=(null==(i=null==n?void 0:n.query)?void 0:i.queryKey)??se(s,r,t),u=re(s,r,t,{...n,query:{...(null==n?void 0:n.query)??{},queryKey:d,enabled:!!t&&((null==(l=null==n?void 0:n.query)?void 0:l.enabled)??!0)},request:{...null==n?void 0:n.request,transformResponse:[...de(e.defaults.transformResponse),(e,n,a)=>{var i,l,o,c;return 200!==a?e:(e=>{const s={};return e.evm_balances.forEach(e=>{var r;e.token_type&&(s[r=e.token_type]??(s[r]=[]),s[e.token_type].push(e))}),{...e,tokenBalances:s}})({...e,address_eth:le(e.address_preimage)||ue(e.address,t),evm_contract:e.evm_contract&&{...e.evm_contract,eth_creation_tx:e.evm_contract.eth_creation_tx?`0x${e.evm_contract.eth_creation_tx}`:void 0},evm_balances:(e.evm_balances||[]).filter(e=>e.balance).map(e=>({...e,balance:oe(e.balance,e.token_decimals)})),balances:(e.balances||[]).filter(e=>e.balance).map(e=>({...e,balance:oe(e.balance,e.token_decimals)})),layer:r,network:s,stats:{...e.stats,total_received:(null==(i=e.stats)?void 0:i.total_received)?oe(null==(l=e.stats)?void 0:l.total_received,H[r].decimals):"0",total_sent:(null==(o=e.stats)?void 0:o.total_sent)?oe(null==(c=e.stats)?void 0:c.total_sent,H[r].decimals):"0"}})},...de(null==(o=null==n?void 0:n.request)?void 0:o.transformResponse)]}}),p=null==(c=u.data)?void 0:c.data,h=ae(t),m=a({enabled:!!h,queryKey:[h,s,r],queryFn:async()=>{if(!h)throw new Error("Needed to fix types - see `enabled`");return await async function(e,s){const r=H[s.layer][s.network];if(!(null==r?void 0:r.runtimeId))throw new Error("Paratime is not configured");const t=new B.client.NodeInternal(ce[s.network]),n=new O.accounts.Wrapper(B.misc.fromHex(r.runtimeId));return[...(await n.queryBalances().setArgs({address:B.staking.addressFromBech32(e)}).query(t)).balances.entries()].map(([e,r])=>({balance:B.quantity.toBigInt(r).toString(),token_symbol:B.misc.toStringUTF8(e)||Q(s)[0].ticker,token_decimals:H[s.layer].decimals})).map(e=>({...e,balance:oe(e.balance,e.token_decimals)}))}(h,{network:s,layer:r})}}).data,y=m&&p?{...p,balances:m}:p;return{...u,data:u.data?{...u.data,data:y}:u.data}};Array(100).keys();const he=()=>{const{address:e}=N(),s=b(),r=i.useMemo(()=>({network:s.network,layer:s.layer}),[s]),{data:t,isLoading:n,error:a}=(({scope:e,address:s,enabled:r=!0})=>{if("consensus"===e.layer)throw new Error("Consensus layer queries are not supported. Only Sapphire runtime is supported.");return pe(e.network,e.layer,s,{query:{queryKey:se(e.network,e.layer,s),enabled:r&&!!s}})})({scope:r,address:e,enabled:!!e}),l=null==t?void 0:t.data,o=i.useMemo(()=>l&&"balances"in l&&l.balances||[],[l]),c=i.useMemo(()=>l&&"evm_balances"in l?(l.evm_balances||[]).filter(e=>e.token_type===Z).map(e=>({address:e.token_contract_addr_eth,symbol:e.token_symbol||"UNKNOWN",name:e.token_name||"Unknown Token",decimals:e.token_decimals,balance:e.balance})):[],[l]),d=i.useMemo(()=>o.map(e=>({address:"0x0000000000000000000000000000000000000000",symbol:e.token_symbol||s.nativeCurrency.symbol,name:e.token_symbol||s.nativeCurrency.name,decimals:e.token_decimals,balance:e.balance})),[o,s]),u=i.useMemo(()=>[...d,...c],[d,c]);return{nativeBalances:o,erc20Tokens:c,allTokens:u,isLoading:n,error:a,scope:r}},me=i.createContext(null),ye=({children:e})=>{const{address:s}=N(),r=he(),t=(e=>{const s=k(),[r,t]=i.useState(0),n=i.useMemo(()=>{const r=[],t=e.filter(e=>!e.symbol.endsWith(".S")),n=s.filter(e=>"Secret"===e.types);return t.forEach(e=>{const t="0x0000000000000000000000000000000000000000"===e.address&&("wROSE"===e.symbol.toUpperCase()||"TEST"===e.symbol.toUpperCase());let a,i=null,l=null,o=e.address;if(t){const e=s.find(e=>"wROSE"===e.symbol&&"ERC20"===e.types);e&&(o=e.address),a="wROSE.S",i=n.find(e=>e.symbol===a)||null}else a=`${e.symbol}.S`,i=n.find(e=>e.symbol===a)||null;i&&(l={address:i.address,symbol:i.symbol,name:i.name,decimals:i.decimals,balance:"0"});const c={...e,address:o};r.push({erc20:c,secret:l||null,isNativeROSE:t})}),r},[e,s]);i.useEffect(()=>{n.length>0&&r>=n.length&&t(0)},[n,r]);const a=i.useMemo(()=>n[r]||null,[n,r]),l=i.useMemo(()=>n.filter(e=>e.secret&&parseFloat(e.secret.balance)>0),[n]);return{tokenPairs:n,selectedPair:a,selectedPairIndex:r,setSelectedPairIndex:t,pairsWithSecretBalance:l,supportedTokens:s}})(r.allTokens),a=i.useMemo(()=>({address:s,nativeBalances:r.nativeBalances,erc20Tokens:r.erc20Tokens,allTokens:r.allTokens,scope:r.scope,isBalancesLoading:r.isLoading,balancesError:r.error,tokenPairs:t.tokenPairs,selectedPair:t.selectedPair,selectedPairIndex:t.selectedPairIndex,setSelectedPairIndex:t.setSelectedPairIndex,pairsWithSecretBalance:t.pairsWithSecretBalance}),[s,r.nativeBalances,r.erc20Tokens,r.allTokens,r.scope,r.isLoading,r.error,t.tokenPairs,t.selectedPair,t.selectedPairIndex,t.setSelectedPairIndex,t.pairsWithSecretBalance]);return n.jsx(me.Provider,{value:a,children:e})},ve=()=>{const e=i.useContext(me);if(!e)throw new Error("useTokenPage must be used within TokenPageProvider");return e},xe=()=>{const{writeToken:e,status:s,isPending:r,isError:t,isSuccessed:n,isLoading:a}=(()=>{const{writeContractAsync:e,data:s,error:r,isPending:t,isError:n,isSuccess:a,status:l,reset:o}=L(),c=k(),{isSuccess:d}=W({hash:s});return i.useEffect(()=>{n&&o()},[n,o]),{writeToken:async s=>{try{const r=c.find(e=>e.address.toLowerCase()===s.contractAddress.toLowerCase());if(!r)throw new Error("Token metadata not found");return await e({address:s.contractAddress,abi:r.abi,functionName:s.functionName,args:s.args,value:s.value})}catch(r){throw r}},hash:s,error:r,isPending:t,isLoading:"idle"!==l&&"error"!==l&&!d,isSuccess:a,isError:n,status:l,isSuccessed:d,reset:o}})(),{address:l}=N(),[o,c]=i.useState(null),[d,u]=i.useState(null);return{transfer:i.useCallback(async(s,r,t,n)=>{if(!l)throw new Error("Wallet not connected");try{const a=z(t,n);c("transfer"),u(null),e({contractAddress:s,functionName:"transfer",args:[r,a]})}catch(a){throw u(a),c(null),a}},[l,e]),burn:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{const n=z(r,t);c("burn"),u(null),e({contractAddress:s,functionName:"burn",args:[n]})}catch(n){throw u(n),c(null),n}},[l,e]),wrap:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{const n=z(r,t);c("wrap"),u(null),e({contractAddress:s,functionName:"wrap",args:[n]})}catch(n){throw u(n),c(null),n}},[l,e]),unwrap:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{const n=z(r,t);c("unwrap"),u(null),e({contractAddress:s,functionName:"unwrap",args:[n]})}catch(n){throw u(n),c(null),n}},[l,e]),deposit:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{const n=z(r,t);c("deposit"),u(null),e({contractAddress:s,functionName:"deposit",args:[],value:n})}catch(n){throw u(n),c(null),n}},[l,e]),withdraw:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{const n=z(r,t);c("withdraw"),u(null),e({contractAddress:s,functionName:"withdraw",args:[n]})}catch(n){throw u(n),c(null),n}},[l,e]),approve:i.useCallback(async(s,r,t)=>{if(!l)throw new Error("Wallet not connected");try{c("approve"),u(null),e({contractAddress:s,functionName:"approve",args:[r,t]})}catch(n){throw u(n),c(null),n}},[l,e]),isPending:r,isLoading:a,activeButton:o,error:d,status:s,isError:t,isSuccessed:n}},ge={allowance:{title:"Checking allowance...",descriptions:{idle:"Checking allowance...",pending:"Checking allowance...",success:"Allowance is enough",error:"Checking allowance failed"}},approve:{title:"Approve",descriptions:{idle:"Need to approve",pending:"Approving...",success:"Approve success",error:"Approve failed"}},wrap:{title:"Wrap",descriptions:{idle:"Ready to wrap",pending:"Executing wrap operation...",success:"Wrap operation success",error:"Wrap operation failed"}}},we=e=>{const s=[{stepKey:"allowance",title:ge.allowance.title,description:ge.allowance.descriptions.success,status:"finish"}];return e&&s.push({stepKey:"approve",title:ge.approve.title,description:ge.approve.descriptions.idle,status:"wait"}),s.push({stepKey:"wrap",title:ge.wrap.title,description:ge.wrap.descriptions.idle,status:"wait"}),s},{Text:fe}=d,be=({open:e,onClose:s,tokenPair:r,amount:t})=>{var a,l;const{steps:c,checkAllowance:d,handleApproveClick:u,handleApproveMaxClick:v,handleWrapClick:x,isLoading:g,isSuccessed:w,status:f,currentStepItem:b,allowanceAmount:k}=((e,s)=>{const{address:r}=N(),{readAllowance:t,allowanceAmount:n}=j(),{wrap:a,approve:l,status:o,isLoading:c,isPending:d,isSuccessed:u,activeButton:p}=xe(),[h,m]=i.useState({steps:we(!1),currentIndex:1}),y=i.useCallback(e=>{const s=we(!e);m({steps:s,currentIndex:1})},[]),v=i.useCallback((e,s)=>{m(r=>{const t=r.steps.findIndex(s=>s.stepKey===e);if(-1===t)return r;const n=(e=>{switch(e){case"pending":return"process";case"success":return"finish";case"error":return"error";default:return"wait"}})(s),a=ge[e].descriptions[s],i=r.steps.map((e,s)=>s===t?{...e,status:n,description:a}:e);let l=r.currentIndex;const o=t===r.currentIndex,c=t<i.length-1;return"finish"===n&&o&&c&&(l=t+1),{steps:i,currentIndex:l}})},[]),{steps:x,currentIndex:g}=h,w=x[g]??x[x.length-1],f=i.useCallback(async n=>{var a,i;if(!(r&&e.erc20.address&&s&&(null==(a=e.secret)?void 0:a.address)))return;const l=z(s,e.erc20.decimals);try{const s=await t(e.erc20.address,r,null==(i=e.secret)?void 0:i.address,l);"init"===n&&y(s.isEnough)}catch(o){v("allowance","error")}},[e,s,t,r,y]);i.useEffect(()=>{"approve"===p?"idle"!==o&&v("approve",o):"wrap"===p&&"idle"!==o&&v("wrap",o)},[p,o]);const b=i.useCallback(async()=>{var r,t;if(!e||!s||!(null==(r=e.secret)?void 0:r.address))return;const n=z(s,e.erc20.decimals);try{await l(e.erc20.address,null==(t=e.secret)?void 0:t.address,n)}catch(a){v("approve","error")}},[e,s,l,v]),k=i.useCallback(async()=>{var s,r;if(!e||!(null==(s=e.secret)?void 0:s.address))return;const t=$;try{await l(e.erc20.address,null==(r=e.secret)?void 0:r.address,t)}catch(n){v("approve","error")}},[e,l,v]),S=i.useCallback(async()=>{var r,t;e&&s&&(null==(r=e.secret)?void 0:r.address)&&await a(null==(t=e.secret)?void 0:t.address,s,e.erc20.decimals)},[e,s,a]);return{steps:x,currentIndex:g,currentStepItem:w,initializeSteps:y,updateStepStatus:v,checkAllowance:f,handleApproveClick:b,handleApproveMaxClick:k,handleWrapClick:S,isPending:d,isLoading:c,isSuccessed:u,status:o,activeButton:p,allowanceAmount:n}})(r,t),S="approve"===b.stepKey&&"finish"!==b.status,E="wrap"===b.stepKey&&"finish"!==b.status,C=i.useMemo(()=>c.map(({stepKey:e,...s})=>({key:e,...s})),[c]);i.useEffect(()=>{e&&d("init")},[e]);const P=()=>{s()};return n.jsx(h,{title:"Wrap operation process",open:e,onCancel:P,closable:"pending"!==f,maskClosable:"pending"!==f,footer:[n.jsx(y,{onClick:P,disabled:"pending"===f||g,children:w?"Complete":"Cancel"},"close")],width:450,centered:!0,children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsx(p,{type:"info",message:n.jsxs(o,{direction:"vertical",size:"small",children:[n.jsxs(fe,{strong:!0,children:[r.erc20.symbol," - ",(null==(a=r.secret)?void 0:a.symbol)||`${r.erc20.symbol}.S`]}),n.jsxs(fe,{children:["Amount: ",t," ",r.erc20.symbol]})]}),showIcon:!0}),n.jsx(m,{direction:"vertical",items:C,size:"small"}),S&&n.jsxs(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:[n.jsx(p,{type:"warning",message:n.jsx(o,{direction:"vertical",size:"small",children:n.jsxs(fe,{children:["Allowance is not enough. Current: ",q(k,r.erc20.decimals),", Required: ",t]})}),showIcon:!0}),n.jsx(y,{type:"primary",onClick:u,loading:g,disabled:!S,block:!0,children:g?"Waiting...":`Approve ${t} ${r.erc20.symbol}...`}),n.jsx(y,{type:"primary",onClick:v,loading:g,disabled:!S,block:!0,children:g?"Waiting...":"Approve Max(uint256)"})]}),"approve"===b.stepKey&&"process"===b.status&&n.jsx(p,{type:"info",message:"Approving token...",showIcon:!0}),E&&n.jsx(y,{type:"primary",onClick:x,loading:g,disabled:!E,block:!0,children:g?"Waiting...":`Wrap ${t} ${r.erc20.symbol} to ${(null==(l=r.secret)?void 0:l.symbol)||"Secret Token"}...`}),c.some(e=>"error"===e.status)&&n.jsx(p,{type:"error",message:"Operation failed",description:"Please check network connection and wallet status, then try again.",showIcon:!0}),w&&n.jsx(p,{type:"success",message:"Wrap operation completed successfully",showIcon:!0})]})})},{Text:ke}=d,{Option:je}=v,Se=({tokenPairs:e,selectedPairIndex:s=0,onPairChange:r,isLoading:t})=>{var a,l;const[c,d]=i.useState(""),[u,h]=i.useState(!1),m=e[s]||e[0],g=i.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&d(s)},[]),w=i.useCallback(()=>{(null==m?void 0:m.erc20)&&m.erc20.balance&&d(K(m.erc20.balance))},[m]),f=i.useCallback(()=>{var e;c&&m&&(null==(e=m.secret)?void 0:e.address)&&h(!0)},[c,m]);return m?n.jsxs(n.Fragment,{children:[n.jsxs(o,{direction:"vertical",size:"middle",children:[e.length>1&&n.jsx(v,{value:s,onChange:r,style:{width:"100%"},disabled:t,children:e.map((e,s)=>{var r;return n.jsxs(je,{value:s,children:[e.erc20.symbol," - ",(null==(r=e.secret)?void 0:r.symbol)||`${e.erc20.symbol}.S`]},s)})}),n.jsx(o.Compact,{style:{width:"100%"},children:n.jsx(x,{placeholder:"Amount",value:c,suffix:(null==m?void 0:m.erc20.symbol)||"",onChange:g,disabled:t||!m,style:{flex:1}})}),n.jsxs(o.Compact,{style:{width:"100%"},children:[n.jsx(y,{onClick:w,disabled:!(null==m?void 0:m.erc20.balance)||t||!m,children:"All"}),n.jsxs(y,{type:"primary",onClick:f,loading:t,disabled:!c||t||!m||!(null==(a=m.secret)?void 0:a.address),block:!0,children:["Wrap to ",(null==(l=null==m?void 0:m.secret)?void 0:l.symbol)||"Secret Token"]})]}),(null==m?void 0:m.erc20)&&n.jsxs(ke,{type:"secondary",children:["Balance: ",K(m.erc20.balance)," ",m.erc20.symbol]})]}),n.jsx(be,{open:u,onClose:()=>h(!1),tokenPair:m,amount:c})]}):n.jsx(p,{type:"info",message:"Please select a token pair",showIcon:!0})},Ee=({selectedPair:e,onDeposit:s,isLoading:r})=>{var t,a,l;const[c,d]=i.useState(""),u=i.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&d(s)},[]),h=i.useCallback(()=>{c&&s(c)},[c,s]);return n.jsxs(o,{direction:"vertical",size:"middle",children:[n.jsx(o.Compact,{style:{width:"100%"},children:n.jsx(x,{placeholder:"Amount",value:c,suffix:e.erc20.symbol,onChange:u,disabled:r||!e,style:{flex:1}})}),n.jsxs(y,{type:"primary",onClick:h,loading:r,disabled:!c||r||!e||!(null==(t=e.secret)?void 0:t.address),block:!0,children:["Deposit ",e.erc20.symbol," to ",null==(a=null==e?void 0:e.secret)?void 0:a.symbol]}),n.jsx(p,{type:"info",message:`Deposit will convert ${e.erc20.symbol} to ${null==(l=null==e?void 0:e.secret)?void 0:l.symbol}`,showIcon:!0})]})},{Text:Ce}=d,{Option:Pe}=v,Te=()=>{var e,s,r,t;const a=S(),[d,u]=i.useState("wrap"),{tokenPairs:h,selectedPair:m,selectedPairIndex:y,setSelectedPairIndex:x,pairsWithSecretBalance:f}=ve(),{deposit:b,isLoading:k}=xe();i.useEffect(()=>{(null==m?void 0:m.isNativeROSE)?u("deposit"):m&&!m.isNativeROSE&&u("wrap")},[m]);const j=i.useMemo(()=>{var e,s;if(!m)return null;if(m.isNativeROSE){if(null==(e=m.secret)?void 0:e.address){const e=Object.values(a).find(e=>{var s;return e&&e.address&&e.address.toLowerCase()===(null==(s=m.secret)?void 0:s.address.toLowerCase())});if(e)return e}return a[E.WROSE_SECRET]||null}if(null==(s=m.secret)?void 0:s.address){const e=Object.values(a).find(e=>{var s;return e&&e.address&&e.address.toLowerCase()===(null==(s=m.secret)?void 0:s.address.toLowerCase())});if(e)return e}return a.OfficialTokenSecret||null},[m,a]),C=i.useCallback(async e=>{var s,r;if(m&&(null==(s=m.secret)?void 0:s.address))try{await b(null==(r=m.secret)?void 0:r.address,e,m.erc20.decimals)}catch(t){}},[b,m]);if(!m)return n.jsx(l,{style:{marginTop:"24px"},children:n.jsx(p,{type:"info",message:"Please select a token pair to perform operations.",showIcon:!0})});const P=[];return m.isNativeROSE?P.push({key:"deposit",label:"Deposit",children:n.jsx(Ee,{selectedPair:m,onDeposit:C,isLoading:k})}):P.push({key:"wrap",label:"Wrap",children:n.jsx(Se,{tokenPairs:h,selectedPairIndex:y,onPairChange:x,isLoading:k})}),n.jsx(l,{style:{marginTop:"24px"},children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsxs(g,{children:[n.jsxs(c,{children:[n.jsx(Ce,{strong:!0,style:{marginRight:"8px"},children:"Select Token Pair: "}),n.jsx(v,{value:y,onChange:x,style:{width:"100%",maxWidth:"400px"},disabled:k,children:h.map((e,s)=>{var r;return n.jsxs(Pe,{value:s,children:[e.erc20.symbol,e.isNativeROSE&&" (Native ROSE)"," - ",(null==(r=e.secret)?void 0:r.symbol)||`${e.erc20.symbol}.S`]},s)})})]}),n.jsxs(o,{style:{marginTop:"12px"},direction:"vertical",size:"small",children:[n.jsxs(Ce,{strong:!0,children:[m.erc20.name," (",m.erc20.symbol,")",m.secret&&` -> ${m.secret.name} (${m.secret.symbol})`]}),(null==(e=m.erc20)?void 0:e.address)&&n.jsxs(Ce,{type:"secondary",copyable:!0,children:["ERC20: ",null==(s=m.erc20)?void 0:s.address]}),(null==(r=m.secret)?void 0:r.address)&&n.jsxs(Ce,{type:"secondary",copyable:!0,children:["Secret: ",null==(t=m.secret)?void 0:t.address]})]})]}),n.jsx(w,{activeKey:d,onChange:u,items:P}),m&&!j&&n.jsx(p,{type:"warning",message:"Secret contract configuration not found for this token pair. Please check contract configuration.",showIcon:!0})]})})},Ie=(e,s=4,r=4)=>!e||e.length<=s+r?e:`${e.slice(0,s)}...${e.slice(-r)}`,_e=(e,s)=>{var r,t,n;const{address:a}=N(),[l,o]=i.useState("EIP712Permit"),[c,d]=i.useState(null),{signAndSavePermit:u,getCurrentEip712Permit:p,isLoading:h,error:m}=T(),{readBalance:y,balance:v,isLoading:x,error:g}=(()=>{const[e,s]=i.useState(!1),[r,t]=i.useState(BigInt(0)),[n,a]=i.useState(null),{balanceOf:l}=C(),{balanceOfWithPermit:o}=P(),{getValidPermit:c}=T(),d=k();return{readBalance:async(e,r,n=!1)=>{s(!0),a(null);try{const a=d.find(s=>s.address.toLowerCase()===e.toLowerCase());if(!a)throw new Error("Token metadata not found");let i=BigInt(0);if("ERC20"===(null==a?void 0:a.types))i=await l(e,r,n);else{if("Secret"!==(null==a?void 0:a.types))return s(!1),BigInt(0);{const s=await c({spender:r,amount:BigInt(0),label:I.VIEW,contractAddress:e});i=await o(e,s,n)}}return t(i),s(!1),i}catch(i){return s(!1),a(i),BigInt(0)}},isLoading:e,balance:r,error:n}})(),w=i.useRef(!1),f=i.useCallback(async()=>{var s;if(!a||!(null==(s=e.secret)?void 0:s.address))return o("EIP712Permit"),void(w.current=!1);if(w.current)return;w.current=!0;p(I.VIEW,a,e.secret.address)?(o("checkBalance"),await y(e.secret.address,a,!0)):o("EIP712Permit"),w.current=!1},[p,a,null==(r=e.secret)?void 0:r.address,y]),b=i.useCallback(async()=>{var s;if(a&&(null==(s=e.secret)?void 0:s.address)){d(null);try{const s={contractAddress:e.secret.address,amount:BigInt(0),label:I.VIEW,spender:a};await u(s)&&(o("checkBalance"),d(null),await y(e.secret.address,a,!0))}catch(r){d(r instanceof Error?r:new Error("Failed to sign EIP712 permit"))}}},[null==(t=e.secret)?void 0:t.address,u,a,y]);return i.useEffect(()=>{var s;w.current=!1,(null==(s=e.secret)?void 0:s.address)&&a&&f()},[null==(n=e.secret)?void 0:n.address,a]),{initSteps:f,handleEIP712Permit:b,currentStep:l,isLoading:x||h,balance:v,error:c||m||g}},{Text:Ae}=d,Re=({selectedPair:e,onUnwrap:s,isLoading:r})=>{var t,a,l,c,d,u,h,m,v;const{handleEIP712Permit:g,currentStep:w,isLoading:f,balance:b,error:k}=_e(e),[j,S]=i.useState("");i.useEffect(()=>{S("")},[null==(t=null==e?void 0:e.secret)?void 0:t.address]);const E=i.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&S(s)},[]),C=i.useCallback(()=>{var s,r;if(b&&b>BigInt(0)){const t=(null==(s=null==e?void 0:e.secret)?void 0:s.decimals)||(null==(r=null==e?void 0:e.erc20)?void 0:r.decimals)||18,n=K(q(b,t));S(n)}},[b,e]),P=i.useCallback(()=>{var r,t;j&&e&&(null==(r=e.secret)?void 0:r.address)&&s(null==(t=e.secret)?void 0:t.address,j)},[j,e,s]);return"EIP712Permit"===w?n.jsx(o,{direction:"vertical",size:"middle",children:n.jsx(p,{type:"warning",showIcon:!0,message:"EIP-712 Signature Required",description:n.jsxs(o,{direction:"vertical",size:"middle",style:{marginTop:8},children:[n.jsxs("div",{children:[n.jsx(Ae,{strong:!0,children:"Type: View Permission"}),n.jsx("div",{children:n.jsxs(Ae,{type:"secondary",style:{fontSize:13},children:["Contract: ",(null==(a=null==e?void 0:e.secret)?void 0:a.address)?Ie(null==(l=e.secret)?void 0:l.address):"N/A"]})})]}),k&&n.jsx(p,{type:"error",showIcon:!0,message:"Signature failed!",description:k.message,style:{marginTop:8}}),n.jsx(y,{type:"primary",block:!0,onClick:g,loading:f,disabled:!(null==(c=null==e?void 0:e.secret)?void 0:c.address)||!(null==e?void 0:e.erc20.address),children:"Sign EIP-712 Permit"})]})})}):"checkBalance"===w?f?n.jsx(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:n.jsx(p,{type:"info",showIcon:!0,message:"Reading balance...",description:"Please wait while we check your token balance."})}):b&&b!==BigInt(0)?n.jsxs(o,{direction:"vertical",size:"middle",children:[n.jsx(o.Compact,{style:{width:"100%"},children:n.jsx(x,{placeholder:"Amount",value:j,suffix:(null==(u=null==e?void 0:e.secret)?void 0:u.symbol)||"",onChange:E,disabled:r||!e,style:{flex:1}})}),n.jsxs(o.Compact,{style:{width:"100%"},children:[n.jsx(y,{onClick:C,disabled:!b||b===BigInt(0)||r||!e,children:"All"}),n.jsxs(y,{type:"primary",onClick:P,loading:r,disabled:!j||r||!e||!(null==(h=e.secret)?void 0:h.address),block:!0,children:["Unwrap to ",null==e?void 0:e.erc20.symbol]})]}),b&&b>BigInt(0)&&n.jsxs(Ae,{type:"secondary",children:["Balance: ",(null==e?void 0:e.secret)?K(q(b,e.secret.decimals))+" "+e.secret.symbol:K(q(b,(null==(m=null==e?void 0:e.erc20)?void 0:m.decimals)||18))+" "+((null==(v=null==e?void 0:e.secret)?void 0:v.symbol)||"Secret Token")]})]}):n.jsx(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:n.jsx(p,{type:"info",showIcon:!0,message:"No balance",description:n.jsxs(Ae,{type:"secondary",children:["You don't have any ",(null==(d=null==e?void 0:e.secret)?void 0:d.symbol)||"Secret Token"," balance to unwrap."]})})}):null},{Text:Be,Paragraph:Oe}=d,Ne=({selectedPair:e,onWithdraw:s,isLoading:r})=>{var t,a,l,c,d,u,h,m;const{handleEIP712Permit:v,currentStep:g,isLoading:w,balance:f,error:b}=_e(e),[k,j]=i.useState("");i.useEffect(()=>{j("")},[null==(t=null==e?void 0:e.secret)?void 0:t.address]);const S=i.useCallback(e=>{const s=e.target.value;(""===s||/^\d*\.?\d*$/.test(s))&&j(s)},[]),E=i.useCallback(()=>{var s,r;if(f&&f>BigInt(0)){const t=(null==(s=null==e?void 0:e.secret)?void 0:s.decimals)||(null==(r=null==e?void 0:e.erc20)?void 0:r.decimals)||18,n=K(q(f,t));j(n)}},[f,e]),C=i.useCallback(()=>{var r;k&&e&&(null==(r=e.secret)?void 0:r.address)&&s(e.secret.address,k)},[k,e,s]);return"EIP712Permit"===g?n.jsx(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:n.jsx(p,{type:"warning",showIcon:!0,message:"EIP-712 Signature Required",description:n.jsxs(o,{direction:"vertical",size:"middle",style:{marginTop:8},children:[n.jsxs("div",{children:[n.jsx(Be,{strong:!0,children:"Type: View Permission"}),n.jsx("div",{children:n.jsxs(Be,{type:"secondary",style:{fontSize:13},children:["Contract: ",(null==(a=null==e?void 0:e.secret)?void 0:a.address)?Ie(e.secret.address):"N/A"]})})]}),b&&n.jsx(p,{type:"error",showIcon:!0,message:"Signature failed!",description:b.message,style:{marginTop:8}}),n.jsx(y,{type:"primary",block:!0,onClick:v,loading:w,disabled:!(null==(l=null==e?void 0:e.secret)?void 0:l.address),children:"Sign EIP-712 Permit"})]})})}):"checkBalance"===g?w?n.jsx(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:n.jsx(p,{type:"info",showIcon:!0,message:"Reading balance...",description:"Please wait while we check your token balance."})}):f&&f!==BigInt(0)?n.jsxs(o,{direction:"vertical",size:"middle",children:[n.jsx(o.Compact,{style:{width:"100%"},children:n.jsx(x,{placeholder:"Amount",value:k,suffix:(null==(d=null==e?void 0:e.secret)?void 0:d.symbol)||"",onChange:S,disabled:r||!e,style:{flex:1}})}),n.jsxs(o.Compact,{style:{width:"100%"},children:[n.jsx(y,{onClick:E,disabled:!f||f===BigInt(0)||r||!e,children:"All"}),n.jsx(y,{type:"primary",onClick:C,loading:r,disabled:!k||r||!e||!(null==(u=e.secret)?void 0:u.address),block:!0,children:"Withdraw to Native ROSE"})]}),f&&f>BigInt(0)&&n.jsxs(Be,{type:"secondary",children:["Balance: ",(null==e?void 0:e.secret)?K(q(f,e.secret.decimals))+" "+e.secret.symbol:K(q(f,(null==(h=null==e?void 0:e.erc20)?void 0:h.decimals)||18))+" "+((null==(m=null==e?void 0:e.secret)?void 0:m.symbol)||"Secret Token")]})]}):n.jsx(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:n.jsx(p,{type:"info",showIcon:!0,message:"No balance",description:n.jsxs(Be,{type:"secondary",children:["You don't have any ",(null==(c=null==e?void 0:e.secret)?void 0:c.symbol)||"Secret Token"," balance to withdraw."]})})}):null},{Text:Le}=d,{Option:We}=v,ze=()=>{var e,s;const r=S(),[t,a]=i.useState("unwrap"),[d,u]=i.useState(0),{tokenPairs:h}=(()=>{const e=k(),s=e.filter(e=>"ERC20"===e.types),r=e.filter(e=>"Secret"===e.types);return{tokenPairs:i.useMemo(()=>{const e=[];return r.forEach(r=>{if("wROSE.S"===r.symbol){const t={erc20:{address:"0x0000000000000000000000000000000000000000",symbol:"TEST",name:"Sapphire Test Token",decimals:18,balance:"0"},secret:{address:r.address,symbol:r.symbol,name:r.name,decimals:r.decimals||18,balance:"0"},isNativeROSE:!0};e.push(t);const n=s.find(e=>"wROSE"===e.symbol);if(n){const s={erc20:{address:n.address,symbol:n.symbol,name:n.name,decimals:n.decimals||18,balance:"0"},secret:{address:r.address,symbol:r.symbol,name:r.name,decimals:r.decimals||18,balance:"0"},isNativeROSE:!1};e.push(s)}}else{const t=s.find(e=>{var s;return e.address.toLowerCase()===(null==(s=r.mappingAddress)?void 0:s.toLowerCase())});if(t){const s={erc20:{address:t.address,symbol:t.symbol,name:t.name,decimals:t.decimals||18,balance:"0"},secret:{address:r.address,symbol:r.symbol,name:r.name,decimals:r.decimals||18,balance:"0"},isNativeROSE:!1};e.push(s)}}}),e},[r,s])}})(),{withdraw:m,unwrap:y,isLoading:x}=xe(),f=i.useMemo(()=>h[d]||null,[h,d]);i.useEffect(()=>{h.length>0&&d>=h.length&&u(0)},[h,d]),i.useEffect(()=>{(null==f?void 0:f.isNativeROSE)?a("withdraw"):a("unwrap")},[f]);const b=i.useMemo(()=>{var e;if(!f||!(null==(e=f.secret)?void 0:e.address))return null;const s=Object.values(r).find(e=>e&&e.address&&e.address.toLowerCase()===f.secret.address.toLowerCase());return s||(f.isNativeROSE?r[E.WROSE_SECRET]||null:r.OfficialTokenSecret||null)},[f,r]),j=i.useCallback(async(e,s)=>{var r;if(f&&(null==(r=f.secret)?void 0:r.address))try{await m(f.secret.address,s,f.secret.decimals)}catch(t){}},[m,f]),C=i.useCallback(async(e,s)=>{var r;if(f&&(null==(r=f.secret)?void 0:r.address))try{await y(f.secret.address,s,f.secret.decimals)}catch(t){}},[y,f]);if(!f||0===h.length)return n.jsx(l,{style:{marginTop:"24px"},children:n.jsx(p,{type:"info",message:"Please select a token pair to perform operations.",showIcon:!0})});const P=[];return f.isNativeROSE?P.push({key:"withdraw",label:"Withdraw",children:n.jsx(Ne,{selectedPair:f,onWithdraw:j,isLoading:x})}):P.push({key:"unwrap",label:"Unwrap",children:n.jsx(Re,{selectedPair:f,onUnwrap:C,isLoading:x})}),n.jsx(l,{style:{marginTop:"24px"},children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsxs(g,{children:[n.jsxs(c,{children:[n.jsx(Le,{strong:!0,style:{marginRight:"8px"},children:"Select Token Pair: "}),n.jsx(v,{value:d,onChange:u,style:{width:"100%",maxWidth:"400px"},disabled:x,children:h.map((e,s)=>{var r;return n.jsxs(We,{value:s,children:[(null==(r=e.secret)?void 0:r.symbol)||`${e.erc20.symbol}.S`," - ",e.erc20.symbol,e.isNativeROSE&&" (Native ROSE)"]},s)})})]}),n.jsxs(o,{style:{marginTop:"12px"},direction:"vertical",size:"small",children:[n.jsxs(Le,{strong:!0,children:[f.secret&&f.secret.name,` ---\x3e ${f.erc20.name}`]}),(null==(e=f.secret)?void 0:e.address)&&n.jsxs(Le,{type:"secondary",copyable:!0,children:["Secret: ",f.secret.address]}),(null==(s=f.erc20)?void 0:s.address)&&n.jsxs(Le,{type:"secondary",copyable:!0,children:["ERC20: ",f.erc20.address]})]})]}),n.jsx(w,{activeKey:t,onChange:a,items:P}),f&&!b&&n.jsx(p,{type:"warning",message:"Secret contract configuration not found for this token pair. Please check contract configuration.",showIcon:!0})]})})},$e=()=>{const{address:e,nativeBalances:s,erc20Tokens:r,scope:t,isBalancesLoading:a,balancesError:i}=ve();return e?a?n.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:n.jsx(l,{children:n.jsx(f,{size:"large",style:{display:"block",textAlign:"center",padding:"40px"}})})}):i?n.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:n.jsx(l,{children:n.jsx(p,{type:"error",message:"Failed to load account data. Please try again later.",showIcon:!0})})}):n.jsxs("div",{children:[n.jsx(V,{nativeBalances:s,erc20Tokens:r,scope:t}),n.jsxs(o,{direction:"horizontal",size:"large",align:"start",style:{width:"100%"},children:[n.jsx(Te,{}),n.jsx(ze,{})]})]}):n.jsx("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:n.jsx(l,{children:n.jsx(p,{type:"warning",message:"Please connect your wallet to view and manage your tokens.",showIcon:!0})})})},qe=()=>n.jsx(ye,{children:n.jsx($e,{})}),{Title:Me,Text:Ke}=d,Fe=()=>{const{writeContract:e,status:s,isPending:r}=L(),{balanceOf:t,mintDate:a}=C(),{address:d}=N(),u=S(),[h,m]=i.useState(BigInt(0)),[v,x]=i.useState(0),[w,f]=i.useState(!1),[b,k]=i.useState(!1),j=u.OfficialToken;i.useEffect(()=>{(async()=>{if(!d||d===M)return;const e=await t(j.address,d);m(e);const s=await a(j.address,d);x(s);const r=s+259200<Date.now()/1e3;f(r)})()},[d,j.address]),i.useEffect(()=>{if(("success"===s||"error"===s)&&(k(!1),"success"===s&&d)){(async()=>{const e=await t(j.address,d);m(e);const s=await a(j.address,d);x(s)})()}},[s,d,j.address]);const E=r||b,P=h?q(h,_.decimals):"0";return n.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[n.jsx(l,{children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsxs("div",{children:[n.jsx(Me,{level:2,children:"Test Token Faucet"}),n.jsxs(o,{direction:"vertical",size:"small",children:[n.jsxs(Ke,{strong:!0,children:[_.name," (",_.symbol,")"]}),n.jsx(Ke,{type:"secondary",copyable:!0,children:j.address})]})]}),n.jsx(l,{size:"small",title:"Mint Tokens",children:n.jsxs(o,{direction:"vertical",size:"middle",style:{width:"100%"},children:[n.jsxs(c,{justify:"space-between",align:"middle",children:[n.jsxs(g,{children:[n.jsx(Ke,{strong:!0,children:"Your Balance: "}),n.jsxs(Ke,{children:[P," ",_.symbol]})]}),n.jsx(g,{children:n.jsx(y,{type:"primary",onClick:()=>{d&&(k(!0),e({...j,functionName:"mint",args:[d]}))},loading:E,disabled:!d||E||!w,children:"Mint"})})]}),n.jsx(p,{type:"info",message:n.jsxs(o,{direction:"vertical",size:"small",children:[n.jsx(Ke,{children:"You can mint 1,000 tokens each time."}),n.jsxs(Ke,{children:["You last minted on: ",A(v||0)]}),n.jsxs(Ke,{children:["You can mint again on: ",A(v+259200||0)]})]}),showIcon:!0})]})})]})}),n.jsx(l,{style:{marginTop:"24px"},children:n.jsxs(o,{direction:"vertical",size:"large",style:{width:"100%"},children:[n.jsx(Me,{level:3,children:"Oasis Official Faucet:"}),n.jsx(R,{type:"info",children:n.jsx("a",{href:"https://faucet.testnet.oasis.io/?",target:"_blank",rel:"noopener noreferrer",children:"https://faucet.testnet.oasis.io/?"})}),n.jsx(R,{children:"The symbol of the token is “TEST”, which can be used for payment of transaction fees in oasis sapphire (testnet), and can also be wrapped into WROSE.S tokens."})]})})]})};export{qe as E,Fe as F};
