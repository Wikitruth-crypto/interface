import{p as e,q as t,x as n,af as o,t as i,a1 as r,r as s,n as a,I as l,ct as c,cu as d,b4 as u,v as h,w as f,cv as p,bi as g,bj as m,b1 as y,cb as x,bQ as v,j as b,S as w,c as S,ad as C,R as N,cw as k,cd as E,b2 as M,cc as _,A as j,bg as P,cx as I,cy as A,cz as D,f as z,cA as R,cB as O,m as B,cC as L,cD as T,bl as $}from"./index-DzmPGAS5.js";import{I as V,P as H}from"./imageSwiper-DmbhBNEG.js";import{T as F}from"./text_p-qX2REdKA.js";import{c as X,T as Y,s as Z}from"./createLucideIcon-CBRxiy0d.js";import{s as K,c as W,a as q,S as G}from"./index-B0orgxkk.js";import{q as U,u as Q,a as J,b as ee,c as te}from"./index-BLZ688Sm.js";import{b as ne,c as oe,d as ie,M as re,e as se,a as ae}from"./hooks-9q6sH1gV.js";import{C as le}from"./index-C1FDvczb.js";import{R as ce,D as de,T as ue,A as he}from"./index-B7EOG2Hz.js";import{S as fe,u as pe}from"./useReadAllowance-D-djFI29.js";import{p as ge,t as me}from"./time-BtlmuUGs.js";import{S as ye}from"./index-CiJrIBMj.js";import"./index-q-iUJzic.js";const xe=e=>{const{componentCls:t}=e;return{[t]:{"&-horizontal":{[`&${t}`]:{"&-sm":{marginBlock:e.marginXS},"&-md":{marginBlock:e.margin}}}}}},ve=e=>{const{componentCls:t,sizePaddingEdgeHorizontal:i,colorSplit:r,lineWidth:s,textPaddingInline:a,orientationMargin:l,verticalMarginInline:c}=e;return{[t]:Object.assign(Object.assign({},n(e)),{borderBlockStart:`${o(s)} solid ${r}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:c,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${o(s)} solid ${r}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${o(e.marginLG)} 0`},[`&-horizontal${t}-with-text`]:{display:"flex",alignItems:"center",margin:`${o(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${r}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${o(s)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${t}-with-text-start`]:{"&::before":{width:`calc(${l} * 100%)`},"&::after":{width:`calc(100% - ${l} * 100%)`}},[`&-horizontal${t}-with-text-end`]:{"&::before":{width:`calc(100% - ${l} * 100%)`},"&::after":{width:`calc(${l} * 100%)`}},[`${t}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:a},"&-dashed":{background:"none",borderColor:r,borderStyle:"dashed",borderWidth:`${o(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:r,borderStyle:"dotted",borderWidth:`${o(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${t}-with-text-start${t}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${t}-inner-text`]:{paddingInlineStart:i}},[`&-horizontal${t}-with-text-end${t}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:i}}})}},be=e("Divider",e=>{const n=t(e,{dividerHorizontalWithTextGutterMargin:e.margin,sizePaddingEdgeHorizontal:0});return[ve(n),xe(n)]},e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),{unitless:{orientationMargin:!0}});const we={small:"sm",middle:"md"},Se=e=>{const{getPrefixCls:t,direction:n,className:o,style:l}=i("divider"),{prefixCls:c,type:d="horizontal",orientation:u="center",orientationMargin:h,className:f,rootClassName:p,children:g,dashed:m,variant:y="solid",plain:x,style:v,size:b}=e,w=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style","size"]),S=t("divider",c),[C,N,k]=be(S),E=r(b),M=we[E],_=!!g,j=s.useMemo(()=>"left"===u?"rtl"===n?"end":"start":"right"===u?"rtl"===n?"start":"end":u,[n,u]),P="start"===j&&null!=h,I="end"===j&&null!=h,A=a(S,o,N,k,`${S}-${d}`,{[`${S}-with-text`]:_,[`${S}-with-text-${j}`]:_,[`${S}-dashed`]:!!m,[`${S}-${y}`]:"solid"!==y,[`${S}-plain`]:!!x,[`${S}-rtl`]:"rtl"===n,[`${S}-no-default-orientation-margin-start`]:P,[`${S}-no-default-orientation-margin-end`]:I,[`${S}-${M}`]:!!M},f,p),D=s.useMemo(()=>"number"==typeof h?h:/^\d+$/.test(h)?Number(h):h,[h]),z={marginInlineStart:P?D:void 0,marginInlineEnd:I?D:void 0};return C(s.createElement("div",Object.assign({className:A,style:Object.assign(Object.assign({},l),v)},w,{role:"separator"}),g&&"vertical"!==d&&s.createElement("span",{className:`${S}-inner-text`,style:z},g)))};function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ce.apply(this,arguments)}const Ne=(e,t)=>s.createElement(l,Ce({},e,{ref:t,icon:c})),ke=s.forwardRef(Ne),Ee=X("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Me=X("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);async function _e(e){try{const{network:t,layer:n}=h,{data:o,error:i}=await K.from("boxes").select("*").eq("network",t).eq("layer",n).eq("id",e).single();if(i)return{box:null,metadataBox:null,error:i};if(!o)return{box:null,metadataBox:null,error:null};const{data:r,error:s}=await K.from("metadata_boxes").select("*").eq("network",t).eq("layer",n).eq("id",e).maybeSingle(),a=r||null,l=function(e){const t=W(e,{deep:!0});return{...t,status:q(t.status,t.deadline,t.buyerId||t.buyer_id),biddersIds:t.biddersIds||[],acceptedToken:t.acceptedToken??void 0,listedMode:t.listedMode??void 0}}(o),c=a?function(e){var t,n;const o=e.encryption_slices_metadata_cid||{},i=e.encryption_passwords||{},r=Array.isArray(e.encryption_file_cid)?e.encryption_file_cid:[],s={slicesMetadataCID_encryption:o.slicesMetadataCID_encryption??o.slicesMetadataCidEncryption??o.slices_metadata_cid_encryption??"",slicesMetadataCID_iv:o.slicesMetadataCID_iv??o.slicesMetadataCidIv??o.slices_metadata_cid_iv??""},a={password_encryption:i.password_encryption??i.passwordEncryption??i.password_encryption??"",password_iv:i.password_iv??i.passwordIv??i.password_iv??""},l=r.map(e=>({fileCID_encryption:e.fileCID_encryption??e.fileCidEncryption??e.file_cid_encryption??"",fileCID_iv:e.fileCID_iv??e.fileCidIv??e.file_cid_iv??""}));return{project:e.project,website:e.website,name:e.name,tokenId:(null==(n=null==(t=e.id)?void 0:t.toString)?void 0:n.call(t))??"",typeOfCrime:e.type_of_crime??"",label:e.label??[],title:e.title??"",nftImage:e.nft_image??"",boxImage:e.box_image??"",country:e.country??"",state:e.state??"",description:e.description??"",eventDate:e.event_date??"",createDate:e.create_date??"",timestamp:Number(e.timestamp??0),mintMethod:e.mint_method,fileList:e.file_list??[],encryptionSlicesMetadataCID:s,encryptionFileCID:l,encryptionPasswords:a,publicKey:e.public_key??""}}(a):null;return{box:l,metadataBox:c,error:null}}catch(t){return{box:null,metadataBox:null,error:je(t)}}}function je(e){return e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null}const Pe=(e,t)=>{const{network:n,layer:o}=h,i=!!e&&!!t&&"Storing"!==t.listedMode&&"Selling"!==t.listedMode&&""!==t.buyerId,r=t.listedMode||"",{data:a,isLoading:l,error:c,isFetching:d}=f({queryKey:["box-bidders",n,o,e,r],queryFn:async()=>{const t=await async function(e,t){const{network:n,layer:o}=h;try{let i=null;if("Auctioning"===t){const{data:t,error:r}=await K.from("box_bidders").select("bidder_id").eq("network",n).eq("layer",o).eq("id",e);if(r)return{biddersIds:null,error:r};t&&Array.isArray(t)&&(i=t.map(e=>{const t=e.bidder_id;return"string"==typeof t?t:"bigint"==typeof t?t.toString():(null==t?void 0:t.toString())||""}).filter(e=>""!==e))}return{biddersIds:i&&i.length>0?i:null,error:null}}catch(c){return{biddersIds:null,error:je(c)}}}(e,r);if(t.error)throw t.error;return t},staleTime:3e5,enabled:i});return{biddersIds:s.useMemo(()=>{if(null==a?void 0:a.biddersIds)return a.biddersIds},[null==a?void 0:a.biddersIds]),isLoading:l||d,error:c||null}},Ie={userState:{roles:[]},modalStatus:{SellAuction:"close",ExtendDeadline:"close",ViewFile:"close",BuyBidPay:"close"}},Ae=g()(m(e=>({...Ie,updateUserState:t=>e(e=>({userState:{...e.userState,...t}}),!1,"updateUserState"),updateModalStatus:(t,n)=>e(e=>({modalStatus:{...e.modalStatus,[t]:n}}),!1,"updateModalStatus")}))),De=s.createContext(void 0),ze=({boxId:e,children:t})=>{const{box:n,metadataBox:o,isLoading:i}=(e=>{const{network:t,layer:n}=h,{data:o,isLoading:i,error:r,isFetching:a}=f({queryKey:["box-detail",t,n,e],queryFn:async()=>{const t=await _e(e);if(t.error)throw t.error;return t},staleTime:3e5,enabled:!!e});return{box:s.useMemo(()=>{if(null==o?void 0:o.box)return o.box},[null==o?void 0:o.box]),metadataBox:s.useMemo(()=>{if(null==o?void 0:o.metadataBox)return o.metadataBox},[null==o?void 0:o.metadataBox]),boxId:e,isLoading:i||a,error:r||null}})(e),r=(e=>{if(!e)return;const{deadline:t,requestRefundDeadline:n,reviewDeadline:o}=e;let i=!1,r=!0,s=!0;const a=Math.floor(Date.now()/1e3);return t&&(i=Number(t)>a),n&&(r=Number(n)>a),o&&(s=Number(o)>a),{isInRequestRefundDeadline:r,isInReviewRefundDeadline:s,isInDeadline:i,isInExtendDeadlineTimeWindow:a>Number(t)-p.deadlineExtensionWindow}})(n||{}),{address:a}=y()||{},l=x(e=>{var t,n;if(!a||!v)return null;const o=e.accounts[v];if(!o)return null;const i=(null==(t=o[a])?void 0:t.userId)??(null==(n=o[a.toLowerCase()])?void 0:n.userId)??null;return i&&""!==i.trim()?i:null}),{boxRewardsData:c,isLoading:d}=((e,t)=>{const{network:n,layer:o}=h,i=!(!e||!t||""===t.listedMode||"InSecrecy"!==t.status&&"Published"!==t.status),{data:r,isLoading:a,error:l,isFetching:c}=f({queryKey:["box-rewards",n,o,e],queryFn:async()=>{const t=await U(e);if(t.error)throw t.error;return t},staleTime:3e5,enabled:i});return{boxRewardsData:s.useMemo(()=>{if(null==r?void 0:r.boxRewardsData)return r.boxRewardsData},[null==r?void 0:r.boxRewardsData]),isLoading:a||c,error:l||null}})(e,n||{}),{biddersIds:u,isLoading:g}=Pe(e,n||{}),m=Ae(e=>e.userState.roles),{orderAmountsData:w,isLoading:S}=Q(e,l||"",m),C=s.useMemo(()=>({box:n,boxId:e,metadataBox:o,isLoading:i||!n,deadlineCheckState:r,boxRewardsData:c,isLoadingRewards:d,biddersIds:u,isLoadingBidders:g,orderAmountsData:w,isLoadingOrderAmounts:S}),[n,e,o,i,r,c,d,u,g,w,S]);return b.jsx(De.Provider,{value:C,children:t})},Re=()=>{const e=s.useContext(De);if(!e)throw new Error("useBoxContext must be used within BoxProvider");return e},Oe=({tokenId:e})=>{const{box:t,metadataBox:n}=Re();return t?b.jsxs("div",{className:"w-full space-y-6 md:space-y-8",children:[b.jsxs(w,{direction:"vertical",size:"middle",children:[b.jsxs(w,{direction:"horizontal",size:"middle",children:[b.jsx(F,{children:"Truth Box Id:"}),b.jsx(F,{children:e})]}),b.jsxs(w,{direction:"horizontal",size:"middle",children:[b.jsx(F,{children:"Minter:"})," ",b.jsx(F,{children:t.minterId})]}),b.jsxs(w,{direction:"horizontal",size:"middle",children:[b.jsx(F,{children:"Owner:"})," ",b.jsx(F,{children:t.ownerAddress})]}),b.jsxs(w,{direction:"horizontal",size:"middle",children:[b.jsx(F,{children:"Create date:"})," ",b.jsx(F,{children:(null==n?void 0:n.createDate)?new Date(null==n?void 0:n.createDate).toLocaleString():""})]})]}),b.jsx("div",{className:"w-full bg-black rounded-xl md:rounded-2xl overflow-hidden",children:b.jsx("div",{className:"aspect-video md:aspect-[4/3] lg:aspect-video",children:b.jsx(V,{images:[(null==n?void 0:n.boxImage)||"",(null==n?void 0:n.nftImage)||""],className:"w-full"})})}),b.jsx("div",{className:"space-y-4",children:b.jsx(Y,{children:null==n?void 0:n.title})}),b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx(F,{children:null==n?void 0:n.country}),b.jsx(F,{children:null==n?void 0:n.state}),b.jsx(F,{children:null==n?void 0:n.eventDate})]}),b.jsx("hr",{className:"border-border/50"}),b.jsx("div",{className:"space-y-3",children:b.jsx(F,{children:null==n?void 0:n.description})})]}):b.jsx("div",{className:"w-full flex items-center justify-center py-12",children:b.jsx("div",{className:"text-muted-foreground text-lg font-mono",children:"Loading..."})})},Be=({children:e,className:t})=>b.jsx("div",{className:S("flex flex-col md:flex-row w-full ","p-2 items-center gap-2 ","bg-background rounded-md md:rounded-xl",t),children:e}),Le=({controller:e,className:t,onClick:n,children:o})=>{var i;return b.jsxs(Be,{className:t,children:[b.jsx(C,{onClick:()=>e.execute({onClick:n}),loading:e.isLoading,disabled:e.isDisabled,children:e.label}),b.jsxs("div",{className:"flex flex-col items-start",children:[(null==(i=e.error)?void 0:i.message)&&b.jsx(F,{type:"error",children:e.error.message}),e.description&&b.jsx("div",{className:"flex flex-col items-start",children:b.jsx(F,{size:"sm",children:e.description})}),o]})]})},Te=g((e,t)=>({functionWriting:null,setFunctionWriting:t=>e({functionWriting:t}),reset:()=>e({functionWriting:null})})),$e=e=>{const{writeContractAsync:t,data:n,error:o,isPending:i,isError:r,isSuccess:a,status:l,reset:c}=ne(),{isSuccess:d}=oe({hash:n}),{address:u}=y(),[h,f]=s.useState(null),{setFunctionWriting:p}=Te(),g=x(e=>e.addBoxInteraction);return s.useEffect(()=>{d&&h&&u&&e?Array.isArray(e)?e.forEach(e=>{g(e,h,n)}):g(e,h,n):r&&(c(),p(null))},[d,h,u,e,n,g,r,c]),{writeCustormV2:async e=>{const n=e.functionName;f(n),p(n);try{return await t({address:e.contract.address,abi:e.contract.abi,functionName:e.functionName,args:e.args})}catch(o){throw o}finally{p(null)}},hash:n,error:o,isPending:i,isLoading:"idle"!==l&&"error"!==l&&!d,isSuccess:a,status:l,isError:r,reset:c,isSuccessed:d}},Ve=["sell","auction","publishByMinter"],He=["sell","auction","publishByMinter"],Fe=["sell","auction","publishByMinter"],Xe=["buy","bid","publishByMinter"],Ye=["buy","bid","publishByMinter"],Ze=["requestRefund","completeOrder"],Ke=["cancelRefund","agreeRefund","refuseRefund"],We=["agreeRefund","cancelRefund","refuseRefund"],qe=["agreeRefund","cancelRefund","refuseRefund"],Ge=["completeOrder","requestRefund","agreeRefund","refuseRefund"],Ue=["payConfiFee","publishByBuyer"],Qe=["publishByMinter","publishByBuyer","sell","auction"],Je=e=>{const{boxId:t,box:n,deadlineCheckState:o}=Re(),{userState:i,modalStatus:r}=Ae(e=>e),{address:a}=y()||{},l=null==a?void 0:a.toLowerCase(),c=[],d=s.useMemo(()=>l&&v?e=>{var n,o;return(null==(o=null==(n=e.accounts[v])?void 0:n[l])?void 0:o.boxInteractions[t])??c}:()=>c,[l,t]),u=x(d);return s.useMemo(()=>{if(!n)return!1;const t=u.map(e=>e.functionWrote)||[],s=i.roles,{isInDeadline:a,isInRequestRefundDeadline:l,isInReviewRefundDeadline:c}=o||{},d=n.isInBlacklist||!1,h=n.status||"Storing",f=Number(n.purchaseTimestamp)||0,p=Number(n.reviewDeadline)||0,g=n.refundPermit||!1,m=!n.buyerId||""===n.buyerId,y=s.includes("Minter"),x=s.includes("Admin"),v=s.includes("Buyer"),b=s.includes("Bidder"),w=s.includes("Other"),S=0===s.length,C=()=>a?y:!S,N=e=>e.every(e=>!t.includes(e));switch(e){case"extendActive":return!d&&y&&a&&(null==o?void 0:o.isInExtendDeadlineTimeWindow)&&N(Ve)&&"close"===r.ExtendDeadline;case"sellActive":return!d&&"Storing"===h&&C()&&N(He)&&"close"===r.SellAuction;case"auctionActive":return!d&&"Storing"===h&&C()&&N(Fe)&&"close"===r.SellAuction;case"buyActive":return!d&&0===f&&m&&"Selling"===h&&w&&N(Xe);case"bidActive":return!d&&"Auctioning"===h&&(w||b)&&a&&N(Ye);case"requestRefundActive":return!d&&!g&&l&&0===p&&"Paid"===h&&v&&N(Ze);case"cancelRefundActive":return!d&&!g&&"Refunding"===h&&v&&N(Ke);case"agreeRefundActive":return!d&&!g&&"Refunding"===h&&(c?x||y:!S)&&N(We);case"refuseRefundActive":return!d&&!g&&"Refunding"===h&&x&&N(qe);case"completeActive":return!d&&0===p&&!g&&"Paid"===h&&(l?v:!S)&&N(Ge);case"payConfiFeeActive":return!d&&"InSecrecy"===h&&(null==o?void 0:o.isInExtendDeadlineTimeWindow)&&!S&&N(Ue);case"publishActive":return!d&&("Storing"===h?y:"InSecrecy"===h&&v)&&N(Qe);case"viewFileActive":return!d&&("Storing"===h||"Selling"===h||"Auctioning"===h?y:"InSecrecy"===h||"Paid"===h?v:("Refunding"===h||"Published"===h)&&!S);default:return!0}},[e,n,l,i.roles,u,r,t])},et=e=>{const t=ie(),{box:n,boxId:o}=Re(),i=Ae(e=>e.userState.roles),{functionWriting:r}=Te(),{writeCustormV2:a,error:l,isLoading:c,isSuccessed:d}=$e(o),u=!e.activeKey||Je(e.activeKey),h=s.useMemo(()=>({box:n,boxId:o,roles:i}),[n,o,i]),f=s.useMemo(()=>o=>e.buildWrite?e.buildWrite(h,t,o):e.contract&&e.functionName&&e.getArgs&&n?{contract:e.contract(t),functionName:e.functionName,args:e.getArgs(h,t)}:null,[e,h,t,n]),p=s.useMemo(()=>f(void 0),[f]),g=e.pendingFunctions??(e.functionName?[e.functionName]:[]),m=g.length>0&&g.includes(r??""),y=null!==r&&!g.includes(r??""),x=!!e.allowedRoles&&!e.allowedRoles.some(e=>i.includes(e)),v=!!e.isDisabled&&e.isDisabled(h),b=!p&&!e.requiresCustomArgs,w=y||m||x||v||!u||b,S=s.useRef(null);s.useEffect(()=>{S.current=r},[r]);return{label:e.label,description:e.description,isLoading:m||c,isDisabled:w,isSuccessed:d,showApprove:!1,error:l,execute:async t=>{var n,o;const i=f(null==t?void 0:t.customArgs);i||!e.requiresCustomArgs?i&&(null==(o=null==t?void 0:t.onClick)||o.call(t),await a({contract:i.contract,functionName:i.functionName,args:i.args})):null==(n=null==t?void 0:t.onClick)||n.call(t)}}},tt=e=>e.Exchange,nt={buy:{id:"buy",label:"Buy",description:"Buy this box.",activeKey:"buyActive",requiresCustomArgs:!0},bid:{id:"bid",label:"Bid",description:"Bid for this box.",activeKey:"bidActive",requiresCustomArgs:!0},payConfiFee:{id:"payConfiFee",label:"PayConfiFee",activeKey:"payConfiFeeActive",requiresCustomArgs:!0},requestRefund:{id:"requestRefund",label:"Refund",description:"Request refund before the deadline.",contract:tt,functionName:"requestRefund",getArgs:({boxId:e})=>[e],activeKey:"requestRefundActive"},cancelRefund:{id:"cancelRefund",label:"Cancel",description:"Cancel refund, the transaction will be completed.",contract:tt,functionName:"cancelRefund",getArgs:({boxId:e})=>[e],activeKey:"cancelRefundActive"},agreeRefund:{id:"agreeRefund",label:"Agree",description:"Agree refund, funds will be returned to the buyer.",contract:tt,functionName:"agreeRefund",getArgs:({boxId:e})=>[e],activeKey:"agreeRefundActive"},refuseRefund:{id:"refuseRefund",label:"Refuse",description:"Refuse refund, the transaction will be completed.",contract:tt,functionName:"refuseRefund",getArgs:({boxId:e})=>[e],activeKey:"refuseRefundActive"},completeOrder:{id:"completeOrder",label:"Complete",description:"Complete the order: Paid → InSecrecy.",contract:tt,functionName:"completeOrder",getArgs:({boxId:e})=>[e],activeKey:"completeActive"},publish:{id:"publish",label:"Publish",description:"Publish the box.",contract:e=>e.TruthBox,functionName:"publishByMinter",getArgs:({boxId:e})=>[e],activeKey:"publishActive",buildWrite:(e,t)=>{const{box:n,boxId:o,roles:i}=e;return n?"Storing"===n.status&&i.includes("Minter")?{contract:t.TruthBox,functionName:"publishByMinter",args:[o]}:"InSecrecy"===n.status&&i.includes("Buyer")?{contract:t.TruthBox,functionName:"publishByBuyer",args:[o]}:null:null}},sell:{id:"sell",label:"Sell",activeKey:"sellActive",requiresCustomArgs:!0,pendingFunctions:["sell"],buildWrite:(e,t,n)=>{if(!n)return null;const{acceptedToken:o,price:i}=n;return{contract:t.Exchange,functionName:"sell",args:[e.boxId,o,i]}}},auction:{id:"auction",label:"Auction",activeKey:"auctionActive",requiresCustomArgs:!0,pendingFunctions:["auction"],buildWrite:(e,t,n)=>{if(!n)return null;const{acceptedToken:o,price:i}=n;return{contract:t.Exchange,functionName:"auction",args:[e.boxId,o,i]}}},extendDeadline:{id:"extendDeadline",label:"Extend Deadline",description:"Extend the deadline of the box.",activeKey:"extendActive",requiresCustomArgs:!0},viewFile:{id:"viewFile",label:"View File",description:"View the confidential file.",activeKey:"viewFileActive",requiresCustomArgs:!0}},ot=N.memo(({onClick:e,className:t})=>{const n=et(nt.completeOrder),{roles:o}=Ae(e=>e.userState),{helperRewardRate:i}=k();return b.jsx(Le,{controller:n,className:t,onClick:e,children:!o.includes("Buyer")&&b.jsxs(F,{children:["You will get a ",i,"% reward for completing the transaction."]})})}),it=N.memo(({onClick:e,className:t})=>{const n=et(nt.agreeRefund);return b.jsx(Le,{controller:n,className:t,onClick:e})}),rt=N.memo(({onClick:e,className:t})=>{const n=et(nt.refuseRefund);return b.jsx(Le,{controller:n,className:t,onClick:e})}),st=N.memo(({onClick:e,className:t})=>{const n=et(nt.cancelRefund);return b.jsx(Le,{controller:n,className:t,onClick:e})}),{Text:at,Paragraph:lt}=E,ct=({label:e,type:t,cidList:n=[],className:o})=>0===n.length?null:b.jsx("div",{className:o,children:b.jsx(le,{children:b.jsxs(w,{direction:"vertical",size:"small",style:{width:"100%"},children:[b.jsxs(at,{strong:!0,style:{fontFamily:"monospace",fontSize:13},children:[e,":"]}),n.map((e,n)=>{return b.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:b.jsx(lt,{copyable:{text:e,icon:[b.jsx(ce,{},"copy"),b.jsx(ke,{},"check")],tooltips:["Copy","Copied!"]},ellipsis:{tooltip:e},style:{flex:1,fontFamily:"cid"===t||"password"===t?"monospace":void 0,fontSize:13},children:(o=e,"password"===t&&o?"•".repeat(Math.min(o.length,12)):o)})},n);var o})]})})}),dt=()=>{const{chainId:e,address:t}=y(),{getPrivateKey_TruthBox:n,setPrivateKey_TruthBox:o}=M(),{session:i,isValidateSession:r,login:s}=_(),{getPrivateData:a}=function(){const{readContract:e}=d();return{getBasicData:async t=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"getBasicData",args:[t]});return n&&Array.isArray(n)&&n.length>=3?[Number(n[0]),Number(n[1]),Number(n[2])]:[0,0,0]}catch(n){return[0,0,0]}},getStatus:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getStatus",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getDeadline:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getDeadline",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getPrice:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getPrice",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getPrivateData:async(t,n)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getPrivateData",args:[t,n]});return o?String(o):""}catch(o){return""}},blacklistSupply:async(t=!1)=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"blacklistSupply",args:[],force:t});return n?Number(n):0}catch(n){return 0}},completeCounts:async(t=!1)=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"completeCounts",args:[],force:t});return n?Number(n):0}catch(n){return 0}},isInBlacklist:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"isInBlacklist",args:[t],force:n});return!!o&&Boolean(o)}catch(o){return!1}}}}();return{checkPrivateKeyExist:o=>!!n(o,e,t),getPrivateKey:async l=>{const c=n(l,e,t);if(c)return c;let d=null;if(r)d=i.token;else{const e=await s({statement:"I want to view the private data of the box",resources:[l]});e&&(d=e.token)}if(d){const n=await a(l,d);if(n)return o(l,n,e,t),n}return null}}},ut=()=>{const[e,t]=s.useState(null),{decryptList:n,decrypt:o}=(()=>{const[e,t]=s.useState(null),[n,o]=s.useState(null),[i,r]=s.useState(null),[a,l]=s.useState(!1);return{decrypt:async(e,n,o,i)=>{l(!0),r(null);try{const s=await de.decrypt(e,n,o,i);if(s.success&&s.data)return t(s.data),s.data;{const e=s.error||"Decryption failed";return r(e),null}}catch(s){const e=s instanceof Error?s.message:"Unknown decryption error";return r(e),null}finally{l(!1)}},decryptList:async(e,t,n)=>{l(!0),r(null);try{const i=await de.decryptList(e,t,n);if(i.success&&i.data)return o(i.data),i.data;{const e=i.error||"Decryption failed";return r(e),null}}catch(i){const e=i instanceof Error?i.message:"Unknown decryption error";return r(e),null}finally{l(!1)}},data:e,dataList:n,error:i,isLoading:a}})();return{decryptionViewFile:async(e,i)=>{try{if(!(i.publicKey&&i.encryptionFileCID&&i.encryptionPasswords&&i.encryptionSlicesMetadataCID))throw new Error("Metadata box is required!");const r=i.encryptionFileCID.map(e=>({iv_bytes:e.fileCID_iv,encrypted_bytes:e.fileCID_encryption})),s=await n(i.publicKey,e,r),a=await o(i.publicKey,e,i.encryptionSlicesMetadataCID.slicesMetadataCID_iv,i.encryptionSlicesMetadataCID.slicesMetadataCID_encryption),l={fileCIDList:s||[],password:await o(i.publicKey,e,i.encryptionPasswords.password_iv,i.encryptionPasswords.password_encryption)||"",slicesMetadataCID:a||""};return t(l),l}catch(r){throw r}},data:e}},ht={key:"privateKey",title:"Reading private key"},ft={key:"decrypt",title:"Decrypting file information"},pt={key:"done",title:"Done"},gt=({onClose:e})=>{var t;const{box:n,metadataBox:o}=Re();if(!n||!o)return null;const{steps:i,isProcessing:r,errorMsg:a,result:l,attemptCount:c,maxRetry:d,start:u,retry:h}=(()=>{const{getPrivateKey:e}=dt(),{decryptionViewFile:t}=ut(),[n,o]=s.useState([{...ht,status:"wait",description:"Reading private key"},{...ft,status:"wait",description:"Decrypting file information"},{...pt,status:"wait",description:"Done"}]),[i,r]=s.useState(!1),[a,l]=s.useState(null),[c,d]=s.useState(null),u=s.useRef(0),h=s.useCallback(()=>{o([{...ht,status:"wait",description:"Reading private key"},{...ft,status:"wait",description:"Decrypting file information"},{...pt,status:"wait",description:"Done"}]),d(null),l(null)},[]),f=s.useCallback((e,t,n)=>{o(o=>o.map(o=>o.key===e?{...o,status:t,description:n??o.description}:o))},[]),p=s.useCallback(async(o,i)=>{var s;if(!o||!i)return d("Box or metadata not found, cannot decrypt."),void f("privateKey","error","Missing necessary data");if(u.current>=5)d("Maximum attempts reached (5 times), please try again later.");else{u.current+=1,r(!0),d(null),f("privateKey","process","Reading private key…");try{const n=o.privateKey?o.privateKey:await e(o.id);if(!n)throw new Error("Cannot read private key, please confirm that the signature authorization has been completed.");f("privateKey","finish","Private key read completed"),f("decrypt","process","Decrypting file information…");const r=await t(n,i);l(r),f("decrypt","finish","Decryption successful"),f("done","finish","Done")}catch(a){const e=(null==a?void 0:a.message)||"Unknown error, please try again later.";d(e),"finish"!==(null==(s=n.find(e=>"privateKey"===e.key))?void 0:s.status)?f("privateKey","error",e):f("decrypt","error",e)}finally{r(!1)}}},[t,e,f,n]),g=s.useCallback((e,t)=>{u.current<5&&p(e,t)},[p]);return{steps:n,isProcessing:i,errorMsg:c,result:a,attemptCount:u.current,maxRetry:5,start:p,retry:g,reset:h}})(),f="create"===(null==o?void 0:o.mintMethod),p=s.useRef(!1);s.useEffect(()=>{p.current||n&&o&&(p.current=!0,u(n,o))},[n,o,u]);const g="finish"===(null==(t=i.find(e=>"decrypt"===e.key))?void 0:t.status),m=Math.max(0,d-c);return b.jsxs(re,{title:"View File",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:()=>{},onCancel:()=>{e()},okButtonProps:{disabled:!0},cancelButtonProps:{disabled:!1},okText:"Download (Soon)",cancelText:"Close",width:520,children:[!f&&b.jsx(j,{type:"warning",showIcon:!0,message:"This Box is in createAndPublish mode, you can view the file directly in the Published area.",className:"mb-4"}),b.jsx(fe,{direction:"vertical",items:i.map(e=>({title:e.title,status:e.status,description:e.description})),className:"mb-4"}),a&&b.jsx(j,{type:"error",showIcon:!0,message:"Operation failed",description:a,className:"mb-3"}),b.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[b.jsxs(F,{children:["Attempts: ",c,"/",d,"（Remaining ",m," times）"]}),b.jsx(C,{type:"link",size:"small",onClick:()=>h(n,o),disabled:r||0===m,className:"px-0",children:"Continue request"})]}),r&&b.jsx(F,{children:"Processing, please wait patiently…"}),g&&b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx(ct,{label:"File CID",type:"cid",cidList:(null==l?void 0:l.fileCIDList)||[]}),b.jsx(ct,{label:"Password",type:"password",cidList:[(null==l?void 0:l.password)||""]}),b.jsx(ct,{label:"Slices Metadata CID",type:"cid",cidList:[(null==l?void 0:l.slicesMetadataCID)||""]})]})]})},mt=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=et(nt.viewFile);return b.jsxs(Le,{controller:i,className:t,onClick:()=>{null==e||e(),o(!0)},children:[b.jsx(F,{children:"You can view the confidential file here."}),n&&b.jsx(gt,{onClose:()=>o(!1)})]})}),yt=N.memo(({onClick:e,className:t})=>{const n=et(nt.publish);return b.jsx(Le,{controller:n,className:t,onClick:e})}),xt=()=>{const{box:e,orderAmountsData:t}=Re(),{address:n}=y();if(!e||!n)return b.jsx("div",{children:"loading..."});const o=null==t?void 0:t.find(t=>t.token===e.acceptedToken),i=s.useMemo(()=>o?Number(o.amount):0,[o]),r=s.useMemo(()=>e.price?Math.max(0,Number(e.price)-i):0,[e.price,i]),a=P(e.acceptedToken);return b.jsxs(b.Fragment,{children:[i>0&&b.jsxs("div",{style:{marginBottom:"5px"},children:[b.jsx(F,{children:"In the Auction, you paid:"}),b.jsx(H,{price:i,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals})]}),r>0&&b.jsxs("div",{children:[b.jsx(F,{children:"You need to pay:"}),b.jsx(H,{price:r,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals})]})]})},vt={allowance:{title:"Checking allowance...",descriptions:{idle:"Checking allowance...",pending:"Checking allowance...",success:"Allowance is enough",error:"Checking allowance failed"}},approve:{title:"Approve",descriptions:{idle:"Need to approve",pending:"Approving...",success:"Approve success",error:"Approve failed"}},buy:{title:"Buy",descriptions:{idle:"Ready to buy",pending:"Executing buy operation...",success:"Buy operation success",error:"Buy operation failed"}},bid:{title:"Bid",descriptions:{idle:"Ready to bid",pending:"Executing bid operation...",success:"Bid operation success",error:"Bid operation failed"}},payConfiFee:{title:"PayConfiFee",descriptions:{idle:"Ready to pay confidentiality fee",pending:"Executing pay confidentiality fee operation...",success:"Pay confidentiality fee operation success",error:"Pay confidentiality fee operation failed"}}},bt=(e,t)=>{const n=[{stepKey:"allowance",title:vt.allowance.title,description:vt.allowance.descriptions.success,status:"wait"}];return t||n.push({stepKey:"approve",title:vt.approve.title,description:vt.approve.descriptions.idle,status:"wait"}),"buy"===e?n.push({stepKey:"buy",title:vt.buy.title,description:vt.buy.descriptions.idle,status:"wait"}):"bid"===e?n.push({stepKey:"bid",title:vt.bid.title,description:vt.bid.descriptions.idle,status:"wait"}):"payConfiFee"===e&&n.push({stepKey:"payConfiFee",title:vt.payConfiFee.title,description:vt.payConfiFee.descriptions.idle,status:"wait"}),n};const wt=({open:e,onClose:t,boxId:n,tokenAddress:o,amount:i,functionName:r})=>{const a=se(o),{steps:l,checkAllowance:c,handleApproveClick:d,handleBuyBidClick:u,isLoading:h,isSuccessed:f,status:p,currentStepItem:g,formattedAllowanceAmount:m}=((e,t,n,o)=>{const i=ie(),{address:r}=I(),{readAllowance:a,allowanceAmount:l,isEnough:c}=pe(),{writeCustormV2:d,status:u,isLoading:h,isSuccessed:f}=$e(e),[p,g]=s.useState({steps:bt(o,!1),currentIndex:0}),m=s.useCallback(e=>{const t=bt(o,e),n=t.length>1?1:0;g({steps:t,currentIndex:n})},[o]),y=s.useCallback((e,t)=>{g(n=>{const o=n.steps.findIndex(t=>t.stepKey===e);if(-1===o)return n;const i=(e=>{switch(e){case"pending":return"process";case"success":return"finish";case"error":return"error";default:return"wait"}})(t),r=vt[e].descriptions[t],s=n.steps.map((e,t)=>t===o?{...e,status:i,description:r}:e);let a=n.currentIndex;const l=o===n.currentIndex,c=o<s.length-1;return"finish"===i&&l&&c&&(a=o+1),{steps:s,currentIndex:a}})},[]),{steps:x,currentIndex:v}=p,b=x[v]??x[x.length-1],w=s.useCallback(async e=>{if(!(r&&t&&n&&i.FundManager.address))return;const o=ge(n,t.decimals);try{const n=await a(t.address,r,i.FundManager.address,o);"init"!==e&&"approve"!==e||m(n.isEnough),y("allowance","success")}catch(s){y("allowance","error")}},[t,n,a,r,m,y]),S=s.useCallback(async(e=!1)=>{if(!t||!n||!i.FundManager.address)return;const o=e?A:ge(n,t.decimals);try{y("approve","pending");const e=D(t.address);await d({contract:e,functionName:"approve",args:[i.FundManager.address,o]}),y("approve","success")}catch(r){y("approve","error")}},[t,n,d,w,y]),C=s.useCallback(async()=>{if(!t||!n||!i)return;let r=i.Exchange;"payConfiFee"===o&&(r=i.TruthBox);try{y(o,"pending"),await d({contract:r,functionName:o,args:[e]}),y(o,"success")}catch(s){y(o,"error")}},[t,n,d,o,e,y]);return{steps:x,currentIndex:v,currentStepItem:b,initializeSteps:m,updateStepStatus:y,checkAllowance:w,handleApproveClick:S,handleBuyBidClick:C,isLoading:h,isEnough:c,isSuccessed:f,status:u,allowanceAmount:l,formattedAllowanceAmount:z(l,(null==t?void 0:t.decimals)??18)}})(n,a,i,r);if(!a||!i)return null;const y=function(e){if(/[eE]/.test(e)){const[t,n]=e.split(/[eE]/),o=parseInt(n,10),[i,r=""]=t.split("."),s=r.length;if(i.length,o>0){const e=i+r,t=o-s;if(t>0)return BigInt(e+"0".repeat(t));if(t<0){const n=e.slice(0,e.length+t);return BigInt(n||"0")}return BigInt(e)}return BigInt(i)}const t=e.split(".")[0];return BigInt(t)}(i),x=z(y,a.decimals),v="approve"===g.stepKey&&"finish"!==g.status,S="buy"===g.stepKey||"bid"===g.stepKey||"payConfiFee"===g.stepKey,N=s.useMemo(()=>l.map(({stepKey:e,...t})=>({key:e,...t})),[l]);s.useEffect(()=>{e&&c("init")},[e,o]);const k=()=>{t()};return b.jsx(re,{title:"Wrap operation process",open:e,onCancel:k,closable:"pending"!==p,maskClosable:"pending"!==p,footer:[b.jsx(C,{onClick:k,disabled:"pending"===p,children:f?"Complete":"Cancel"},"close")],width:450,centered:!0,children:b.jsxs(w,{direction:"vertical",size:"large",style:{width:"100%"},children:[b.jsx(j,{type:"info",message:b.jsxs(w,{direction:"vertical",size:"small",children:[b.jsxs(F,{type:"info",children:["You are about to ",r," this box."]}),b.jsxs(F,{children:["Price: ",x," ",null==a?void 0:a.symbol]})]}),showIcon:!0}),b.jsx(fe,{direction:"vertical",items:N,size:"small"}),v&&b.jsxs(w,{direction:"vertical",size:"middle",style:{width:"100%"},children:[b.jsx(j,{type:"warning",message:b.jsx(w,{direction:"vertical",size:"small",children:b.jsxs(F,{children:["Allowance is not enough. Current: ",m,", Required: ",i]})}),showIcon:!0}),b.jsxs(C,{type:"primary",onClick:()=>d(!1),loading:h,disabled:!v,block:!0,children:["Approve ",x," ",null==a?void 0:a.symbol]}),b.jsx(C,{type:"primary",onClick:()=>d(!0),loading:h,disabled:!v,block:!0,children:"Approve Max(uint256)"})]}),"approve"===g.stepKey&&"process"===g.status&&b.jsx(j,{type:"info",message:"Approving token...",showIcon:!0}),S&&b.jsx(C,{type:"primary",onClick:u,loading:h,disabled:!S,block:!0,children:r}),l.some(e=>"error"===e.status)&&b.jsx(j,{type:"error",message:"Operation failed",description:"Please check network connection and wallet status, then try again.",showIcon:!0}),f&&b.jsx(j,{type:"success",message:"Wrap operation completed successfully",showIcon:!0})]})})},St=N.memo(({onClick:e,className:t})=>{var n;const o=et(nt.bid),{box:i}=Re(),[r,a]=s.useState(!1),l=null==i?void 0:i.acceptedToken,c=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);return b.jsxs(Le,{controller:o,className:t,onClick:()=>{null==e||e(),a(!0)},children:[b.jsx("div",{className:"w-full mt-2 flex-col",children:b.jsx(xt,{})}),l&&b.jsx(wt,{open:r,onClose:()=>a(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:l,amount:c,functionName:"bid"})]})}),Ct=N.memo(({onClick:e,className:t})=>{var n;const o=et(nt.buy),{box:i}=Re(),[r,a]=s.useState(!1),l=null==i?void 0:i.acceptedToken,c=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);return b.jsx(Le,{controller:o,className:t,onClick:()=>{null==e||e(),a(!0)},children:l&&b.jsx(wt,{open:r,onClose:()=>a(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:l,amount:c,functionName:"buy"})})}),Nt=({options:e,value:t,defaultValue:n,onChange:o,placeholder:i="Please select",className:r,disabled:a=!1,searchable:l=!0,searchPlaceholder:c="Search...",filterFunction:d,onSearch:u,noResultsText:h="No matching results",allowClear:f=!0,maxDisplayOptions:p=10})=>{const[g,m]=s.useState(""),[y,x]=s.useState(""),v=void 0!==t;v||e.find(e=>String(e.value)===y),s.useEffect(()=>{n&&!v&&x(String(n.value))},[n,v]),s.useEffect(()=>{v&&t?x(String(t.value)):v&&!t&&x("")},[t,v]);const w=(e,t)=>{const n=t.toLowerCase().trim();return!n||(e.name.toLowerCase().includes(n)||e.symbol&&e.symbol.toLowerCase().includes(n)||String(e.value).toLowerCase().includes(n))},C=N.useMemo(()=>{if(!l||!g)return e.slice(0,p);const t=d||w;return e.filter(e=>t(e,g)).slice(0,p)},[e,g,l,d,p]),k=e=>b.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.icon&&b.jsx("img",{src:e.icon,alt:"icon",className:"w-5 h-5 rounded-full flex-shrink-0 object-cover"}),b.jsx("span",{className:"truncate font-mono flex-1",children:e.name}),e.symbol&&b.jsx("span",{className:"text-muted-foreground font-mono text-sm flex-shrink-0",children:e.symbol})]}),E=C.map(e=>({label:k(e),value:String(e.value)}));return b.jsx("div",{className:S("w-full",r),children:b.jsx(ye,{value:y||void 0,onChange:t=>(t=>{const n=e.find(e=>String(e.value)===t);v||x(t),null==o||o(n||null)})(t||""),disabled:a||0===E.length,placeholder:i,allowClear:f,onClear:()=>{v||x(""),null==o||o(null),m("")},showSearch:l,onSearch:e=>{m(e),u&&u(e)},filterOption:!1,options:E,notFoundContent:g?h:"No options",className:"w-full",optionLabelProp:"label"})})},kt=({onChange:e})=>{const t=ae(),[n,o]=s.useState(null),i=t.filter(e=>e.canAcceptToken).map(e=>({index:e.index,name:e.name,symbol:e.symbol,value:e.address,decimals:e.decimals}));return s.useEffect(()=>{o(i[0])},[]),b.jsx(Nt,{options:i,value:n,onChange:t=>{e(t),o(t)},placeholder:"Please select a token"})},Et=({onClose:e,listedMode:t,controller:n})=>{const o=Ae(e=>e.updateModalStatus),{roles:i}=Ae(e=>e.userState),{boxId:r,box:a}=Re(),l=R[0].address,c=R[0].decimals,[d,u]=s.useState(""),[h,f]=s.useState(l),[p,g]=s.useState(c);s.useEffect(()=>{o("SellAuction","open")},[]);const m=()=>{o("SellAuction","close"),e()};if(!a)return b.jsx("div",{children:"loading..."});const y=i.includes("Minter");return b.jsx(re,{title:"Sell"===t?"Sell Truth Box":"Auction Truth Box",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:async()=>{if(n.isSuccessed)return void m();if(!a)return;let e=h,t=BigInt(0);if(i.includes("Minter")){if(!h)return void Z.error("Token is required");t=d&&Number(d)>0?ge(String(d),p):BigInt(0)}await n.execute({customArgs:{acceptedToken:e,price:t}})},onCancel:m,okButtonProps:{disabled:n.isLoading},cancelButtonProps:{disabled:n.isLoading},okText:n.isLoading?"Processing...":n.isSuccessed?"Success":"Submit",cancelText:"Close",width:450,children:b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsxs("div",{className:"flex flex-col gap-2 text-foreground",children:[b.jsxs(F,{children:["boxId:",r]}),b.jsxs("div",{className:"flex flex-row gap-2 items-baseline",children:[b.jsx(F,{children:"Current Price:"}),b.jsx(H,{price:a.price,symbol:R[0].symbol,decimals:R[0].decimals})]}),b.jsx("hr",{className:"my-2"}),y?b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsxs("div",{className:"flex flex-col gap-2 items-start",children:[b.jsx(F,{children:"Accpet Token:"}),b.jsx(kt,{onChange:e=>{f(null==e?void 0:e.value),g(null==e?void 0:e.decimals)}})]}),b.jsxs("div",{className:"flex flex-col gap-2 items-baseline",children:[b.jsx(F,{children:"Price:"}),b.jsx(ue,{onChange:e=>(e=>{u(null==e?"":String(e))})(e),value:d?Number(d):void 0,placeholder:"Enter price"})]}),b.jsx(F,{children:"If you don't enter the price, the default price will be used."})]}):b.jsx(F,{children:"Only Minter can set price!"})]}),b.jsx("hr",{className:"my-2"})]})})},Mt=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=et(nt.sell),{roles:r}=Ae(e=>e.userState),{helperRewardRate:a}=k();return b.jsxs(Le,{controller:i,className:t,onClick:()=>{null==e||e(),i.isDisabled||o(!0)},children:[b.jsx("div",{className:"flex flex-col items-start",children:r.includes("Minter")?b.jsx(F,{children:"You can sell or auction the Box at any time."}):b.jsxs(F,{children:["Sell or auction the Box, you can get the Rewards, the Rewards is ",a,"% of the Box price."]})}),n&&b.jsx(Et,{onClose:()=>{o(!1)},listedMode:"Sell",controller:i})]})}),_t=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=et(nt.auction),{initialAuctionPeriod:r}=k();return b.jsxs(Le,{controller:i,className:t,onClick:()=>{null==e||e(),o(!0)},children:[b.jsxs(F,{children:["Start the auction, the initial auction period is ",r/24/3600," days."]}),n&&b.jsx(Et,{onClose:()=>{o(!1)},listedMode:"Auction",controller:i})]})}),jt=N.memo(({onClick:e,className:t})=>{const n=et(nt.requestRefund),{box:o}=Re();return b.jsx(Le,{controller:n,className:t,onClick:e,children:b.jsx("div",{className:S("flex flex-col items-start"),children:b.jsxs(F,{type:"info",children:["Request Refund Deadline: ",me(Number(null==o?void 0:o.requestRefundDeadline))]})})})}),Pt=N.memo(({onClick:e,className:t})=>{var n;const o=et(nt.payConfiFee),{box:i}=Re(),{confidentialityFeeExtensionPeriod:r,incrementRate:a}=k(),[l,c]=s.useState(!1),d=null==i?void 0:i.acceptedToken,u=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);return b.jsxs(Le,{controller:o,className:t,onClick:()=>{null==e||e(),c(!0)},children:[b.jsxs("div",{className:S("flex flex-col items-start"),children:[b.jsxs(F,{children:["Pay the confidentiality fee to extend the confidentiality period: ",r/24/3600," days"]}),b.jsxs(F,{children:["The increment rate: ",a,"%"]})]}),d&&b.jsx(wt,{open:l,onClose:()=>c(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:d,amount:u,functionName:"payConfiFee"})]})}),It=({onClose:e})=>{const{boxId:t,box:n}=Re(),o=Ae(e=>e.updateModalStatus),{writeCustormV2:i,error:r,isLoading:a,isSuccessed:l}=$e(t),c=ie(),[d,u]=s.useState(!1),[h,f]=s.useState("Submit"),[p,g]=s.useState("");if(!n)return b.jsx("div",{children:"loading..."});s.useEffect(()=>{o("ExtendDeadline","open")},[]),s.useEffect(()=>{l?(u(!1),f("Success")):a?(u(!0),f("wait...")):r&&(u(!1),f("Submit"))},[r,a,l]);return b.jsxs(re,{title:"Extend Deadline",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:async()=>{if(p&&Number(p)>0){const e=24*Number(p)*60*60;await i({contract:c.TruthBox,functionName:"extendDeadline",args:[t,e]})}else alert("Empty data!")},onCancel:()=>{o("ExtendDeadline","close"),e()},okButtonProps:{disabled:d},cancelButtonProps:{disabled:d},okText:h,cancelText:"Close",width:450,children:[b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsxs("div",{className:"flex flex-row gap-2 items-baseline",children:[b.jsx(F,{children:"Current boxId:"}),b.jsx(F,{children:t})]}),b.jsx("div",{className:"flex flex-col gap-2",children:b.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[b.jsx(F,{children:"Days:"}),b.jsx("div",{className:"flex flex-row w-full",children:b.jsx(ue,{value:p,suffix:"days",precision:0,min:"1",step:10,placeholder:"Input timestamp",onChange:e=>(e=>{g(e)})(e||"")})})]})})]}),b.jsx("hr",{className:"my-2"})]})},At=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=et(nt.extendDeadline);return b.jsx(Le,{controller:i,className:t,onClick:()=>{null==e||e(),i.isDisabled||o(!0)},children:n&&b.jsx(It,{onClose:()=>{o(!1)}})})}),Dt=({})=>{const{box:e}=Re();return e?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[b.jsx(Mt,{}),b.jsx(_t,{}),b.jsx(At,{}),b.jsx(yt,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},zt=({})=>{Ae(e=>e);const{box:e}=Re();return e?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[!e.buyerId&&Number(e.deadline)<Math.floor(Date.now()/1e3)&&b.jsx("div",{className:"mb-4",children:b.jsx(j,{type:"warning",message:"Warning",description:"No one bought, the transaction is over, please public this Truth Box"})}),b.jsx(Ct,{}),b.jsx(yt,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},Rt=({})=>{const e=Ae(e=>e),{roles:t}=e.userState,{box:n,biddersIds:o}=Re();return n?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[t.includes("Minter")||t.includes("Admin")||t.includes("Seller")||t.includes("Buyer")?b.jsx(j,{type:"warning",message:"Warning",description:"You are not authorized to participate in the bidding."}):b.jsx(b.Fragment,{}),0===(null==o?void 0:o.length)&&Number(n.deadline)<Math.floor(Date.now()/1e3)&&b.jsx("div",{className:"mb-4",children:b.jsx(j,{type:"warning",message:"Warning",description:"No one participated in the auction, the auction is over, please public this Truth Box"})}),b.jsx(St,{}),b.jsx(yt,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},Ot=({})=>{const{box:e}=Re();return e?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[b.jsx(Se,{}),b.jsx(jt,{}),b.jsx(ot,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},Bt=({})=>{const{box:e}=Re();return e?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[b.jsx(it,{}),b.jsx(rt,{}),b.jsx(st,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},Lt=({})=>{const e=Ae(e=>e),{roles:t}=e.userState,{box:n}=Re();return n?b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[t.includes("Buyer")&&b.jsx("div",{className:"mb-4",children:b.jsx(j,{type:"info",message:"Info",description:"Each time the confidentiality period is extended, an additional confidentiality fee must be paid."})}),b.jsx(Pt,{}),b.jsx(yt,{}),b.jsx(mt,{})]}):b.jsx("div",{children:"loading..."})},Tt=({})=>{const{box:e,metadataBox:t}=Re(),{decryptionViewFile:n}=ut();s.useRef(n).current=n;const[o,i]=s.useState([]),[r,a]=s.useState(null),l=(null==t?void 0:t.mintMethod)||"create",c="create"===l;if(s.useEffect(()=>t?"createAndPublish"===t.mintMethod?(i(t.fileList||[]),void a(null)):void 0:(i([]),void a("Metadata not found, cannot show download information.")),[t]),!e)return b.jsx("div",{children:"loading..."});const d=o.length>0;return b.jsxs("div",{className:"flex w-full flex-col items-start justify-center gap-4",children:[b.jsxs(F,{children:["You can use the link to download the file. If the password is empty,",b.jsx("br",{}),"it means that a password is not required."]}),t&&b.jsxs(F,{children:["The current Box uses the ",b.jsx("strong",{className:"text-primary",children:l})," mode to publish,",c?" need to decrypt to get file CID / password.":" metadata directly contains file CID."]}),r&&b.jsx(j,{type:"error",showIcon:!0,message:"Cannot show file information",description:r}),o.length>0?b.jsx(ct,{label:"File CID",type:"cid",cidList:o}):b.jsx(mt,{}),!r&&t&&!d&&b.jsx(F,{children:"Metadata does not contain files to display."})]})};function $t(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,o=0;o<e.length;o++)""!==(n=$t(e[o]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Vt={value:()=>{}};function Ht(){for(var e,t=0,n=arguments.length,o={};t<n;++t){if(!(e=arguments[t]+"")||e in o||/[\s.]/.test(e))throw new Error("illegal type: "+e);o[e]=[]}return new Ft(o)}function Ft(e){this._=e}function Xt(e,t){for(var n,o=0,i=e.length;o<i;++o)if((n=e[o]).name===t)return n.value}function Yt(e,t,n){for(var o=0,i=e.length;o<i;++o)if(e[o].name===t){e[o]=Vt,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=n&&e.push({name:t,value:n}),e}Ft.prototype=Ht.prototype={constructor:Ft,on:function(e,t){var n,o,i=this._,r=(o=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!o.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=r[s]).type)i[n]=Yt(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Yt(i[n],e.name,null);return this}for(;++s<a;)if((n=(e=r[s]).type)&&(n=Xt(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ft(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,o,i=new Array(n),r=0;r<n;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,n=(o=this._[e]).length;r<n;++r)o[r].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)}};var Zt="http://www.w3.org/1999/xhtml";const Kt={svg:"http://www.w3.org/2000/svg",xhtml:Zt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Wt(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Kt.hasOwnProperty(t)?{space:Kt[t],local:e}:e}function qt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Zt&&t.documentElement.namespaceURI===Zt?t.createElement(e):t.createElementNS(n,e)}}function Gt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ut(e){var t=Wt(e);return(t.local?Gt:qt)(t)}function Qt(){}function Jt(e){return null==e?Qt:function(){return this.querySelector(e)}}function en(){return[]}function tn(e){return null==e?en:function(){return this.querySelectorAll(e)}}function nn(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}function on(e){return function(){return this.matches(e)}}function rn(e){return function(t){return t.matches(e)}}var sn=Array.prototype.find;function an(){return this.firstElementChild}var ln=Array.prototype.filter;function cn(){return Array.from(this.children)}function dn(e){return new Array(e.length)}function un(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function hn(e,t,n,o,i,r){for(var s,a=0,l=t.length,c=r.length;a<c;++a)(s=t[a])?(s.__data__=r[a],o[a]=s):n[a]=new un(e,r[a]);for(;a<l;++a)(s=t[a])&&(i[a]=s)}function fn(e,t,n,o,i,r,s){var a,l,c,d=new Map,u=t.length,h=r.length,f=new Array(u);for(a=0;a<u;++a)(l=t[a])&&(f[a]=c=s.call(l,l.__data__,a,t)+"",d.has(c)?i[a]=l:d.set(c,l));for(a=0;a<h;++a)c=s.call(e,r[a],a,r)+"",(l=d.get(c))?(o[a]=l,l.__data__=r[a],d.delete(c)):n[a]=new un(e,r[a]);for(a=0;a<u;++a)(l=t[a])&&d.get(f[a])===l&&(i[a]=l)}function pn(e){return e.__data__}function gn(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function mn(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function yn(e){return function(){this.removeAttribute(e)}}function xn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vn(e,t){return function(){this.setAttribute(e,t)}}function bn(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function wn(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Sn(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Cn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Nn(e){return function(){this.style.removeProperty(e)}}function kn(e,t,n){return function(){this.style.setProperty(e,t,n)}}function En(e,t,n){return function(){var o=t.apply(this,arguments);null==o?this.style.removeProperty(e):this.style.setProperty(e,o,n)}}function Mn(e,t){return e.style.getPropertyValue(t)||Cn(e).getComputedStyle(e,null).getPropertyValue(t)}function _n(e){return function(){delete this[e]}}function jn(e,t){return function(){this[e]=t}}function Pn(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function In(e){return e.trim().split(/^|\s+/)}function An(e){return e.classList||new Dn(e)}function Dn(e){this._node=e,this._names=In(e.getAttribute("class")||"")}function zn(e,t){for(var n=An(e),o=-1,i=t.length;++o<i;)n.add(t[o])}function Rn(e,t){for(var n=An(e),o=-1,i=t.length;++o<i;)n.remove(t[o])}function On(e){return function(){zn(this,e)}}function Bn(e){return function(){Rn(this,e)}}function Ln(e,t){return function(){(t.apply(this,arguments)?zn:Rn)(this,e)}}function Tn(){this.textContent=""}function $n(e){return function(){this.textContent=e}}function Vn(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Hn(){this.innerHTML=""}function Fn(e){return function(){this.innerHTML=e}}function Xn(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Yn(){this.nextSibling&&this.parentNode.appendChild(this)}function Zn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Kn(){return null}function Wn(){var e=this.parentNode;e&&e.removeChild(this)}function qn(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Gn(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Un(e){return function(){var t=this.__on;if(t){for(var n,o=0,i=-1,r=t.length;o<r;++o)n=t[o],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function Qn(e,t,n){return function(){var o,i=this.__on,r=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var s=0,a=i.length;s<a;++s)if((o=i[s]).type===e.type&&o.name===e.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=r,o.options=n),void(o.value=t);this.addEventListener(e.type,r,n),o={type:e.type,name:e.name,value:t,listener:r,options:n},i?i.push(o):this.__on=[o]}}function Jn(e,t,n){var o=Cn(e),i=o.CustomEvent;"function"==typeof i?i=new i(t,n):(i=o.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function eo(e,t){return function(){return Jn(this,e,t)}}function to(e,t){return function(){return Jn(this,e,t.apply(this,arguments))}}un.prototype={constructor:un,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Dn.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var no=[null];function oo(e,t){this._groups=e,this._parents=t}function io(){return new oo([[document.documentElement]],no)}function ro(e){return"string"==typeof e?new oo([[document.querySelector(e)]],[document.documentElement]):new oo([[e]],no)}function so(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,[(o=o.matrixTransform(t.getScreenCTM().inverse())).x,o.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}oo.prototype=io.prototype={constructor:oo,select:function(e){"function"!=typeof e&&(e=Jt(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s,a=t[i],l=a.length,c=o[i]=new Array(l),d=0;d<l;++d)(r=a[d])&&(s=e.call(r,r.__data__,d,a))&&("__data__"in r&&(s.__data__=r.__data__),c[d]=s);return new oo(o,this._parents)},selectAll:function(e){e="function"==typeof e?nn(e):tn(e);for(var t=this._groups,n=t.length,o=[],i=[],r=0;r<n;++r)for(var s,a=t[r],l=a.length,c=0;c<l;++c)(s=a[c])&&(o.push(e.call(s,s.__data__,c,a)),i.push(s));return new oo(o,i)},selectChild:function(e){return this.select(null==e?an:function(e){return function(){return sn.call(this.children,e)}}("function"==typeof e?e:rn(e)))},selectChildren:function(e){return this.selectAll(null==e?cn:function(e){return function(){return ln.call(this.children,e)}}("function"==typeof e?e:rn(e)))},filter:function(e){"function"!=typeof e&&(e=on(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s=t[i],a=s.length,l=o[i]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new oo(o,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,pn);var n,o=t?fn:hn,i=this._parents,r=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var s=r.length,a=new Array(s),l=new Array(s),c=new Array(s),d=0;d<s;++d){var u=i[d],h=r[d],f=h.length,p=gn(e.call(u,u&&u.__data__,d,i)),g=p.length,m=l[d]=new Array(g),y=a[d]=new Array(g);o(u,h,m,y,c[d]=new Array(f),p,t);for(var x,v,b=0,w=0;b<g;++b)if(x=m[b]){for(b>=w&&(w=b+1);!(v=y[w])&&++w<g;);x._next=v||null}}return(a=new oo(a,i))._enter=l,a._exit=c,a},enter:function(){return new oo(this._enter||this._groups.map(dn),this._parents)},exit:function(){return new oo(this._exit||this._groups.map(dn),this._parents)},join:function(e,t,n){var o=this.enter(),i=this,r=this.exit();return"function"==typeof e?(o=e(o))&&(o=o.selection()):o=o.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?r.remove():n(r),o&&i?o.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,o=t._groups,i=n.length,r=o.length,s=Math.min(i,r),a=new Array(i),l=0;l<s;++l)for(var c,d=n[l],u=o[l],h=d.length,f=a[l]=new Array(h),p=0;p<h;++p)(c=d[p]||u[p])&&(f[p]=c);for(;l<i;++l)a[l]=n[l];return new oo(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var o,i=e[t],r=i.length-1,s=i[r];--r>=0;)(o=i[r])&&(s&&4^o.compareDocumentPosition(s)&&s.parentNode.insertBefore(o,s),s=o);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=mn);for(var n=this._groups,o=n.length,i=new Array(o),r=0;r<o;++r){for(var s,a=n[r],l=a.length,c=i[r]=new Array(l),d=0;d<l;++d)(s=a[d])&&(c[d]=s);c.sort(t)}return new oo(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],i=0,r=o.length;i<r;++i){var s=o[i];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,o=t.length;n<o;++n)for(var i,r=t[n],s=0,a=r.length;s<a;++s)(i=r[s])&&e.call(i,i.__data__,s,r);return this},attr:function(e,t){var n=Wt(e);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((null==t?n.local?xn:yn:"function"==typeof t?n.local?Sn:wn:n.local?bn:vn)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Nn:"function"==typeof t?En:kn)(e,t,null==n?"":n)):Mn(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?_n:"function"==typeof t?Pn:jn)(e,t)):this.node()[e]},classed:function(e,t){var n=In(e+"");if(arguments.length<2){for(var o=An(this.node()),i=-1,r=n.length;++i<r;)if(!o.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Ln:t?On:Bn)(n,t))},text:function(e){return arguments.length?this.each(null==e?Tn:("function"==typeof e?Vn:$n)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Hn:("function"==typeof e?Xn:Fn)(e)):this.node().innerHTML},raise:function(){return this.each(Yn)},lower:function(){return this.each(Zn)},append:function(e){var t="function"==typeof e?e:Ut(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:Ut(e),o=null==t?Kn:"function"==typeof t?t:Jt(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})},remove:function(){return this.each(Wn)},clone:function(e){return this.select(e?Gn:qn)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var o,i,r=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=r.length;if(!(arguments.length<2)){for(a=t?Qn:Un,o=0;o<s;++o)this.each(a(r[o],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,d=a.length;c<d;++c)for(o=0,l=a[c];o<s;++o)if((i=r[o]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?to:eo)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o,i=e[t],r=0,s=i.length;r<s;++r)(o=i[r])&&(yield o)}};const ao={passive:!1},lo={capture:!0,passive:!1};function co(e){e.stopImmediatePropagation()}function uo(e){e.preventDefault(),e.stopImmediatePropagation()}function ho(e){var t=e.document.documentElement,n=ro(e).on("dragstart.drag",uo,lo);"onselectstart"in t?n.on("selectstart.drag",uo,lo):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function fo(e,t){var n=e.document.documentElement,o=ro(e).on("dragstart.drag",null);t&&(o.on("click.drag",uo,lo),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const po=e=>()=>e;function go(e,{sourceEvent:t,subject:n,target:o,identifier:i,active:r,x:s,y:a,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}function mo(e){return!e.ctrlKey&&!e.button}function yo(){return this.parentNode}function xo(e,t){return null==t?{x:e.x,y:e.y}:t}function vo(){return navigator.maxTouchPoints||"ontouchstart"in this}function bo(){var e,t,n,o,i=mo,r=yo,s=xo,a=vo,l={},c=Ht("start","drag","end"),d=0,u=0;function h(e){e.on("mousedown.drag",f).filter(a).on("touchstart.drag",m).on("touchmove.drag",y,ao).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(s,a){if(!o&&i.call(this,s,a)){var l=v(this,r.call(this,s,a),s,a,"mouse");l&&(ro(s.view).on("mousemove.drag",p,lo).on("mouseup.drag",g,lo),ho(s.view),co(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function p(o){if(uo(o),!n){var i=o.clientX-e,r=o.clientY-t;n=i*i+r*r>u}l.mouse("drag",o)}function g(e){ro(e.view).on("mousemove.drag mouseup.drag",null),fo(e.view,n),uo(e),l.mouse("end",e)}function m(e,t){if(i.call(this,e,t)){var n,o,s=e.changedTouches,a=r.call(this,e,t),l=s.length;for(n=0;n<l;++n)(o=v(this,a,e,t,s[n].identifier,s[n]))&&(co(e),o("start",e,s[n]))}}function y(e){var t,n,o=e.changedTouches,i=o.length;for(t=0;t<i;++t)(n=l[o[t].identifier])&&(uo(e),n("drag",e,o[t]))}function x(e){var t,n,i=e.changedTouches,r=i.length;for(o&&clearTimeout(o),o=setTimeout(function(){o=null},500),t=0;t<r;++t)(n=l[i[t].identifier])&&(co(e),n("end",e,i[t]))}function v(e,t,n,o,i,r){var a,u,f,p=c.copy(),g=so(r||n,t);if(null!=(f=s.call(e,new go("beforestart",{sourceEvent:n,target:h,identifier:i,active:d,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),o)))return a=f.x-g[0]||0,u=f.y-g[1]||0,function n(r,s,c){var m,y=g;switch(r){case"start":l[i]=n,m=d++;break;case"end":delete l[i],--d;case"drag":g=so(c||s,t),m=d}p.call(r,e,new go(r,{sourceEvent:s,subject:f,target:h,identifier:i,active:m,x:g[0]+a,y:g[1]+u,dx:g[0]-y[0],dy:g[1]-y[1],dispatch:p}),o)}}return h.filter=function(e){return arguments.length?(i="function"==typeof e?e:po(!!e),h):i},h.container=function(e){return arguments.length?(r="function"==typeof e?e:po(e),h):r},h.subject=function(e){return arguments.length?(s="function"==typeof e?e:po(e),h):s},h.touchable=function(e){return arguments.length?(a="function"==typeof e?e:po(!!e),h):a},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(u=(e=+e)*e,h):Math.sqrt(u)},h}function wo(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function So(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function Co(){}go.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var No=.7,ko=1/No,Eo="\\s*([+-]?\\d+)\\s*",Mo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",_o="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jo=/^#([0-9a-f]{3,8})$/,Po=new RegExp(`^rgb\\(${Eo},${Eo},${Eo}\\)$`),Io=new RegExp(`^rgb\\(${_o},${_o},${_o}\\)$`),Ao=new RegExp(`^rgba\\(${Eo},${Eo},${Eo},${Mo}\\)$`),Do=new RegExp(`^rgba\\(${_o},${_o},${_o},${Mo}\\)$`),zo=new RegExp(`^hsl\\(${Mo},${_o},${_o}\\)$`),Ro=new RegExp(`^hsla\\(${Mo},${_o},${_o},${Mo}\\)$`),Oo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Bo(){return this.rgb().formatHex()}function Lo(){return this.rgb().formatRgb()}function To(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=jo.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?$o(t):3===n?new Fo(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Vo(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Vo(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Po.exec(e))?new Fo(t[1],t[2],t[3],1):(t=Io.exec(e))?new Fo(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ao.exec(e))?Vo(t[1],t[2],t[3],t[4]):(t=Do.exec(e))?Vo(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=zo.exec(e))?qo(t[1],t[2]/100,t[3]/100,1):(t=Ro.exec(e))?qo(t[1],t[2]/100,t[3]/100,t[4]):Oo.hasOwnProperty(e)?$o(Oo[e]):"transparent"===e?new Fo(NaN,NaN,NaN,0):null}function $o(e){return new Fo(e>>16&255,e>>8&255,255&e,1)}function Vo(e,t,n,o){return o<=0&&(e=t=n=NaN),new Fo(e,t,n,o)}function Ho(e,t,n,o){return 1===arguments.length?((i=e)instanceof Co||(i=To(i)),i?new Fo((i=i.rgb()).r,i.g,i.b,i.opacity):new Fo):new Fo(e,t,n,null==o?1:o);var i}function Fo(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}function Xo(){return`#${Wo(this.r)}${Wo(this.g)}${Wo(this.b)}`}function Yo(){const e=Zo(this.opacity);return`${1===e?"rgb(":"rgba("}${Ko(this.r)}, ${Ko(this.g)}, ${Ko(this.b)}${1===e?")":`, ${e})`}`}function Zo(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ko(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Wo(e){return((e=Ko(e))<16?"0":"")+e.toString(16)}function qo(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Uo(e,t,n,o)}function Go(e){if(e instanceof Uo)return new Uo(e.h,e.s,e.l,e.opacity);if(e instanceof Co||(e=To(e)),!e)return new Uo;if(e instanceof Uo)return e;var t=(e=e.rgb()).r/255,n=e.g/255,o=e.b/255,i=Math.min(t,n,o),r=Math.max(t,n,o),s=NaN,a=r-i,l=(r+i)/2;return a?(s=t===r?(n-o)/a+6*(n<o):n===r?(o-t)/a+2:(t-n)/a+4,a/=l<.5?r+i:2-r-i,s*=60):a=l>0&&l<1?0:s,new Uo(s,a,l,e.opacity)}function Uo(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}function Qo(e){return(e=(e||0)%360)<0?e+360:e}function Jo(e){return Math.max(0,Math.min(1,e||0))}function ei(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}wo(Co,To,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Bo,formatHex:Bo,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Go(this).formatHsl()},formatRgb:Lo,toString:Lo}),wo(Fo,Ho,So(Co,{brighter(e){return e=null==e?ko:Math.pow(ko,e),new Fo(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?No:Math.pow(No,e),new Fo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Fo(Ko(this.r),Ko(this.g),Ko(this.b),Zo(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xo,formatHex:Xo,formatHex8:function(){return`#${Wo(this.r)}${Wo(this.g)}${Wo(this.b)}${Wo(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Yo,toString:Yo})),wo(Uo,function(e,t,n,o){return 1===arguments.length?Go(e):new Uo(e,t,n,null==o?1:o)},So(Co,{brighter(e){return e=null==e?ko:Math.pow(ko,e),new Uo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?No:Math.pow(No,e),new Uo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,i=2*n-o;return new Fo(ei(e>=240?e-240:e+120,i,o),ei(e,i,o),ei(e<120?e+240:e-120,i,o),this.opacity)},clamp(){return new Uo(Qo(this.h),Jo(this.s),Jo(this.l),Zo(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Zo(this.opacity);return`${1===e?"hsl(":"hsla("}${Qo(this.h)}, ${100*Jo(this.s)}%, ${100*Jo(this.l)}%${1===e?")":`, ${e})`}`}}));const ti=e=>()=>e;function ni(e){return 1===(e=+e)?oi:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}(t,n,e):ti(isNaN(t)?n:t)}}function oi(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):ti(isNaN(e)?t:e)}const ii=function e(t){var n=ni(t);function o(e,t){var o=n((e=Ho(e)).r,(t=Ho(t)).r),i=n(e.g,t.g),r=n(e.b,t.b),s=oi(e.opacity,t.opacity);return function(t){return e.r=o(t),e.g=i(t),e.b=r(t),e.opacity=s(t),e+""}}return o.gamma=e,o}(1);function ri(e,t){t||(t=[]);var n,o=e?Math.min(t.length,e.length):0,i=t.slice();return function(r){for(n=0;n<o;++n)i[n]=e[n]*(1-r)+t[n]*r;return i}}function si(e,t){var n,o=t?t.length:0,i=e?Math.min(o,e.length):0,r=new Array(i),s=new Array(o);for(n=0;n<i;++n)r[n]=fi(e[n],t[n]);for(;n<o;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=r[n](e);return s}}function ai(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function li(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ci(e,t){var n,o={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?o[n]=fi(e[n],t[n]):i[n]=t[n];return function(e){for(n in o)i[n]=o[n](e);return i}}var di=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ui=new RegExp(di.source,"g");function hi(e,t){var n,o,i,r=di.lastIndex=ui.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=di.exec(e))&&(o=ui.exec(t));)(i=o.index)>r&&(i=t.slice(r,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,l.push({i:s,x:li(n,o)})),r=ui.lastIndex;return r<t.length&&(i=t.slice(r),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,o=0;o<t;++o)a[(n=l[o]).i]=n.x(e);return a.join("")})}function fi(e,t){var n,o,i=typeof t;return null==t||"boolean"===i?ti(t):("number"===i?li:"string"===i?(n=To(t))?(t=n,ii):hi:t instanceof To?ii:t instanceof Date?ai:(o=t,!ArrayBuffer.isView(o)||o instanceof DataView?Array.isArray(t)?si:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?ci:li:ri))(e,t)}var pi,gi=180/Math.PI,mi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function yi(e,t,n,o,i,r){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*o)&&(n-=e*l,o-=t*l),(a=Math.sqrt(n*n+o*o))&&(n/=a,o/=a,l/=a),e*o<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:r,rotate:Math.atan2(t,e)*gi,skewX:Math.atan(l)*gi,scaleX:s,scaleY:a}}function xi(e,t,n,o){function i(e){return e.length?e.pop()+" ":""}return function(r,s){var a=[],l=[];return r=e(r),s=e(s),function(e,o,i,r,s,a){if(e!==i||o!==r){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:li(e,i)},{i:l-2,x:li(o,r)})}else(i||r)&&s.push("translate("+i+t+r+n)}(r.translateX,r.translateY,s.translateX,s.translateY,a,l),function(e,t,n,r){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),r.push({i:n.push(i(n)+"rotate(",null,o)-2,x:li(e,t)})):t&&n.push(i(n)+"rotate("+t+o)}(r.rotate,s.rotate,a,l),function(e,t,n,r){e!==t?r.push({i:n.push(i(n)+"skewX(",null,o)-2,x:li(e,t)}):t&&n.push(i(n)+"skewX("+t+o)}(r.skewX,s.skewX,a,l),function(e,t,n,o,r,s){if(e!==n||t!==o){var a=r.push(i(r)+"scale(",null,",",null,")");s.push({i:a-4,x:li(e,n)},{i:a-2,x:li(t,o)})}else 1===n&&1===o||r.push(i(r)+"scale("+n+","+o+")")}(r.scaleX,r.scaleY,s.scaleX,s.scaleY,a,l),r=s=null,function(e){for(var t,n=-1,o=l.length;++n<o;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var vi=xi(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?mi:yi(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),bi=xi(function(e){return null==e?mi:(pi||(pi=document.createElementNS("http://www.w3.org/2000/svg","g")),pi.setAttribute("transform",e),(e=pi.transform.baseVal.consolidate())?yi((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):mi)},", ",")",")");function wi(e){return((e=Math.exp(e))+1/e)/2}const Si=function e(t,n,o){function i(e,i){var r,s,a=e[0],l=e[1],c=e[2],d=i[0],u=i[1],h=i[2],f=d-a,p=u-l,g=f*f+p*p;if(g<1e-12)s=Math.log(h/c)/t,r=function(e){return[a+e*f,l+e*p,c*Math.exp(t*e*s)]};else{var m=Math.sqrt(g),y=(h*h-c*c+o*g)/(2*c*n*m),x=(h*h-c*c-o*g)/(2*h*n*m),v=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(x*x+1)-x);s=(b-v)/t,r=function(e){var o,i=e*s,r=wi(v),d=c/(n*m)*(r*(o=t*i+v,((o=Math.exp(2*o))-1)/(o+1))-function(e){return((e=Math.exp(e))-1/e)/2}(v));return[a+d*f,l+d*p,c*r/wi(t*i+v)]}}return r.duration=1e3*s*t/Math.SQRT2,r}return i.rho=function(t){var n=Math.max(.001,+t),o=n*n;return e(n,o,o*o)},i}(Math.SQRT2,2,4);var Ci,Ni,ki=0,Ei=0,Mi=0,_i=0,ji=0,Pi=0,Ii="object"==typeof performance&&performance.now?performance:Date,Ai="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Di(){return ji||(Ai(zi),ji=Ii.now()+Pi)}function zi(){ji=0}function Ri(){this._call=this._time=this._next=null}function Oi(e,t,n){var o=new Ri;return o.restart(e,t,n),o}function Bi(){ji=(_i=Ii.now())+Pi,ki=Ei=0;try{!function(){Di(),++ki;for(var e,t=Ci;t;)(e=ji-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ki}()}finally{ki=0,function(){var e,t,n=Ci,o=1/0;for(;n;)n._call?(o>n._time&&(o=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Ci=t);Ni=e,Ti(o)}(),ji=0}}function Li(){var e=Ii.now(),t=e-_i;t>1e3&&(Pi-=t,_i=e)}function Ti(e){ki||(Ei&&(Ei=clearTimeout(Ei)),e-ji>24?(e<1/0&&(Ei=setTimeout(Bi,e-Ii.now()-Pi)),Mi&&(Mi=clearInterval(Mi))):(Mi||(_i=Ii.now(),Mi=setInterval(Li,1e3)),ki=1,Ai(Bi)))}function $i(e,t,n){var o=new Ri;return t=null==t?0:+t,o.restart(n=>{o.stop(),e(n+t)},t,n),o}Ri.prototype=Oi.prototype={constructor:Ri,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Di():+n)+(null==t?0:+t),this._next||Ni===this||(Ni?Ni._next=this:Ci=this,Ni=this),this._call=e,this._time=n,Ti()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ti())}};var Vi=Ht("start","end","cancel","interrupt"),Hi=[];function Fi(e,t,n,o,i,r){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var o,i=e.__transition;function r(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(r){var c,d,u,h;if(1!==n.state)return l();for(c in i)if((h=i[c]).name===n.name){if(3===h.state)return $i(s);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[c])}if($i(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(r))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,o=new Array(u=n.tween.length),c=0,d=-1;c<u;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(o[++d]=h);o.length=d+1}}function a(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),r=-1,s=o.length;++r<s;)o[r].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var o in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=Oi(r,0,n.time)}(e,n,{name:t,index:o,group:i,on:Vi,tween:Hi,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function Xi(e,t){var n=Zi(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Yi(e,t){var n=Zi(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Zi(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ki(e,t){var n,o,i,r=e.__transition,s=!0;if(r){for(i in t=null==t?null:t+"",r)(n=r[i]).name===t?(o=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[i]):s=!1;s&&delete e.__transition}}function Wi(e,t){var n,o;return function(){var i=Yi(this,e),r=i.tween;if(r!==n)for(var s=0,a=(o=n=r).length;s<a;++s)if(o[s].name===t){(o=o.slice()).splice(s,1);break}i.tween=o}}function qi(e,t,n){var o,i;if("function"!=typeof n)throw new Error;return function(){var r=Yi(this,e),s=r.tween;if(s!==o){i=(o=s).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}r.tween=i}}function Gi(e,t,n){var o=e._id;return e.each(function(){var e=Yi(this,o);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Zi(e,o).value[t]}}function Ui(e,t){var n;return("number"==typeof t?li:t instanceof To?ii:(n=To(t))?(t=n,ii):hi)(e,t)}function Qi(e){return function(){this.removeAttribute(e)}}function Ji(e){return function(){this.removeAttributeNS(e.space,e.local)}}function er(e,t,n){var o,i,r=n+"";return function(){var s=this.getAttribute(e);return s===r?null:s===o?i:i=t(o=s,n)}}function tr(e,t,n){var o,i,r=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===o?i:i=t(o=s,n)}}function nr(e,t,n){var o,i,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===o&&a===i?r:(i=a,r=t(o=s,l));this.removeAttribute(e)}}function or(e,t,n){var o,i,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===o&&a===i?r:(i=a,r=t(o=s,l));this.removeAttributeNS(e.space,e.local)}}function ir(e,t){var n,o;function i(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function rr(e,t){var n,o;function i(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function sr(e,t){return function(){Xi(this,e).delay=+t.apply(this,arguments)}}function ar(e,t){return t=+t,function(){Xi(this,e).delay=t}}function lr(e,t){return function(){Yi(this,e).duration=+t.apply(this,arguments)}}function cr(e,t){return t=+t,function(){Yi(this,e).duration=t}}var dr=io.prototype.constructor;function ur(e){return function(){this.style.removeProperty(e)}}var hr=0;function fr(e,t,n,o){this._groups=e,this._parents=t,this._name=n,this._id=o}function pr(){return++hr}var gr=io.prototype;fr.prototype={constructor:fr,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=Jt(e));for(var o=this._groups,i=o.length,r=new Array(i),s=0;s<i;++s)for(var a,l,c=o[s],d=c.length,u=r[s]=new Array(d),h=0;h<d;++h)(a=c[h])&&(l=e.call(a,a.__data__,h,c))&&("__data__"in a&&(l.__data__=a.__data__),u[h]=l,Fi(u[h],t,n,h,u,Zi(a,n)));return new fr(r,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=tn(e));for(var o=this._groups,i=o.length,r=[],s=[],a=0;a<i;++a)for(var l,c=o[a],d=c.length,u=0;u<d;++u)if(l=c[u]){for(var h,f=e.call(l,l.__data__,u,c),p=Zi(l,n),g=0,m=f.length;g<m;++g)(h=f[g])&&Fi(h,t,n,g,f,p);r.push(f),s.push(l)}return new fr(r,s,t,n)},selectChild:gr.selectChild,selectChildren:gr.selectChildren,filter:function(e){"function"!=typeof e&&(e=on(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s=t[i],a=s.length,l=o[i]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new fr(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,o=t.length,i=n.length,r=Math.min(o,i),s=new Array(o),a=0;a<r;++a)for(var l,c=t[a],d=n[a],u=c.length,h=s[a]=new Array(u),f=0;f<u;++f)(l=c[f]||d[f])&&(h[f]=l);for(;a<o;++a)s[a]=t[a];return new fr(s,this._parents,this._name,this._id)},selection:function(){return new dr(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=pr(),o=this._groups,i=o.length,r=0;r<i;++r)for(var s,a=o[r],l=a.length,c=0;c<l;++c)if(s=a[c]){var d=Zi(s,t);Fi(s,e,n,c,a,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new fr(o,this._parents,e,n)},call:gr.call,nodes:gr.nodes,node:gr.node,size:gr.size,empty:gr.empty,each:gr.each,on:function(e,t){var n=this._id;return arguments.length<2?Zi(this.node(),n).on.on(e):this.each(function(e,t,n){var o,i,r=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Xi:Yi;return function(){var s=r(this,e),a=s.on;a!==o&&(i=(o=a).copy()).on(t,n),s.on=i}}(n,e,t))},attr:function(e,t){var n=Wt(e),o="transform"===n?bi:Ui;return this.attrTween(e,"function"==typeof t?(n.local?or:nr)(n,o,Gi(this,"attr."+e,t)):null==t?(n.local?Ji:Qi)(n):(n.local?tr:er)(n,o,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var o=Wt(e);return this.tween(n,(o.local?ir:rr)(o,t))},style:function(e,t,n){var o="transform"==(e+="")?vi:Ui;return null==t?this.styleTween(e,function(e,t){var n,o,i;return function(){var r=Mn(this,e),s=(this.style.removeProperty(e),Mn(this,e));return r===s?null:r===n&&s===o?i:i=t(n=r,o=s)}}(e,o)).on("end.style."+e,ur(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var o,i,r;return function(){var s=Mn(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=Mn(this,e)),s===l?null:s===o&&l===i?r:(i=l,r=t(o=s,a))}}(e,o,Gi(this,"style."+e,t))).each(function(e,t){var n,o,i,r,s="style."+t,a="end."+s;return function(){var l=Yi(this,e),c=l.on,d=null==l.value[s]?r||(r=ur(t)):void 0;c===n&&i===d||(o=(n=c).copy()).on(a,i=d),l.on=o}}(this._id,e)):this.styleTween(e,function(e,t,n){var o,i,r=n+"";return function(){var s=Mn(this,e);return s===r?null:s===o?i:i=t(o=s,n)}}(e,o,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==t)return this.tween(o,null);if("function"!=typeof t)throw new Error;return this.tween(o,function(e,t,n){var o,i;function r(){var r=t.apply(this,arguments);return r!==i&&(o=(i=r)&&function(e,t,n){return function(o){this.style.setProperty(e,t.call(this,o),n)}}(e,r,n)),o}return r._value=t,r}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Gi(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function o(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&function(e){return function(t){this.textContent=e.call(this,t)}}(o)),t}return o._value=e,o}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var o,i=Zi(this.node(),n).tween,r=0,s=i.length;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((null==t?Wi:qi)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?sr:ar)(t,e)):Zi(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?lr:cr)(t,e)):Zi(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Yi(this,e).ease=t}}(t,e)):Zi(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Yi(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,o=n._id,i=n.size();return new Promise(function(r,s){var a={value:s},l={value:function(){0===--i&&r()}};n.each(function(){var n=Yi(this,o),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===i&&r()})},[Symbol.iterator]:gr[Symbol.iterator]};var mr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function yr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}io.prototype.interrupt=function(e){return this.each(function(){Ki(this,e)})},io.prototype.transition=function(e){var t,n;e instanceof fr?(t=e._id,e=e._name):(t=pr(),(n=mr).time=Di(),e=null==e?null:e+"");for(var o=this._groups,i=o.length,r=0;r<i;++r)for(var s,a=o[r],l=a.length,c=0;c<l;++c)(s=a[c])&&Fi(s,e,t,c,a,n||yr(s,t));return new fr(o,this._parents,e,t)};const xr=e=>()=>e;function vr(e,{sourceEvent:t,target:n,transform:o,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function br(e,t,n){this.k=e,this.x=t,this.y=n}br.prototype={constructor:br,scale:function(e){return 1===e?this:new br(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new br(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var wr=new br(1,0,0);function Sr(e){for(;!e.__zoom;)if(!(e=e.parentNode))return wr;return e.__zoom}function Cr(e){e.stopImmediatePropagation()}function Nr(e){e.preventDefault(),e.stopImmediatePropagation()}function kr(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Er(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Mr(){return this.__zoom||wr}function _r(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function jr(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pr(e,t,n){var o=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],r=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function Ir(){var e,t,n,o=kr,i=Er,r=Pr,s=_r,a=jr,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],d=250,u=Si,h=Ht("start","zoom","end"),f=0,p=10;function g(e){e.property("__zoom",Mr).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",N).filter(a).on("touchstart.zoom",k).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new br(t,e.x,e.y)}function y(e,t,n){var o=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return o===e.x&&i===e.y?e:new br(e.k,o,i)}function x(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function v(e,t,n,o){e.on("start.zoom",function(){b(this,arguments).event(o).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(o).end()}).tween("zoom",function(){var e=this,r=arguments,s=b(e,r).event(o),a=i.apply(e,r),l=null==n?x(a):"function"==typeof n?n.apply(e,r):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),d=e.__zoom,h="function"==typeof t?t.apply(e,r):t,f=u(d.invert(l).concat(c/d.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=f(e),n=c/t[2];e=new br(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}})}function b(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function S(e,...t){if(o.apply(this,arguments)){var n=b(this,t).event(e),i=this.__zoom,a=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,s.apply(this,arguments)))),d=so(e);if(n.wheel)n.mouse[0][0]===d[0]&&n.mouse[0][1]===d[1]||(n.mouse[1]=i.invert(n.mouse[0]=d)),clearTimeout(n.wheel);else{if(i.k===a)return;n.mouse=[d,i.invert(d)],Ki(this),n.start()}Nr(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",r(y(m(i,a),n.mouse[0],n.mouse[1]),n.extent,c))}}function C(e,...t){if(!n&&o.apply(this,arguments)){var i=e.currentTarget,s=b(this,t,!0).event(e),a=ro(e.view).on("mousemove.zoom",function(e){if(Nr(e),!s.moved){var t=e.clientX-d,n=e.clientY-u;s.moved=t*t+n*n>f}s.event(e).zoom("mouse",r(y(s.that.__zoom,s.mouse[0]=so(e,i),s.mouse[1]),s.extent,c))},!0).on("mouseup.zoom",function(e){a.on("mousemove.zoom mouseup.zoom",null),fo(e.view,s.moved),Nr(e),s.event(e).end()},!0),l=so(e,i),d=e.clientX,u=e.clientY;ho(e.view),Cr(e),s.mouse=[l,this.__zoom.invert(l)],Ki(this),s.start()}}function N(e,...t){if(o.apply(this,arguments)){var n=this.__zoom,s=so(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(s),l=n.k*(e.shiftKey?.5:2),u=r(y(m(n,l),s,a),i.apply(this,t),c);Nr(e),d>0?ro(this).transition().duration(d).call(v,u,s,e):ro(this).call(g.transform,u,s,e)}}function k(n,...i){if(o.apply(this,arguments)){var r,s,a,l,c=n.touches,d=c.length,u=b(this,i,n.changedTouches.length===d).event(n);for(Cr(n),s=0;s<d;++s)l=[l=so(a=c[s],this),this.__zoom.invert(l),a.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,r=!0,u.taps=1+!!e);e&&(e=clearTimeout(e)),r&&(u.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),Ki(this),u.start())}}function E(e,...t){if(this.__zooming){var n,o,i,s,a=b(this,t).event(e),l=e.changedTouches,d=l.length;for(Nr(e),n=0;n<d;++n)i=so(o=l[n],this),a.touch0&&a.touch0[2]===o.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===o.identifier&&(a.touch1[0]=i);if(o=a.that.__zoom,a.touch1){var u=a.touch0[0],h=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-u[0])*g+(g=f[1]-u[1])*g,x=(x=p[0]-h[0])*x+(x=p[1]-h[1])*x;o=m(o,Math.sqrt(g/x)),i=[(u[0]+f[0])/2,(u[1]+f[1])/2],s=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],s=a.touch0[1]}a.zoom("touch",r(y(o,i,s),a.extent,c))}}function M(e,...o){if(this.__zooming){var i,r,s=b(this,o).event(e),a=e.changedTouches,l=a.length;for(Cr(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),i=0;i<l;++i)r=a[i],s.touch0&&s.touch0[2]===r.identifier?delete s.touch0:s.touch1&&s.touch1[2]===r.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(r=so(r,this),Math.hypot(t[0]-r[0],t[1]-r[1])<p)){var c=ro(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(e,t,n,o){var i=e.selection?e.selection():e;i.property("__zoom",Mr),e!==i?v(e,t,n,o):i.interrupt().each(function(){b(this,arguments).event(o).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},g.scaleBy=function(e,t,n,o){g.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,o)},g.scaleTo=function(e,t,n,o){g.transform(e,function(){var e=i.apply(this,arguments),o=this.__zoom,s=null==n?x(e):"function"==typeof n?n.apply(this,arguments):n,a=o.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return r(y(m(o,l),s,a),e,c)},n,o)},g.translateBy=function(e,t,n,o){g.transform(e,function(){return r(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)},null,o)},g.translateTo=function(e,t,n,o,s){g.transform(e,function(){var e=i.apply(this,arguments),s=this.__zoom,a=null==o?x(e):"function"==typeof o?o.apply(this,arguments):o;return r(wr.translate(a[0],a[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)},o,s)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=ro(this.that).datum();h.call(e,this.that,new vr(e,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:h}),t)}},g.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:xr(+e),g):s},g.filter=function(e){return arguments.length?(o="function"==typeof e?e:xr(!!e),g):o},g.touchable=function(e){return arguments.length?(a="function"==typeof e?e:xr(!!e),g):a},g.extent=function(e){return arguments.length?(i="function"==typeof e?e:xr([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):i},g.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],g):[l[0],l[1]]},g.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(e){return arguments.length?(r=e,g):r},g.duration=function(e){return arguments.length?(d=+e,g):d},g.interpolate=function(e){return arguments.length?(u=e,g):u},g.on=function(){var e=h.on.apply(h,arguments);return e===h?g:e},g.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,g):Math.sqrt(f)},g.tapDistance=function(e){return arguments.length?(p=+e,g):p},g}Sr.prototype=br.prototype;const Ar=()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",Dr=e=>`Node type "${e}" not found. Using fallback type "default".`,zr=()=>"The React Flow parent container needs a width and a height to render the graph.",Rr=()=>"Only child nodes can use a parent extent.",Or=e=>`Marker type "${e}" doesn't exist.`,Br=(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${"source"===e?n:o}", edge id: ${t}.`,Lr=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",Tr=e=>`Edge type "${e}" not found. Using fallback type "default".`,$r=e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,Vr=()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs.",Hr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Fr=["Enter"," ","Escape"],Xr={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Yr,Zr,Kr,Wr,qr,Gr;(Zr=Yr||(Yr={})).Strict="strict",Zr.Loose="loose",(Wr=Kr||(Kr={})).Free="free",Wr.Vertical="vertical",Wr.Horizontal="horizontal",(Gr=qr||(qr={})).Partial="partial",Gr.Full="full";const Ur={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Qr,Jr,es,ts,ns,os;(Jr=Qr||(Qr={})).Bezier="default",Jr.Straight="straight",Jr.Step="step",Jr.SmoothStep="smoothstep",Jr.SimpleBezier="simplebezier",(ts=es||(es={})).Arrow="arrow",ts.ArrowClosed="arrowclosed",(os=ns||(ns={})).Left="left",os.Top="top",os.Right="right",os.Bottom="bottom";const is={[ns.Left]:ns.Right,[ns.Right]:ns.Left,[ns.Top]:ns.Bottom,[ns.Bottom]:ns.Top};function rs(e){return null===e?null:e?"valid":"invalid"}const ss=e=>"id"in e&&"source"in e&&"target"in e,as=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),ls=(e,t=[0,0])=>{const{width:n,height:o}=Os(e),i=e.origin??t,r=n*i[0],s=o*i[1];return{x:e.position.x-r,y:e.position.y-s}},cs=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},o=!1;return e.forEach(e=>{(void 0===t.filter||t.filter(e))&&(n=vs(n,Cs(e)),o=!0)}),o?ws(n):{x:0,y:0,width:0,height:0}},ds=(e,t,[n,o,i]=[0,0,1],r=!1,s=!1)=>{const a={...Ps(t,[n,o,i]),width:t.width/i,height:t.height/i},l=[];for(const c of e.values()){const{measured:e,selectable:t=!0,hidden:n=!1}=c;if(s&&!t||n)continue;const o=e.width??c.width??c.initialWidth??null,i=e.height??c.height??c.initialHeight??null,d=ks(a,Ss(c)),u=(o??0)*(i??0),h=r&&d>0;(!c.internals.handleBounds||h||d>=u||c.dragging)&&l.push(c)}return l};async function us({nodes:e,width:t,height:n,panZoom:o,minZoom:i,maxZoom:r},s){if(0===e.size)return Promise.resolve(!0);const a=function(e,t){const n=new Map,o=(null==t?void 0:t.nodes)?new Set(t.nodes.map(e=>e.id)):null;return e.forEach(e=>{!e.measured.width||!e.measured.height||!(null==t?void 0:t.includeHiddenNodes)&&e.hidden||o&&!o.has(e.id)||n.set(e.id,e)}),n}(e,s),l=cs(a),c=Ds(l,t,n,(null==s?void 0:s.minZoom)??i,(null==s?void 0:s.maxZoom)??r,(null==s?void 0:s.padding)??.1);return await o.setViewport(c,{duration:null==s?void 0:s.duration,ease:null==s?void 0:s.ease,interpolate:null==s?void 0:s.interpolate}),Promise.resolve(!0)}function hs({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:i,onError:r}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:l,y:c}=a?a.internals.positionAbsolute:{x:0,y:0},d=s.origin??o;let u=s.extent||i;if("parent"!==s.extent||s.expandParent)a&&Rs(s.extent)&&(u=[[s.extent[0][0]+l,s.extent[0][1]+c],[s.extent[1][0]+l,s.extent[1][1]+c]]);else if(a){const e=a.measured.width,t=a.measured.height;e&&t&&(u=[[l,c],[l+e,c+t]])}else null==r||r("005",Rr());const h=Rs(u)?gs(t,u,s.measured):t;return void 0!==s.measured.width&&void 0!==s.measured.height||null==r||r("015",Vr()),{position:{x:h.x-l+(s.measured.width??0)*d[0],y:h.y-c+(s.measured.height??0)*d[1]},positionAbsolute:h}}async function fs({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:i}){const r=new Set(e.map(e=>e.id)),s=[];for(const h of n){if(!1===h.deletable)continue;const e=r.has(h.id),t=!e&&h.parentId&&s.find(e=>e.id===h.parentId);(e||t)&&s.push(h)}const a=new Set(t.map(e=>e.id)),l=o.filter(e=>!1!==e.deletable),c=((e,t)=>{const n=new Set;return e.forEach(e=>{n.add(e.id)}),t.filter(e=>n.has(e.source)||n.has(e.target))})(s,l),d=c;for(const h of l){a.has(h.id)&&!d.find(e=>e.id===h.id)&&d.push(h)}if(!i)return{edges:d,nodes:s};const u=await i({nodes:s,edges:d});return"boolean"==typeof u?u?{edges:d,nodes:s}:{edges:[],nodes:[]}:u}const ps=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),gs=(e={x:0,y:0},t,n)=>({x:ps(e.x,t[0][0],t[1][0]-((null==n?void 0:n.width)??0)),y:ps(e.y,t[0][1],t[1][1]-((null==n?void 0:n.height)??0))});function ms(e,t,n){const{width:o,height:i}=Os(n),{x:r,y:s}=n.internals.positionAbsolute;return gs(e,[[r,s],[r+o,s+i]],t)}const ys=(e,t,n)=>e<t?ps(Math.abs(e-t),1,t)/t:e>n?-ps(Math.abs(e-n),1,t)/t:0,xs=(e,t,n=15,o=40)=>[ys(e.x,o,t.width-o)*n,ys(e.y,o,t.height-o)*n],vs=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),bs=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),ws=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),Ss=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=as(e)?e.internals.positionAbsolute:ls(e,t);return{x:i,y:r,width:(null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0,height:(null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0}},Cs=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=as(e)?e.internals.positionAbsolute:ls(e,t);return{x:i,y:r,x2:i+((null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0),y2:r+((null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0)}},Ns=(e,t)=>ws(vs(bs(e),bs(t))),ks=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},Es=e=>Ms(e.width)&&Ms(e.height)&&Ms(e.x)&&Ms(e.y),Ms=e=>!isNaN(e)&&isFinite(e),_s=(e,t)=>{},js=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Ps=({x:e,y:t},[n,o,i],r=!1,s=[1,1])=>{const a={x:(e-n)/i,y:(t-o)/i};return r?js(a,s):a},Is=({x:e,y:t},[n,o,i])=>({x:e*i+n,y:t*i+o});function As(e,t){if("number"==typeof e)return Math.floor(.5*(t-t/(1+e)));if("string"==typeof e&&e.endsWith("px")){const t=parseFloat(e);if(!Number.isNaN(t))return Math.floor(t)}if("string"==typeof e&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return 0}const Ds=(e,t,n,o,i,r)=>{const s=function(e,t,n){if("string"==typeof e||"number"==typeof e){const o=As(e,n),i=As(e,t);return{top:o,right:i,bottom:o,left:i,x:2*i,y:2*o}}if("object"==typeof e){const o=As(e.top??e.y??0,n),i=As(e.bottom??e.y??0,n),r=As(e.left??e.x??0,t),s=As(e.right??e.x??0,t);return{top:o,right:s,bottom:i,left:r,x:r+s,y:o+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}(r,t,n),a=(t-s.x)/e.width,l=(n-s.y)/e.height,c=Math.min(a,l),d=ps(c,o,i),u=t/2-(e.x+e.width/2)*d,h=n/2-(e.y+e.height/2)*d,f=function(e,t,n,o,i,r){const{x:s,y:a}=Is(e,[t,n,o]),{x:l,y:c}=Is({x:e.x+e.width,y:e.y+e.height},[t,n,o]),d=i-l,u=r-c;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(d),bottom:Math.floor(u)}}(e,u,h,d,t,n),p=Math.min(f.left-s.left,0),g=Math.min(f.top-s.top,0);return{x:u-p+Math.min(f.right-s.right,0),y:h-g+Math.min(f.bottom-s.bottom,0),zoom:d}},zs=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0};function Rs(e){return null!=e&&"parent"!==e}function Os(e){var t,n;return{width:(null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth??0,height:(null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight??0}}function Bs(e){var t,n;return void 0!==((null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth)&&void 0!==((null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight)}function Ls(e,t={width:0,height:0},n,o,i){const r={...e},s=o.get(n);if(s){const e=s.origin||i;r.x+=s.internals.positionAbsolute.x-(t.width??0)*e[0],r.y+=s.internals.positionAbsolute.y-(t.height??0)*e[1]}return r}function Ts(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function $s(e){return{...Xr,...e||{}}}function Vs(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:i}){const{x:r,y:s}=Ks(e),a=Ps({x:r-((null==i?void 0:i.left)??0),y:s-((null==i?void 0:i.top)??0)},o),{x:l,y:c}=n?js(a,t):a;return{xSnapped:l,ySnapped:c,...a}}const Hs=e=>({width:e.offsetWidth,height:e.offsetHeight}),Fs=e=>{var t;return(null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},Xs=["INPUT","SELECT","TEXTAREA"];function Ys(e){var t,n;const o=(null==(n=null==(t=e.composedPath)?void 0:t.call(e))?void 0:n[0])||e.target;if(1!==(null==o?void 0:o.nodeType))return!1;return Xs.includes(o.nodeName)||o.hasAttribute("contenteditable")||!!o.closest(".nokey")}const Zs=e=>"clientX"in e,Ks=(e,t)=>{var n,o;const i=Zs(e),r=i?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,s=i?e.clientY:null==(o=e.touches)?void 0:o[0].clientY;return{x:r-((null==t?void 0:t.left)??0),y:s-((null==t?void 0:t.top)??0)}},Ws=(e,t,n,o,i)=>{const r=t.querySelectorAll(`.${e}`);return r&&r.length?Array.from(r).map(t=>{const r=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),type:e,nodeId:i,position:t.getAttribute("data-handlepos"),x:(r.left-n.left)/o,y:(r.top-n.top)/o,...Hs(t)}}):null};function qs({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:i,sourceControlY:r,targetControlX:s,targetControlY:a}){const l=.125*e+.375*i+.375*s+.125*n,c=.125*t+.375*r+.375*a+.125*o;return[l,c,Math.abs(l-e),Math.abs(c-t)]}function Gs(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Us({pos:e,x1:t,y1:n,x2:o,y2:i,c:r}){switch(e){case ns.Left:return[t-Gs(t-o,r),n];case ns.Right:return[t+Gs(o-t,r),n];case ns.Top:return[t,n-Gs(n-i,r)];case ns.Bottom:return[t,n+Gs(i-n,r)]}}function Qs({sourceX:e,sourceY:t,sourcePosition:n=ns.Bottom,targetX:o,targetY:i,targetPosition:r=ns.Top,curvature:s=.25}){const[a,l]=Us({pos:n,x1:e,y1:t,x2:o,y2:i,c:s}),[c,d]=Us({pos:r,x1:o,y1:i,x2:e,y2:t,c:s}),[u,h,f,p]=qs({sourceX:e,sourceY:t,targetX:o,targetY:i,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${a},${l} ${c},${d} ${o},${i}`,u,h,f,p]}function Js({sourceX:e,sourceY:t,targetX:n,targetY:o}){const i=Math.abs(n-e)/2,r=n<e?n+i:n-i,s=Math.abs(o-t)/2;return[r,o<t?o+s:o-s,i,s]}function ea({sourceNode:e,targetNode:t,width:n,height:o,transform:i}){const r=vs(Cs(e),Cs(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:o/i[2]};return ks(s,ws(r))>0}const ta=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,na=(e,t)=>{if(!e.source||!e.target)return t;let n;return n=ss(e)?{...e}:{...e,id:ta(e)},((e,t)=>t.some(t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))))(n,t)?t:(null===n.sourceHandle&&delete n.sourceHandle,null===n.targetHandle&&delete n.targetHandle,t.concat(n))};function oa({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[i,r,s,a]=Js({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,i,r,s,a]}const ia={[ns.Left]:{x:-1,y:0},[ns.Right]:{x:1,y:0},[ns.Top]:{x:0,y:-1},[ns.Bottom]:{x:0,y:1}},ra=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function sa({source:e,sourcePosition:t=ns.Bottom,target:n,targetPosition:o=ns.Top,center:i,offset:r,stepPosition:s}){const a=ia[t],l=ia[o],c={x:e.x+a.x*r,y:e.y+a.y*r},d={x:n.x+l.x*r,y:n.y+l.y*r},u=(({source:e,sourcePosition:t=ns.Bottom,target:n})=>t===ns.Left||t===ns.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:c,sourcePosition:t,target:d}),h=0!==u.x?"x":"y",f=u[h];let p,g,m=[];const y={x:0,y:0},x={x:0,y:0},[,,v,b]=Js({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[h]*l[h]===-1){"x"===h?(p=i.x??c.x+(d.x-c.x)*s,g=i.y??(c.y+d.y)/2):(p=i.x??(c.x+d.x)/2,g=i.y??c.y+(d.y-c.y)*s);const e=[{x:p,y:c.y},{x:p,y:d.y}],t=[{x:c.x,y:g},{x:d.x,y:g}];m=a[h]===f?"x"===h?e:t:"x"===h?t:e}else{const i=[{x:c.x,y:d.y}],s=[{x:d.x,y:c.y}];if(m="x"===h?a.x===f?s:i:a.y===f?i:s,t===o){const t=Math.abs(e[h]-n[h]);if(t<=r){const o=Math.min(r-1,r-t);a[h]===f?y[h]=(c[h]>e[h]?-1:1)*o:x[h]=(d[h]>n[h]?-1:1)*o}}if(t!==o){const e="x"===h?"y":"x",t=a[h]===l[e],n=c[e]>d[e],o=c[e]<d[e];(1===a[h]&&(!t&&n||t&&o)||1!==a[h]&&(!t&&o||t&&n))&&(m="x"===h?i:s)}const u={x:c.x+y.x,y:c.y+y.y},v={x:d.x+x.x,y:d.y+x.y};Math.max(Math.abs(u.x-m[0].x),Math.abs(v.x-m[0].x))>=Math.max(Math.abs(u.y-m[0].y),Math.abs(v.y-m[0].y))?(p=(u.x+v.x)/2,g=m[0].y):(p=m[0].x,g=(u.y+v.y)/2)}return[[e,{x:c.x+y.x,y:c.y+y.y},...m,{x:d.x+x.x,y:d.y+x.y},n],p,g,v,b]}function aa({sourceX:e,sourceY:t,sourcePosition:n=ns.Bottom,targetX:o,targetY:i,targetPosition:r=ns.Top,borderRadius:s=5,centerX:a,centerY:l,offset:c=20,stepPosition:d=.5}){const[u,h,f,p,g]=sa({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:i},targetPosition:r,center:{x:a,y:l},offset:c,stepPosition:d});return[u.reduce((e,t,n)=>{let o="";return o=n>0&&n<u.length-1?function(e,t,n,o){const i=Math.min(ra(e,t)/2,ra(t,n)/2,o),{x:r,y:s}=t;if(e.x===r&&r===n.x||e.y===s&&s===n.y)return`L${r} ${s}`;if(e.y===s)return`L ${r+i*(e.x<n.x?-1:1)},${s}Q ${r},${s} ${r},${s+i*(e.y<n.y?1:-1)}`;const a=e.x<n.x?1:-1;return`L ${r},${s+i*(e.y<n.y?-1:1)}Q ${r},${s} ${r+i*a},${s}`}(u[n-1],t,u[n+1],s):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=o},""),h,f,p,g]}function la(e){var t;return e&&!(!e.internals.handleBounds&&!(null==(t=e.handles)?void 0:t.length))&&!!(e.measured.width||e.width||e.initialWidth)}function ca(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,"source"===o.type?t.push(o):"target"===o.type&&n.push(o);return{source:t,target:n}}function da(e,t,n=ns.Left,o=!1){const i=((null==t?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((null==t?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??Os(e);if(o)return{x:i+s/2,y:r+a/2};switch((null==t?void 0:t.position)??n){case ns.Top:return{x:i+s/2,y:r};case ns.Right:return{x:i+s,y:r+a/2};case ns.Bottom:return{x:i+s/2,y:r+a};case ns.Left:return{x:i,y:r+a/2}}}function ua(e,t){return e&&(t?e.find(e=>e.id===t):e[0])||null}function ha(e,t){if(!e)return"";if("string"==typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`}const fa={nodeOrigin:[0,0],nodeExtent:Hr,elevateNodesOnSelect:!0,defaults:{}},pa={...fa,checkEquality:!0};function ga(e,t){const n={...e};for(const o in t)void 0!==t[o]&&(n[o]=t[o]);return n}function ma(e,t){if(!e.handles)return e.measured?null==t?void 0:t.internals.handleBounds:void 0;const n=[],o=[];for(const i of e.handles){const t={id:i.id,width:i.width??1,height:i.height??1,nodeId:e.id,x:i.x,y:i.y,position:i.position,type:i.type};"source"===i.type?n.push(t):"target"===i.type&&o.push(t)}return{source:n,target:o}}function ya(e,t,n,o){var i,r;const s=ga(pa,o);let a={i:-1},l=e.length>0;const c=new Map(t),d=(null==s?void 0:s.elevateNodesOnSelect)?1e3:0;t.clear(),n.clear();for(const u of e){let e=c.get(u.id);if(s.checkEquality&&u===(null==e?void 0:e.internals.userNode))t.set(u.id,e);else{const n=ls(u,s.nodeOrigin),o=Rs(u.extent)?u.extent:s.nodeExtent,a=gs(n,o,Os(u));e={...s.defaults,...u,measured:{width:null==(i=u.measured)?void 0:i.width,height:null==(r=u.measured)?void 0:r.height},internals:{positionAbsolute:a,handleBounds:ma(u,e),z:va(u,d),userNode:u}},t.set(u.id,e)}void 0!==e.measured&&void 0!==e.measured.width&&void 0!==e.measured.height||e.hidden||(l=!1),u.parentId&&xa(e,t,n,o,a)}return l}function xa(e,t,n,o,i){const{elevateNodesOnSelect:r,nodeOrigin:s,nodeExtent:a}=ga(fa,o),l=e.parentId,c=t.get(l);if(!c)return;!function(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}(e,n),i&&!c.parentId&&void 0===c.internals.rootParentIndex&&(c.internals.rootParentIndex=++i.i,c.internals.z=c.internals.z+10*i.i),i&&void 0!==c.internals.rootParentIndex&&(i.i=c.internals.rootParentIndex);const d=r?1e3:0,{x:u,y:h,z:f}=function(e,t,n,o,i){const{x:r,y:s}=t.internals.positionAbsolute,a=Os(e),l=ls(e,n),c=Rs(e.extent)?gs(l,e.extent,a):l;let d=gs({x:r+c.x,y:s+c.y},o,a);"parent"===e.extent&&(d=ms(d,a,t));const u=va(e,i),h=t.internals.z??0;return{x:d.x,y:d.y,z:h>=u?h+1:u}}(e,c,s,a,d),{positionAbsolute:p}=e.internals,g=u!==p.x||h!==p.y;(g||f!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:u,y:h}:p,z:f}})}function va(e,t){return(Ms(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function ba(e,t,n,o=[0,0]){var i;const r=[],s=new Map;for(const a of e){const e=t.get(a.parentId);if(!e)continue;const n=(null==(i=s.get(a.parentId))?void 0:i.expandedRect)??Ss(e),o=Ns(n,a.rect);s.set(a.parentId,{expandedRect:o,parent:e})}return s.size>0&&s.forEach(({expandedRect:t,parent:i},s)=>{var a;const l=i.internals.positionAbsolute,c=Os(i),d=i.origin??o,u=t.x<l.x?Math.round(Math.abs(l.x-t.x)):0,h=t.y<l.y?Math.round(Math.abs(l.y-t.y)):0,f=Math.max(c.width,Math.round(t.width)),p=Math.max(c.height,Math.round(t.height)),g=(f-c.width)*d[0],m=(p-c.height)*d[1];(u>0||h>0||g||m)&&(r.push({id:s,type:"position",position:{x:i.position.x-u+g,y:i.position.y-h+m}}),null==(a=n.get(s))||a.forEach(t=>{e.some(e=>e.id===t.id)||r.push({id:t.id,type:"position",position:{x:t.position.x+u,y:t.position.y+h}})})),(c.width<t.width||c.height<t.height||u||h)&&r.push({id:s,type:"dimensions",setAttributes:!0,dimensions:{width:f+(u?d[0]*u-g:0),height:p+(h?d[1]*h-m:0)}})}),r}function wa(e,t,n,o,i,r){let s=i;const a=o.get(s)||new Map;o.set(s,a.set(n,t)),s=`${i}-${e}`;const l=o.get(s)||new Map;if(o.set(s,l.set(n,t)),r){s=`${i}-${e}-${r}`;const a=o.get(s)||new Map;o.set(s,a.set(n,t))}}function Sa(e,t,n){e.clear(),t.clear();for(const o of n){const{source:n,target:i,sourceHandle:r=null,targetHandle:s=null}=o,a={edgeId:o.id,source:n,target:i,sourceHandle:r,targetHandle:s},l=`${n}-${r}--${i}-${s}`;wa("source",a,`${i}-${s}--${n}-${r}`,e,n,r),wa("target",a,l,e,i,s),t.set(o.id,o)}}function Ca(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return!!n&&(!!n.selected||Ca(n,t))}function Na(e,t,n){var o;let i=e;do{if(null==(o=null==i?void 0:i.matches)?void 0:o.call(i,t))return!0;if(i===n)return!1;i=null==i?void 0:i.parentElement}while(i);return!1}function ka({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var i,r,s;const a=[];for(const[c,d]of t){const e=null==(i=n.get(c))?void 0:i.internals.userNode;e&&a.push({...e,position:d.position,dragging:o})}if(!e)return[a[0],a];const l=null==(r=n.get(e))?void 0:r.internals.userNode;return[l?{...l,position:(null==(s=t.get(e))?void 0:s.position)||l.position,dragging:o}:a[0],a]}function Ea({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:i}){let r={x:null,y:null},s=0,a=new Map,l=!1,c={x:0,y:0},d=null,u=!1,h=null,f=!1,p=!1,g=null;return{update:function({noDragClassName:m,handleSelector:y,domNode:x,isSelectable:v,nodeId:b,nodeClickDistance:w=0}){function S({x:e,y:n}){const{nodeLookup:i,nodeExtent:s,snapGrid:l,snapToGrid:c,nodeOrigin:d,onNodeDrag:u,onSelectionDrag:h,onError:f,updateNodePositions:m}=t();r={x:e,y:n};let y=!1;const x=a.size>1,v=x&&s?bs(cs(a)):null,w=x&&c?function({dragItems:e,snapGrid:t,x:n,y:o}){const i=e.values().next().value;if(!i)return null;const r={x:n-i.distance.x,y:o-i.distance.y},s=js(r,t);return{x:s.x-r.x,y:s.y-r.y}}({dragItems:a,snapGrid:l,x:e,y:n}):null;for(const[t,o]of a){if(!i.has(t))continue;let r={x:e-o.distance.x,y:n-o.distance.y};c&&(r=w?{x:Math.round(r.x+w.x),y:Math.round(r.y+w.y)}:js(r,l));let a=null;if(x&&s&&!o.extent&&v){const{positionAbsolute:e}=o.internals,t=e.x-v.x+s[0][0],n=e.x+o.measured.width-v.x2+s[1][0];a=[[t,e.y-v.y+s[0][1]],[n,e.y+o.measured.height-v.y2+s[1][1]]]}const{position:u,positionAbsolute:h}=hs({nodeId:t,nextPosition:r,nodeLookup:i,nodeExtent:a||s,nodeOrigin:d,onError:f});y=y||o.position.x!==u.x||o.position.y!==u.y,o.position=u,o.internals.positionAbsolute=h}if(p=p||y,y&&(m(a,!0),g&&(o||u||!b&&h))){const[e,t]=ka({nodeId:b,dragItems:a,nodeLookup:i});null==o||o(g,a,e,t),null==u||u(g,e,t),b||null==h||h(g,t)}}async function C(){if(!d)return;const{transform:e,panBy:n,autoPanSpeed:o,autoPanOnNodeDrag:i}=t();if(!i)return l=!1,void cancelAnimationFrame(s);const[a,u]=xs(c,d,o);0===a&&0===u||(r.x=(r.x??0)-a/e[2],r.y=(r.y??0)-u/e[2],await n({x:a,y:u})&&S(r)),s=requestAnimationFrame(C)}function N(o){var i;const{nodeLookup:s,multiSelectionActive:l,nodesDraggable:c,transform:h,snapGrid:f,snapToGrid:p,selectNodesOnDrag:g,onNodeDragStart:m,onSelectionDragStart:y,unselectNodesAndEdges:x}=t();u=!0,g&&v||l||!b||(null==(i=s.get(b))?void 0:i.selected)||x(),v&&g&&b&&(null==e||e(b));const w=Vs(o.sourceEvent,{transform:h,snapGrid:f,snapToGrid:p,containerBounds:d});if(r=w,a=function(e,t,n,o){const i=new Map;for(const[r,s]of e)if((s.selected||s.id===o)&&(!s.parentId||!Ca(s,e))&&(s.draggable||t&&void 0===s.draggable)){const t=e.get(r);t&&i.set(r,{id:r,position:t.position||{x:0,y:0},distance:{x:n.x-t.internals.positionAbsolute.x,y:n.y-t.internals.positionAbsolute.y},extent:t.extent,parentId:t.parentId,origin:t.origin,expandParent:t.expandParent,internals:{positionAbsolute:t.internals.positionAbsolute||{x:0,y:0}},measured:{width:t.measured.width??0,height:t.measured.height??0}})}return i}(s,c,w,b),a.size>0&&(n||m||!b&&y)){const[e,t]=ka({nodeId:b,dragItems:a,nodeLookup:s});null==n||n(o.sourceEvent,a,e,t),null==m||m(o.sourceEvent,e,t),b||null==y||y(o.sourceEvent,t)}}h=ro(x);const k=bo().clickDistance(w).on("start",e=>{const{domNode:n,nodeDragThreshold:o,transform:i,snapGrid:s,snapToGrid:a}=t();d=(null==n?void 0:n.getBoundingClientRect())||null,f=!1,p=!1,g=e.sourceEvent,0===o&&N(e);const l=Vs(e.sourceEvent,{transform:i,snapGrid:s,snapToGrid:a,containerBounds:d});r=l,c=Ks(e.sourceEvent,d)}).on("drag",e=>{const{autoPanOnNodeDrag:n,transform:o,snapGrid:i,snapToGrid:s,nodeDragThreshold:h,nodeLookup:p}=t(),m=Vs(e.sourceEvent,{transform:o,snapGrid:i,snapToGrid:s,containerBounds:d});if(g=e.sourceEvent,("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1||b&&!p.has(b))&&(f=!0),!f){if(!l&&n&&u&&(l=!0,C()),!u){const t=Ks(e.sourceEvent,d),n=t.x-c.x,o=t.y-c.y;Math.sqrt(n*n+o*o)>h&&N(e)}(r.x!==m.xSnapped||r.y!==m.ySnapped)&&a&&u&&(c=Ks(e.sourceEvent,d),S(m))}}).on("end",e=>{if(u&&!f&&(l=!1,u=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:n,updateNodePositions:o,onNodeDragStop:r,onSelectionDragStop:s}=t();if(p&&(o(a,!1),p=!1),i||r||!b&&s){const[t,o]=ka({nodeId:b,dragItems:a,nodeLookup:n,dragging:!1});null==i||i(e.sourceEvent,a,t,o),null==r||r(e.sourceEvent,t,o),b||null==s||s(e.sourceEvent,o)}}}).filter(e=>{const t=e.target;return!e.button&&(!m||!Na(t,`.${m}`,x))&&(!y||Na(t,y,x))});h.call(k)},destroy:function(){null==h||h.on(".drag",null)}}}function Ma(e,t,n,o){var i,r;let s=[],a=1/0;const l=function(e,t,n){const o=[],i={x:e.x-n,y:e.y-n,width:2*n,height:2*n};for(const r of t.values())ks(i,Ss(r))>0&&o.push(r);return o}(e,n,t+250);for(const c of l){const n=[...(null==(i=c.internals.handleBounds)?void 0:i.source)??[],...(null==(r=c.internals.handleBounds)?void 0:r.target)??[]];for(const i of n){if(o.nodeId===i.nodeId&&o.type===i.type&&o.id===i.id)continue;const{x:n,y:r}=da(c,i,i.position,!0),l=Math.sqrt(Math.pow(n-e.x,2)+Math.pow(r-e.y,2));l>t||(l<a?(s=[{...i,x:n,y:r}],a=l):l===a&&s.push({...i,x:n,y:r}))}}if(!s.length)return null;if(s.length>1){const e="source"===o.type?"target":"source";return s.find(t=>t.type===e)??s[0]}return s[0]}function _a(e,t,n,o,i,r=!1){var s,a,l;const c=o.get(e);if(!c)return null;const d="strict"===i?null==(s=c.internals.handleBounds)?void 0:s[t]:[...(null==(a=c.internals.handleBounds)?void 0:a.source)??[],...(null==(l=c.internals.handleBounds)?void 0:l.target)??[]],u=(n?null==d?void 0:d.find(e=>e.id===n):null==d?void 0:d[0])??null;return u&&r?{...u,...da(c,u,u.position,!0)}:u}function ja(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}const Pa=()=>!0;function Ia(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:i,fromType:r,doc:s,lib:a,flowId:l,isValidConnection:c=Pa,nodeLookup:d}){const u="target"===r,h=t?s.querySelector(`.${a}-flow__handle[data-id="${l}-${null==t?void 0:t.nodeId}-${null==t?void 0:t.id}-${null==t?void 0:t.type}"]`):null,{x:f,y:p}=Ks(e),g=s.elementFromPoint(f,p),m=(null==g?void 0:g.classList.contains(`${a}-flow__handle`))?g:h,y={handleDomNode:m,isValid:!1,connection:null,toHandle:null};if(m){const e=ja(void 0,m),t=m.getAttribute("data-nodeid"),r=m.getAttribute("data-handleid"),s=m.classList.contains("connectable"),a=m.classList.contains("connectableend");if(!t||!e)return y;const l={source:u?t:o,sourceHandle:u?r:i,target:u?o:t,targetHandle:u?i:r};y.connection=l;const h=s&&a&&(n===Yr.Strict?u&&"source"===e||!u&&"target"===e:t!==o||r!==i);y.isValid=h&&c(l),y.toHandle=_a(t,e,r,d,n,!0)}return y}const Aa={onPointerDown:function(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:i,edgeUpdaterType:r,isTarget:s,domNode:a,nodeLookup:l,lib:c,autoPanOnConnect:d,flowId:u,panBy:h,cancelConnection:f,onConnectStart:p,onConnect:g,onConnectEnd:m,isValidConnection:y=Pa,onReconnectEnd:x,updateConnection:v,getTransform:b,getFromHandle:w,autoPanSpeed:S,dragThreshold:C=1,handleDomNode:N}){const k=Fs(e.target);let E,M=0;const{x:_,y:j}=Ks(e),P=ja(r,N),I=null==a?void 0:a.getBoundingClientRect();let A=!1;if(!I||!P)return;const D=_a(i,P,o,l,t);if(!D)return;let z=Ks(e,I),R=!1,O=null,B=!1,L=null;function T(){if(!d||!I)return;const[e,t]=xs(z,I,S);h({x:e,y:t}),M=requestAnimationFrame(T)}const $={...D,nodeId:i,type:P,position:D.position},V=l.get(i);let H={inProgress:!0,isValid:null,from:da(V,$,ns.Left,!0),fromHandle:$,fromPosition:$.position,fromNode:V,to:z,toHandle:null,toPosition:is[$.position],toNode:null};function F(){A=!0,v(H),null==p||p(e,{nodeId:i,handleId:o,handleType:P})}function X(e){if(!A){const{x:t,y:n}=Ks(e),o=t-_,i=n-j;if(!(o*o+i*i>C*C))return;F()}if(!w()||!$)return void Y(e);const r=b();z=Ks(e,I),E=Ma(Ps(z,r,!1,[1,1]),n,l,$),R||(T(),R=!0);const a=Ia(e,{handle:E,connectionMode:t,fromNodeId:i,fromHandleId:o,fromType:s?"target":"source",isValidConnection:y,doc:k,lib:c,flowId:u,nodeLookup:l});L=a.handleDomNode,O=a.connection,B=function(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}(!!E,a.isValid);const d={...H,isValid:B,to:a.toHandle&&B?Is({x:a.toHandle.x,y:a.toHandle.y},r):z,toHandle:a.toHandle,toPosition:B&&a.toHandle?a.toHandle.position:is[$.position],toNode:a.toHandle?l.get(a.toHandle.nodeId):null};B&&E&&H.toHandle&&d.toHandle&&H.toHandle.type===d.toHandle.type&&H.toHandle.nodeId===d.toHandle.nodeId&&H.toHandle.id===d.toHandle.id&&H.to.x===d.to.x&&H.to.y===d.to.y||(v(d),H=d)}function Y(e){if(!("touches"in e&&e.touches.length>0)){if(A){(E||L)&&O&&B&&(null==g||g(O));const{inProgress:t,...n}=H,o={...n,toPosition:H.toHandle?H.toPosition:null};null==m||m(e,o),r&&(null==x||x(e,o))}f(),cancelAnimationFrame(M),R=!1,B=!1,O=null,L=null,k.removeEventListener("mousemove",X),k.removeEventListener("mouseup",Y),k.removeEventListener("touchmove",X),k.removeEventListener("touchend",Y)}}0===C&&F(),k.addEventListener("mousemove",X),k.addEventListener("mouseup",Y),k.addEventListener("touchmove",X),k.addEventListener("touchend",Y)},isValid:Ia};const Da=e=>({x:e.x,y:e.y,zoom:e.k}),za=({x:e,y:t,zoom:n})=>wr.translate(e,t).scale(n),Ra=(e,t)=>e.target.closest(`.${t}`),Oa=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),Ba=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,La=(e,t=0,n=Ba,o=()=>{})=>{const i="number"==typeof t&&t>0;return i||o(),i?e.transition().duration(t).ease(n).on("end",o):e},Ta=e=>{const t=e.ctrlKey&&zs()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t};function $a({domNode:e,minZoom:t,maxZoom:n,translateExtent:o,viewport:i,onPanZoom:r,onPanZoomStart:s,onPanZoomEnd:a,onDraggingChange:l}){const c={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),u=Ir().scaleExtent([t,n]).translateExtent(o),h=ro(e).call(u);y({x:i.x,y:i.y,zoom:ps(i.zoom,t,n)},[[0,0],[d.width,d.height]],o);const f=h.on("wheel.zoom"),p=h.on("dblclick.zoom");function g(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?fi:Si).transform(La(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)}function m(){u.on("zoom",null)}async function y(e,t,n){const o=za(e),i=null==u?void 0:u.constrain()(o,t,n);return i&&await g(i),new Promise(e=>e(i))}return u.wheelDelta(Ta),{update:function({noWheelClassName:e,noPanClassName:t,onPaneContextMenu:n,userSelectionActive:o,panOnScroll:i,panOnDrag:d,panOnScrollMode:g,panOnScrollSpeed:y,preventScrolling:x,zoomOnPinch:v,zoomOnScroll:b,zoomOnDoubleClick:w,zoomActivationKeyPressed:S,lib:C,onTransformChange:N,connectionInProgress:k,paneClickDistance:E,selectionOnDrag:M}){o&&!c.isZoomingOrPanning&&m();const _=i&&!S&&!o;u.clickDistance(M?1/0:!Ms(E)||E<0?0:E);const j=_?function({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:i,panOnScrollSpeed:r,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:c}){return d=>{if(Ra(d,t))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const u=n.property("__zoom").k||1;if(d.ctrlKey&&s){const e=so(d),t=Ta(d),i=u*Math.pow(2,t);return void o.scaleTo(n,i,e,d)}const h=1===d.deltaMode?20:1;let f=i===Kr.Vertical?0:d.deltaX*h,p=i===Kr.Horizontal?0:d.deltaY*h;!zs()&&d.shiftKey&&i!==Kr.Vertical&&(f=d.deltaY*h,p=0),o.translateBy(n,-f/u*r,-p/u*r,{internal:!0});const g=Da(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(null==l||l(d,g),e.panScrollTimeout=setTimeout(()=>{null==c||c(d,g),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,null==a||a(d,g))}}({zoomPanValues:c,noWheelClassName:e,d3Selection:h,d3Zoom:u,panOnScrollMode:g,panOnScrollSpeed:y,zoomOnPinch:v,onPanZoomStart:s,onPanZoom:r,onPanZoomEnd:a}):function({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,i){const r="wheel"===o.type,s=!t&&r&&!o.ctrlKey,a=Ra(o,e);if(o.ctrlKey&&r&&a&&o.preventDefault(),s||a)return null;o.preventDefault(),n.call(this,o,i)}}({noWheelClassName:e,preventScrolling:x,d3ZoomHandler:f});if(h.on("wheel.zoom",j,{passive:!1}),!o){const e=function({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var i,r,s;if(null==(i=o.sourceEvent)?void 0:i.internal)return;const a=Da(o.transform);e.mouseButton=(null==(r=o.sourceEvent)?void 0:r.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=a,"mousedown"===(null==(s=o.sourceEvent)?void 0:s.type)&&t(!0),n&&(null==n||n(o.sourceEvent,a))}}({zoomPanValues:c,onDraggingChange:l,onPanZoomStart:s});u.on("start",e);const t=function({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:i}){return r=>{var s,a;e.usedRightMouseButton=!(!n||!Oa(t,e.mouseButton??0)),(null==(s=r.sourceEvent)?void 0:s.sync)||o([r.transform.x,r.transform.y,r.transform.k]),i&&!(null==(a=r.sourceEvent)?void 0:a.internal)&&(null==i||i(r.sourceEvent,Da(r.transform)))}}({zoomPanValues:c,panOnDrag:d,onPaneContextMenu:!!n,onPanZoom:r,onTransformChange:N});u.on("zoom",t);const o=function({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:i,onPaneContextMenu:r}){return s=>{var a;if(!(null==(a=s.sourceEvent)?void 0:a.internal)&&(e.isZoomingOrPanning=!1,r&&Oa(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&r(s.sourceEvent),e.usedRightMouseButton=!1,o(!1),i)){const t=Da(s.transform);e.prevViewport=t,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{null==i||i(s.sourceEvent,t)},n?150:0)}}}({zoomPanValues:c,panOnDrag:d,panOnScroll:i,onPaneContextMenu:n,onPanZoomEnd:a,onDraggingChange:l});u.on("end",o)}const P=function({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:i,zoomOnDoubleClick:r,userSelectionActive:s,noWheelClassName:a,noPanClassName:l,lib:c,connectionInProgress:d}){return u=>{var h;const f=e||t,p=n&&u.ctrlKey,g="wheel"===u.type;if(1===u.button&&"mousedown"===u.type&&(Ra(u,`${c}-flow__node`)||Ra(u,`${c}-flow__edge`)))return!0;if(!(o||f||i||r||n))return!1;if(s)return!1;if(d&&!g)return!1;if(Ra(u,a)&&g)return!1;if(Ra(u,l)&&(!g||i&&g&&!e))return!1;if(!n&&u.ctrlKey&&g)return!1;if(!n&&"touchstart"===u.type&&(null==(h=u.touches)?void 0:h.length)>1)return u.preventDefault(),!1;if(!f&&!i&&!p&&g)return!1;if(!o&&("mousedown"===u.type||"touchstart"===u.type))return!1;if(Array.isArray(o)&&!o.includes(u.button)&&"mousedown"===u.type)return!1;const m=Array.isArray(o)&&o.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||g)&&m}}({zoomActivationKeyPressed:S,panOnDrag:d,zoomOnScroll:b,panOnScroll:i,zoomOnDoubleClick:w,zoomOnPinch:v,userSelectionActive:o,noPanClassName:t,noWheelClassName:e,lib:C,connectionInProgress:k});u.filter(P),w?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)},destroy:m,setViewport:async function(e,t){const n=za(e);return await g(n,t),new Promise(e=>e(n))},setViewportConstrained:y,getViewport:function(){const e=h?Sr(h.node()):{x:0,y:0,k:1};return{x:e.x,y:e.y,zoom:e.k}},scaleTo:function(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?fi:Si).scaleTo(La(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},scaleBy:function(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?fi:Si).scaleBy(La(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},setScaleExtent:function(e){null==u||u.scaleExtent(e)},setTranslateExtent:function(e){null==u||u.translateExtent(e)},syncViewport:function(e){if(h){const t=za(e),n=h.property("__zoom");n.k===e.zoom&&n.x===e.x&&n.y===e.y||null==u||u.transform(h,t,null,{sync:!0})}},setClickDistance:function(e){const t=!Ms(e)||e<0?0:e;null==u||u.clickDistance(t)}}}var Va,Ha;function Fa(e){return{isHorizontal:e.includes("right")||e.includes("left"),isVertical:e.includes("bottom")||e.includes("top"),affectsX:e.includes("left"),affectsY:e.includes("top")}}function Xa(e,t){return Math.max(0,t-e)}function Ya(e,t){return Math.max(0,e-t)}function Za(e,t,n){return Math.max(0,t-e,e-n)}function Ka(e,t){return e?!t:t}(Ha=Va||(Va={})).Line="line",Ha.Handle="handle";const Wa={width:0,height:0,x:0,y:0},qa={...Wa,pointerX:0,pointerY:0,aspectRatio:1};function Ga(e,t,n){const o=t.position.x+e.position.x,i=t.position.y+e.position.y,r=e.measured.width??0,s=e.measured.height??0,a=n[0]*r,l=n[1]*s;return[[o-a,i-l],[o+r-a,i+s-l]]}function Ua({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:i}){const r=ro(e);let s={controlDirection:Fa("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};return{update:function({controlPosition:e,boundaries:a,keepAspectRatio:l,resizeDirection:c,onResizeStart:d,onResize:u,onResizeEnd:h,shouldResize:f}){let p,g={...Wa},m={...qa};s={boundaries:a,resizeDirection:c,keepAspectRatio:l,controlDirection:Fa(e)};let y,x,v,b=null,w=[],S=!1;const C=bo().on("start",e=>{const{nodeLookup:o,transform:i,snapGrid:r,snapToGrid:s,nodeOrigin:a,paneDomNode:l}=n();if(p=o.get(t),!p)return;b=(null==l?void 0:l.getBoundingClientRect())??null;const{xSnapped:c,ySnapped:u}=Vs(e.sourceEvent,{transform:i,snapGrid:r,snapToGrid:s,containerBounds:b});g={width:p.measured.width??0,height:p.measured.height??0,x:p.position.x??0,y:p.position.y??0},m={...g,pointerX:c,pointerY:u,aspectRatio:g.width/g.height},y=void 0,p.parentId&&("parent"===p.extent||p.expandParent)&&(y=o.get(p.parentId),x=y&&"parent"===p.extent?function(e){return[[0,0],[e.measured.width,e.measured.height]]}(y):void 0),w=[],v=void 0;for(const[n,d]of o)if(d.parentId===t&&(w.push({id:n,position:{...d.position},extent:d.extent}),"parent"===d.extent||d.expandParent)){const e=Ga(d,p,d.origin??a);v=v?[[Math.min(e[0][0],v[0][0]),Math.min(e[0][1],v[0][1])],[Math.max(e[1][0],v[1][0]),Math.max(e[1][1],v[1][1])]]:e}null==d||d(e,{...g})}).on("drag",e=>{const{transform:t,snapGrid:i,snapToGrid:r,nodeOrigin:a}=n(),l=Vs(e.sourceEvent,{transform:t,snapGrid:i,snapToGrid:r,containerBounds:b}),c=[];if(!p)return;const{x:d,y:h,width:C,height:N}=g,k={},E=p.origin??a,{width:M,height:_,x:j,y:P}=function(e,t,n,o,i,r,s,a){let{affectsX:l,affectsY:c}=t;const{isHorizontal:d,isVertical:u}=t,h=d&&u,{xSnapped:f,ySnapped:p}=n,{minWidth:g,maxWidth:m,minHeight:y,maxHeight:x}=o,{x:v,y:b,width:w,height:S,aspectRatio:C}=e;let N=Math.floor(d?f-e.pointerX:0),k=Math.floor(u?p-e.pointerY:0);const E=w+(l?-N:N),M=S+(c?-k:k),_=-r[0]*w,j=-r[1]*S;let P=Za(E,g,m),I=Za(M,y,x);if(s){let e=0,t=0;l&&N<0?e=Xa(v+N+_,s[0][0]):!l&&N>0&&(e=Ya(v+E+_,s[1][0])),c&&k<0?t=Xa(b+k+j,s[0][1]):!c&&k>0&&(t=Ya(b+M+j,s[1][1])),P=Math.max(P,e),I=Math.max(I,t)}if(a){let e=0,t=0;l&&N>0?e=Ya(v+N,a[0][0]):!l&&N<0&&(e=Xa(v+E,a[1][0])),c&&k>0?t=Ya(b+k,a[0][1]):!c&&k<0&&(t=Xa(b+M,a[1][1])),P=Math.max(P,e),I=Math.max(I,t)}if(i){if(d){const e=Za(E/C,y,x)*C;if(P=Math.max(P,e),s){let e=0;e=!l&&!c||l&&!c&&h?Ya(b+j+E/C,s[1][1])*C:Xa(b+j+(l?N:-N)/C,s[0][1])*C,P=Math.max(P,e)}if(a){let e=0;e=!l&&!c||l&&!c&&h?Xa(b+E/C,a[1][1])*C:Ya(b+(l?N:-N)/C,a[0][1])*C,P=Math.max(P,e)}}if(u){const e=Za(M*C,g,m)/C;if(I=Math.max(I,e),s){let e=0;e=!l&&!c||c&&!l&&h?Ya(v+M*C+_,s[1][0])/C:Xa(v+(c?k:-k)*C+_,s[0][0])/C,I=Math.max(I,e)}if(a){let e=0;e=!l&&!c||c&&!l&&h?Xa(v+M*C,a[1][0])/C:Ya(v+(c?k:-k)*C,a[0][0])/C,I=Math.max(I,e)}}}k+=k<0?I:-I,N+=N<0?P:-P,i&&(h?E>M*C?k=(Ka(l,c)?-N:N)/C:N=(Ka(l,c)?-k:k)*C:d?(k=N/C,c=l):(N=k*C,l=c));const A=l?v+N:v,D=c?b+k:b;return{width:w+(l?-N:N),height:S+(c?-k:k),x:r[0]*N*(l?-1:1)+A,y:r[1]*k*(c?-1:1)+D}}(m,s.controlDirection,l,s.boundaries,s.keepAspectRatio,E,x,v),I=M!==C,A=_!==N,D=j!==d&&I,z=P!==h&&A;if(!(D||z||I||A))return;if((D||z||1===E[0]||1===E[1])&&(k.x=D?j:g.x,k.y=z?P:g.y,g.x=k.x,g.y=k.y,w.length>0)){const e=j-d,t=P-h;for(const n of w)n.position={x:n.position.x-e+E[0]*(M-C),y:n.position.y-t+E[1]*(_-N)},c.push(n)}if((I||A)&&(k.width=!I||s.resizeDirection&&"horizontal"!==s.resizeDirection?g.width:M,k.height=!A||s.resizeDirection&&"vertical"!==s.resizeDirection?g.height:_,g.width=k.width,g.height=k.height),y&&p.expandParent){const e=E[0]*(k.width??0);k.x&&k.x<e&&(g.x=e,m.x=m.x-(k.x-e));const t=E[1]*(k.height??0);k.y&&k.y<t&&(g.y=t,m.y=m.y-(k.y-t))}const R=function({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:i,affectsY:r}){const s=e-t,a=n-o,l=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(l[0]=-1*l[0]),a&&r&&(l[1]=-1*l[1]),l}({width:g.width,prevWidth:C,height:g.height,prevHeight:N,affectsX:s.controlDirection.affectsX,affectsY:s.controlDirection.affectsY}),O={...g,direction:R};!1!==(null==f?void 0:f(e,O))&&(S=!0,null==u||u(e,O),o(k,c))}).on("end",e=>{S&&(null==h||h(e,{...g}),null==i||i({...g}),S=!1)});r.call(C)},destroy:function(){r.on(".drag",null)}}}var Qa,Ja,el,tl,nl={exports:{}},ol={},il={exports:{}},rl={};function sl(){return Ja||(Ja=1,il.exports=function(){if(Qa)return rl;Qa=1;var e=O(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,o=e.useEffect,i=e.useLayoutEffect,r=e.useDebugValue;function s(e){var n=e.getSnapshot;e=e.value;try{var o=n();return!t(e,o)}catch(i){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),l=n({inst:{value:a,getSnapshot:t}}),c=l[0].inst,d=l[1];return i(function(){c.value=a,c.getSnapshot=t,s(c)&&d({inst:c})},[e,a,t]),o(function(){return s(c)&&d({inst:c}),e(function(){s(c)&&d({inst:c})})},[e]),r(a),a};return rl.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:a,rl}()),il.exports}
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */const al=B((tl||(tl=1,nl.exports=function(){if(el)return ol;el=1;var e=O(),t=sl(),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=t.useSyncExternalStore,i=e.useRef,r=e.useEffect,s=e.useMemo,a=e.useDebugValue;return ol.useSyncExternalStoreWithSelector=function(e,t,l,c,d){var u=i(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;u=s(function(){function e(e){if(!r){if(r=!0,o=e,e=c(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return i=t}return i=e}if(t=i,n(o,e))return t;var s=c(e);return void 0!==d&&d(t,s)?(o=e,t):(o=e,i=s)}var o,i,r=!1,s=void 0===l?null:l;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]},[t,l,c,d]);var f=o(e,u[0],u[1]);return r(function(){h.hasValue=!0,h.value=f},[f]),a(f),f},ol}()),nl.exports)),ll=e=>{let t;const n=new Set,o=(e,o)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=o?o:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,r={setState:o,getState:i,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{n.clear()}},s=t=e(o,i,r);return r},{useDebugValue:cl}=N,{useSyncExternalStoreWithSelector:dl}=al,ul=e=>e;function hl(e,t=ul,n){const o=dl(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return cl(o),o}const fl=(e,t)=>{const n=(e=>e?ll(e):ll)(e),o=(e,o=t)=>hl(n,e,o);return Object.assign(o,n),o};function pl(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,o]of e)if(!Object.is(o,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const gl=s.createContext(null),ml=gl.Provider,yl=Ar();function xl(e,t){const n=s.useContext(gl);if(null===n)throw new Error(yl);return hl(n,e,t)}function vl(){const e=s.useContext(gl);if(null===e)throw new Error(yl);return s.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const bl={display:"none"},wl={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Sl="react-flow__node-desc",Cl="react-flow__edge-desc",Nl=e=>e.ariaLiveMessage,kl=e=>e.ariaLabelConfig;function El({rfId:e}){const t=xl(Nl);return b.jsx("div",{id:`react-flow__aria-live-${e}`,"aria-live":"assertive","aria-atomic":"true",style:wl,children:t})}function Ml({rfId:e,disableKeyboardA11y:t}){const n=xl(kl);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:`${Sl}-${e}`,style:bl,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),b.jsx("div",{id:`${Cl}-${e}`,style:bl,children:n["edge.a11yDescription.default"]}),!t&&b.jsx(El,{rfId:e})]})}const _l=s.forwardRef(({position:e="top-left",children:t,className:n,style:o,...i},r)=>{const s=`${e}`.split("-");return b.jsx("div",{className:$t(["react-flow__panel",n,...s]),style:o,ref:r,...i,children:t})});function jl({proOptions:e,position:t="bottom-right"}){return(null==e?void 0:e.hideAttribution)?null:b.jsx(_l,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:b.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}_l.displayName="Panel";const Pl=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},Il=e=>e.id;function Al(e,t){return pl(e.selectedNodes.map(Il),t.selectedNodes.map(Il))&&pl(e.selectedEdges.map(Il),t.selectedEdges.map(Il))}function Dl({onSelectionChange:e}){const t=vl(),{selectedNodes:n,selectedEdges:o}=xl(Pl,Al);return s.useEffect(()=>{const i={nodes:n,edges:o};null==e||e(i),t.getState().onSelectionChangeHandlers.forEach(e=>e(i))},[n,o,e]),null}const zl=e=>!!e.onSelectionChangeHandlers;function Rl({onSelectionChange:e}){const t=xl(zl);return e||t?b.jsx(Dl,{onSelectionChange:e}):null}const Ol=[0,0],Bl={x:0,y:0,zoom:1},Ll=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","rfId"],Tl=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),$l={translateExtent:Hr,nodeOrigin:Ol,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function Vl(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:i,setTranslateExtent:r,setNodeExtent:a,reset:l,setDefaultNodesAndEdges:c}=xl(Tl,pl),d=vl();s.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{u.current=$l,l()}),[]);const u=s.useRef($l);return s.useEffect(()=>{for(const s of Ll){const l=e[s];l!==u.current[s]&&(void 0!==e[s]&&("nodes"===s?t(l):"edges"===s?n(l):"minZoom"===s?o(l):"maxZoom"===s?i(l):"translateExtent"===s?r(l):"nodeExtent"===s?a(l):"ariaLabelConfig"===s?d.setState({ariaLabelConfig:$s(l)}):"fitView"===s?d.setState({fitViewQueued:l}):"fitViewOptions"===s?d.setState({fitViewOptions:l}):d.setState({[s]:l})))}u.current=e},Ll.map(t=>e[t])),null}function Hl(){return"undefined"!=typeof window&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null}const Fl="undefined"!=typeof document?document:null;function Xl(e=null,t={target:Fl,actInsideInputWithModifier:!0}){const[n,o]=s.useState(!1),i=s.useRef(!1),r=s.useRef(new Set([])),[a,l]=s.useMemo(()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter(e=>"string"==typeof e).map(e=>e.replace("+","\n").replace("\n\n","\n+").split("\n")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return s.useEffect(()=>{const n=(null==t?void 0:t.target)??Fl,s=(null==t?void 0:t.actInsideInputWithModifier)??!0;if(null!==e){const e=e=>{var n,c;i.current=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;if((!i.current||i.current&&!s)&&Ys(e))return!1;const d=Zl(e.code,l);if(r.current.add(e[d]),Yl(a,r.current,!1)){const r=(null==(c=null==(n=e.composedPath)?void 0:n.call(e))?void 0:c[0])||e.target,s="BUTTON"===(null==r?void 0:r.nodeName)||"A"===(null==r?void 0:r.nodeName);!1===t.preventDefault||!i.current&&s||e.preventDefault(),o(!0)}},c=e=>{const t=Zl(e.code,l);Yl(a,r.current,!0)?(o(!1),r.current.clear()):r.current.delete(e[t]),"Meta"===e.key&&r.current.clear(),i.current=!1},d=()=>{r.current.clear(),o(!1)};return null==n||n.addEventListener("keydown",e),null==n||n.addEventListener("keyup",c),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{null==n||n.removeEventListener("keydown",e),null==n||n.removeEventListener("keyup",c),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,o]),n}function Yl(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function Zl(e,t){return t.includes(e)?"code":"key"}function Kl(e,t){const n=[],o=new Map,i=[];for(const r of e)if("add"!==r.type)if("remove"===r.type||"replace"===r.type)o.set(r.id,[r]);else{const e=o.get(r.id);e?e.push(r):o.set(r.id,[r])}else i.push(r);for(const r of t){const e=o.get(r.id);if(!e){n.push(r);continue}if("remove"===e[0].type)continue;if("replace"===e[0].type){n.push({...e[0].item});continue}const t={...r};for(const n of e)Wl(n,t);n.push(t)}return i.length&&i.forEach(e=>{void 0!==e.index?n.splice(e.index,0,{...e.item}):n.push({...e.item})}),n}function Wl(e,t){switch(e.type){case"select":t.selected=e.selected;break;case"position":void 0!==e.position&&(t.position=e.position),void 0!==e.dragging&&(t.dragging=e.dragging);break;case"dimensions":void 0!==e.dimensions&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&(!0!==e.setAttributes&&"width"!==e.setAttributes||(t.width=e.dimensions.width),!0!==e.setAttributes&&"height"!==e.setAttributes||(t.height=e.dimensions.height))),"boolean"==typeof e.resizing&&(t.resizing=e.resizing)}}function ql(e,t){return Kl(e,t)}function Gl(e,t){return Kl(e,t)}function Ul(e,t){return{id:e,type:"select",selected:t}}function Ql(e,t=new Set,n=!1){const o=[];for(const[i,r]of e){const e=t.has(i);void 0===r.selected&&!e||r.selected===e||(n&&(r.selected=e),o.push(Ul(r.id,e)))}return o}function Jl({items:e=[],lookup:t}){var n;const o=[],i=new Map(e.map(e=>[e.id,e]));for(const[r,s]of e.entries()){const e=t.get(s.id),i=(null==(n=null==e?void 0:e.internals)?void 0:n.userNode)??e;void 0!==i&&i!==s&&o.push({id:s.id,item:s,type:"replace"}),void 0===i&&o.push({item:s,type:"add",index:r})}for(const[r]of t){void 0===i.get(r)&&o.push({id:r,type:"remove"})}return o}function ec(e){return{id:e.id,type:"remove"}}const tc=e=>(e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e))(e);function nc(e){return s.forwardRef(e)}const oc="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;function ic(e){const[t,n]=s.useState(BigInt(0)),[o]=s.useState(()=>function(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}(()=>n(e=>e+BigInt(1))));return oc(()=>{const t=o.get();t.length&&(e(t),o.reset())},[t]),o}const rc=s.createContext(null);function sc({children:e}){const t=vl(),n=ic(s.useCallback(e=>{const{nodes:n=[],setNodes:o,hasDefaultNodes:i,onNodesChange:r,nodeLookup:s,fitViewQueued:a}=t.getState();let l=n;for(const t of e)l="function"==typeof t?t(l):t;const c=Jl({items:l,lookup:s});i&&o(l),c.length>0?null==r||r(c):a&&window.requestAnimationFrame(()=>{const{fitViewQueued:e,nodes:n,setNodes:o}=t.getState();e&&o(n)})},[])),o=ic(s.useCallback(e=>{const{edges:n=[],setEdges:o,hasDefaultEdges:i,onEdgesChange:r,edgeLookup:s}=t.getState();let a=n;for(const t of e)a="function"==typeof t?t(a):t;i?o(a):r&&r(Jl({items:a,lookup:s}))},[])),i=s.useMemo(()=>({nodeQueue:n,edgeQueue:o}),[]);return b.jsx(rc.Provider,{value:i,children:e})}const ac=e=>!!e.panZoom;function lc(){const e=(()=>{const e=vl();return s.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:null==n?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,i,r],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??o,y:t.y??i,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:i,minZoom:r,maxZoom:s,panZoom:a}=e.getState(),l=Ds(t,o,i,r,s,(null==n?void 0:n.padding)??.1);return a?(await a.setViewport(l,{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:i,snapToGrid:r,domNode:s}=e.getState();if(!s)return t;const{x:a,y:l}=s.getBoundingClientRect(),c={x:t.x-a,y:t.y-l},d=n.snapGrid??i,u=n.snapToGrid??r;return Ps(c,o,u,d)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:i,y:r}=o.getBoundingClientRect(),s=Is(t,n);return{x:s.x+i,y:s.y+r}}}),[])})(),t=vl(),n=function(){const e=s.useContext(rc);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}(),o=xl(ac),i=s.useMemo(()=>{const e=e=>t.getState().nodeLookup.get(e),o=e=>{n.nodeQueue.push(e)},i=e=>{n.edgeQueue.push(e)},r=e=>{var n,o;const{nodeLookup:i,nodeOrigin:r}=t.getState(),s=tc(e)?e:i.get(e.id),a=s.parentId?Ls(s.position,s.measured,s.parentId,i,r):s.position,l={...s,position:a,width:(null==(n=s.measured)?void 0:n.width)??s.width,height:(null==(o=s.measured)?void 0:o.height)??s.height};return Ss(l)},s=(e,t,n={replace:!1})=>{o(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&tc(e)?e:{...o,...e}}return o}))},a=(e,t,n={replace:!1})=>{i(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&ss(e)?e:{...o,...e}}return o}))};return{getNodes:()=>t.getState().nodes.map(e=>({...e})),getNode:t=>{var n;return null==(n=e(t))?void 0:n.internals.userNode},getInternalNode:e,getEdges:()=>{const{edges:e=[]}=t.getState();return e.map(e=>({...e}))},getEdge:e=>t.getState().edgeLookup.get(e),setNodes:o,setEdges:i,addNodes:e=>{const t=Array.isArray(e)?e:[e];n.nodeQueue.push(e=>[...e,...t])},addEdges:e=>{const t=Array.isArray(e)?e:[e];n.edgeQueue.push(e=>[...e,...t])},toObject:()=>{const{nodes:e=[],edges:n=[],transform:o}=t.getState(),[i,r,s]=o;return{nodes:e.map(e=>({...e})),edges:n.map(e=>({...e})),viewport:{x:i,y:r,zoom:s}}},deleteElements:async({nodes:e=[],edges:n=[]})=>{const{nodes:o,edges:i,onNodesDelete:r,onEdgesDelete:s,triggerNodeChanges:a,triggerEdgeChanges:l,onDelete:c,onBeforeDelete:d}=t.getState(),{nodes:u,edges:h}=await fs({nodesToRemove:e,edgesToRemove:n,nodes:o,edges:i,onBeforeDelete:d}),f=h.length>0,p=u.length>0;if(f){const e=h.map(ec);null==s||s(h),l(e)}if(p){const e=u.map(ec);null==r||r(u),a(e)}return(p||f)&&(null==c||c({nodes:u,edges:h})),{deletedNodes:u,deletedEdges:h}},getIntersectingNodes:(e,n=!0,o)=>{const i=Es(e),s=i?e:r(e),a=void 0!==o;return s?(o||t.getState().nodes).filter(o=>{const r=t.getState().nodeLookup.get(o.id);if(r&&!i&&(o.id===e.id||!r.internals.positionAbsolute))return!1;const l=Ss(a?o:r),c=ks(l,s);return n&&c>0||c>=l.width*l.height||c>=s.width*s.height}):[]},isNodeIntersecting:(e,t,n=!0)=>{const o=Es(e)?e:r(e);if(!o)return!1;const i=ks(o,t);return n&&i>0||i>=t.width*t.height||i>=o.width*o.height},updateNode:s,updateNodeData:(e,t,n={replace:!1})=>{s(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},updateEdge:a,updateEdgeData:(e,t,n={replace:!1})=>{a(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},getNodesBounds:e=>{const{nodeLookup:n,nodeOrigin:o}=t.getState();return((e,t={nodeOrigin:[0,0]})=>{if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const o="string"==typeof n;let i=t.nodeLookup||o?void 0:n;t.nodeLookup&&(i=o?t.nodeLookup.get(n):as(n)?n:t.nodeLookup.get(n.id));const r=i?Cs(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return vs(e,r)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ws(n)})(e,{nodeLookup:n,nodeOrigin:o})},getHandleConnections:({type:e,id:n,nodeId:o})=>{var i;return Array.from((null==(i=t.getState().connectionLookup.get(`${o}-${e}${n?`-${n}`:""}`))?void 0:i.values())??[])},getNodeConnections:({type:e,handleId:n,nodeId:o})=>{var i;return Array.from((null==(i=t.getState().connectionLookup.get(`${o}${e?n?`-${e}-${n}`:`-${e}`:""}`))?void 0:i.values())??[])},fitView:async e=>{const o=t.getState().fitViewResolver??function(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}();return t.setState({fitViewQueued:!0,fitViewOptions:e,fitViewResolver:o}),n.nodeQueue.push(e=>[...e]),o.promise}}},[]);return s.useMemo(()=>({...i,...e,viewportInitialized:o}),[o])}const cc=e=>e.selected,dc="undefined"!=typeof window?window:void 0;const uc={position:"absolute",width:"100%",height:"100%",top:0,left:0},hc=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function fc({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:i=.5,panOnScrollMode:r=Kr.Free,zoomOnDoubleClick:a=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:u,maxZoom:h,zoomActivationKeyCode:f,preventScrolling:p=!0,children:g,noWheelClassName:m,noPanClassName:y,onViewportChange:x,isControlledViewport:v,paneClickDistance:w,selectionOnDrag:S}){const C=vl(),N=s.useRef(null),{userSelectionActive:k,lib:E,connectionInProgress:M}=xl(hc,pl),_=Xl(f),j=s.useRef();!function(e){const t=vl();s.useEffect(()=>{const n=()=>{var n,o,i,r;if(!e.current||!((null==(o=(n=e.current).checkVisibility)?void 0:o.call(n))??1))return!1;const s=Hs(e.current);0!==s.height&&0!==s.width||null==(r=(i=t.getState()).onError)||r.call(i,"004",zr()),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const t=new ResizeObserver(()=>n());return t.observe(e.current),()=>{window.removeEventListener("resize",n),t&&e.current&&t.unobserve(e.current)}}},[])}(N);const P=s.useCallback(e=>{null==x||x({x:e[0],y:e[1],zoom:e[2]}),v||C.setState({transform:e})},[x,v]);return s.useEffect(()=>{if(N.current){j.current=$a({domNode:N.current,minZoom:u,maxZoom:h,translateExtent:d,viewport:c,onDraggingChange:e=>C.setState({paneDragging:e}),onPanZoomStart:(e,t)=>{const{onViewportChangeStart:n,onMoveStart:o}=C.getState();null==o||o(e,t),null==n||n(t)},onPanZoom:(e,t)=>{const{onViewportChange:n,onMove:o}=C.getState();null==o||o(e,t),null==n||n(t)},onPanZoomEnd:(e,t)=>{const{onViewportChangeEnd:n,onMoveEnd:o}=C.getState();null==o||o(e,t),null==n||n(t)}});const{x:e,y:t,zoom:n}=j.current.getViewport();return C.setState({panZoom:j.current,transform:[e,t,n],domNode:N.current.closest(".react-flow")}),()=>{var e;null==(e=j.current)||e.destroy()}}},[]),s.useEffect(()=>{var s;null==(s=j.current)||s.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:i,panOnScrollMode:r,zoomOnDoubleClick:a,panOnDrag:l,zoomActivationKeyPressed:_,preventScrolling:p,noPanClassName:y,userSelectionActive:k,noWheelClassName:m,lib:E,onTransformChange:P,connectionInProgress:M,selectionOnDrag:S,paneClickDistance:w})},[e,t,n,o,i,r,a,l,_,p,y,k,m,E,P,M,S,w]),b.jsx("div",{className:"react-flow__renderer",ref:N,style:uc,children:g})}const pc=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function gc(){const{userSelectionActive:e,userSelectionRect:t}=xl(pc,pl);return e&&t?b.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const mc=(e,t)=>n=>{n.target===t.current&&(null==e||e(n))},yc=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function xc({isSelecting:e,selectionKeyPressed:t,selectionMode:n=qr.Full,panOnDrag:o,paneClickDistance:i,selectionOnDrag:r,onSelectionStart:a,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:u,onPaneMouseEnter:h,onPaneMouseMove:f,onPaneMouseLeave:p,children:g}){const m=vl(),{userSelectionActive:y,elementsSelectable:x,dragging:v,connectionInProgress:w}=xl(yc,pl),S=x&&(e||y),C=s.useRef(null),N=s.useRef(),k=s.useRef(new Set),E=s.useRef(new Set),M=s.useRef(!1),_=e=>{M.current||w?M.current=!1:(null==c||c(e),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1}))},j=u?e=>u(e):void 0,P=!0===o||Array.isArray(o)&&o.includes(0);return b.jsxs("div",{className:$t(["react-flow__pane",{draggable:P,dragging:v,selection:e}]),onClick:S?void 0:mc(_,C),onContextMenu:mc(e=>{Array.isArray(o)&&(null==o?void 0:o.includes(2))?e.preventDefault():null==d||d(e)},C),onWheel:mc(j,C),onPointerEnter:S?void 0:h,onPointerMove:S?e=>{const{userSelectionRect:o,transform:r,nodeLookup:s,edgeLookup:l,connectionLookup:c,triggerNodeChanges:d,triggerEdgeChanges:u,defaultEdgeOptions:h,resetSelectedElements:f}=m.getState();if(!N.current||!o)return;const{x:p,y:g}=Ks(e.nativeEvent,N.current),{startX:y,startY:x}=o;if(!M.current){const n=t?0:i;if(Math.hypot(p-y,g-x)<=n)return;f(),null==a||a(e)}M.current=!0;const v={startX:y,startY:x,x:p<y?p:y,y:g<x?g:x,width:Math.abs(p-y),height:Math.abs(g-x)},b=k.current,w=E.current;k.current=new Set(ds(s,v,r,n===qr.Partial,!0).map(e=>e.id)),E.current=new Set;const S=(null==h?void 0:h.selectable)??!0;for(const t of k.current){const e=c.get(t);if(e)for(const{edgeId:t}of e.values()){const e=l.get(t);e&&(e.selectable??S)&&E.current.add(t)}}if(!Ts(b,k.current)){d(Ql(s,k.current,!0))}if(!Ts(w,E.current)){u(Ql(l,E.current))}m.setState({userSelectionRect:v,userSelectionActive:!0,nodesSelectionActive:!1})}:f,onPointerUp:S?e=>{var t,n;0===e.button&&(null==(n=null==(t=e.target)?void 0:t.releasePointerCapture)||n.call(t,e.pointerId),!y&&e.target===C.current&&m.getState().userSelectionRect&&(null==_||_(e)),m.setState({userSelectionActive:!1,userSelectionRect:null}),M.current&&(null==l||l(e),m.setState({nodesSelectionActive:k.current.size>0})))}:void 0,onPointerDownCapture:S?n=>{var o,i;const{domNode:s}=m.getState();if(N.current=null==s?void 0:s.getBoundingClientRect(),!N.current)return;const a=n.target===C.current;if(!a&&!!n.target.closest(".nokey")||!e||!(r&&a||t)||0!==n.button||!n.isPrimary)return;null==(i=null==(o=n.target)?void 0:o.setPointerCapture)||i.call(o,n.pointerId),M.current=!1;const{x:l,y:c}=Ks(n.nativeEvent,N.current);m.setState({userSelectionRect:{width:0,height:0,startX:l,startY:c,x:l,y:c}}),a||(n.stopPropagation(),n.preventDefault())}:void 0,onClickCapture:S?e=>{M.current&&(e.stopPropagation(),M.current=!1)}:void 0,onPointerLeave:p,ref:C,style:uc,children:[g,b.jsx(gc,{})]})}function vc({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:i,unselectNodesAndEdges:r,multiSelectionActive:s,nodeLookup:a,onError:l}=t.getState(),c=a.get(e);c?(t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&s)&&(r({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var e;return null==(e=null==o?void 0:o.current)?void 0:e.blur()})):i([e])):null==l||l("012",$r(e))}function bc({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:i,isSelectable:r,nodeClickDistance:a}){const l=vl(),[c,d]=s.useState(!1),u=s.useRef();return s.useEffect(()=>{u.current=Ea({getStoreItems:()=>l.getState(),onNodeMouseDown:t=>{vc({id:t,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),s.useEffect(()=>{var s,l;if(t)null==(s=u.current)||s.destroy();else if(e.current)return null==(l=u.current)||l.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:r,nodeId:i,nodeClickDistance:a}),()=>{var e;null==(e=u.current)||e.destroy()}},[n,o,t,r,e,i]),c}function wc(){const e=vl();return s.useCallback(t=>{const{nodeExtent:n,snapToGrid:o,snapGrid:i,nodesDraggable:r,onError:s,updateNodePositions:a,nodeLookup:l,nodeOrigin:c}=e.getState(),d=new Map,u=(e=>t=>t.selected&&(t.draggable||e&&void 0===t.draggable))(r),h=o?i[0]:5,f=o?i[1]:5,p=t.direction.x*h*t.factor,g=t.direction.y*f*t.factor;for(const[,e]of l){if(!u(e))continue;let t={x:e.internals.positionAbsolute.x+p,y:e.internals.positionAbsolute.y+g};o&&(t=js(t,i));const{position:r,positionAbsolute:a}=hs({nodeId:e.id,nextPosition:t,nodeLookup:l,nodeExtent:n,nodeOrigin:c,onError:s});e.position=r,e.internals.positionAbsolute=a,d.set(e.id,e)}a(d)},[])}const Sc=s.createContext(null),Cc=Sc.Provider;Sc.Consumer;const Nc=()=>s.useContext(Sc),kc=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId});const Ec=s.memo(nc(function({type:e="source",position:t=ns.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:i=!0,isConnectableEnd:r=!0,id:s,onConnect:a,children:l,className:c,onMouseDown:d,onTouchStart:u,...h},f){var p,g;const m=s||null,y="target"===e,x=vl(),v=Nc(),{connectOnClick:w,noPanClassName:S,rfId:C}=xl(kc,pl),{connectingFrom:N,connectingTo:k,clickConnecting:E,isPossibleEndHandle:M,connectionInProcess:_,clickConnectionInProcess:j,valid:P}=xl(((e,t,n)=>o=>{const{connectionClickStartHandle:i,connectionMode:r,connection:s}=o,{fromHandle:a,toHandle:l,isValid:c}=s,d=(null==l?void 0:l.nodeId)===e&&(null==l?void 0:l.id)===t&&(null==l?void 0:l.type)===n;return{connectingFrom:(null==a?void 0:a.nodeId)===e&&(null==a?void 0:a.id)===t&&(null==a?void 0:a.type)===n,connectingTo:d,clickConnecting:(null==i?void 0:i.nodeId)===e&&(null==i?void 0:i.id)===t&&(null==i?void 0:i.type)===n,isPossibleEndHandle:r===Yr.Strict?(null==a?void 0:a.type)!==n:e!==(null==a?void 0:a.nodeId)||t!==(null==a?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!i,valid:d&&c}})(v,m,e),pl);v||null==(g=(p=x.getState()).onError)||g.call(p,"010",Lr());const I=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:o}=x.getState(),i={...t,...e};if(o){const{edges:e,setEdges:t}=x.getState();t(na(i,e))}null==n||n(i),null==a||a(i)},A=e=>{if(!v)return;const t=Zs(e.nativeEvent);if(i&&(t&&0===e.button||!t)){const t=x.getState();Aa.onPointerDown(e.nativeEvent,{handleDomNode:e.currentTarget,autoPanOnConnect:t.autoPanOnConnect,connectionMode:t.connectionMode,connectionRadius:t.connectionRadius,domNode:t.domNode,nodeLookup:t.nodeLookup,lib:t.lib,isTarget:y,handleId:m,nodeId:v,flowId:t.rfId,panBy:t.panBy,cancelConnection:t.cancelConnection,onConnectStart:t.onConnectStart,onConnectEnd:t.onConnectEnd,updateConnection:t.updateConnection,onConnect:I,isValidConnection:n||t.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:t.autoPanSpeed,dragThreshold:t.connectionDragThreshold})}t?null==d||d(e):null==u||u(e)};return b.jsx("div",{"data-handleid":m,"data-nodeid":v,"data-handlepos":t,"data-id":`${C}-${v}-${m}-${e}`,className:$t(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",S,c,{source:!y,target:y,connectable:o,connectablestart:i,connectableend:r,clickconnecting:E,connectingfrom:N,connectingto:k,valid:P,connectionindicator:o&&(!_||M)&&(_||j?r:i)}]),onMouseDown:A,onTouchStart:A,onClick:w?t=>{const{onClickConnectStart:o,onClickConnectEnd:r,connectionClickStartHandle:s,connectionMode:a,isValidConnection:l,lib:c,rfId:d,nodeLookup:u,connection:h}=x.getState();if(!v||!s&&!i)return;if(!s)return null==o||o(t.nativeEvent,{nodeId:v,handleId:m,handleType:e}),void x.setState({connectionClickStartHandle:{nodeId:v,type:e,id:m}});const f=Fs(t.target),p=n||l,{connection:g,isValid:y}=Aa.isValid(t.nativeEvent,{handle:{nodeId:v,id:m,type:e},connectionMode:a,fromNodeId:s.nodeId,fromHandleId:s.id||null,fromType:s.type,isValidConnection:p,flowId:d,doc:f,lib:c,nodeLookup:u});y&&g&&I(g);const b=structuredClone(h);delete b.inProgress,b.toPosition=b.toHandle?b.toHandle.position:null,null==r||r(t,b),x.setState({connectionClickStartHandle:null})}:void 0,ref:f,...h,children:l})}));const Mc={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},_c={input:function({data:e,isConnectable:t,sourcePosition:n=ns.Bottom}){return b.jsxs(b.Fragment,{children:[null==e?void 0:e.label,b.jsx(Ec,{type:"source",position:n,isConnectable:t})]})},default:function({data:e,isConnectable:t,targetPosition:n=ns.Top,sourcePosition:o=ns.Bottom}){return b.jsxs(b.Fragment,{children:[b.jsx(Ec,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label,b.jsx(Ec,{type:"source",position:o,isConnectable:t})]})},output:function({data:e,isConnectable:t,targetPosition:n=ns.Top}){return b.jsxs(b.Fragment,{children:[b.jsx(Ec,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label]})},group:function(){return null}};const jc=e=>{const{width:t,height:n,x:o,y:i}=cs(e.nodeLookup,{filter:e=>!!e.selected});return{width:Ms(t)?t:null,height:Ms(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${i}px)`}};function Pc({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=vl(),{width:i,height:r,transformString:a,userSelectionActive:l}=xl(jc,pl),c=wc(),d=s.useRef(null);if(s.useEffect(()=>{var e;n||null==(e=d.current)||e.focus({preventScroll:!0})},[n]),bc({nodeRef:d}),l||!i||!r)return null;const u=e?t=>{const n=o.getState().nodes.filter(e=>e.selected);e(t,n)}:void 0;return b.jsx("div",{className:$t(["react-flow__nodesselection","react-flow__container",t]),style:{transform:a},children:b.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:n?void 0:-1,onKeyDown:n?void 0:e=>{Object.prototype.hasOwnProperty.call(Mc,e.key)&&(e.preventDefault(),c({direction:Mc[e.key],factor:e.shiftKey?4:1}))},style:{width:i,height:r}})})}const Ic="undefined"!=typeof window?window:void 0,Ac=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Dc({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:a,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:u,selectionMode:h,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:g,panActivationKeyCode:m,zoomActivationKeyCode:y,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:w,panOnScroll:S,panOnScrollSpeed:C,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:E,defaultViewport:M,translateExtent:_,minZoom:j,maxZoom:P,preventScrolling:I,onSelectionContextMenu:A,noWheelClassName:D,noPanClassName:z,disableKeyboardA11y:R,onViewportChange:O,isControlledViewport:B}){const{nodesSelectionActive:L,userSelectionActive:T}=xl(Ac),$=Xl(d,{target:Ic}),V=Xl(m,{target:Ic}),H=V||E,F=V||S,X=u&&!0!==H,Y=$||T||X;return function({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=vl(),{deleteElements:o}=lc(),i=Xl(e,{actInsideInputWithModifier:!1}),r=Xl(t,{target:dc});s.useEffect(()=>{if(i){const{edges:e,nodes:t}=n.getState();o({nodes:t.filter(cc),edges:e.filter(cc)}),n.setState({nodesSelectionActive:!1})}},[i]),s.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}({deleteKeyCode:c,multiSelectionKeyCode:g}),b.jsx(fc,{onPaneContextMenu:r,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:w,panOnScroll:F,panOnScrollSpeed:C,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:!$&&H,defaultViewport:M,translateExtent:_,minZoom:j,maxZoom:P,zoomActivationKeyCode:y,preventScrolling:I,noWheelClassName:D,noPanClassName:z,onViewportChange:O,isControlledViewport:B,paneClickDistance:l,selectionOnDrag:X,children:b.jsxs(xc,{onSelectionStart:f,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:a,panOnDrag:H,isSelecting:!!Y,selectionMode:h,selectionKeyPressed:$,paneClickDistance:l,selectionOnDrag:X,children:[e,L&&b.jsx(Pc,{onSelectionContextMenu:A,noPanClassName:z,disableKeyboardA11y:R})]})})}Dc.displayName="FlowRenderer";const zc=s.memo(Dc);function Rc(e){return xl(s.useCallback((e=>t=>e?ds(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(e=>e.id):Array.from(t.nodeLookup.keys()))(e),[e]),pl)}const Oc=e=>e.updateNodeInternals;var Bc=s.memo(function({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:i,onContextMenu:r,onDoubleClick:a,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:u,resizeObserver:h,noDragClassName:f,noPanClassName:p,disableKeyboardA11y:g,rfId:m,nodeTypes:y,nodeClickDistance:x,onError:v}){const{node:w,internals:S,isParent:C}=xl(t=>{const n=t.nodeLookup.get(e),o=t.parentLookup.has(e);return{node:n,internals:n.internals,isParent:o}},pl);let N=w.type||"default",k=(null==y?void 0:y[N])||_c[N];void 0===k&&(null==v||v("003",Dr(N)),N="default",k=(null==y?void 0:y.default)||_c.default);const E=!!(w.draggable||l&&void 0===w.draggable),M=!!(w.selectable||c&&void 0===w.selectable),_=!!(w.connectable||d&&void 0===w.connectable),j=!!(w.focusable||u&&void 0===w.focusable),P=vl(),I=Bs(w),A=function({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const i=vl(),r=s.useRef(null),a=s.useRef(null),l=s.useRef(e.sourcePosition),c=s.useRef(e.targetPosition),d=s.useRef(t),u=n&&!!e.internals.handleBounds;return s.useEffect(()=>{!r.current||e.hidden||u&&a.current===r.current||(a.current&&(null==o||o.unobserve(a.current)),null==o||o.observe(r.current),a.current=r.current)},[u,e.hidden]),s.useEffect(()=>()=>{a.current&&(null==o||o.unobserve(a.current),a.current=null)},[]),s.useEffect(()=>{if(r.current){const n=d.current!==t,o=l.current!==e.sourcePosition,s=c.current!==e.targetPosition;(n||o||s)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,i.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}({node:w,nodeType:N,hasDimensions:I,resizeObserver:h}),D=bc({nodeRef:A,disabled:w.hidden||!E,noDragClassName:f,handleSelector:w.dragHandle,nodeId:e,isSelectable:M,nodeClickDistance:x}),z=wc();if(w.hidden)return null;const R=Os(w),O=function(e){var t,n,o,i;return void 0===e.internals.handleBounds?{width:e.width??e.initialWidth??(null==(t=e.style)?void 0:t.width),height:e.height??e.initialHeight??(null==(n=e.style)?void 0:n.height)}:{width:e.width??(null==(o=e.style)?void 0:o.width),height:e.height??(null==(i=e.style)?void 0:i.height)}}(w),B=M||E||t||n||o||i,L=n?e=>n(e,{...S.userNode}):void 0,T=o?e=>o(e,{...S.userNode}):void 0,$=i?e=>i(e,{...S.userNode}):void 0,V=r?e=>r(e,{...S.userNode}):void 0,H=a?e=>a(e,{...S.userNode}):void 0;return b.jsx("div",{className:$t(["react-flow__node",`react-flow__node-${N}`,{[p]:E},w.className,{selected:w.selected,selectable:M,parent:C,draggable:E,dragging:D}]),ref:A,style:{zIndex:S.z,transform:`translate(${S.positionAbsolute.x}px,${S.positionAbsolute.y}px)`,pointerEvents:B?"all":"none",visibility:I?"visible":"hidden",...w.style,...O},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:L,onMouseMove:T,onMouseLeave:$,onContextMenu:V,onClick:n=>{const{selectNodesOnDrag:o,nodeDragThreshold:i}=P.getState();M&&(!o||!E||i>0)&&vc({id:e,store:P,nodeRef:A}),t&&t(n,{...S.userNode})},onDoubleClick:H,onKeyDown:j?t=>{if(!Ys(t.nativeEvent)&&!g)if(Fr.includes(t.key)&&M){const n="Escape"===t.key;vc({id:e,store:P,unselect:n,nodeRef:A})}else if(E&&w.selected&&Object.prototype.hasOwnProperty.call(Mc,t.key)){t.preventDefault();const{ariaLabelConfig:e}=P.getState();P.setState({ariaLiveMessage:e["node.a11yDescription.ariaLiveMessage"]({direction:t.key.replace("Arrow","").toLowerCase(),x:~~S.positionAbsolute.x,y:~~S.positionAbsolute.y})}),z({direction:Mc[t.key],factor:t.shiftKey?4:1})}}:void 0,tabIndex:j?0:void 0,onFocus:j?()=>{var t;if(g||!(null==(t=A.current)?void 0:t.matches(":focus-visible")))return;const{transform:n,width:o,height:i,autoPanOnNodeFocus:r,setCenter:s}=P.getState();if(!r)return;ds(new Map([[e,w]]),{x:0,y:0,width:o,height:i},n,!0).length>0||s(w.position.x+R.width/2,w.position.y+R.height/2,{zoom:n[2]})}:void 0,role:w.ariaRole??(j?"group":void 0),"aria-roledescription":"node","aria-describedby":g?void 0:`${Sl}-${m}`,"aria-label":w.ariaLabel,...w.domAttributes,children:b.jsx(Cc,{value:e,children:b.jsx(k,{id:e,data:w.data,type:N,positionAbsoluteX:S.positionAbsolute.x,positionAbsoluteY:S.positionAbsolute.y,selected:w.selected??!1,selectable:M,draggable:E,deletable:w.deletable??!0,isConnectable:_,sourcePosition:w.sourcePosition,targetPosition:w.targetPosition,dragging:D,dragHandle:w.dragHandle,zIndex:S.z,parentId:w.parentId,...R})})})});const Lc=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Tc(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:i,onError:r}=xl(Lc,pl),a=Rc(e.onlyRenderVisibleElements),l=function(){const e=xl(Oc),[t]=s.useState(()=>"undefined"==typeof ResizeObserver?null:new ResizeObserver(t=>{const n=new Map;t.forEach(e=>{const t=e.target.getAttribute("data-id");n.set(t,{id:t,nodeElement:e.target,force:!0})}),e(n)}));return s.useEffect(()=>()=>{null==t||t.disconnect()},[t]),t}();return b.jsx("div",{className:"react-flow__nodes",style:uc,children:a.map(s=>b.jsx(Bc,{id:s,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:i,nodeClickDistance:e.nodeClickDistance,onError:r},s))})}Tc.displayName="NodeRenderer";const $c=s.memo(Tc);const Vc={[es.Arrow]:({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return b.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},[es.ArrowClosed]:({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return b.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})}};const Hc=({id:e,type:t,color:n,width:o=12.5,height:i=12.5,markerUnits:r="strokeWidth",strokeWidth:a,orient:l="auto-start-reverse"})=>{const c=function(e){const t=vl();return s.useMemo(()=>{var n,o;return Object.prototype.hasOwnProperty.call(Vc,e)?Vc[e]:(null==(o=(n=t.getState()).onError)||o.call(n,"009",Or(e)),null)},[e])}(t);return c?b.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:l,refX:"0",refY:"0",children:b.jsx(c,{color:n,strokeWidth:a})}):null},Fc=({defaultColor:e,rfId:t})=>{const n=xl(e=>e.edges),o=xl(e=>e.defaultEdgeOptions),i=s.useMemo(()=>{const i=function(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:i}){const r=new Set;return e.reduce((e,s)=>([s.markerStart||o,s.markerEnd||i].forEach(o=>{if(o&&"object"==typeof o){const i=ha(o,t);r.has(i)||(e.push({id:i,color:o.color||n,...o}),r.add(i))}}),e),[]).sort((e,t)=>e.id.localeCompare(t.id))}(n,{id:t,defaultColor:e,defaultMarkerStart:null==o?void 0:o.markerStart,defaultMarkerEnd:null==o?void 0:o.markerEnd});return i},[n,o,t,e]);return i.length?b.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:b.jsx("defs",{children:i.map(e=>b.jsx(Hc,{id:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient},e.id))})}):null};Fc.displayName="MarkerDefinitions";var Xc=s.memo(Fc);function Yc({x:e,y:t,label:n,labelStyle:o,labelShowBg:i=!0,labelBgStyle:r,labelBgPadding:a=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...u}){const[h,f]=s.useState({x:1,y:0,width:0,height:0}),p=$t(["react-flow__edge-textwrapper",d]),g=s.useRef(null);return s.useEffect(()=>{if(g.current){const e=g.current.getBBox();f({x:e.x,y:e.y,width:e.width,height:e.height})}},[n]),n?b.jsxs("g",{transform:`translate(${e-h.width/2} ${t-h.height/2})`,className:p,visibility:h.width?"visible":"hidden",...u,children:[i&&b.jsx("rect",{width:h.width+2*a[0],x:-a[0],y:-a[1],height:h.height+2*a[1],className:"react-flow__edge-textbg",style:r,rx:l,ry:l}),b.jsx("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:g,style:o,children:n}),c]}):null}Yc.displayName="EdgeText";const Zc=s.memo(Yc);function Kc({path:e,labelX:t,labelY:n,label:o,labelStyle:i,labelShowBg:r,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:l,interactionWidth:c=20,...d}){return b.jsxs(b.Fragment,{children:[b.jsx("path",{...d,d:e,fill:"none",className:$t(["react-flow__edge-path",d.className])}),c?b.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:c,className:"react-flow__edge-interaction"}):null,o&&Ms(t)&&Ms(n)?b.jsx(Zc,{x:t,y:n,label:o,labelStyle:i,labelShowBg:r,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:l}):null]})}function Wc({pos:e,x1:t,y1:n,x2:o,y2:i}){return e===ns.Left||e===ns.Right?[.5*(t+o),n]:[t,.5*(n+i)]}function qc({sourceX:e,sourceY:t,sourcePosition:n=ns.Bottom,targetX:o,targetY:i,targetPosition:r=ns.Top}){const[s,a]=Wc({pos:n,x1:e,y1:t,x2:o,y2:i}),[l,c]=Wc({pos:r,x1:o,y1:i,x2:e,y2:t}),[d,u,h,f]=qs({sourceX:e,sourceY:t,targetX:o,targetY:i,sourceControlX:s,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${e},${t} C${s},${a} ${l},${c} ${o},${i}`,d,u,h,f]}function Gc(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,sourcePosition:s,targetPosition:a,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:y})=>{const[x,v,w]=qc({sourceX:n,sourceY:o,sourcePosition:s,targetX:i,targetY:r,targetPosition:a}),S=e.isInternal?void 0:t;return b.jsx(Kc,{id:S,path:x,labelX:v,labelY:w,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:y})})}const Uc=Gc({isInternal:!1}),Qc=Gc({isInternal:!0});function Jc(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,sourcePosition:f=ns.Bottom,targetPosition:p=ns.Top,markerEnd:g,markerStart:m,pathOptions:y,interactionWidth:x})=>{const[v,w,S]=aa({sourceX:n,sourceY:o,sourcePosition:f,targetX:i,targetY:r,targetPosition:p,borderRadius:null==y?void 0:y.borderRadius,offset:null==y?void 0:y.offset,stepPosition:null==y?void 0:y.stepPosition}),C=e.isInternal?void 0:t;return b.jsx(Kc,{id:C,path:v,labelX:w,labelY:S,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:g,markerStart:m,interactionWidth:x})})}Uc.displayName="SimpleBezierEdge",Qc.displayName="SimpleBezierEdgeInternal";const ed=Jc({isInternal:!1}),td=Jc({isInternal:!0});function nd(e){return s.memo(({id:t,...n})=>{var o;const i=e.isInternal?void 0:t;return b.jsx(ed,{...n,id:i,pathOptions:s.useMemo(()=>{var e;return{borderRadius:0,offset:null==(e=n.pathOptions)?void 0:e.offset}},[null==(o=n.pathOptions)?void 0:o.offset])})})}ed.displayName="SmoothStepEdge",td.displayName="SmoothStepEdgeInternal";const od=nd({isInternal:!1}),id=nd({isInternal:!0});function rd(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:p,interactionWidth:g})=>{const[m,y,x]=oa({sourceX:n,sourceY:o,targetX:i,targetY:r}),v=e.isInternal?void 0:t;return b.jsx(Kc,{id:v,path:m,labelX:y,labelY:x,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:p,interactionWidth:g})})}od.displayName="StepEdge",id.displayName="StepEdgeInternal";const sd=rd({isInternal:!1}),ad=rd({isInternal:!0});function ld(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,sourcePosition:s=ns.Bottom,targetPosition:a=ns.Top,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,pathOptions:y,interactionWidth:x})=>{const[v,w,S]=Qs({sourceX:n,sourceY:o,sourcePosition:s,targetX:i,targetY:r,targetPosition:a,curvature:null==y?void 0:y.curvature}),C=e.isInternal?void 0:t;return b.jsx(Kc,{id:C,path:v,labelX:w,labelY:S,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:x})})}sd.displayName="StraightEdge",ad.displayName="StraightEdgeInternal";const cd=ld({isInternal:!1}),dd=ld({isInternal:!0});cd.displayName="BezierEdge",dd.displayName="BezierEdgeInternal";const ud={default:dd,straight:ad,step:id,smoothstep:td,simplebezier:Qc},hd={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},fd=(e,t,n)=>n===ns.Left?e-t:n===ns.Right?e+t:e,pd=(e,t,n)=>n===ns.Top?e-t:n===ns.Bottom?e+t:e,gd="react-flow__edgeupdater";function md({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:i,onMouseEnter:r,onMouseOut:s,type:a}){return b.jsx("circle",{onMouseDown:i,onMouseEnter:r,onMouseOut:s,className:$t([gd,`${gd}-${a}`]),cx:fd(t,o,e),cy:pd(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function yd({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:i,targetX:r,targetY:s,sourcePosition:a,targetPosition:l,onReconnect:c,onReconnectStart:d,onReconnectEnd:u,setReconnecting:h,setUpdateHover:f}){const p=vl(),g=(e,t)=>{if(0!==e.button)return;const{autoPanOnConnect:o,domNode:i,isValidConnection:r,connectionMode:s,connectionRadius:a,lib:l,onConnectStart:f,onConnectEnd:g,cancelConnection:m,nodeLookup:y,rfId:x,panBy:v,updateConnection:b}=p.getState(),w="target"===t.type;Aa.onPointerDown(e.nativeEvent,{autoPanOnConnect:o,connectionMode:s,connectionRadius:a,domNode:i,handleId:t.id,nodeId:t.nodeId,nodeLookup:y,isTarget:w,edgeUpdaterType:t.type,lib:l,flowId:x,cancelConnection:m,panBy:v,isValidConnection:r,onConnect:e=>null==c?void 0:c(n,e),onConnectStart:(o,i)=>{h(!0),null==d||d(e,n,t.type),null==f||f(o,i)},onConnectEnd:g,onReconnectEnd:(e,o)=>{h(!1),null==u||u(e,n,t.type,o)},updateConnection:b,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:e.currentTarget})},m=()=>f(!0),y=()=>f(!1);return b.jsxs(b.Fragment,{children:[(!0===e||"source"===e)&&b.jsx(md,{position:a,centerX:o,centerY:i,radius:t,onMouseDown:e=>g(e,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),onMouseEnter:m,onMouseOut:y,type:"source"}),(!0===e||"target"===e)&&b.jsx(md,{position:l,centerX:r,centerY:s,radius:t,onMouseDown:e=>g(e,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),onMouseEnter:m,onMouseOut:y,type:"target"})]})}var xd=s.memo(function({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:i,onDoubleClick:r,onContextMenu:a,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,rfId:g,edgeTypes:m,noPanClassName:y,onError:x,disableKeyboardA11y:v}){let w=xl(t=>t.edgeLookup.get(e));const S=xl(e=>e.defaultEdgeOptions);w=S?{...S,...w}:w;let C=w.type||"default",N=(null==m?void 0:m[C])||ud[C];void 0===N&&(null==x||x("011",Tr(C)),C="default",N=(null==m?void 0:m.default)||ud.default);const k=!!(w.focusable||t&&void 0===w.focusable),E=void 0!==h&&(w.reconnectable||n&&void 0===w.reconnectable),M=!!(w.selectable||o&&void 0===w.selectable),_=s.useRef(null),[j,P]=s.useState(!1),[I,A]=s.useState(!1),D=vl(),{zIndex:z,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$}=xl(s.useCallback(t=>{const n=t.nodeLookup.get(w.source),o=t.nodeLookup.get(w.target);if(!n||!o)return{zIndex:w.zIndex,...hd};const i=function(e){var t;const{sourceNode:n,targetNode:o}=e;if(!la(n)||!la(o))return null;const i=n.internals.handleBounds||ca(n.handles),r=o.internals.handleBounds||ca(o.handles),s=ua((null==i?void 0:i.source)??[],e.sourceHandle),a=ua(e.connectionMode===Yr.Strict?(null==r?void 0:r.target)??[]:((null==r?void 0:r.target)??[]).concat((null==r?void 0:r.source)??[]),e.targetHandle);if(!s||!a)return null==(t=e.onError)||t.call(e,"008",Br(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=(null==s?void 0:s.position)||ns.Bottom,c=(null==a?void 0:a.position)||ns.Top,d=da(n,s,l),u=da(o,a,c);return{sourceX:d.x,sourceY:d.y,targetX:u.x,targetY:u.y,sourcePosition:l,targetPosition:c}}({id:e,sourceNode:n,targetNode:o,sourceHandle:w.sourceHandle||null,targetHandle:w.targetHandle||null,connectionMode:t.connectionMode,onError:x}),r=function({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:i=!1}){return void 0!==o?o:(i&&n?1e3:0)+Math.max(e.parentId||i&&e.selected?e.internals.z:0,t.parentId||i&&t.selected?t.internals.z:0)}({selected:w.selected,zIndex:w.zIndex,sourceNode:n,targetNode:o,elevateOnSelect:t.elevateEdgesOnSelect});return{zIndex:r,...i||hd}},[w.source,w.target,w.sourceHandle,w.targetHandle,w.selected,w.zIndex]),pl),V=s.useMemo(()=>w.markerStart?`url('#${ha(w.markerStart,g)}')`:void 0,[w.markerStart,g]),H=s.useMemo(()=>w.markerEnd?`url('#${ha(w.markerEnd,g)}')`:void 0,[w.markerEnd,g]);if(w.hidden||null===R||null===O||null===B||null===L)return null;const F=r?e=>{r(e,{...w})}:void 0,X=a?e=>{a(e,{...w})}:void 0,Y=l?e=>{l(e,{...w})}:void 0,Z=c?e=>{c(e,{...w})}:void 0,K=d?e=>{d(e,{...w})}:void 0;return b.jsx("svg",{style:{zIndex:z},children:b.jsxs("g",{className:$t(["react-flow__edge",`react-flow__edge-${C}`,w.className,y,{selected:w.selected,animated:w.animated,inactive:!M&&!i,updating:j,selectable:M}]),onClick:t=>{var n;const{addSelectedEdges:o,unselectNodesAndEdges:r,multiSelectionActive:s}=D.getState();M&&(D.setState({nodesSelectionActive:!1}),w.selected&&s?(r({nodes:[],edges:[w]}),null==(n=_.current)||n.blur()):o([e])),i&&i(t,w)},onDoubleClick:F,onContextMenu:X,onMouseEnter:Y,onMouseMove:Z,onMouseLeave:K,onKeyDown:k?t=>{var n;if(!v&&Fr.includes(t.key)&&M){const{unselectNodesAndEdges:o,addSelectedEdges:i}=D.getState();"Escape"===t.key?(null==(n=_.current)||n.blur(),o({edges:[w]})):i([e])}}:void 0,tabIndex:k?0:void 0,role:w.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":null===w.ariaLabel?void 0:w.ariaLabel||`Edge from ${w.source} to ${w.target}`,"aria-describedby":k?`${Cl}-${g}`:void 0,ref:_,...w.domAttributes,children:[!I&&b.jsx(N,{id:e,source:w.source,target:w.target,type:w.type,selected:w.selected,animated:w.animated,selectable:M,deletable:w.deletable??!0,label:w.label,labelStyle:w.labelStyle,labelShowBg:w.labelShowBg,labelBgStyle:w.labelBgStyle,labelBgPadding:w.labelBgPadding,labelBgBorderRadius:w.labelBgBorderRadius,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$,data:w.data,style:w.style,sourceHandleId:w.sourceHandle,targetHandleId:w.targetHandle,markerStart:V,markerEnd:H,pathOptions:"pathOptions"in w?w.pathOptions:void 0,interactionWidth:w.interactionWidth}),E&&b.jsx(yd,{edge:w,isReconnectable:E,reconnectRadius:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$,setUpdateHover:P,setReconnecting:A})]})})});const vd=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function bd({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:i,onReconnect:r,onEdgeContextMenu:a,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:u,reconnectRadius:h,onEdgeDoubleClick:f,onReconnectStart:p,onReconnectEnd:g,disableKeyboardA11y:m}){const{edgesFocusable:y,edgesReconnectable:x,elementsSelectable:v,onError:w}=xl(vd,pl),S=(C=t,xl(s.useCallback(e=>{if(!C)return e.edges.map(e=>e.id);const t=[];if(e.width&&e.height)for(const n of e.edges){const o=e.nodeLookup.get(n.source),i=e.nodeLookup.get(n.target);o&&i&&ea({sourceNode:o,targetNode:i,width:e.width,height:e.height,transform:e.transform})&&t.push(n.id)}return t},[C]),pl));var C;return b.jsxs("div",{className:"react-flow__edges",children:[b.jsx(Xc,{defaultColor:e,rfId:n}),S.map(e=>b.jsx(xd,{id:e,edgesFocusable:y,edgesReconnectable:x,elementsSelectable:v,noPanClassName:i,onReconnect:r,onContextMenu:a,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:u,reconnectRadius:h,onDoubleClick:f,onReconnectStart:p,onReconnectEnd:g,rfId:n,onError:w,edgeTypes:o,disableKeyboardA11y:m},e))]})}bd.displayName="EdgeRenderer";const wd=s.memo(bd),Sd=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Cd({children:e}){const t=xl(Sd);return b.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}const Nd=e=>{var t;return null==(t=e.panZoom)?void 0:t.syncViewport};function kd(e){return e.connection.inProgress?{...e.connection,to:Ps(e.connection.to,e.transform)}:{...e.connection}}function Ed(e){return xl(kd,pl)}const Md=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function _d({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:i,width:r,height:s,isValid:a,inProgress:l}=xl(Md,pl);return!!(r&&i&&l)?b.jsx("svg",{style:e,width:r,height:s,className:"react-flow__connectionline react-flow__container",children:b.jsx("g",{className:$t(["react-flow__connection",rs(a)]),children:b.jsx(jd,{style:t,type:n,CustomComponent:o,isValid:a})})}):null}const jd=({style:e,type:t=Qr.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:i,from:r,fromNode:s,fromHandle:a,fromPosition:l,to:c,toNode:d,toHandle:u,toPosition:h}=Ed();if(!i)return;if(n)return b.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:r.x,fromY:r.y,toX:c.x,toY:c.y,fromPosition:l,toPosition:h,connectionStatus:rs(o),toNode:d,toHandle:u});let f="";const p={sourceX:r.x,sourceY:r.y,sourcePosition:l,targetX:c.x,targetY:c.y,targetPosition:h};switch(t){case Qr.Bezier:[f]=Qs(p);break;case Qr.SimpleBezier:[f]=qc(p);break;case Qr.Step:[f]=aa({...p,borderRadius:0});break;case Qr.SmoothStep:[f]=aa(p);break;default:[f]=oa(p)}return b.jsx("path",{d:f,fill:"none",className:"react-flow__connection-path",style:e})};jd.displayName="ConnectionLine";const Pd={};function Id(e=Pd){s.useRef(e),vl(),s.useEffect(()=>{},[e])}function Ad({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:i,onNodeDoubleClick:r,onEdgeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,onSelectionContextMenu:h,onSelectionStart:f,onSelectionEnd:p,connectionLineType:g,connectionLineStyle:m,connectionLineComponent:y,connectionLineContainerStyle:x,selectionKeyCode:v,selectionOnDrag:w,selectionMode:S,multiSelectionKeyCode:C,panActivationKeyCode:N,zoomActivationKeyCode:k,deleteKeyCode:E,onlyRenderVisibleElements:M,elementsSelectable:_,defaultViewport:j,translateExtent:P,minZoom:I,maxZoom:A,preventScrolling:D,defaultMarkerColor:z,zoomOnScroll:R,zoomOnPinch:O,panOnScroll:B,panOnScrollSpeed:L,panOnScrollMode:T,zoomOnDoubleClick:$,panOnDrag:V,onPaneClick:H,onPaneMouseEnter:F,onPaneMouseMove:X,onPaneMouseLeave:Y,onPaneScroll:Z,onPaneContextMenu:K,paneClickDistance:W,nodeClickDistance:q,onEdgeContextMenu:G,onEdgeMouseEnter:U,onEdgeMouseMove:Q,onEdgeMouseLeave:J,reconnectRadius:ee,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,noDragClassName:ie,noWheelClassName:re,noPanClassName:se,disableKeyboardA11y:ae,nodeExtent:le,rfId:ce,viewport:de,onViewportChange:ue}){return Id(e),Id(t),vl(),s.useRef(!1),s.useEffect(()=>{},[]),function(e){const t=lc(),n=s.useRef(!1);s.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}(n),function(e){const t=xl(Nd),n=vl();s.useEffect(()=>{e&&(null==t||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t])}(de),b.jsx(zc,{onPaneClick:H,onPaneMouseEnter:F,onPaneMouseMove:X,onPaneMouseLeave:Y,onPaneContextMenu:K,onPaneScroll:Z,paneClickDistance:W,deleteKeyCode:E,selectionKeyCode:v,selectionOnDrag:w,selectionMode:S,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:C,panActivationKeyCode:N,zoomActivationKeyCode:k,elementsSelectable:_,zoomOnScroll:R,zoomOnPinch:O,zoomOnDoubleClick:$,panOnScroll:B,panOnScrollSpeed:L,panOnScrollMode:T,panOnDrag:V,defaultViewport:j,translateExtent:P,minZoom:I,maxZoom:A,onSelectionContextMenu:h,preventScrolling:D,noDragClassName:ie,noWheelClassName:re,noPanClassName:se,disableKeyboardA11y:ae,onViewportChange:ue,isControlledViewport:!!de,children:b.jsxs(Cd,{children:[b.jsx(wd,{edgeTypes:t,onEdgeClick:i,onEdgeDoubleClick:a,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,onlyRenderVisibleElements:M,onEdgeContextMenu:G,onEdgeMouseEnter:U,onEdgeMouseMove:Q,onEdgeMouseLeave:J,reconnectRadius:ee,defaultMarkerColor:z,noPanClassName:se,disableKeyboardA11y:ae,rfId:ce}),b.jsx(_d,{style:m,type:g,component:y,containerStyle:x}),b.jsx("div",{className:"react-flow__edgelabel-renderer"}),b.jsx($c,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:r,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,nodeClickDistance:q,onlyRenderVisibleElements:M,noPanClassName:se,noDragClassName:ie,disableKeyboardA11y:ae,nodeExtent:le,rfId:ce}),b.jsx("div",{className:"react-flow__viewport-portal"})]})})}Ad.displayName="GraphView";const Dd=s.memo(Ad),zd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l=.5,maxZoom:c=2,nodeOrigin:d,nodeExtent:u}={})=>{const h=new Map,f=new Map,p=new Map,g=new Map,m=o??t??[],y=n??e??[],x=d??[0,0],v=u??Hr;Sa(p,g,m);const b=ya(y,h,f,{nodeOrigin:x,nodeExtent:v,elevateNodesOnSelect:!1});let w=[0,0,1];if(s&&i&&r){const e=cs(h,{filter:e=>!(!e.width&&!e.initialWidth||!e.height&&!e.initialHeight)}),{x:t,y:n,zoom:o}=Ds(e,i,r,l,c,(null==a?void 0:a.padding)??.1);w=[t,n,o]}return{rfId:"1",width:i??0,height:r??0,transform:w,nodes:y,nodesInitialized:b,nodeLookup:h,parentLookup:f,edges:m,edgeLookup:g,connectionLookup:p,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:void 0!==n,hasDefaultEdges:void 0!==o,panZoom:null,minZoom:l,maxZoom:c,translateExtent:Hr,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Yr.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Ur},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:_s,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Xr}},Rd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l,maxZoom:c,nodeOrigin:d,nodeExtent:u})=>{return h=(h,f)=>{async function p(){const{nodeLookup:e,panZoom:t,fitViewOptions:n,fitViewResolver:o,width:i,height:r,minZoom:s,maxZoom:a}=f();t&&(await us({nodes:e,width:i,height:r,panZoom:t,minZoom:s,maxZoom:a},n),null==o||o.resolve(!0),h({fitViewResolver:null}))}return{...zd({nodes:e,edges:t,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l,maxZoom:c,nodeOrigin:d,nodeExtent:u,defaultNodes:n,defaultEdges:o}),setNodes:e=>{const{nodeLookup:t,parentLookup:n,nodeOrigin:o,elevateNodesOnSelect:i,fitViewQueued:r}=f(),s=ya(e,t,n,{nodeOrigin:o,nodeExtent:u,elevateNodesOnSelect:i,checkEquality:!0});r&&s?(p(),h({nodes:e,nodesInitialized:s,fitViewQueued:!1,fitViewOptions:void 0})):h({nodes:e,nodesInitialized:s})},setEdges:e=>{const{connectionLookup:t,edgeLookup:n}=f();Sa(t,n,e),h({edges:e})},setDefaultNodesAndEdges:(e,t)=>{if(e){const{setNodes:t}=f();t(e),h({hasDefaultNodes:!0})}if(t){const{setEdges:e}=f();e(t),h({hasDefaultEdges:!0})}},updateNodeInternals:e=>{const{triggerNodeChanges:t,nodeLookup:n,parentLookup:o,domNode:i,nodeOrigin:r,nodeExtent:s,debug:a,fitViewQueued:l}=f(),{changes:c,updatedInternals:d}=function(e,t,n,o,i,r){const s=null==o?void 0:o.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const l=[],c=window.getComputedStyle(s),{m22:d}=new window.DOMMatrixReadOnly(c.transform),u=[];for(const h of e.values()){const e=t.get(h.id);if(!e)continue;if(e.hidden){t.set(e.id,{...e,internals:{...e.internals,handleBounds:void 0}}),a=!0;continue}const o=Hs(h.nodeElement),s=e.measured.width!==o.width||e.measured.height!==o.height;if(o.width&&o.height&&(s||!e.internals.handleBounds||h.force)){const c=h.nodeElement.getBoundingClientRect(),f=Rs(e.extent)?e.extent:r;let{positionAbsolute:p}=e.internals;e.parentId&&"parent"===e.extent?p=ms(p,o,t.get(e.parentId)):f&&(p=gs(p,f,o));const g={...e,measured:o,internals:{...e.internals,positionAbsolute:p,handleBounds:{source:Ws("source",h.nodeElement,c,d,e.id),target:Ws("target",h.nodeElement,c,d,e.id)}}};t.set(e.id,g),e.parentId&&xa(g,t,n,{nodeOrigin:i}),a=!0,s&&(l.push({id:e.id,type:"dimensions",dimensions:o}),e.expandParent&&e.parentId&&u.push({id:e.id,parentId:e.parentId,rect:Ss(g,i)}))}}if(u.length>0){const e=ba(u,t,n,i);l.push(...e)}return{changes:l,updatedInternals:a}}(e,n,o,i,r,s);d&&(function(e,t,n){const o=ga(fa,n);for(const i of e.values())if(i.parentId)xa(i,e,t,o);else{const e=ls(i,o.nodeOrigin),t=Rs(i.extent)?i.extent:o.nodeExtent,n=gs(e,t,Os(i));i.internals.positionAbsolute=n}}(n,o,{nodeOrigin:r,nodeExtent:s}),l?(p(),h({fitViewQueued:!1,fitViewOptions:void 0})):h({}),(null==c?void 0:c.length)>0&&(null==t||t(c)))},updateNodePositions:(e,t=!1)=>{const n=[],o=[],{nodeLookup:i,triggerNodeChanges:r}=f();for(const[s,a]of e){const e=i.get(s),r=!!((null==e?void 0:e.expandParent)&&(null==e?void 0:e.parentId)&&(null==a?void 0:a.position)),l={id:s,type:"position",position:r?{x:Math.max(0,a.position.x),y:Math.max(0,a.position.y)}:a.position,dragging:t};r&&e.parentId&&n.push({id:s,parentId:e.parentId,rect:{...a.internals.positionAbsolute,width:a.measured.width??0,height:a.measured.height??0}}),o.push(l)}if(n.length>0){const{parentLookup:e,nodeOrigin:t}=f(),r=ba(n,i,e,t);o.push(...r)}r(o)},triggerNodeChanges:e=>{const{onNodesChange:t,setNodes:n,nodes:o,hasDefaultNodes:i,debug:r}=f();(null==e?void 0:e.length)&&(i&&n(ql(e,o)),null==t||t(e))},triggerEdgeChanges:e=>{const{onEdgesChange:t,setEdges:n,edges:o,hasDefaultEdges:i,debug:r}=f();(null==e?void 0:e.length)&&(i&&n(Gl(e,o)),null==t||t(e))},addSelectedNodes:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:i,triggerEdgeChanges:r}=f();t?i(e.map(e=>Ul(e,!0))):(i(Ql(o,new Set([...e]),!0)),r(Ql(n)))},addSelectedEdges:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:i,triggerEdgeChanges:r}=f();t?r(e.map(e=>Ul(e,!0))):(r(Ql(n,new Set([...e]))),i(Ql(o,new Set,!0)))},unselectNodesAndEdges:({nodes:e,edges:t}={})=>{const{edges:n,nodes:o,nodeLookup:i,triggerNodeChanges:r,triggerEdgeChanges:s}=f(),a=t||n,l=(e||o).map(e=>{const t=i.get(e.id);return t&&(t.selected=!1),Ul(e.id,!1)}),c=a.map(e=>Ul(e.id,!1));r(l),s(c)},setMinZoom:e=>{const{panZoom:t,maxZoom:n}=f();null==t||t.setScaleExtent([e,n]),h({minZoom:e})},setMaxZoom:e=>{const{panZoom:t,minZoom:n}=f();null==t||t.setScaleExtent([n,e]),h({maxZoom:e})},setTranslateExtent:e=>{var t;null==(t=f().panZoom)||t.setTranslateExtent(e),h({translateExtent:e})},resetSelectedElements:()=>{const{edges:e,nodes:t,triggerNodeChanges:n,triggerEdgeChanges:o,elementsSelectable:i}=f();if(!i)return;const r=t.reduce((e,t)=>t.selected?[...e,Ul(t.id,!1)]:e,[]),s=e.reduce((e,t)=>t.selected?[...e,Ul(t.id,!1)]:e,[]);n(r),o(s)},setNodeExtent:e=>{const{nodes:t,nodeLookup:n,parentLookup:o,nodeOrigin:i,elevateNodesOnSelect:r,nodeExtent:s}=f();e[0][0]===s[0][0]&&e[0][1]===s[0][1]&&e[1][0]===s[1][0]&&e[1][1]===s[1][1]||(ya(t,n,o,{nodeOrigin:i,nodeExtent:e,elevateNodesOnSelect:r,checkEquality:!1}),h({nodeExtent:e}))},panBy:e=>{const{transform:t,width:n,height:o,panZoom:i,translateExtent:r}=f();return async function({delta:e,panZoom:t,transform:n,translateExtent:o,width:i,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[i,r]],o),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}({delta:e,panZoom:i,transform:t,translateExtent:r,width:n,height:o})},setCenter:async(e,t,n)=>{const{width:o,height:i,maxZoom:r,panZoom:s}=f();if(!s)return Promise.resolve(!1);const a=void 0!==(null==n?void 0:n.zoom)?n.zoom:r;return await s.setViewport({x:o/2-e*a,y:i/2-t*a,zoom:a},{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{h({connection:{...Ur}})},updateConnection:e=>{h({connection:e})},reset:()=>h({...zd()})}},f=Object.is,h?fl(h,f):fl;var h,f};function Od({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:i,initialHeight:r,initialMinZoom:a,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:u,nodeExtent:h,children:f}){const[p]=s.useState(()=>Rd({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:d,minZoom:a,maxZoom:l,fitViewOptions:c,nodeOrigin:u,nodeExtent:h}));return b.jsx(ml,{value:p,children:b.jsx(sc,{children:f})})}function Bd({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:i,width:r,height:a,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:u,nodeOrigin:h,nodeExtent:f}){return s.useContext(gl)?b.jsx(b.Fragment,{children:e}):b.jsx(Od,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:i,initialWidth:r,initialHeight:a,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:u,nodeOrigin:h,nodeExtent:f,children:e})}const Ld={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};var Td,$d,Vd=nc(function({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:i,nodeTypes:r,edgeTypes:a,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:u,onMoveStart:h,onMoveEnd:f,onConnect:p,onConnectStart:g,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,onNodeMouseEnter:v,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:C,onNodeDoubleClick:N,onNodeDragStart:k,onNodeDrag:E,onNodeDragStop:M,onNodesDelete:_,onEdgesDelete:j,onDelete:P,onSelectionChange:I,onSelectionDragStart:A,onSelectionDrag:D,onSelectionDragStop:z,onSelectionContextMenu:R,onSelectionStart:O,onSelectionEnd:B,onBeforeDelete:L,connectionMode:T,connectionLineType:$=Qr.Bezier,connectionLineStyle:V,connectionLineComponent:H,connectionLineContainerStyle:F,deleteKeyCode:X="Backspace",selectionKeyCode:Y="Shift",selectionOnDrag:Z=!1,selectionMode:K=qr.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:q=(zs()?"Meta":"Control"),zoomActivationKeyCode:G=(zs()?"Meta":"Control"),snapToGrid:U,snapGrid:Q,onlyRenderVisibleElements:J=!1,selectNodesOnDrag:ee,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:ie,nodeOrigin:re=Ol,edgesFocusable:se,edgesReconnectable:ae,elementsSelectable:le=!0,defaultViewport:ce=Bl,minZoom:de=.5,maxZoom:ue=2,translateExtent:he=Hr,preventScrolling:fe=!0,nodeExtent:pe,defaultMarkerColor:ge="#b1b1b7",zoomOnScroll:me=!0,zoomOnPinch:ye=!0,panOnScroll:xe=!1,panOnScrollSpeed:ve=.5,panOnScrollMode:be=Kr.Free,zoomOnDoubleClick:we=!0,panOnDrag:Se=!0,onPaneClick:Ce,onPaneMouseEnter:Ne,onPaneMouseMove:ke,onPaneMouseLeave:Ee,onPaneScroll:Me,onPaneContextMenu:_e,paneClickDistance:je=0,nodeClickDistance:Pe=0,children:Ie,onReconnect:Ae,onReconnectStart:De,onReconnectEnd:ze,onEdgeContextMenu:Re,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Be,onEdgeMouseMove:Le,onEdgeMouseLeave:Te,reconnectRadius:$e=10,onNodesChange:Ve,onEdgesChange:He,noDragClassName:Fe="nodrag",noWheelClassName:Xe="nowheel",noPanClassName:Ye="nopan",fitView:Ze,fitViewOptions:Ke,connectOnClick:We,attributionPosition:qe,proOptions:Ge,defaultEdgeOptions:Ue,elevateNodesOnSelect:Qe,elevateEdgesOnSelect:Je,disableKeyboardA11y:et=!1,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,connectionRadius:it,isValidConnection:rt,onError:st,style:at,id:lt,nodeDragThreshold:ct,connectionDragThreshold:dt,viewport:ut,onViewportChange:ht,width:ft,height:pt,colorMode:gt="light",debug:mt,onScroll:yt,ariaLabelConfig:xt,...vt},bt){const wt=lt||"1",St=function(e){var t;const[n,o]=s.useState("system"===e?null:e);return s.useEffect(()=>{if("system"!==e)return void o(e);const t=Hl(),n=()=>o((null==t?void 0:t.matches)?"dark":"light");return n(),null==t||t.addEventListener("change",n),()=>{null==t||t.removeEventListener("change",n)}},[e]),null!==n?n:(null==(t=Hl())?void 0:t.matches)?"dark":"light"}(gt),Ct=s.useCallback(e=>{e.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),null==yt||yt(e)},[yt]);return b.jsx("div",{"data-testid":"rf__wrapper",...vt,onScroll:Ct,style:{...at,...Ld},ref:bt,className:$t(["react-flow",i,St]),id:lt,role:"application",children:b.jsxs(Bd,{nodes:e,edges:t,width:ft,height:pt,fitView:Ze,fitViewOptions:Ke,minZoom:de,maxZoom:ue,nodeOrigin:re,nodeExtent:pe,children:[b.jsx(Dd,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:v,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:C,onNodeDoubleClick:N,nodeTypes:r,edgeTypes:a,connectionLineType:$,connectionLineStyle:V,connectionLineComponent:H,connectionLineContainerStyle:F,selectionKeyCode:Y,selectionOnDrag:Z,selectionMode:K,deleteKeyCode:X,multiSelectionKeyCode:q,panActivationKeyCode:W,zoomActivationKeyCode:G,onlyRenderVisibleElements:J,defaultViewport:ce,translateExtent:he,minZoom:de,maxZoom:ue,preventScrolling:fe,zoomOnScroll:me,zoomOnPinch:ye,zoomOnDoubleClick:we,panOnScroll:xe,panOnScrollSpeed:ve,panOnScrollMode:be,panOnDrag:Se,onPaneClick:Ce,onPaneMouseEnter:Ne,onPaneMouseMove:ke,onPaneMouseLeave:Ee,onPaneScroll:Me,onPaneContextMenu:_e,paneClickDistance:je,nodeClickDistance:Pe,onSelectionContextMenu:R,onSelectionStart:O,onSelectionEnd:B,onReconnect:Ae,onReconnectStart:De,onReconnectEnd:ze,onEdgeContextMenu:Re,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Be,onEdgeMouseMove:Le,onEdgeMouseLeave:Te,reconnectRadius:$e,defaultMarkerColor:ge,noDragClassName:Fe,noWheelClassName:Xe,noPanClassName:Ye,rfId:wt,disableKeyboardA11y:et,nodeExtent:pe,viewport:ut,onViewportChange:ht}),b.jsx(Vl,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:p,onConnectStart:g,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:ie,edgesFocusable:se,edgesReconnectable:ae,elementsSelectable:le,elevateNodesOnSelect:Qe,elevateEdgesOnSelect:Je,minZoom:de,maxZoom:ue,nodeExtent:pe,onNodesChange:Ve,onEdgesChange:He,snapToGrid:U,snapGrid:Q,connectionMode:T,translateExtent:he,connectOnClick:We,defaultEdgeOptions:Ue,fitView:Ze,fitViewOptions:Ke,onNodesDelete:_,onEdgesDelete:j,onDelete:P,onNodeDragStart:k,onNodeDrag:E,onNodeDragStop:M,onSelectionDrag:D,onSelectionDragStart:A,onSelectionDragStop:z,onMove:u,onMoveStart:h,onMoveEnd:f,noPanClassName:Ye,nodeOrigin:re,rfId:wt,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,onError:st,connectionRadius:it,isValidConnection:rt,selectNodesOnDrag:ee,nodeDragThreshold:ct,connectionDragThreshold:dt,onBeforeDelete:L,debug:mt,ariaLabelConfig:xt}),b.jsx(Rl,{onSelectionChange:I}),Ie,b.jsx(jl,{proOptions:Ge,position:qe}),b.jsx(Ml,{rfId:wt,disableKeyboardA11y:et})]})})});function Hd({dimensions:e,lineWidth:t,variant:n,className:o}){return b.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:$t(["react-flow__background-pattern",n,o])})}function Fd({radius:e,className:t}){return b.jsx("circle",{cx:e,cy:e,r:e,className:$t(["react-flow__background-pattern","dots",t])})}($d=Td||(Td={})).Lines="lines",$d.Dots="dots",$d.Cross="cross";const Xd={[Td.Dots]:1,[Td.Lines]:1,[Td.Cross]:6},Yd=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Zd({id:e,variant:t=Td.Dots,gap:n=20,size:o,lineWidth:i=1,offset:r=0,color:a,bgColor:l,style:c,className:d,patternClassName:u}){const h=s.useRef(null),{transform:f,patternId:p}=xl(Yd,pl),g=o||Xd[t],m=t===Td.Dots,y=t===Td.Cross,x=Array.isArray(n)?n:[n,n],v=[x[0]*f[2]||1,x[1]*f[2]||1],w=g*f[2],S=Array.isArray(r)?r:[r,r],C=y?[w,w]:v,N=[S[0]*f[2]||1+C[0]/2,S[1]*f[2]||1+C[1]/2],k=`${p}${e||""}`;return b.jsxs("svg",{className:$t(["react-flow__background",d]),style:{...c,...uc,"--xy-background-color-props":l,"--xy-background-pattern-color-props":a},ref:h,"data-testid":"rf__background",children:[b.jsx("pattern",{id:k,x:f[0]%v[0],y:f[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`,children:m?b.jsx(Fd,{radius:w/2,className:u}):b.jsx(Hd,{dimensions:C,lineWidth:i,variant:t,className:u})}),b.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}Zd.displayName="Background";const Kd=s.memo(Zd);function Wd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:b.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function qd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:b.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Gd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:b.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Ud(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Qd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Jd({children:e,className:t,...n}){return b.jsx("button",{type:"button",className:$t(["react-flow__controls-button",t]),...n,children:e})}const eu=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function tu({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:i,onZoomIn:r,onZoomOut:s,onFitView:a,onInteractiveChange:l,className:c,children:d,position:u="bottom-left",orientation:h="vertical","aria-label":f}){const p=vl(),{isInteractive:g,minZoomReached:m,maxZoomReached:y,ariaLabelConfig:x}=xl(eu,pl),{zoomIn:v,zoomOut:w,fitView:S}=lc(),C="horizontal"===h?"horizontal":"vertical";return b.jsxs(_l,{className:$t(["react-flow__controls",C,c]),position:u,style:e,"data-testid":"rf__controls","aria-label":f??x["controls.ariaLabel"],children:[t&&b.jsxs(b.Fragment,{children:[b.jsx(Jd,{onClick:()=>{v(),null==r||r()},className:"react-flow__controls-zoomin",title:x["controls.zoomIn.ariaLabel"],"aria-label":x["controls.zoomIn.ariaLabel"],disabled:y,children:b.jsx(Wd,{})}),b.jsx(Jd,{onClick:()=>{w(),null==s||s()},className:"react-flow__controls-zoomout",title:x["controls.zoomOut.ariaLabel"],"aria-label":x["controls.zoomOut.ariaLabel"],disabled:m,children:b.jsx(qd,{})})]}),n&&b.jsx(Jd,{className:"react-flow__controls-fitview",onClick:()=>{S(i),null==a||a()},title:x["controls.fitView.ariaLabel"],"aria-label":x["controls.fitView.ariaLabel"],children:b.jsx(Gd,{})}),o&&b.jsx(Jd,{className:"react-flow__controls-interactive",onClick:()=>{p.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),null==l||l(!g)},title:x["controls.interactive.ariaLabel"],"aria-label":x["controls.interactive.ariaLabel"],children:g?b.jsx(Qd,{}):b.jsx(Ud,{})}),d]})}tu.displayName="Controls";const nu=s.memo(tu);const ou=s.memo(function({id:e,x:t,y:n,width:o,height:i,style:r,color:s,strokeColor:a,strokeWidth:l,className:c,borderRadius:d,shapeRendering:u,selected:h,onClick:f}){const{background:p,backgroundColor:g}=r||{},m=s||p||g;return b.jsx("rect",{className:$t(["react-flow__minimap-node",{selected:h},c]),x:t,y:n,rx:d,ry:d,width:o,height:i,style:{fill:m,stroke:a,strokeWidth:l},shapeRendering:u,onClick:f?t=>f(t,e):void 0})}),iu=e=>e.nodes.map(e=>e.id),ru=e=>e instanceof Function?e:()=>e;const su=s.memo(function({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:i,nodeStrokeWidth:r,shapeRendering:s,NodeComponent:a,onClick:l}){const{node:c,x:d,y:u,width:h,height:f}=xl(t=>{const{internals:n}=t.nodeLookup.get(e),o=n.userNode,{x:i,y:r}=n.positionAbsolute,{width:s,height:a}=Os(o);return{node:o,x:i,y:r,width:s,height:a}},pl);return c&&!c.hidden&&Bs(c)?b.jsx(a,{x:d,y:u,width:h,height:f,style:c.style,selected:!!c.selected,className:o(c),color:t(c),borderRadius:i,strokeColor:n(c),strokeWidth:r,shapeRendering:s,onClick:l,id:c.id}):null});var au=s.memo(function({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:i,nodeComponent:r=ou,onClick:s}){const a=xl(iu,pl),l=ru(t),c=ru(e),d=ru(n),u="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return b.jsx(b.Fragment,{children:a.map(e=>b.jsx(su,{id:e,nodeColorFunc:l,nodeStrokeColorFunc:c,nodeClassNameFunc:d,nodeBorderRadius:o,nodeStrokeWidth:i,NodeComponent:r,onClick:s,shapeRendering:u},e))})});const lu=e=>!e.hidden,cu=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?Ns(cs(e.nodeLookup,{filter:lu}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}};function du({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:i="",nodeBorderRadius:r=5,nodeStrokeWidth:a,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:u,maskStrokeWidth:h,position:f="bottom-right",onClick:p,onNodeClick:g,pannable:m=!1,zoomable:y=!1,ariaLabel:x,inversePan:v,zoomStep:w=1,offsetScale:S=5}){const C=vl(),N=s.useRef(null),{boundingRect:k,viewBB:E,rfId:M,panZoom:_,translateExtent:j,flowWidth:P,flowHeight:I,ariaLabelConfig:A}=xl(cu,pl),D=(null==e?void 0:e.width)??200,z=(null==e?void 0:e.height)??150,R=k.width/D,O=k.height/z,B=Math.max(R,O),L=B*D,T=B*z,$=S*B,V=k.x-(L-k.width)/2-$,H=k.y-(T-k.height)/2-$,F=L+2*$,X=T+2*$,Y=`react-flow__minimap-desc-${M}`,Z=s.useRef(0),K=s.useRef();Z.current=B,s.useEffect(()=>{if(N.current&&_)return K.current=function({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const i=ro(e);return{update:function({translateExtent:e,width:r,height:s,zoomStep:a=1,pannable:l=!0,zoomable:c=!0,inversePan:d=!1}){let u=[0,0];const h=Ir().on("start",e=>{"mousedown"!==e.sourceEvent.type&&"touchstart"!==e.sourceEvent.type||(u=[e.sourceEvent.clientX??e.sourceEvent.touches[0].clientX,e.sourceEvent.clientY??e.sourceEvent.touches[0].clientY])}).on("zoom",l?i=>{const a=n();if("mousemove"!==i.sourceEvent.type&&"touchmove"!==i.sourceEvent.type||!t)return;const l=[i.sourceEvent.clientX??i.sourceEvent.touches[0].clientX,i.sourceEvent.clientY??i.sourceEvent.touches[0].clientY],c=[l[0]-u[0],l[1]-u[1]];u=l;const h=o()*Math.max(a[2],Math.log(a[2]))*(d?-1:1),f={x:a[0]-c[0]*h,y:a[1]-c[1]*h},p=[[0,0],[r,s]];t.setViewportConstrained({x:f.x,y:f.y,zoom:a[2]},p,e)}:null).on("zoom.wheel",c?e=>{if("wheel"!==e.sourceEvent.type||!t)return;const o=n(),i=e.sourceEvent.ctrlKey&&zs()?10:1,r=-e.sourceEvent.deltaY*(1===e.sourceEvent.deltaMode?.05:e.sourceEvent.deltaMode?1:.002)*a,s=o[2]*Math.pow(2,r*i);t.scaleTo(s)}:null);i.call(h,{})},destroy:function(){i.on("zoom",null)},pointer:so}}({domNode:N.current,panZoom:_,getTransform:()=>C.getState().transform,getViewScale:()=>Z.current}),()=>{var e;null==(e=K.current)||e.destroy()}},[_]),s.useEffect(()=>{var e;null==(e=K.current)||e.update({translateExtent:j,width:P,height:I,inversePan:v,pannable:m,zoomStep:w,zoomable:y})},[m,y,v,w,j,P,I]);const W=p?e=>{var t;const[n,o]=(null==(t=K.current)?void 0:t.pointer(e))||[0,0];p(e,{x:n,y:o})}:void 0,q=g?s.useCallback((e,t)=>{const n=C.getState().nodeLookup.get(t).internals.userNode;g(e,n)},[]):void 0,G=x??A["minimap.ariaLabel"];return b.jsx(_l,{position:f,style:{...e,"--xy-minimap-background-color-props":"string"==typeof c?c:void 0,"--xy-minimap-mask-background-color-props":"string"==typeof d?d:void 0,"--xy-minimap-mask-stroke-color-props":"string"==typeof u?u:void 0,"--xy-minimap-mask-stroke-width-props":"number"==typeof h?h*B:void 0,"--xy-minimap-node-background-color-props":"string"==typeof o?o:void 0,"--xy-minimap-node-stroke-color-props":"string"==typeof n?n:void 0,"--xy-minimap-node-stroke-width-props":"number"==typeof a?a:void 0},className:$t(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:b.jsxs("svg",{width:D,height:z,viewBox:`${V} ${H} ${F} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Y,ref:N,onClick:W,children:[G&&b.jsx("title",{id:Y,children:G}),b.jsx(au,{onClick:q,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:i,nodeStrokeWidth:a,nodeComponent:l}),b.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-$},${H-$}h${F+2*$}v${X+2*$}h${-F-2*$}z\n        M${E.x},${E.y}h${E.width}v${E.height}h${-E.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}du.displayName="MiniMap",s.memo(du);const uu={[Va.Line]:"right",[Va.Handle]:"bottom-right"};s.memo(function({nodeId:e,position:t,variant:n=Va.Handle,className:o,style:i,children:r,color:a,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:h=!1,resizeDirection:f,autoScale:p=!0,shouldResize:g,onResizeStart:m,onResize:y,onResizeEnd:x}){const v=Nc(),w="string"==typeof e?e:v,S=vl(),C=s.useRef(null),N=n===Va.Handle,k=xl(s.useCallback((E=N&&p,e=>E?`${Math.max(1/e.transform[2],1)}`:void 0),[N,p]),pl);var E;const M=s.useRef(null),_=t??uu[n];s.useEffect(()=>{if(C.current&&w)return M.current||(M.current=Ua({domNode:C.current,nodeId:w,getStoreItems:()=>{const{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:i,domNode:r}=S.getState();return{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:i,paneDomNode:r}},onChange:(e,t)=>{const{triggerNodeChanges:n,nodeLookup:o,parentLookup:i,nodeOrigin:r}=S.getState(),s=[],a={x:e.x,y:e.y},l=o.get(w);if(l&&l.expandParent&&l.parentId){const t=l.origin??r,n=e.width??l.measured.width??0,c=e.height??l.measured.height??0,d=ba([{id:l.id,parentId:l.parentId,rect:{width:n,height:c,...Ls({x:e.x??l.position.x,y:e.y??l.position.y},{width:n,height:c},l.parentId,o,t)}}],o,i,r);s.push(...d),a.x=e.x?Math.max(t[0]*n,e.x):void 0,a.y=e.y?Math.max(t[1]*c,e.y):void 0}if(void 0!==a.x&&void 0!==a.y){const e={id:w,type:"position",position:{...a}};s.push(e)}if(void 0!==e.width&&void 0!==e.height){const t={id:w,type:"dimensions",resizing:!0,setAttributes:!f||("horizontal"===f?"width":"height"),dimensions:{width:e.width,height:e.height}};s.push(t)}for(const c of t){const e={...c,type:"position"};s.push(e)}n(s)},onEnd:({width:e,height:t})=>{const n={id:w,type:"dimensions",resizing:!1,dimensions:{width:e,height:t}};S.getState().triggerNodeChanges([n])}})),M.current.update({controlPosition:_,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:u},keepAspectRatio:h,resizeDirection:f,onResizeStart:m,onResize:y,onResizeEnd:x,shouldResize:g}),()=>{var e;null==(e=M.current)||e.destroy()}},[_,l,c,d,u,h,m,y,x,g]);const j=_.split("-");return b.jsx("div",{className:$t(["react-flow__resize-control","nodrag",...j,n,o]),ref:C,style:{...i,scale:k,...a&&{[N?"backgroundColor":"borderColor"]:a}},children:r})});const hu={statusNode:({data:e})=>b.jsxs("div",{className:"relative",children:[b.jsx(Ec,{type:"target",position:ns.Left,style:{background:"#555"}}),b.jsx(G,{status:e.status,size:e.size,responsive:e.responsive,disabled:!e.isActive}),b.jsx(Ec,{type:"source",position:ns.Right,style:{background:"#555"}})]})},fu=({status:e="Storing",listedMode:t="Selling",className:n,size:o="md",responsive:i=!0,showControls:r=!1,showBackground:a=!0,draggable:l=!1,fixedSize:c=!1})=>{const d=s.useCallback(n=>{if(!e)return!1;return({Storing:["Storing"],Selling:["Storing","Selling"],Auctioning:["Storing","Auctioning"],Paid:["Storing",t,"Paid"],Refunding:["Storing",t,"Paid","Refunding"],InSecrecy:["Storing",t,"Paid","InSecrecy"],Published:["Storing",t,"Paid","InSecrecy","Published"],Blacklisted:["Storing","Blacklisted"]}[e]||[]).includes(n)},[e,t]),u=s.useCallback(()=>{const e={sm:{storing:{x:0,y:40},selling:{x:120,y:20},auctioning:{x:120,y:60},paid:{x:240,y:40},inSecrecy:{x:360,y:20},refunding:{x:360,y:60},published:{x:480,y:40}},md:{storing:{x:0,y:60},selling:{x:150,y:30},auctioning:{x:150,y:90},paid:{x:300,y:60},inSecrecy:{x:450,y:30},refunding:{x:450,y:90},published:{x:600,y:60}},lg:{storing:{x:0,y:80},selling:{x:200,y:40},auctioning:{x:200,y:120},paid:{x:400,y:80},inSecrecy:{x:600,y:40},refunding:{x:600,y:120},published:{x:800,y:80}}};return e[o]||e.md},[o]),h=s.useCallback(()=>{const t=u();return[{id:"storing",position:t.storing,data:{status:"Storing",isActive:d("Storing"),isCurrent:"Storing"===e,size:o,responsive:i},type:"statusNode"},{id:"selling",position:t.selling,data:{status:"Selling",isActive:d("Selling"),isCurrent:"Selling"===e,size:o,responsive:i},type:"statusNode"},{id:"auctioning",position:t.auctioning,data:{status:"Auctioning",isActive:d("Auctioning"),isCurrent:"Auctioning"===e,size:o,responsive:i},type:"statusNode"},{id:"paid",position:t.paid,data:{status:"Paid",isActive:d("Paid"),isCurrent:"Paid"===e,size:o,responsive:i},type:"statusNode"},{id:"inSecrecy",position:t.inSecrecy,data:{status:"InSecrecy",isActive:d("InSecrecy"),isCurrent:"InSecrecy"===e,size:o,responsive:i},type:"statusNode"},{id:"refunding",position:t.refunding,data:{status:"Refunding",isActive:d("Refunding"),isCurrent:"Refunding"===e,size:o,responsive:i},type:"statusNode"},{id:"published",position:t.published,data:{status:"Published",isActive:d("Published"),isCurrent:"Published"===e,size:o,responsive:i},type:"statusNode"}]},[u,d,e,o,i]),f=s.useMemo(()=>[{id:"storing-selling",source:"storing",target:"selling"},{id:"storing-auctioning",source:"storing",target:"auctioning"},{id:"selling-paid",source:"selling",target:"paid"},{id:"auctioning-paid",source:"auctioning",target:"paid"},{id:"paid-inSecrecy",source:"paid",target:"inSecrecy"},{id:"paid-refunding",source:"paid",target:"refunding"},{id:"inSecrecy-published",source:"inSecrecy",target:"published"},{id:"refunding-published",source:"refunding",target:"published"}],[]),[p,g,m]=function(e){const[t,n]=s.useState(e),o=s.useCallback(e=>n(t=>ql(e,t)),[]);return[t,n,o]}(h()),[y,x,v]=function(e){const[t,n]=s.useState(e),o=s.useCallback(e=>n(t=>Gl(e,t)),[]);return[t,n,o]}(f);s.useEffect(()=>{g(h())},[h,g]);const w=s.useCallback(e=>x(t=>na(e,t)),[]),C=s.useCallback(()=>{const e={sm:"80px",md:"120px",lg:"160px"};return e[o]||e.md},[o]),N=s.useCallback(()=>{const e={sm:"720px",md:"920px",lg:"1120px"};return e[o]||e.md},[o]);return b.jsx("div",{className:S("bg-background ",n),style:{height:c?C():"100%",width:c?N():"100%",position:"relative",overflow:"hidden"},children:b.jsxs(Vd,{nodes:p,edges:y,onNodesChange:m,onEdgesChange:v,onConnect:w,nodeTypes:hu,fitView:!0,fitViewOptions:{padding:.3},nodesDraggable:l,nodesConnectable:!1,elementsSelectable:!1,panOnDrag:!1,zoomOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,preventScrolling:!1,proOptions:{hideAttribution:!0},children:[a&&b.jsx(Kd,{}),r&&b.jsx(nu,{})]},`flow-${y.length}-${p.length}`)})},pu=({status:e,listedMode:t,className:n,size:o="md",responsive:i=!0,showBackground:r=!0,showIndicator:a=!0,enableHorizontalScroll:l=!1})=>(s.useEffect(()=>{l&&(e=>{const t=document.querySelector(`#status-step-flow-${e}`);t&&t.scrollIntoView({behavior:"smooth",inline:"center"})})(e)},[l,e]),b.jsxs("div",{className:S("bg-background relative",n),style:{width:"100%",position:"relative"},children:[l&&a&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"absolute left-0 top-0 w-8 h-full bg-gradient-to-r from-background via-background/80 to-transparent z-10 flex items-center justify-start pl-1 pointer-events-none",children:b.jsx(Ee,{className:"w-4 h-4 text-muted-foreground/60 animate-pulse"})}),b.jsx("div",{className:"absolute right-0 top-0 w-8 h-full bg-gradient-to-l from-background via-background/80 to-transparent z-10 flex items-center justify-end pr-1 pointer-events-none",children:b.jsx(Me,{className:"w-4 h-4 text-muted-foreground/60 animate-pulse"})})]}),b.jsx("div",{className:S(l&&"status-step-flow-container"),style:l?{overflowX:"auto",overflowY:"hidden",width:"100%"}:{width:"100%",overflow:"hidden"},children:b.jsx("div",{style:l?{display:"flex",justifyContent:"center",alignItems:"center",minWidth:"fit-content",width:"max-content"}:{width:"100%",height:"100%"},children:b.jsx(fu,{status:e,listedMode:"Auctioning"!==t?"Selling":t,size:o,responsive:i,showBackground:r,fixedSize:l})})})]})),gu=({value:e,unit:t,size:n,responsive:o=!0})=>{const i=s.useMemo(()=>{const e={sm:{number:o?"text-xl sm:text-2xl lg:text-3xl":"text-2xl",unit:o?"text-sm sm:text-base":"text-base",padding:o?"px-2 py-1 sm:px-3 sm:py-2":"px-3 py-2",spacing:o?"ml-1 mr-1 sm:ml-1 sm:mr-2":"ml-1 mr-2"},md:{number:o?"text-2xl sm:text-3xl lg:text-4xl":"text-3xl",unit:o?"text-base sm:text-lg":"text-lg",padding:o?"px-3 py-2 sm:px-4 sm:py-3 lg:px-5 lg:py-4":"px-4 py-3",spacing:o?"ml-1 mr-2 sm:ml-2 sm:mr-3 lg:mr-3":"ml-2 mr-3"},lg:{number:o?"text-3xl sm:text-4xl lg:text-5xl":"text-4xl",unit:o?"text-lg sm:text-xl":"text-xl",padding:o?"px-4 py-3 sm:px-5 sm:py-4 lg:px-6 lg:py-5":"px-5 py-4",spacing:o?"ml-2 mr-3 sm:ml-2 sm:mr-4 lg:mr-4":"ml-2 mr-4"}};return e[n]||e.md},[n,o]);return b.jsxs("div",{className:"flex items-baseline",children:[b.jsx("span",{className:S("font-medium text-foreground bg-secondary rounded-lg transition-all duration-200",i.number,i.padding),children:e.toString().padStart(2,"0")}),b.jsx("span",{className:S("text-muted-foreground font-normal",i.unit,i.spacing),children:t})]})},mu=({targetTime:e,size:t="md",className:n,showStatus:o=!0,customStatusText:i,onCountdownEnd:r,direction:a="vertical",responsive:l=!0})=>{const c=s.useCallback(()=>{const t=Math.floor(Date.now()/1e3),n=e-t;let o={days:0,hours:0,minutes:0,seconds:0};return n>0?(o={days:Math.floor(n/86400),hours:Math.floor(n/3600%24),minutes:Math.floor(n/60%60),seconds:Math.floor(n%60)},{timeLeft:o,status:"counting"}):{timeLeft:o,status:"ended"}},[e]),[d,u]=s.useState(()=>{const{timeLeft:e}=c();return e}),[h,f]=s.useState(()=>{const{status:e}=c();return e}),p=s.useMemo(()=>({counting:(null==i?void 0:i.counting)||"Countdown",ended:(null==i?void 0:i.ended)||"Countdown has ended"}),[i]),g=s.useMemo(()=>{const e={sm:{spacing:l?"space-y-2 sm:space-y-3":"space-y-3",statusText:l?"text-lg sm:text-xl":"text-xl",containerPadding:l?"p-3 sm:p-4":"p-4"},md:{spacing:l?"space-y-3 sm:space-y-4 lg:space-y-5":"space-y-4",statusText:l?"text-xl sm:text-2xl lg:text-3xl":"text-2xl",containerPadding:l?"p-4 sm:p-6 lg:p-8":"p-6"},lg:{spacing:l?"space-y-4 sm:space-y-6 lg:space-y-8":"space-y-6",statusText:l?"text-2xl sm:text-3xl lg:text-4xl":"text-3xl",containerPadding:l?"p-6 sm:p-8 lg:p-10":"p-8"}};return e[t]||e.md},[t,l]);s.useEffect(()=>{const e=setInterval(()=>{const{timeLeft:e,status:t}=c();u(e),h!==t&&(f(t),"ended"===t&&r&&r())},1e3);return()=>clearInterval(e)},[e,c,h,r]);const m=s.useMemo(()=>[{value:d.days,unit:"D",label:"Days"},{value:d.hours,unit:"H",label:"Hours"},{value:d.minutes,unit:"M",label:"Minutes"},{value:d.seconds,unit:"S",label:"Seconds"}],[d]),y=s.useMemo(()=>{const e="flex justify-center items-center";return"horizontal"===a?`${e} flex-row space-x-4 sm:space-x-6`:`${e} flex-col ${g.spacing}`},[a,g.spacing]),x=s.useMemo(()=>"flex flex-row justify-center items-center space-x-1 sm:space-x-2",[a]);return b.jsxs("div",{className:S("w-full bg-background rounded-lg border border-border/50 md:rounded-2xl",y,g.containerPadding,n),children:[o&&b.jsx("p",{className:S("text-center font-medium","counting"===h?"text-foreground":"text-muted-foreground",g.statusText),children:p[h]}),b.jsx("div",{className:x,children:m.map((e,n)=>b.jsx(gu,{value:e.value,unit:e.unit,size:t,responsive:l},e.unit))})]})},yu=()=>{const{roles:e}=Ae(e=>e.userState),{login:t,isLoading:n}=_();return(()=>{const{box:e,biddersIds:t}=Re(),{address:n,isConnected:o,chainId:i}=y()||{},{isValidateSession:r}=_(),{updateUserState:a}=Ae(),l=x(e=>{var t,o;const r=i||v;if(!r||!n)return"";const s=e.accounts[r];return s?(null==(t=s[n])?void 0:t.userId)??(null==(o=s[n.toLowerCase()])?void 0:o.userId)??"":""});s.useEffect(()=>{let i=[];if(a({roles:i}),!n||!o||!e)return;if(!r)return;const s=String(l).trim(),c=e.sellerId?String(e.sellerId).trim():"",d=e.buyerId?String(e.buyerId).trim():"",u=e.minterId?String(e.minterId).trim():"",h=e.completerId?String(e.completerId).trim():"";t&&t.length>0&&s&&""!==s&&t.some(e=>e===s)&&d!==s&&i.push("Bidder"),a({roles:((null==n?void 0:n.toLowerCase())===he.toLowerCase()&&i.push("Admin"),s&&""!==s&&(s===u&&i.push("Minter"),s===c&&i.push("Seller"),s===d&&i.push("Buyer"),s===h&&i.push("Completer")),0===i.length&&i.push("Other"),i)})},[n,o,e,l,r])})(),b.jsx("div",{className:"flex flex-col items-start justify-center",children:e.length>0?b.jsx(b.Fragment,{children:b.jsx(j,{showIcon:!0,message:`You are: ${e.join(", ")}`,description:"You can do the following actions:",type:"info"})}):b.jsx(b.Fragment,{children:b.jsx(j,{type:"warning",showIcon:!0,message:"You are: Guest, please login!",description:b.jsx(w,{direction:"vertical",size:"small",style:{width:"100%"},children:b.jsx(C,{type:"primary",block:!0,loading:n,onClick:()=>t(),children:"Login"})})})})})},xu={WTRC:4.8,"WROSE.S":.005,"WTRC.S":4.8},vu=({price:e,token:t,status:n})=>{const{getTokenPrice:o}={getTokenPrice:async(e,t)=>{const n=L.find(t=>t.address===e);if(!n)throw new Error(`Token ${e} not found`);const o=Number(z(BigInt(t),n.decimals));return xu[n.symbol]*o}},[i,r]=s.useState(0),a=P(t);s.useEffect(()=>{a&&o(a.address,Number(e)).then(e=>{r(e)})},[a,e]);const l="Published"!==n&&"Blacklisted"!==n;return b.jsx(b.Fragment,{children:l&&b.jsxs("div",{className:"flex items-baseline flex-row gap-2",children:[b.jsx(F,{children:"Price:"}),b.jsx(H,{size:"xl",price:e,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals}),i>0&&b.jsxs("span",{className:"flex items-baseline flex-row gap-2",children:[b.jsx(F,{children:"≈"}),b.jsx(H,{size:"lg",price:i,symbol:"USD"})]})]})})},bu=[{name:"Twitter",icon:b.jsx(J,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(e)}`,color:"hover:bg-primary/10 text-primary"},{name:"Facebook",icon:b.jsx(ee,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`,color:"hover:bg-primary/10 text-primary"},{name:"Telegram",icon:b.jsx(te,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://t.me/share/url?url=${encodeURIComponent(t)}&text=${encodeURIComponent(e)}`,color:"hover:bg-primary/10 text-primary"}],wu=({title:e="",description:t="",url:n="",className:o=""})=>{const i=e||t||"",r=n||("undefined"!=typeof window?window.location.href:"");return b.jsx("div",{className:`flex w-full flex-row gap-3 md:gap-4 justify-center items-center ${o}`,children:bu.map(e=>b.jsx("a",{href:e.getUrl(i,r),target:"_blank",rel:"noopener noreferrer","aria-label":`Share to ${e.name}`,className:`rounded-full p-1 md:p-2 shadow-sm transition-colors duration-150 ${e.color} hover:text-primary hover:scale-105`,children:b.jsx("div",{className:"w-4 h-4 md:w-5 md:h-5 flex items-center justify-center text-muted-foreground hover:text-primary ",children:e.icon})},e.name))})},Su=({tokenId:e})=>{const{box:t,metadataBox:n,isLoading:o}=Re(),[i,r]=s.useState(""),[a,l]=s.useState("Storing"),[c,d]=s.useState(""),[u,h]=s.useState(0),[f,p]=s.useState("");s.useEffect(()=>{t&&(l(t.status),r(t.price??""),h(Number(t.deadline)),p(t.acceptedToken??""),d(t.listedMode??"Selling"))},[t]);return o?b.jsx("div",{className:"w-full flex items-center justify-center py-12",children:b.jsx("div",{className:"text-muted-foreground text-lg",children:"Loading..."})}):b.jsxs("div",{className:"w-full space-y-4 md:space-y-6",children:[b.jsx(G,{status:a}),b.jsx(pu,{status:a,listedMode:c,size:"sm",enableHorizontalScroll:!0}),"Published"!==a&&b.jsxs(b.Fragment,{children:[b.jsx(mu,{targetTime:u,size:"sm"}),b.jsx("hr",{className:"border-border/50"})]}),(null==t?void 0:t.isInBlacklist)&&b.jsx(j,{message:"Warning",description:"The NFT is in blacklist, can't do anything!",type:"warning"}),b.jsx(vu,{status:a,price:i,token:f}),b.jsx(yu,{}),(()=>{switch(a){case"Storing":return b.jsx(Dt,{});case"Selling":return b.jsx(zt,{});case"Auctioning":return b.jsx(Rt,{});case"Paid":return b.jsx(Ot,{});case"Refunding":return b.jsx(Bt,{});case"InSecrecy":return b.jsx(Lt,{});case"Published":return b.jsx(Tt,{});default:return null}})(),b.jsx("hr",{className:"border-border/50"}),!1,b.jsx(wu,{title:(null==n?void 0:n.title)??"",description:(null==n?void 0:n.description)??"",image:(null==n?void 0:n.nftImage)??"",url:"undefined"!=typeof window?window.location.href:""})]})},Cu=()=>{const{tokenId:e}=T();return b.jsx(b.Fragment,{children:b.jsxs($,{className:"py-8 md:py-12 lg:py-16",children:[b.jsx("div",{className:"text-center mb-8 md:mb-12",children:b.jsx("p",{className:"text-xl text-muted-foreground md:text-2xl lg:text-3xl font-bold",children:"Only criminals fear the truth being revealed!"})}),b.jsx("div",{className:"bg-muted/30 backdrop-blur-sm rounded-2xl p-6 md:p-8 lg:p-12",children:b.jsx(ze,{boxId:e||"",children:b.jsxs("div",{className:"flex w-full flex-col lg:flex-row gap-8 lg:gap-12",children:[b.jsx("div",{className:"flex-1 lg:max-w-2xl",children:b.jsx(Oe,{tokenId:e||""})}),b.jsx("div",{className:"hidden lg:block w-px bg-border/50 self-stretch"}),b.jsx("div",{className:"flex-1 lg:max-w-xl",children:b.jsx(Su,{tokenId:e||""})})]})})})]})})};export{Cu as default};
